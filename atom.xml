<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>扬舲&#39;s blog</title>
  
  
  <link href="https://kobingogo.github.io/atom.xml" rel="self"/>
  
  <link href="https://kobingogo.github.io/"/>
  <updated>2022-02-07T02:52:27.794Z</updated>
  <id>https://kobingogo.github.io/</id>
  
  <author>
    <name>yangling</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>2021前端发展展望</title>
    <link href="https://kobingogo.github.io/2021%E5%89%8D%E7%AB%AF%E5%8F%91%E5%B1%95%E5%B1%95%E6%9C%9B/"/>
    <id>https://kobingogo.github.io/2021%E5%89%8D%E7%AB%AF%E5%8F%91%E5%B1%95%E5%B1%95%E6%9C%9B/</id>
    <published>2021-01-14T10:06:10.000Z</published>
    <updated>2022-02-07T02:52:27.794Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>又到了年底，想简单谈谈这一年前端的发展，以及21年可能会出现的一些趋势。毋庸置疑，2020年确实是不平凡的一年，对前端来说，私以为可以用“大前端持续深耕，泛前端兼容并包”这十四个字来形容。这里需要明确一下我对“大前端”以及“泛前端”这两个概念的理解：首先大前端可以分为广义的“大前端”和狭义的“大前端”，市面上常...</p></blockquote><span id="more"></span><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><div class="story post-story"><p><img src="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20210114180804.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20210114180804.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="20210114180804"></p><p>又到了年底，想简单谈谈这一年前端的发展，以及21年可能会出现的一些趋势。毋庸置疑，2020年确实是不平凡的一年，对前端来说，私以为可以用“大前端持续深耕，泛前端兼容并包”这十四个字来形容。这里需要明确一下我对“大前端”以及“泛前端”这两个概念的理解：首先大前端可以分为广义的“大前端”和狭义的“大前端”，市面上常说的大前端主要分为这两类，所谓广义的“大前端”是指以前端技术解决所有本属于其他领域问题的前端技术，这里其实是包含了后边所说的泛前端的概念，也就是说只要是使用前端技术去解决的都可以定义为“大前端”；而狭义的“大前端”是仅指垂直到后端领域的前端技术，其代表是以node.js为主的扩展的去解决后端领域的技术，如出现了诸如express、koa、egg、nest等等配套的后端技术框架，甚至出现了node的微服务框架，我这里不做说明仅指狭义的“大前端”概念。对于“泛前端”，这个概念没有歧义，通常指的都是跨端技术，比如客户端、桌面端，甚至HUB等等，上图中所示的仅仅指一部分框架，并未收录完全，毕竟js/ts的社区实在太太太太活跃了，下面简单分说一下“大前端”和“泛前端”个人的一些见解，是以前端三大框架Vue、React、Angular为核心进行横向和纵向的框架探讨</p><h3 id="泛前端技术框架探讨"><a href="#泛前端技术框架探讨" class="headerlink" title="泛前端技术框架探讨"></a>泛前端技术框架探讨</h3><table><thead><tr><th></th><th>Vue</th><th>React</th><th>Angular</th></tr></thead><tbody><tr><td>web端</td><td>Vue全家桶</td><td>React全家桶</td><td>Angular全家桶</td></tr><tr><td>桌面端</td><td>Electron/Nw</td><td>Electron/Nw</td><td>Electron/Nw/Cordova/Ionic</td></tr><tr><td>原生移动端</td><td>Weex</td><td>React Native</td><td>Cordova/Ionic</td></tr><tr><td>小程序端</td><td>uniapp/mpvue/mapx</td><td>taro/Rax</td><td>无</td></tr></tbody></table><h3 id="大前端技术框架探讨"><a href="#大前端技术框架探讨" class="headerlink" title="大前端技术框架探讨"></a>大前端技术框架探讨</h3><table><thead><tr><th></th><th>Vue</th><th>React</th><th>Angular</th></tr></thead><tbody><tr><td>web端</td><td>Vue全家桶</td><td>React全家桶</td><td>Angular全家桶</td></tr><tr><td>SSR</td><td>Nuxt</td><td>Next</td><td>Universal</td></tr><tr><td>服务端</td><td>无特定</td><td>无特定</td><td>可配合Nest</td></tr></tbody></table><p>今年<a href="https://mp.weixin.qq.com/s/Nm1G3jgS-fafEeNywTCtDA" target="_blank" rel="noopener external nofollow noreferrer">阿里前端练习生计划</a>将前端领域划分了七大方向，分别是工程化方向、前端中后台方向、Node.js方向、跨端技术方向、互动技术方向、可视化技术方向、前端智能化方向，个人认为Node.js是一个整体的前端基础，并不能单算做一个方向，因而我将其替换为音视频方向，私以为可将前端方向划分为以下几种，下面我将在这几个不同的方向维度进行个人的一些阐述和拙见：</p><ul><li>  中后台方向：微前端</li><li>  可视化方向：antv</li><li>  智能化方向：imgcook</li><li>  互动方向：Eva</li><li>  音视频方向：wasm</li><li>  工程化方向：severless、全链路工程</li><li>  跨端方向：kbone、rax</li></ul></div><h2 id="中后台方向"><a href="#中后台方向" class="headerlink" title="中后台方向"></a>中后台方向</h2><div class="story post-story"><ol><li> 对于中后台方向，这是传统web方向，对于前端来说，2020年对于微前端的落地应用已有很多实践。因此，私以为微前端会作为未来前端大型应用的一种趋势，对于不同团队的不同技术栈的汇总整合是一个比较好的方案，虽然不同于服务端的那种微服务可以微的很彻底，但是前端加持着ts等的特性也是可以实现微化的效果，从而优化工时，提升效率，避免重复劳作；</li><li> 既然第一点提到了ts，那这里我想说一说关于ts的问题，在19年我对ts的态度尚存观望，但在今年，我认为ts可以作为一种必备技能来考察和实践，并不是因为大家都在用，而是因为随着时间的发展，现在前端要承载的能力越来越重，项目也越来越大，ts可以很好的约定，对于后期的维护以及修改都可以很好的限制，对于大型团队、大型项目来说，ts是不二之选；另外，如果有团队真的要去开发服务端，那我真的建议你去用ts，如果你用过nest.js，你会发现和写java真的没什么区别，而且服务端的很多理念也可以通过ts的各种特性来使用，比如泛型、抽象类等。当然，如果是小团队，而且需要快速开发，对于小而美的应用，个人认为还是js适合，毕竟js是一门灵活的语言，哈哈哈</li></ol></div><h2 id="可视化方向"><a href="#可视化方向" class="headerlink" title="可视化方向"></a>可视化方向</h2><div class="story post-story"><ol><li> 可视化这里，今年其实没有做多少实践，但是个人认为，这七个大方向而言，最容易出成果，或者说最能出大佬的，可能还真是可视化领域，如果能在可视化领域做到了前5%，那么我相信各大厂肯定会花钱养着你，毕竟我拥有你不一定重要，但是对手不拥有你对我很重要，你的技术壁垒就呈现了出来，也就在这个内卷的江湖获得了一些领先和优势，最起码裁员的优先级也不会那么靠前，哈哈哈</li><li> 第一点说的有点儿远，说说实在的，个人觉得可以将阿里的antv作为可视化领域的一个标杆，针对各种特定领域进行展开，比如gis等，当然，其实可视化领域研究的深的话还是挺冷门的，这其实也会有一些机会，webGL/webAR/webVR等等都可以作为切入点，配合着下面的音视频领域，这两个的相互结合，确实还是能做出些东西的</li></ol></div><h2 id="智能化方向"><a href="#智能化方向" class="headerlink" title="智能化方向"></a>智能化方向</h2><div class="story post-story"><ol><li> 智能化领域，个人认为其实核心不在于前端，而在于人工智能，而人工智能领域就不仅仅前端那么些东西了，对于封装好的如TensorFlow.js，我们是直接拿来用的，但是对于领面的模型建立其实才是关键，如果有同学想在智能化领域有所发展，个人建议还是要深钻一下，最好可以深造一下，毕竟这个东西是真的需要学术研究+产业实践的</li><li> 在产业实践的前端领域，阿里还是比较领先的，比如imgcook，其核心目的是将图片转成前端代码，利用的机器视觉去识别图片中的不同的位置信息等，将其转成前端的代码，也就是所谓的D2C，即：Design to Code，今年的D2大会上又提出了P2C，即：Product to Code，但并不是真的将人类语言直接转换成code，而是对D2C的一个业务扩展，对于D2C某些业务代码利用一些特定的schema进行约定，让机器学习过程中多一些参数约束，从而提升代码实现度。虽然转化的代码还很冗余，但是对于一些初级的项目或页面，确实可以交给机器去实现，个人认为人工智能对低端重复的工作确实会进行替代，也算是对前端内卷做了一定的贡献，摊手...</li></ol></div><h2 id="互动方向"><a href="#互动方向" class="headerlink" title="互动方向"></a>互动方向</h2><div class="story post-story"><ol><li> 互动方向，目前大头还是在游戏方向，但是我还是认为页游或前端实现游戏主要还是做一些开胃菜的功能，并不能真正的将用户带进沉浸式的体验，对于小游戏引擎，今年阿里好像出了一个eva的引擎，感兴趣的同学可以看看</li><li> 对于新体验方面，AR/VR/MR等可能在明年5g深化的时候会有一些落地实践，但可能还是不温不火，互动方向配合设计的新理念可能会是一个新的突破点</li></ol></div><h2 id="音视频方向"><a href="#音视频方向" class="headerlink" title="音视频方向"></a>音视频方向</h2><div class="story post-story"><ol><li> 这里想说一说WebAssembly，虽然都说wasm是会替代掉js，但目前看应该还不太现实，wasm目前主要还是配合音视频领域多一些，另外就是一些额外的优化措施，配合rust进行优化等，如果有志于音视频领域有所建树的同学，wasm确实可以储备起来</li><li> webrtc是音视频领域一个绕不开的技术，另外就是播放器的实现，video.js、flv.js等，对于一些视频播放的协议也要了解，如rtmp/rtsp等，今年疫情的关系，带动着直播领域的火热，前端音视频方向说不定会是一个风口</li></ol></div><h2 id="工程化方向"><a href="#工程化方向" class="headerlink" title="工程化方向"></a>工程化方向</h2><div class="story post-story"><ol><li> 工程化方向就不得不提serverless，这是今年前端最火热的一个话题了，私以为serverless不仅仅是前端领域的变化，它可能改变目前的开发模式，以后没有前后端之分（ps：目前确实是有合的趋势），只有云工程师和端工程师之分，那么对于目前的前端来说，我们就不能仅仅只关注前端领域的一些内容了，docker、k8s等属于传统后端或运维的部分，我们也需要掌握，对于一些后端的思维及名词也需要熟悉，如限流、削峰、服务降级等。当然serverless的前提其实是云原生，如果没有云化，那实现serverless的效果应该不如目前这样，当然个人认为这是一个必然的趋势，从今年的云栖大会以及运营商5g云化来看，云网融合、云边协同应该会是主流</li><li> 前端工程化另外一个方向就是全链路的工程化，从脚手架、low code、插件市场等全链路的提供，简化前端开发门槛，这里可以参考淘系的飞冰，对low code以及ide的插件提供都有涉及，以及ui组件库的提供等等，形成一个全链路的前端生态。这里可以说说low code和no code，no code是一个无需任何编码的现成的工具，就是完全没有编程的入口；low code是一个需要部分编码的工具，为了是给一些非专业人士但又有编程需要的人员使用，强调开发出来给别人用，常见的比如给运营人员用的h5编辑器，如易企秀、maka、ih5等</li></ol></div><h2 id="跨端方向"><a href="#跨端方向" class="headerlink" title="跨端方向"></a>跨端方向</h2><div class="story post-story"><ol><li> 跨端方向是一个老生常谈的问题，主流还是要write once，run anywhere，常见的无非就是利用各种框架将各个DSL进行来回转换，但其实这是一个伪命题，本质是不可能达到大一统的局面的，抽象就很难具象，这两者需要有一个平衡，需要对具体常见具体分析</li><li> 私以为小程序领域是端方向下一个各家大佬追逐的市场，因为app领域的跑马圈地都已基本形成，现在再去开发出一个现象级的app几乎很难很难了，但是将app作为操作系统，以小程序去带动用户，形成用户闭环，还是有很大市场的，类小程序应用，如pwa、快应用等都是这种承载方式的不同展现，对跨端来说，这个不失为一种发展选择。对于小程序的框架也出现了kbone、rax等，可能也会有一个类似w3c这样的一个小程序标准，但是像微信这种巨无霸应用，是否真的会遵守就是另一回事了，总之，其实也不失为一个选择</li></ol></div><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><div class="story post-story"><p>回望2020，展望2021，总结如下：</p><ol><li> 大前端持续深耕，泛前端兼容并包</li><li> 中后台微服务化，可视化行业细化</li><li> 智能侧算法深化，互娱侧形态变化</li><li> 音视频结构优化，工程侧全面转化</li><li> 跨端侧具体改化，前端更加内卷化</li></ol><p>好了，2021到了，愿大家在这个内卷的时代，都有自己的一技之长，形成自己的核心竞争力，升职加薪，再创辉煌，共勉！！！</p><p>转载自<a href="https://segmentfault.com/a/1190000038768154" target="_blank" rel="noopener external nofollow noreferrer">Source</a></p></div>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;又到了年底，想简单谈谈这一年前端的发展，以及21年可能会出现的一些趋势。毋庸置疑，2020年确实是不平凡的一年，对前端来说，私以为可以用“大前端持续深耕，泛前端兼容并包”这十四个字来形容。这里需要明确一下我对“大前端”以及“泛前端”这两个概念的理解：首先大前端可以分为广义的“大前端”和狭义的“大前端”，市面上常...&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>css实现两个圆重叠</title>
    <link href="https://kobingogo.github.io/css-css%E5%AE%9E%E7%8E%B0%E4%B8%A4%E4%B8%AA%E5%9C%86%E9%87%8D%E5%8F%A0/"/>
    <id>https://kobingogo.github.io/css-css%E5%AE%9E%E7%8E%B0%E4%B8%A4%E4%B8%AA%E5%9C%86%E9%87%8D%E5%8F%A0/</id>
    <published>2021-01-07T09:04:27.000Z</published>
    <updated>2022-02-07T02:52:27.795Z</updated>
    
    <content type="html"><![CDATA[<p>工作中有一个需求，实现两个椭圆相交，并且相交区域颜色不同，类似于一个简单的<code>韦恩图</code>，如何用css实现这个效果？ 经过一番探索，找到了答案。</p><span id="more"></span><p>要实现这个效果，需要用到的神技：<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/mix-blend-mode#%E4%B8%8D%E5%90%8Cmix-blend-mode%E5%80%BC%E7%9A%84%E6%95%88%E6%9E%9C" target="_blank" rel="noopener external nofollow noreferrer"><code>css-blend-mode</code></a>, 它是一个css属性，描述了元素的内容应该与元素的直系父元素的内容和元素的背景如何混合。</p><p>有了这个，就可以愉快的直接上代码了：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;isolate&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;circle circle-1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;circle circle-2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.circle</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">110px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">70px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span> / <span class="number">35px</span>;</span><br><span class="line">  <span class="attribute">mix-blend-mode</span>: color-dodge;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.circle-1</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#39518A</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.circle-2</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#0091FF</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">40px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.isolate</span> &#123;</span><br><span class="line">  <span class="attribute">isolation</span>: isolate; <span class="comment">/* Without isolation, the background color will be taken into account */</span></span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>具体效果参见：<a href="https://codepen.io/jiangawait/pen/zYKaRZx" target="_blank" rel="noopener external nofollow noreferrer">例子</a></p><p>当然css-blend-mode不仅仅只有这点作用，它还能用作背景混合，纹理叠加，视频混合等场景，具体可参考：</p><p><a href="https://www.zhangxinxu.com/wordpress/2019/05/css-mix-blend-mode-screen/" target="_blank" rel="noopener external nofollow noreferrer">大神的文章</a></p><p>打完收工😊</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;工作中有一个需求，实现两个椭圆相交，并且相交区域颜色不同，类似于一个简单的&lt;code&gt;韦恩图&lt;/code&gt;，如何用css实现这个效果？ 经过一番探索，找到了答案。&lt;/p&gt;</summary>
    
    
    
    <category term="css" scheme="https://kobingogo.github.io/categories/css/"/>
    
    
    <category term="css" scheme="https://kobingogo.github.io/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>ES6全部特性汇总</title>
    <link href="https://kobingogo.github.io/javascript-ES6%E5%85%A8%E9%83%A8%E7%89%B9%E6%80%A7%E6%B1%87%E6%80%BB/"/>
    <id>https://kobingogo.github.io/javascript-ES6%E5%85%A8%E9%83%A8%E7%89%B9%E6%80%A7%E6%B1%87%E6%80%BB/</id>
    <published>2020-10-23T02:58:51.000Z</published>
    <updated>2022-02-07T09:15:01.277Z</updated>
    
    <content type="html"><![CDATA[<p>本文的知识点完全是参考或摘录<a href="https://es6.ruanyifeng.com/" target="_blank" rel="noopener external nofollow noreferrer">《ES6》</a>里的语句，有部分语句为了方便理解和记忆，进行了相同意思的转义，同时对知识点进行归类划分。为了让大家能集中精力来记住这些特性，全文一句废话和题外话都没有，全部模块以笔记的形式进行书写，如果看得不是很惯建议对照<a href="https://es6.ruanyifeng.com/" target="_blank" rel="noopener external nofollow noreferrer">《ES6》</a>的内容来学习。</p><p>本文整理出来的笔记都是书中的精华内容，囊括了整个<code>ES6体系</code>的所有特性，非常方便大家重新认识<code>全部ES6特性</code>。半小时的阅读就可对<code>ES6</code>有一个全面的了解，可认为是一本<code>ES6特性小字典</code>，收藏后可随时查阅。即使看不完也要拉到本文末尾喔，有个大彩蛋，嘻嘻！</p><span id="more"></span><p><img src="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20201023110159.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20201023110159.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="20201023110159"></p><h3 id="修正"><a href="#修正" class="headerlink" title="修正"></a>修正</h3><p><strong>ES6</strong>是<code>ECMA</code>为<code>JavaScript</code>制定的第6个标准版本，相关历史可查看此章节<a href="https://es6.ruanyifeng.com/#docs/intro" target="_blank" rel="noopener external nofollow noreferrer">《ES6-ECMAScript6简介》</a>。</p><p>标准委员会最终决定，标准在每年6月正式发布并作为当年的正式版本，接下来的时间里就在此版本的基础上进行改动，直到下一年6月草案就自然变成新一年的版本，这样一来就无需以前的版本号，只要用年份标记即可。<code>ECMAscript 2015</code>是在<code>2015年6月</code>发布ES6的第一个版本。以此类推，<code>ECMAscript 2016</code>是ES6的第二个版本、 <code>ECMAscript 2017</code>是ES6的第三个版本。<strong>ES6</strong>既是一个历史名词也是一个泛指，含义是<code>5.1版本</code>以后的<code>JavaScript下一代标准</code>，目前涵盖了<code>ES2015</code>、<code>ES2016</code>、<code>ES2017</code>、<code>ES2018</code>、<code>ES2019</code>、<code>ES2020</code>。</p><p>所以有些文章上提到的<code>ES7</code>(实质上是<code>ES2016</code>)、<code>ES8</code>(实质上是<code>ES2017</code>)、<code>ES9</code>(实质上是<code>ES2018</code>)、<code>ES10</code>(实质上是<code>ES2019</code>)、<code>ES11</code>(实质上是<code>ES2020</code>)，实质上都是一些不规范的概念。从ES1到ES6，每个标准都是花了好几年甚至十多年才制定下来，你一个ES6到ES7，ES7到ES8，才用了一年，按照这样的定义下去，那不是很快就ES20了。用正确的概念来说ES6目前涵盖了<strong>ES2015</strong>、<strong>ES2016</strong>、<strong>ES2017</strong>、<strong>ES2018</strong>、<strong>ES2019</strong>、<strong>ES2020</strong>。</p><p><img src="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20201023110231.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20201023110231.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="20201023110231"></p><p>另外，ES6更新的内容主要分为以下几点</p><ul><li>  <strong>表达式</strong>：声明、解构赋值</li><li>  <strong>内置对象</strong>：字符串扩展、数值扩展、对象扩展、数组扩展、函数扩展、正则扩展、Symbol、Set、Map、Proxy、Reflect</li><li>  <strong>语句与运算</strong>：Class、Module、Iterator</li><li>  <strong>异步编程</strong>：Promise、Generator、Async</li></ul><h2 id="ES2015"><a href="#ES2015" class="headerlink" title="ES2015"></a>ES2015</h2><div class="story post-story"><p><img src="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20201023110314.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20201023110314.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="20201023110314"></p><h3 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h3><ul><li>  <strong>const命令</strong>：声明常量</li><li>  <strong>let命令</strong>：声明变量</li></ul><blockquote><p>作用</p></blockquote><ul><li>作用域<ul><li>  <strong>全局作用域</strong></li><li>  <strong>函数作用域</strong>：<code>function() &#123;&#125;</code></li><li>  <strong>块级作用域</strong>：<code>&#123;&#125;</code></li></ul></li><li>作用范围<ul><li>  <code>var命令</code>在全局代码中执行</li><li>  <code>const命令</code>和<code>let命令</code>只能在代码块中执行</li></ul></li><li>赋值使用<ul><li>  <code>const命令</code>声明常量后必须立马赋值</li><li>  <code>let命令</code>声明变量后可立马赋值或使用时赋值</li></ul></li><li>  声明方法：<code>var</code>、<code>const</code>、<code>let</code>、<code>function</code>、<code>class</code>、<code>import</code></li></ul><blockquote><p>重点难点</p></blockquote><ul><li>  不允许重复声明</li><li>  未定义就使用会报错：<code>const命令</code>和<code>let命令</code>不存在变量提升</li><li>  暂时性死区：在代码块内使用<code>const命令</code>和<code>let命令</code>声明变量之前，该变量都不可用</li></ul><h3 id="解构赋值"><a href="#解构赋值" class="headerlink" title="解构赋值"></a>解构赋值</h3><ul><li>  <strong>字符串解构</strong>：<code>const [a, b, c, d, e] = &quot;hello&quot;</code></li><li>  <strong>数值解构</strong>：<code>const &#123; toString: s &#125; = 123</code></li><li>  <strong>布尔解构</strong>：<code>const &#123; toString: b &#125; = true</code></li><li><strong>对象解构</strong><ul><li>  形式：<code>const &#123; x, y &#125; = &#123; x: 1, y: 2 &#125;</code></li><li>  默认：<code>const &#123; x, y = 2 &#125; = &#123; x: 1 &#125;</code></li><li>  改名：<code>const &#123; x, y: z &#125; = &#123; x: 1, y: 2 &#125;</code></li></ul></li><li><strong>数组解构</strong><ul><li>  规则：数据结构具有<code>Iterator接口</code>可采用数组形式的解构赋值</li><li>  形式：<code>const [x, y] = [1, 2]</code></li><li>  默认：<code>const [x, y = 2] = [1]</code></li></ul></li><li><strong>函数参数解构</strong><ul><li>  数组解构：<code>function Func([x = 0, y = 1]) &#123;&#125;</code></li><li>  对象解构：<code>function Func(&#123; x = 0, y = 1 &#125; = &#123;&#125;) &#123;&#125;</code></li></ul></li></ul><blockquote><p>应用场景</p></blockquote><ul><li>  交换变量值：<code>[x, y] = [y, x]</code></li><li>  返回函数多个值：<code>const [x, y, z] = Func()</code></li><li>  定义函数参数：<code>Func([1, 2])</code></li><li>  提取JSON数据：<code>const &#123; name, version &#125; = packageJson</code></li><li>  定义函数参数默认值：<code>function Func(&#123; x = 1, y = 2 &#125; = &#123;&#125;) &#123;&#125;</code></li><li>  遍历Map结构：<code>for (let [k, v] of Map) &#123;&#125;</code></li><li>  输入模块指定属性和方法：<code>const &#123; readFile, writeFile &#125; = require(&quot;fs&quot;)</code></li></ul><blockquote><p>重点难点</p></blockquote><ul><li>  匹配模式：只要等号两边的模式相同，左边的变量就会被赋予对应的值</li><li>  解构赋值规则：只要等号右边的值不是对象或数组，就先将其转为对象</li><li>  解构默认值生效条件：属性值严格等于<code>undefined</code></li><li>  解构遵循匹配模式</li><li>  解构不成功时变量的值等于<code>undefined</code></li><li>  <code>undefined</code>和<code>null</code>无法转为对象，因此无法进行解构</li></ul><h3 id="字符串扩展"><a href="#字符串扩展" class="headerlink" title="字符串扩展"></a>字符串扩展</h3><ul><li>  <strong>Unicode表示法</strong>：<code>大括号包含</code>表示Unicode字符(<code>\u&#123;0xXX&#125;</code>或<code>\u&#123;0XXX&#125;</code>)</li><li>  <strong>字符串遍历</strong>：可通过<code>for-of</code>遍历字符串</li><li>  <strong>字符串模板</strong>：可单行可多行可插入变量的增强版字符串</li><li>  <strong>标签模板</strong>：函数参数的特殊调用</li><li>  **String.raw()**：返回把字符串所有变量替换且对斜杠进行转义的结果</li><li>  **String.fromCodePoint()**：返回码点对应字符</li><li>  **codePointAt()**：返回字符对应码点(<code>String.fromCodePoint()</code>的逆操作)</li><li>  **normalize()**：把字符的不同表示方法统一为同样形式，返回<code>新字符串</code>(Unicode正规化)</li><li>  **repeat()**：把字符串重复n次，返回<code>新字符串</code></li><li>  **matchAll()**：返回正则表达式在字符串的所有匹配</li><li>  **includes()**：是否存在指定字符串</li><li>  **startsWith()**：是否存在字符串头部指定字符串</li><li>  **endsWith()**：是否存在字符串尾部指定字符串</li></ul><blockquote><p>重点难点</p></blockquote><ul><li>  以上扩展方法均可作用于由<code>4个字节储存</code>的<code>Unicode字符</code>上</li></ul><h3 id="数值扩展"><a href="#数值扩展" class="headerlink" title="数值扩展"></a>数值扩展</h3><ul><li>  <strong>二进制表示法</strong>：<code>0b或0B开头</code>表示二进制(<code>0bXX</code>或<code>0BXX</code>)</li><li>  <strong>八进制表示法</strong>：<code>0o或0O开头</code>表示二进制(<code>0oXX</code>或<code>0OXX</code>)</li><li>  <strong>Number.EPSILON</strong>：数值最小精度</li><li>  <strong>Number.MIN_SAFE_INTEGER</strong>：最小安全数值(<code>-2^53</code>)</li><li>  <strong>Number.MAX_SAFE_INTEGER</strong>：最大安全数值(<code>2^53</code>)</li><li>  **Number.parseInt()**：返回转换值的整数部分</li><li>  **Number.parseFloat()**：返回转换值的浮点数部分</li><li>  **Number.isFinite()**：是否为有限数值</li><li>  **Number.isNaN()**：是否为NaN</li><li>  **Number.isInteger()**：是否为整数</li><li>  **Number.isSafeInteger()**：是否在数值安全范围内</li><li>  **Math.trunc()**：返回数值整数部分</li><li>  **Math.sign()**：返回数值类型(<code>正数1</code>、<code>负数-1</code>、<code>零0</code>)</li><li>  **Math.cbrt()**：返回数值立方根</li><li>  **Math.clz32()**：返回数值的32位无符号整数形式</li><li>  **Math.imul()**：返回两个数值相乘</li><li>  **Math.fround()**：返回数值的32位单精度浮点数形式</li><li>  **Math.hypot()**：返回所有数值平方和的平方根</li><li>  **Math.expm1()**：返回<code>e^n - 1</code></li><li>  **Math.log1p()**：返回<code>1 + n</code>的自然对数(<code>Math.log(1 + n)</code>)</li><li>  **Math.log10()**：返回以10为底的n的对数</li><li>  **Math.log2()**：返回以2为底的n的对数</li><li>  **Math.sinh()**：返回n的双曲正弦</li><li>  **Math.cosh()**：返回n的双曲余弦</li><li>  **Math.tanh()**：返回n的双曲正切</li><li>  **Math.asinh()**：返回n的反双曲正弦</li><li>  **Math.acosh()**：返回n的反双曲余弦</li><li>  **Math.atanh()**：返回n的反双曲正切</li></ul><h3 id="对象扩展"><a href="#对象扩展" class="headerlink" title="对象扩展"></a>对象扩展</h3><ul><li>  <strong>简洁表示法</strong>：直接写入变量和函数作为对象的属性和方法(<code>&#123; prop, method() &#123;&#125; &#125;</code>)</li><li>  <strong>属性名表达式</strong>：字面量定义对象时使用<code>[]</code>定义键(<code>[prop]</code>，不能与上同时使用)</li><li><strong>方法的name属性</strong>：返回方法函数名<ul><li>  取值函数(getter)和存值函数(setter)：<code>get/set 函数名</code>(属性的描述对象在<code>get</code>和<code>set</code>上)</li><li>  bind返回的函数：<code>bound 函数名</code></li><li>  Function构造函数返回的函数实例：<code>anonymous</code></li></ul></li><li>  <strong>属性的可枚举性和遍历</strong>：描述对象的<code>enumerable</code></li><li>  <strong>super关键字</strong>：指向当前对象的原型对象(只能用在对象的简写方法中<code>method() &#123;&#125;</code>)</li><li>  **Object.is()**：对比两值是否相等</li><li>  **Object.assign()**：合并对象(浅拷贝)，返回原对象</li><li>  **Object.getPrototypeOf()**：返回对象的原型对象</li><li>  **Object.setPrototypeOf()**：设置对象的原型对象</li><li>  **__proto__**：返回或设置对象的原型对象</li></ul><blockquote><p>属性遍历</p></blockquote><ul><li>  描述：<code>自身</code>、<code>可继承</code>、<code>可枚举</code>、<code>非枚举</code>、<code>Symbol</code></li><li>遍历<ul><li>  <code>for-in</code>：遍历对象<code>自身可继承可枚举</code>属性</li><li>  <code>Object.keys()</code>：返回对象<code>自身可枚举</code>属性键组成的数组</li><li>  <code>Object.getOwnPropertyNames()</code>：返回对象<code>自身非Symbol</code>属性键组成的数组</li><li>  <code>Object.getOwnPropertySymbols()</code>：返回对象<code>自身Symbol</code>属性键组成的数组</li><li>  <code>Reflect.ownKeys()</code>：返回对象<code>自身全部</code>属性键组成的数组</li></ul></li><li>规则<ul><li>  首先遍历所有数值键，按照数值升序排列</li><li>  其次遍历所有字符串键，按照加入时间升序排列</li><li>  最后遍历所有Symbol键，按照加入时间升序排列</li></ul></li></ul><h3 id="数组扩展"><a href="#数组扩展" class="headerlink" title="数组扩展"></a>数组扩展</h3><ul><li>  **扩展运算符(...)**：转换数组为用逗号分隔的参数序列(<code>[...arr]</code>，相当于<code>rest/spread参数</code>的逆运算)</li><li>**Array.from()**：转换具有<code>Iterator接口</code>的数据结构为真正数组，返回新数组<ul><li>  类数组对象：<code>包含length的对象</code>、<code>Arguments对象</code>、<code>NodeList对象</code></li><li>  可遍历对象：<code>String</code>、<code>Set结构</code>、<code>Map结构</code>、<code>Generator函数</code></li></ul></li><li>  **Array.of()**：转换一组值为真正数组，返回新数组</li><li>  **copyWithin()**：把指定位置的成员复制到其他位置，返回原数组</li><li>  **find()**：返回第一个符合条件的成员</li><li>  **findIndex()**：返回第一个符合条件的成员索引值</li><li>  **fill()**：根据指定值填充整个数组，返回原数组</li><li>  **keys()**：返回以索引值为遍历器的对象</li><li>  **values()**：返回以属性值为遍历器的对象</li><li>  **entries()**：返回以索引值和属性值为遍历器的对象</li><li>  <strong>数组空位</strong>：ES6明确将数组空位转为<code>undefined</code>(空位处理规不一，建议避免出现)</li></ul><blockquote><p>扩展应用</p></blockquote><ul><li>  克隆数组：<code>const arr = [...arr1]</code></li><li>  合并数组：<code>const arr = [...arr1, ...arr2]</code></li><li>  拼接数组：<code>arr.push(...arr1)</code></li><li>  代替apply：<code>Math.max.apply(null, [x, y])</code> =&gt; <code>Math.max(...[x, y])</code></li><li>  转换字符串为数组：<code>[...&quot;hello&quot;]</code></li><li>  转换类数组对象为数组：<code>[...Arguments, ...NodeList]</code></li><li>  转换可遍历对象为数组：<code>[...String, ...Set, ...Map, ...Generator]</code></li><li>  与数组解构赋值结合：<code>const [x, ...rest/spread] = [1, 2, 3]</code></li><li>  计算Unicode字符长度：<code>Array.from(&quot;hello&quot;).length</code> =&gt; <code>[...&quot;hello&quot;].length</code></li></ul><blockquote><p>重点难点</p></blockquote><ul><li>  使用<code>keys()</code>、<code>values()</code>、<code>entries()</code>返回的遍历器对象，可用<code>for-of</code>自动遍历或<code>next()</code>手动遍历</li></ul><h3 id="函数扩展"><a href="#函数扩展" class="headerlink" title="函数扩展"></a>函数扩展</h3><ul><li><strong>参数默认值</strong>：为函数参数指定默认值<ul><li>  形式：<code>function Func(x = 1, y = 2) &#123;&#125;</code></li><li>  参数赋值：惰性求值(函数调用后才求值)</li><li>  参数位置：尾参数</li><li>  参数作用域：函数作用域</li><li>  声明方式：默认声明，不能用<code>const</code>或<code>let</code>再次声明</li><li>  length：返回没有指定默认值的参数个数</li><li>  与解构赋值默认值结合：<code>function Func(&#123; x = 1, y = 2 &#125; = &#123;&#125;) &#123;&#125;</code></li><li>应用<ul><li>  指定某个参数不得省略，省略即抛出错误：<code>function Func(x = throwMissing()) &#123;&#125;</code></li><li>  将参数默认值设为<code>undefined</code>，表明此参数可省略：<code>Func(undefined, 1)</code></li></ul></li></ul></li><li>**rest/spread参数(...)**：返回函数多余参数<ul><li>  形式：以数组的形式存在，之后不能再有其他参数</li><li>  作用：代替<code>Arguments对象</code></li><li>  length：返回没有指定默认值的参数个数但不包括<code>rest/spread参数</code></li></ul></li><li><strong>严格模式</strong>：在严格条件下运行JS<ul><li>  应用：只要函数参数使用默认值、解构赋值、扩展运算符，那么函数内部就不能显式设定为严格模式</li></ul></li><li><strong>name属性</strong>：返回函数的函数名<ul><li>  将匿名函数赋值给变量：<code>空字符串</code>(<strong>ES5</strong>)、<code>变量名</code>(<strong>ES6</strong>)</li><li>  将具名函数赋值给变量：<code>函数名</code>(<strong>ES5和ES6</strong>)</li><li>  bind返回的函数：<code>bound 函数名</code>(<strong>ES5和ES6</strong>)</li><li>  Function构造函数返回的函数实例：<code>anonymous</code>(<strong>ES5和ES6</strong>)</li></ul></li><li>**箭头函数(=&gt;)**：函数简写<ul><li>  无参数：<code>() =&gt; &#123;&#125;</code></li><li>  单个参数：<code>x =&gt; &#123;&#125;</code></li><li>  多个参数：<code>(x, y) =&gt; &#123;&#125;</code></li><li>  解构参数：<code>(&#123;x, y&#125;) =&gt; &#123;&#125;</code></li><li>  嵌套使用：部署管道机制</li><li>this指向固定化<ul><li>  并非因为内部有绑定<code>this</code>的机制，而是根本没有自己的<code>this</code>，导致内部的<code>this</code>就是外层代码块的<code>this</code></li><li>  因为没有<code>this</code>，因此不能用作构造函数</li></ul></li></ul></li><li><strong>尾调用优化</strong>：只保留内层函数的调用帧<ul><li>尾调用<ul><li>  定义：某个函数的最后一步是调用另一个函数</li><li>  形式：<code>function f(x) &#123; return g(x); &#125;</code></li></ul></li><li>尾递归<ul><li>  定义：函数尾调用自身</li><li>  作用：只要使用尾递归就不会发生栈溢出，相对节省内存</li><li>  实现：把所有用到的内部变量改写成函数的参数并使用参数默认值</li></ul></li></ul></li></ul><blockquote><p>箭头函数误区</p></blockquote><ul><li>  函数体内的<code>this</code>是<code>定义时所在的对象</code>而不是<code>使用时所在的对象</code></li><li>  可让<code>this</code>指向固定化，这种特性很有利于封装回调函数</li><li>  不可当作<code>构造函数</code>，因此箭头函数不可使用<code>new命令</code></li><li>  不可使用<code>yield命令</code>，因此箭头函数不能用作<code>Generator函数</code></li><li>  不可使用<code>Arguments对象</code>，此对象在函数体内不存在(可用<code>rest/spread参数</code>代替)</li><li>  返回对象时必须在对象外面加上括号</li></ul><h3 id="正则扩展"><a href="#正则扩展" class="headerlink" title="正则扩展"></a>正则扩展</h3><ul><li>  <strong>变更RegExp构造函数入参</strong>：允许首参数为<code>正则对象</code>，尾参数为<code>正则修饰符</code>(返回的正则表达式会忽略原正则表达式的修饰符)</li><li>  <strong>正则方法调用变更</strong>：字符串对象的<code>match()</code>、<code>replace()</code>、<code>search()</code>、<code>split()</code>内部调用转为调用<code>RegExp</code>实例对应的<code>RegExp.prototype[Symbol.方法]</code></li><li><strong>u修饰符</strong>：Unicode模式修饰符，正确处理大于<code>\uFFFF</code>的<code>Unicode字符</code><ul><li>  <code>点字符</code>(.)</li><li>  <code>Unicode表示法</code></li><li>  <code>量词</code></li><li>  <code>预定义模式</code></li><li>  <code>i修饰符</code></li><li>  <code>转义</code></li></ul></li><li>  <strong>y修饰符</strong>：粘连修饰符，确保匹配必须从剩余的第一个位置开始全局匹配(与<code>g修饰符</code>作用类似)</li><li>  <strong>unicode</strong>：是否设置<code>u修饰符</code></li><li>  <strong>sticky</strong>：是否设置<code>y修饰符</code></li><li>  <strong>flags</strong>：返回正则表达式的修饰符</li></ul><blockquote><p>重点难点</p></blockquote><ul><li>  <code>y修饰符</code>隐含头部匹配标志<code>^</code></li><li>  单单一个<code>y修饰符</code>对<code>match()</code>只能返回第一个匹配，必须与<code>g修饰符</code>联用才能返回所有匹配</li></ul><h3 id="Symbol"><a href="#Symbol" class="headerlink" title="Symbol"></a>Symbol</h3><ul><li>  定义：独一无二的值</li><li>  声明：<code>const set = Symbol(str)</code></li><li>  入参：字符串(可选)</li><li>方法<ul><li>  **Symbol()**：创建以参数作为描述的<code>Symbol值</code>(不登记在全局环境)</li><li>  **Symbol.for()**：创建以参数作为描述的<code>Symbol值</code>，如存在此参数则返回原有的<code>Symbol值</code>(先搜索后创建，登记在全局环境)</li><li>  **Symbol.keyFor()**：返回已登记的<code>Symbol值</code>的描述(只能返回<code>Symbol.for()</code>的<code>key</code>)</li><li>  **Object.getOwnPropertySymbols()**：返回对象中所有用作属性名的<code>Symbol值</code>的数组</li></ul></li><li>内置<ul><li>  <strong>Symbol.hasInstance</strong>：指向一个内部方法，当其他对象使用<code>instanceof运算符</code>判断是否为此对象的实例时会调用此方法</li><li>  <strong>Symbol.isConcatSpreadable</strong>：指向一个布尔，定义对象用于<code>Array.prototype.concat()</code>时是否可展开</li><li>  <strong>Symbol.species</strong>：指向一个构造函数，当实例对象使用自身构造函数时会调用指定的构造函数</li><li>  <strong>Symbol.match</strong>：指向一个函数，当实例对象被<code>String.prototype.match()</code>调用时会重新定义<code>match()</code>的行为</li><li>  <strong>Symbol.replace</strong>：指向一个函数，当实例对象被<code>String.prototype.replace()</code>调用时会重新定义<code>replace()</code>的行为</li><li>  <strong>Symbol.search</strong>：指向一个函数，当实例对象被<code>String.prototype.search()</code>调用时会重新定义<code>search()</code>的行为</li><li>  <strong>Symbol.split</strong>：指向一个函数，当实例对象被<code>String.prototype.split()</code>调用时会重新定义<code>split()</code>的行为</li><li>  <strong>Symbol.iterator</strong>：指向一个默认遍历器方法，当实例对象执行<code>for-of</code>时会调用指定的默认遍历器</li><li>  <strong>Symbol.toPrimitive</strong>：指向一个函数，当实例对象被转为原始类型的值时会返回此对象对应的原始类型值</li><li>  <strong>Symbol.toStringTag</strong>：指向一个函数，当实例对象被<code>Object.prototype.toString()</code>调用时其返回值会出现在<code>toString()</code>返回的字符串之中表示对象的类型</li><li>  <strong>Symbol.unscopables</strong>：指向一个对象，指定使用<code>with</code>时哪些属性会被<code>with环境</code>排除</li></ul></li></ul><blockquote><p>数据类型</p></blockquote><ul><li>  <strong>Undefined</strong></li><li>  <strong>Null</strong></li><li>  <strong>String</strong></li><li>  <strong>Number</strong></li><li>  <strong>Boolean</strong></li><li>  <strong>Object</strong>(包含<code>Array</code>、<code>Function</code>、<code>Date</code>、<code>RegExp</code>、<code>Error</code>)</li><li>  <strong>Symbol</strong></li></ul><blockquote><p>应用场景</p></blockquote><ul><li>  唯一化对象属性名：属性名属于Symbol类型，就都是独一无二的，可保证不会与其他属性名产生冲突</li><li>  消除魔术字符串：在代码中多次出现且与代码形成强耦合的某一个具体的字符串或数值</li><li>  遍历属性名：无法通过<code>for-in</code>、<code>for-of</code>、<code>Object.keys()</code>、<code>Object.getOwnPropertyNames()</code>、<code>JSON.stringify()</code>返回，只能通过<code>Object.getOwnPropertySymbols</code>返回</li><li>  启用模块的Singleton模式：调用一个类在任何时候返回同一个实例(<code>window</code>和<code>global</code>)，使用<code>Symbol.for()</code>来模拟全局的<code>Singleton模式</code></li></ul><blockquote><p>重点难点</p></blockquote><ul><li>  <code>Symbol()</code>生成一个原始类型的值不是对象，因此<code>Symbol()</code>前不能使用<code>new命令</code></li><li>  <code>Symbol()</code>参数表示对当前<code>Symbol值</code>的描述，相同参数的<code>Symbol()</code>返回值不相等</li><li>  <code>Symbol值</code>不能与其他类型的值进行运算</li><li>  <code>Symbol值</code>可通过<code>String()</code>或<code>toString()</code>显式转为字符串</li><li>  <code>Symbol值</code>作为对象属性名时，此属性是公开属性，但不是私有属性</li><li>  <code>Symbol值</code>作为对象属性名时，只能用方括号运算符(<code>[]</code>)读取，不能用点运算符(<code>.</code>)读取</li><li>  <code>Symbol值</code>作为对象属性名时，不会被常规方法遍历得到，可利用此特性为对象定义<code>非私有但又只用于内部的方法</code></li></ul><h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><h5 id="Set-1"><a href="#Set-1" class="headerlink" title="Set"></a>Set</h5><ul><li>  定义：类似于数组的数据结构，成员值都是唯一且没有重复的值</li><li>  声明：<code>const set = new Set(arr)</code></li><li>  入参：具有<code>Iterator接口</code>的数据结构</li><li>属性<ul><li>  <strong>constructor</strong>：构造函数，返回Set</li><li>  <strong>size</strong>：返回实例成员总数</li></ul></li><li>方法<ul><li>  **add()**：添加值，返回实例</li><li>  **delete()**：删除值，返回布尔</li><li>  **has()**：检查值，返回布尔</li><li>  **clear()**：清除所有成员</li><li>  **keys()**：返回以属性值为遍历器的对象</li><li>  **values()**：返回以属性值为遍历器的对象</li><li>  **entries()**：返回以属性值和属性值为遍历器的对象</li><li>  **forEach()**：使用回调函数遍历每个成员</li></ul></li></ul><blockquote><p>应用场景</p></blockquote><ul><li>  去重字符串：<code>[...new Set(str)].join(&quot;&quot;)</code></li><li>  去重数组：<code>[...new Set(arr)]</code>或<code>Array.from(new Set(arr))</code></li><li>集合数组<ul><li>  声明：<code>const a = new Set(arr1)</code>、<code>const b = new Set(arr2)</code></li><li>  并集：<code>new Set([...a, ...b])</code></li><li>  交集：<code>new Set([...a].filter(v =&gt; b.has(v)))</code></li><li>  差集：<code>new Set([...a].filter(v =&gt; !b.has(v)))</code></li></ul></li><li>映射集合<ul><li>  声明：<code>let set = new Set(arr)</code></li><li>  映射：<code>set = new Set([...set].map(v =&gt; v * 2))</code>或<code>set = new Set(Array.from(set, v =&gt; v * 2))</code></li></ul></li></ul><blockquote><p>重点难点</p></blockquote><ul><li>  遍历顺序：插入顺序</li><li>  没有键只有值，可认为键和值两值相等</li><li>  添加多个<code>NaN</code>时，只会存在一个<code>NaN</code></li><li>  添加相同的对象时，会认为是不同的对象</li><li>  添加值时不会发生类型转换(<code>5 !== &quot;5&quot;</code>)</li><li>  <code>keys()</code>和<code>values()</code>的行为完全一致，<code>entries()</code>返回的遍历器同时包括键和值且两值相等</li></ul><h5 id="WeakSet"><a href="#WeakSet" class="headerlink" title="WeakSet"></a>WeakSet</h5><ul><li>  定义：和Set结构类似，成员值只能是对象</li><li>  声明：<code>const set = new WeakSet(arr)</code></li><li>  入参：具有<code>Iterator接口</code>的数据结构</li><li>属性<ul><li>  <strong>constructor</strong>：构造函数，返回WeakSet</li></ul></li><li>方法<ul><li>  **add()**：添加值，返回实例</li><li>  **delete()**：删除值，返回布尔</li><li>  **has()**：检查值，返回布尔</li></ul></li></ul><blockquote><p>应用场景</p></blockquote><ul><li>  储存DOM节点：DOM节点被移除时自动释放此成员，不用担心这些节点从文档移除时会引发内存泄漏</li><li>  临时存放一组对象或存放跟对象绑定的信息：只要这些对象在外部消失，它在<code>WeakSet结构</code>中的引用就会自动消</li></ul><blockquote><p>重点难点</p></blockquote><ul><li>  成员都是<code>弱引用</code>，垃圾回收机制不考虑<code>WeakSet结构</code>对此成员的引用</li><li>  成员不适合引用，它会随时消失，因此ES6规定<code>WeakSet结构不可遍历</code></li><li>  其他对象不再引用成员时，垃圾回收机制会自动回收此成员所占用的内存，不考虑此成员是否还存在于<code>WeakSet结构</code>中</li></ul><h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><h5 id="Map-1"><a href="#Map-1" class="headerlink" title="Map"></a>Map</h5><ul><li>  定义：类似于对象的数据结构，成员键是任何类型的值</li><li>  声明：<code>const set = new Map(arr)</code></li><li>  入参：具有<code>Iterator接口</code>且每个成员都是一个双元素数组的数据结构</li><li>属性<ul><li>  <strong>constructor</strong>：构造函数，返回Map</li><li>  <strong>size</strong>：返回实例成员总数</li></ul></li><li>方法<ul><li>  **get()**：返回键值对</li><li>  **set()**：添加键值对，返回实例</li><li>  **delete()**：删除键值对，返回布尔</li><li>  **has()**：检查键值对，返回布尔</li><li>  **clear()**：清除所有成员</li><li>  **keys()**：返回以键为遍历器的对象</li><li>  **values()**：返回以值为遍历器的对象</li><li>  **entries()**：返回以键和值为遍历器的对象</li><li>  **forEach()**：使用回调函数遍历每个成员</li></ul></li></ul><blockquote><p>重点难点</p></blockquote><ul><li>  遍历顺序：插入顺序</li><li>  对同一个键多次赋值，后面的值将覆盖前面的值</li><li>  对同一个对象的引用，被视为一个键</li><li>  对同样值的两个实例，被视为两个键</li><li>  键跟内存地址绑定，只要内存地址不一样就视为两个键</li><li>  添加多个以<code>NaN</code>作为键时，只会存在一个以<code>NaN</code>作为键的值</li><li>  <code>Object结构</code>提供<code>字符串—值</code>的对应，<code>Map结构</code>提供<code>值—值</code>的对应</li></ul><h5 id="WeakMap"><a href="#WeakMap" class="headerlink" title="WeakMap"></a>WeakMap</h5><ul><li>  定义：和Map结构类似，成员键只能是对象</li><li>  声明：<code>const set = new WeakMap(arr)</code></li><li>  入参：具有<code>Iterator接口</code>且每个成员都是一个双元素数组的数据结构</li><li>属性<ul><li>  <strong>constructor</strong>：构造函数，返回WeakMap</li></ul></li><li>方法<ul><li>  **get()**：返回键值对</li><li>  **set()**：添加键值对，返回实例</li><li>  **delete()**：删除键值对，返回布尔</li><li>  **has()**：检查键值对，返回布尔</li></ul></li></ul><blockquote><p>应用场景</p></blockquote><ul><li>  储存DOM节点：DOM节点被移除时自动释放此成员键，不用担心这些节点从文档移除时会引发内存泄漏</li><li>  部署私有属性：内部属性是实例的弱引用，删除实例时它们也随之消失，不会造成内存泄漏</li></ul><blockquote><p>重点难点</p></blockquote><ul><li>  成员键都是<code>弱引用</code>，垃圾回收机制不考虑<code>WeakMap结构</code>对此成员键的引用</li><li>  成员键不适合引用，它会随时消失，因此ES6规定<code>WeakMap结构不可遍历</code></li><li>  其他对象不再引用成员键时，垃圾回收机制会自动回收此成员所占用的内存，不考虑此成员是否还存在于<code>WeakMap结构</code>中</li><li>  一旦不再需要，成员会自动消失，不用手动删除引用</li><li>  弱引用的<code>只是键而不是值</code>，值依然是正常引用</li><li>  即使在外部消除了成员键的引用，内部的成员值依然存在</li></ul><h3 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h3><ul><li>  定义：修改某些操作的默认行为</li><li>  声明：<code>const proxy = new Proxy(target, handler)</code></li><li>入参<ul><li>  <strong>target</strong>：拦截的目标对象</li><li>  <strong>handler</strong>：定制拦截行为</li></ul></li><li>方法<ul><li>  **Proxy.revocable()**：返回可取消的Proxy实例(返回<code>&#123; proxy, revoke &#125;</code>，通过revoke()取消代理)</li></ul></li><li>拦截方式<ul><li>  **get()**：拦截对象属性读取</li><li>  **set()**：拦截对象属性设置，返回布尔</li><li>  **has()**：拦截对象属性检查<code>k in obj</code>，返回布尔</li><li>  **deleteProperty()**：拦截对象属性删除<code>delete obj[k]</code>，返回布尔</li><li>  **defineProperty()**：拦截对象属性定义<code>Object.defineProperty()</code>、<code>Object.defineProperties()</code>，返回布尔</li><li>  **ownKeys()**：拦截对象属性遍历<code>for-in</code>、<code>Object.keys()</code>、<code>Object.getOwnPropertyNames()</code>、<code>Object.getOwnPropertySymbols()</code>，返回数组</li><li>  **getOwnPropertyDescriptor()**：拦截对象属性描述读取<code>Object.getOwnPropertyDescriptor()</code>，返回对象</li><li>  **getPrototypeOf()**：拦截对象原型读取<code>instanceof</code>、<code>Object.getPrototypeOf()</code>、<code>Object.prototype.__proto__</code>、<code>Object.prototype.isPrototypeOf()</code>、<code>Reflect.getPrototypeOf()</code>，返回对象</li><li>  **setPrototypeOf()**：拦截对象原型设置<code>Object.setPrototypeOf()</code>，返回布尔</li><li>  **isExtensible()**：拦截对象是否可扩展读取<code>Object.isExtensible()</code>，返回布尔</li><li>  **preventExtensions()**：拦截对象不可扩展设置<code>Object.preventExtensions()</code>，返回布尔</li><li>  **apply()**：拦截Proxy实例作为函数调用<code>proxy()</code>、<code>proxy.apply()</code>、<code>proxy.call()</code></li><li>  **construct()**：拦截Proxy实例作为构造函数调用<code>new proxy()</code></li></ul></li></ul><blockquote><p>应用场景</p></blockquote><ul><li>  <code>Proxy.revocable()</code>：不允许直接访问对象，必须通过代理访问，一旦访问结束就收回代理权不允许再次访问</li><li>  <code>get()</code>：读取未知属性报错、读取数组负数索引的值、封装链式操作、生成DOM嵌套节点</li><li>  <code>set()</code>：数据绑定(Vue数据绑定实现原理)、确保属性值设置符合要求、防止内部属性被外部读写</li><li>  <code>has()</code>：隐藏内部属性不被发现、排除不符合属性条件的对象</li><li>  <code>deleteProperty()</code>：保护内部属性不被删除</li><li>  <code>defineProperty()</code>：阻止属性被外部定义</li><li>  <code>ownKeys()</code>：保护内部属性不被遍历</li></ul><blockquote><p>重点难点</p></blockquote><ul><li>  要使<code>Proxy</code>起作用，必须针对<code>实例</code>进行操作，而不是针对<code>目标对象</code>进行操作</li><li>  没有设置任何拦截时，等同于<code>直接通向原对象</code></li><li>  属性被定义为<code>不可读写/扩展/配置/枚举</code>时，使用拦截方法会报错</li><li>  代理下的目标对象，内部<code>this</code>指向<code>Proxy代理</code></li></ul><h3 id="Reflect"><a href="#Reflect" class="headerlink" title="Reflect"></a>Reflect</h3><ul><li>  定义：保持<code>Object方法</code>的默认行为</li><li>方法<ul><li>  **get()**：返回对象属性</li><li>  **set()**：设置对象属性，返回布尔</li><li>  **has()**：检查对象属性，返回布尔</li><li>  **deleteProperty()**：删除对象属性，返回布尔</li><li>  **defineProperty()**：定义对象属性，返回布尔</li><li>  **ownKeys()**：遍历对象属性，返回数组(<code>Object.getOwnPropertyNames()</code>+<code>Object.getOwnPropertySymbols()</code>)</li><li>  **getOwnPropertyDescriptor()**：返回对象属性描述，返回对象</li><li>  **getPrototypeOf()**：返回对象原型，返回对象</li><li>  **setPrototypeOf()**：设置对象原型，返回布尔</li><li>  **isExtensible()**：返回对象是否可扩展，返回布尔</li><li>  **preventExtensions()**：设置对象不可扩展，返回布尔</li><li>  **apply()**：绑定this后执行指定函数</li><li>  **construct()**：调用构造函数创建实例</li></ul></li></ul><blockquote><p>设计目的</p></blockquote><ul><li>  将<code>Object</code>属于<code>语言内部的方法</code>放到<code>Reflect</code>上</li><li>  将某些Object方法报错情况改成返回<code>false</code></li><li>  让<code>Object操作</code>变成<code>函数行为</code></li><li>  <code>Proxy</code>与<code>Reflect</code>相辅相成</li></ul><blockquote><p>废弃方法</p></blockquote><ul><li>  <code>Object.defineProperty()</code> =&gt; <code>Reflect.defineProperty()</code></li><li>  <code>Object.getOwnPropertyDescriptor()</code> =&gt; <code>Reflect.getOwnPropertyDescriptor()</code></li></ul><blockquote><p>重点难点</p></blockquote><ul><li>  <code>Proxy方法</code>和<code>Reflect方法</code>一一对应</li><li>  <code>Proxy</code>和<code>Reflect</code>联合使用，前者负责<code>拦截赋值操作</code>，后者负责<code>完成赋值操作</code></li></ul><blockquote><p>数据绑定：观察者模式</p></blockquote><pre><code>const observerQueue = new Set();const observe = fn =&gt; observerQueue.add(fn);const observable = obj =&gt; new Proxy(obj, &#123;    set(tgt, key, val, receiver) &#123;        const result = Reflect.set(tgt, key, val, receiver);        observerQueue.forEach(v =&gt; v());        return result;    &#125;&#125;);const person = observable(&#123; age: 25, name: &quot;Yajun&quot; &#125;);const print = () =&gt; console.log(`$&#123;person.name&#125; is $&#123;person.age&#125; years old`);observe(print);person.name = &quot;Joway&quot;;复制代码</code></pre><h3 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h3><ul><li>  定义：对一类具有共同特征的事物的抽象(构造函数语法糖)</li><li>  原理：类本身指向构造函数，所有方法定义在<code>prototype</code>上，可看作构造函数的另一种写法(<code>Class === Class.prototype.constructor</code>)</li><li>方法和关键字<ul><li>  **constructor()**：构造函数，<code>new命令</code>生成实例时自动调用</li><li>  <strong>extends</strong>：继承父类</li><li>  <strong>super</strong>：新建父类的<code>this</code></li><li>  <strong>static</strong>：定义静态属性方法</li><li>  <strong>get</strong>：取值函数，拦截属性的取值行为</li><li>  <strong>set</strong>：存值函数，拦截属性的存值行为</li></ul></li><li>属性<ul><li>  **__proto__**：<code>构造函数的继承</code>(总是指向<code>父类</code>)</li><li>  **__proto__.__proto__**：子类的原型的原型，即父类的原型(总是指向父类的<code>__proto__</code>)</li><li>  **prototype.__proto__**：<code>属性方法的继承</code>(总是指向父类的<code>prototype</code>)</li></ul></li><li>  静态属性：定义类完成后赋值属性，该属性<code>不会被实例继承</code>，只能通过类来调用</li><li>  静态方法：使用<code>static</code>定义方法，该方法<code>不会被实例继承</code>，只能通过类来调用(方法中的<code>this</code>指向类，而不是实例)</li><li>继承<ul><li>实质<ul><li>  ES5实质：先创造子类实例的<code>this</code>，再将父类的属性方法添加到<code>this</code>上(<code>Parent.apply(this)</code>)</li><li>  ES6实质：先将父类实例的属性方法加到<code>this</code>上(调用<code>super()</code>)，再用子类构造函数修改<code>this</code></li></ul></li><li>super<ul><li>  作为函数调用：只能在构造函数中调用<code>super()</code>，内部<code>this</code>指向继承的<code>当前子类</code>(<code>super()</code>调用后才可在构造函数中使用<code>this</code>)</li><li>  作为对象调用：在<code>普通方法</code>中指向<code>父类的原型对象</code>，在<code>静态方法</code>中指向<code>父类</code></li></ul></li><li>  显示定义：使用<code>constructor() &#123; super(); &#125;</code>定义继承父类，没有书写则<code>显示定义</code></li><li>子类继承父类：子类使用父类的属性方法时，必须在构造函数中调用<code>super()</code>，否则得不到父类的<code>this</code><ul><li>  父类静态属性方法可被子类继承</li><li>  子类继承父类后，可从<code>super</code>上调用父类静态属性方法</li></ul></li></ul></li><li>实例：类相当于<code>实例的原型</code>，所有在类中定义的属性方法都会被实例继承<ul><li>  显式指定属性方法：使用<code>this</code>指定到自身上(使用<code>Class.hasOwnProperty()</code>可检测到)</li><li>  隐式指定属性方法：直接声明定义在对象原型上(使用<code>Class.__proto__.hasOwnProperty()</code>可检测到)</li></ul></li><li>表达式<ul><li>  类表达式：<code>const Class = class &#123;&#125;</code></li><li>  name属性：返回紧跟<code>class</code>后的类名</li><li>  属性表达式：<code>[prop]</code></li><li>  Generator方法：<code>* mothod() &#123;&#125;</code></li><li>  Async方法：<code>async mothod() &#123;&#125;</code></li></ul></li><li>this指向：解构实例属性或方法时会报错<ul><li>  绑定this：<code>this.mothod = this.mothod.bind(this)</code></li><li>  箭头函数：<code>this.mothod = () =&gt; this.mothod()</code></li></ul></li><li>属性定义位置<ul><li>  定义在构造函数中并使用<code>this</code>指向</li><li>  定义在<code>类最顶层</code></li></ul></li><li>  <strong>new.target</strong>：确定构造函数是如何调用</li></ul><blockquote><p>原生构造函数</p></blockquote><ul><li>  <strong>String()</strong></li><li>  <strong>Number()</strong></li><li>  <strong>Boolean()</strong></li><li>  <strong>Array()</strong></li><li>  <strong>Object()</strong></li><li>  <strong>Function()</strong></li><li>  <strong>Date()</strong></li><li>  <strong>RegExp()</strong></li><li>  <strong>Error()</strong></li></ul><blockquote><p>重点难点</p></blockquote><ul><li>  在实例上调用方法，实质是调用原型上的方法</li><li>  <code>Object.assign()</code>可方便地一次向类添加多个方法(<code>Object.assign(Class.prototype, &#123; ... &#125;)</code>)</li><li>  类内部所有定义的方法是不可枚举的(<code>non-enumerable</code>)</li><li>  构造函数默认返回实例对象(<code>this</code>)，可指定返回另一个对象</li><li>  取值函数和存值函数设置在属性的<code>Descriptor对象</code>上</li><li>  类不存在变量提升</li><li>  利用<code>new.target === Class</code>写出不能独立使用必须继承后才能使用的类</li><li>  子类继承父类后，<code>this</code>指向子类实例，通过<code>super</code>对某个属性赋值，赋值的属性会变成子类实例的属性</li><li>  使用<code>super</code>时，必须显式指定是作为函数还是作为对象使用</li><li>  <code>extends</code>不仅可继承类还可继承原生的构造函数</li></ul><blockquote><p>私有属性方法</p></blockquote><pre><code>const name = Symbol(&quot;name&quot;);const print = Symbol(&quot;print&quot;);class Person &#123;    constructor(age) &#123;        this[name] = &quot;Bruce&quot;;        this.age = age;    &#125;    [print]() &#123;        console.log(`$&#123;this[name]&#125; is $&#123;this.age&#125; years old`);    &#125;&#125;复制代码</code></pre><blockquote><p>继承混合类</p></blockquote><pre><code>function CopyProperties(target, source) &#123;    for (const key of Reflect.ownKeys(source)) &#123;        if (key !== &quot;constructor&quot; &amp;&amp; key !== &quot;prototype&quot; &amp;&amp; key !== &quot;name&quot;) &#123;            const desc = Object.getOwnPropertyDescriptor(source, key);            Object.defineProperty(target, key, desc);        &#125;    &#125;&#125;function MixClass(...mixins) &#123;    class Mix &#123;        constructor() &#123;            for (const mixin of mixins) &#123;                CopyProperties(this, new mixin());            &#125;        &#125;    &#125;    for (const mixin of mixins) &#123;        CopyProperties(Mix, mixin);        CopyProperties(Mix.prototype, mixin.prototype);    &#125;    return Mix;&#125;class Student extends MixClass(Person, Kid) &#123;&#125;复制代码</code></pre><h3 id="Module"><a href="#Module" class="headerlink" title="Module"></a>Module</h3><ul><li>命令<ul><li><strong>export</strong>：规定模块对外接口<ul><li>  <strong>默认导出</strong>：<code>export default Person</code>(导入时可指定模块任意名称，无需知晓内部真实名称)</li><li>  <strong>单独导出</strong>：<code>export const name = &quot;Bruce&quot;</code></li><li>  <strong>按需导出</strong>：<code>export &#123; age, name, sex &#125;</code>(推荐)</li><li>  <strong>改名导出</strong>：<code>export &#123; name as newName &#125;</code></li></ul></li><li><strong>import</strong>：导入模块内部功能<ul><li>  <strong>默认导入</strong>：<code>import Person from &quot;person&quot;</code></li><li>  <strong>整体导入</strong>：<code>import * as Person from &quot;person&quot;</code></li><li>  <strong>按需导入</strong>：<code>import &#123; age, name, sex &#125; from &quot;person&quot;</code></li><li>  <strong>改名导入</strong>：<code>import &#123; name as newName &#125; from &quot;person&quot;</code></li><li>  <strong>自执导入</strong>：<code>import &quot;person&quot;</code></li><li>  <strong>复合导入</strong>：<code>import Person, &#123; name &#125; from &quot;person&quot;</code></li></ul></li><li><strong>复合模式</strong>：<code>export命令</code>和<code>import命令</code>结合在一起写成一行，变量实质没有被导入当前模块，相当于对外转发接口，导致当前模块无法直接使用其导入变量<ul><li>  <strong>默认导入导出</strong>：<code>export &#123; default &#125; from &quot;person&quot;</code></li><li>  <strong>整体导入导出</strong>：<code>export * from &quot;person&quot;</code></li><li>  <strong>按需导入导出</strong>：<code>export &#123; age, name, sex &#125; from &quot;person&quot;</code></li><li>  <strong>改名导入导出</strong>：<code>export &#123; name as newName &#125; from &quot;person&quot;</code></li><li>  <strong>具名改默认导入导出</strong>：<code>export &#123; name as default &#125; from &quot;person&quot;</code></li><li>  <strong>默认改具名导入导出</strong>：<code>export &#123; default as name &#125; from &quot;person&quot;</code></li></ul></li></ul></li><li>  继承：<code>默认导出</code>和<code>改名导出</code>结合使用可使模块具备继承性</li><li>  设计思想：尽量地静态化，使得编译时就能确定模块的依赖关系，以及输入和输出的变量</li><li>  严格模式：ES6模块自动采用严格模式(不管模块头部是否添加<code>use strict</code>)</li></ul><blockquote><p>模块方案</p></blockquote><ul><li>  <strong>CommonJS</strong>：用于服务器(动态化依赖)</li><li>  <strong>AMD</strong>：用于浏览器(动态化依赖)</li><li>  <strong>CMD</strong>：用于浏览器(动态化依赖)</li><li>  <strong>UMD</strong>：用于浏览器和服务器(动态化依赖)</li><li>  <strong>ESM</strong>：用于浏览器和服务器(静态化依赖)</li></ul><blockquote><p>加载方式</p></blockquote><ul><li><strong>运行时加载</strong><ul><li>  定义：整体加载模块生成一个对象，再从对象上获取需要的属性和方法进行加载(全部加载)</li><li>  影响：只有运行时才能得到这个对象，导致无法在编译时做静态优化</li></ul></li><li><strong>编译时加载</strong><ul><li>  定义：直接从模块中获取需要的属性和方法进行加载(按需加载)</li><li>  影响：在编译时就完成模块加载，效率比其他方案高，但无法引用模块本身(<strong>本身不是对象</strong>)，可拓展JS高级语法(<strong>宏和类型校验</strong>)</li></ul></li></ul><blockquote><p>加载实现</p></blockquote><ul><li><strong>传统加载</strong>：通过<code>&lt;script&gt;</code>进行同步或异步加载脚本<ul><li>  同步加载：<code>&lt;script src=&quot;&quot;&gt;&lt;/script&gt;</code></li><li>  Defer异步加载：<code>&lt;script src=&quot;&quot; defer&gt;&lt;/script&gt;</code>(顺序加载，渲染完再执行)</li><li>  Async异步加载：<code>&lt;script src=&quot;&quot; async&gt;&lt;/script&gt;</code>(乱序加载，下载完就执行)</li></ul></li><li>  <strong>模块加载</strong>：<code>&lt;script type=&quot;module&quot; src=&quot;&quot;&gt;&lt;/script&gt;</code>(默认是Defer异步加载)</li></ul><blockquote><p>CommonJS和ESM的区别</p></blockquote><ul><li><code>CommonJS</code>输出<code>值的拷贝</code>，<code>ESM</code>输出<code>值的引用</code><ul><li>  <code>CommonJS</code>一旦输出一个值，模块内部的变化就影响不到这个值</li><li>  <code>ESM</code>是动态引用且不会缓存值，模块里的变量绑定其所在的模块，等到脚本真正执行时，再根据这个只读引用到被加载的那个模块里去取值</li></ul></li><li><code>CommonJS</code>是运行时加载，<code>ESM</code>是编译时加载<ul><li>  <code>CommonJS</code>加载模块是对象(即<code>module.exports</code>)，该对象只有在脚本运行完才会生成</li><li>  <code>ESM</code>加载模块不是对象，它的对外接口只是一种静态定义，在代码静态解析阶段就会生成</li></ul></li></ul><blockquote><p>Node加载</p></blockquote><ul><li>  背景：<code>CommonJS</code>和<code>ESM</code>互不兼容，目前解决方案是将两者分开，采用各自的加载方案</li><li>区分：要求<code>ESM</code>采用<code>.mjs</code>后缀文件名<ul><li>  <code>require()</code>不能加载<code>.mjs文件</code>，只有<code>import命令</code>才可加载<code>.mjs文件</code></li><li>  <code>.mjs文件</code>里不能使用<code>require()</code>，必须使用<code>import命令</code>加载文件</li></ul></li><li>  驱动：<code>node --experimental-modules file.mjs</code></li><li>  限制：Node的<code>import命令</code>目前只支持加载本地模块(<code>file:协议</code>)，不支持加载远程模块</li><li>加载优先级<ul><li>  脚本文件省略后缀名：依次尝试加载四个后缀名文件(<code>.mjs</code>、<code>.js</code>、<code>.json</code>、<code>node</code>)</li><li>  以上不存在：尝试加载<code>package.json</code>的<code>main字段</code>指定的脚本</li><li>  以上不存在：依次尝试加载名称为<code>index</code>四个后缀名文件(<code>.mjs</code>、<code>.js</code>、<code>.json</code>、<code>node</code>)</li><li>  以上不存在：报错</li></ul></li><li>  不存在的内部变量：<code>arguments</code>、<code>exports</code>、<code>module</code>、<code>require</code>、<code>this</code>、<code>__dirname</code>、<code>__filename</code></li><li>CommonJS加载ESM<ul><li>  不能使用<code>require()</code>，只能使用<code>import()</code></li></ul></li><li>ESM加载CommonJS<ul><li>  自动将<code>module.exports</code>转化成<code>export default</code></li><li>  <code>CommonJS</code>输出缓存机制在<code>ESM</code>加载方式下依然有效</li><li>  采用<code>import命令</code>加载<code>CommonJS模块</code>时，不允许采用<code>按需导入</code>，应使用<code>默认导入</code>或<code>整体导入</code></li></ul></li></ul><blockquote><p>循环加载</p></blockquote><ul><li>  定义：<code>脚本A</code>的执行依赖<code>脚本B</code>，而<code>脚本A</code>的执行又依赖<code>脚本B</code></li><li>加载原理<ul><li>  CommonJS：<code>require()</code>首次加载脚本就会执行整个脚本，在内存里生成一个对象缓存下来，二次加载脚本时直接从缓存中获取</li><li>  ESM：<code>import命令</code>加载变量不会被缓存，而是成为一个指向被加载模块的引用</li></ul></li><li>循环加载<ul><li>  CommonJS：只输出已经执行的部分，还未执行的部分不会输出</li><li>  ESM：需开发者自己保证真正取值时能够取到值(可把变量写成函数形式，函数具有提升作用)</li></ul></li></ul><blockquote><p>重点难点</p></blockquote><ul><li>  ES6模块中，顶层<code>this</code>指向<code>undefined</code>，不应该在顶层代码使用<code>this</code></li><li>  一个模块就是一个独立的文件，该文件内部的所有变量，外部无法获取</li><li>  <code>export命令</code>输出的接口与其对应的值是<code>动态绑定关系</code>，即通过该接口可获取模块内部实时的值</li><li>  <code>import命令</code>大括号里的变量名必须与被导入模块对外接口的名称相同</li><li>  <code>import命令</code>输入的变量只读(本质是输入接口)，不允许在加载模块的脚本里改写接口</li><li>  <code>import命令</code>命令具有提升效果，会提升到整个模块的头部，首先执行</li><li>  重复执行同一句<code>import语句</code>，只会执行一次</li><li>  <code>export default</code>命令只能使用一次</li><li>  <code>export default命令</code>导出的整体模块，在执行<code>import命令</code>时其后不能跟<code>大括号</code></li><li>  <code>export default命令</code>本质是输出一个名为<code>default</code>的变量，后面不能跟<code>变量声明语句</code></li><li>  <code>export default命令</code>本质是将后面的值赋给名为<code>default</code>的变量，可直接将值写在其后</li><li>  <code>export default命令</code>和<code>export &#123;&#125;命令</code>可同时存在，对应<code>复合导入</code></li><li>  <code>export命令</code>和<code>import命令</code>可出现在模块任何位置，只要处于模块顶层即可，不能处于块级作用域</li><li>  <code>import()</code>加载模块成功后，此模块会作为一个对象，当作<code>then()</code>的参数，可使用<code>对象解构赋值</code>来获取输出接口</li><li>  同时动态加载多个模块时，可使用<code>Promise.all()</code>和<code>import()</code>相结合来实现</li><li>  <code>import()</code>和结合<code>async/await</code>来书写同步操作的代码</li></ul><blockquote><p>单例模式：跨模块常量</p></blockquote><pre><code>const NAME = &quot;Bruce&quot;;const AGE = 25;const SEX = &quot;male&quot;;export &#123; AGE, NAME, SEX &#125;;复制代码import &#123; AGE &#125; from &quot;person&quot;;console.log(AGE);复制代码import &#123; AGE, NAME, SEX &#125; from &quot;person&quot;;console.log(AGE, NAME, SEX);复制代码</code></pre><blockquote><p>默认导入互换整体导入</p></blockquote><pre><code>import Person from &quot;person&quot;;console.log(Person.AGE);复制代码import * as Person from &quot;person&quot;;console.log(Person.default.AGE);复制代码</code></pre><h3 id="Iterator"><a href="#Iterator" class="headerlink" title="Iterator"></a>Iterator</h3><ul><li>  定义：为各种不同的数据结构提供统一的访问机制</li><li>  原理：创建一个指针指向首个成员，按照次序使用<code>next()</code>指向下一个成员，直接到结束位置(数据结构只要部署<code>Iterator接口</code>就可完成遍历操作)</li><li>作用<ul><li>  为各种数据结构提供一个统一的简便的访问接口</li><li>  使得数据结构成员能够按某种次序排列</li><li>  ES6创造了新的遍历命令<code>for-of</code>，<code>Iterator接口</code>主要供<code>for-of</code>消费</li></ul></li><li>  形式：<code>for-of</code>(自动去寻找Iterator接口)</li><li>数据结构<ul><li>  集合：<code>Array</code>、<code>Object</code>、<code>Set</code>、<code>Map</code></li><li>  原生具备接口的数据结构：<code>String</code>、<code>Array</code>、<code>Set</code>、<code>Map</code>、<code>TypedArray</code>、<code>Arguments</code>、<code>NodeList</code></li></ul></li><li>  部署：默认部署在<code>Symbol.iterator</code>(具备此属性被认为<code>可遍历的iterable</code>)</li><li>遍历器对象<ul><li>  **next()**：下一步操作，返回<code>&#123; done, value &#125;</code>(必须部署)</li><li>  **return()**：<code>for-of</code>提前退出调用，返回<code>&#123; done: true &#125;</code></li><li>  **throw()**：不使用，配合<code>Generator函数</code>使用</li></ul></li></ul><blockquote><p>ForOf循环</p></blockquote><ul><li>  定义：调用<code>Iterator接口</code>产生遍历器对象(<code>for-of</code>内部调用数据结构的<code>Symbol.iterator()</code>)</li><li>  遍历字符串：<code>for-in</code>获取<code>索引</code>，<code>for-of</code>获取<code>值</code>(可识别32位UTF-16字符)</li><li>  遍历数组：<code>for-in</code>获取<code>索引</code>，<code>for-of</code>获取<code>值</code></li><li>  遍历对象：<code>for-in</code>获取<code>键</code>，<code>for-of</code>需自行部署</li><li>  遍历Set：<code>for-of</code>获取<code>值</code> =&gt; <code>for (const v of set)</code></li><li>  遍历Map：<code>for-of</code>获取<code>键值对</code> =&gt; <code>for (const [k, v] of map)</code></li><li>  遍历类数组：<code>包含length的对象</code>、<code>Arguments对象</code>、<code>NodeList对象</code>(无<code>Iterator接口的类数组</code>可用<code>Array.from()</code>转换)</li><li>计算生成数据结构：<code>Array</code>、<code>Set</code>、<code>Map</code><ul><li>  **keys()**：返回遍历器对象，遍历所有的键</li><li>  **values()**：返回遍历器对象，遍历所有的值</li><li>  **entries()**：返回遍历器对象，遍历所有的键值对</li></ul></li><li>与<code>for-in</code>区别<ul><li>  有着同<code>for-in</code>一样的简洁语法，但没有<code>for-in</code>那些缺点、</li><li>  不同于<code>forEach()</code>，它可与<code>break</code>、<code>continue</code>和<code>return</code>配合使用</li><li>  提供遍历所有数据结构的统一操作接口</li></ul></li></ul><blockquote><p>应用场景</p></blockquote><ul><li>  改写具有<code>Iterator接口</code>的数据结构的<code>Symbol.iterator</code></li><li>  解构赋值：对Set进行结构</li><li>  扩展运算符：将部署<code>Iterator接口</code>的数据结构转为数组</li><li>  yield*：<code>yield*</code>后跟一个可遍历的数据结构，会调用其遍历器接口</li><li>  接受数组作为参数的函数：<code>for-of</code>、<code>Array.from()</code>、<code>new Set()</code>、<code>new WeakSet()</code>、<code>new Map()</code>、<code>new WeakMap()</code>、<code>Promise.all()</code>、<code>Promise.race()</code></li></ul><h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><ul><li>  定义：包含异步操作结果的对象</li><li>状态<ul><li>  <strong>进行中</strong>：<code>pending</code></li><li>  <strong>已成功</strong>：<code>resolved</code></li><li>  <strong>已失败</strong>：<code>rejected</code></li></ul></li><li>特点<ul><li>  对象的状态不受外界影响</li><li>  一旦状态改变就不会再变，任何时候都可得到这个结果</li></ul></li><li>  声明：<code>new Promise((resolve, reject) =&gt; &#123;&#125;)</code></li><li>出参<ul><li>  <strong>resolve</strong>：将状态从<code>未完成</code>变为<code>成功</code>，在异步操作成功时调用，并将异步操作的结果作为参数传递出去</li><li>  <strong>reject</strong>：将状态从<code>未完成</code>变为<code>失败</code>，在异步操作失败时调用，并将异步操作的错误作为参数传递出去</li></ul></li><li>方法<ul><li>**then()**：分别指定<code>resolved状态</code>和<code>rejected状态</code>的回调函数<ul><li>  <strong>第一参数</strong>：状态变为<code>resolved</code>时调用</li><li>  <strong>第二参数</strong>：状态变为<code>rejected</code>时调用(可选)</li></ul></li><li>  **catch()**：指定发生错误时的回调函数</li><li>**Promise.all()**：将多个实例包装成一个新实例，返回全部实例状态变更后的结果数组(齐变更再返回)<ul><li>  入参：具有<code>Iterator接口</code>的数据结构</li><li>  成功：只有全部实例状态变成<code>fulfilled</code>，最终状态才会变成<code>fulfilled</code></li><li>  失败：其中一个实例状态变成<code>rejected</code>，最终状态就会变成<code>rejected</code></li></ul></li><li>**Promise.race()**：将多个实例包装成一个新实例，返回全部实例状态优先变更后的结果(先变更先返回)<ul><li>  入参：具有<code>Iterator接口</code>的数据结构</li><li>  成功失败：哪个实例率先改变状态就返回哪个实例的状态</li></ul></li><li>**Promise.resolve()**：将对象转为Promise对象(等价于<code>new Promise(resolve =&gt; resolve())</code>)<ul><li>  <strong>Promise实例</strong>：原封不动地返回入参</li><li>  <strong>Thenable对象</strong>：将此对象转为Promise对象并返回(Thenable为包含<code>then()</code>的对象，执行<code>then()</code>相当于执行此对象的<code>then()</code>)</li><li>  <strong>不具有then()的对象</strong>：将此对象转为Promise对象并返回，状态为<code>resolved</code></li><li>  <strong>不带参数</strong>：返回Promise对象，状态为<code>resolved</code></li></ul></li><li>  **Promise.reject()**：将对象转为状态为<code>rejected</code>的Promise对象(等价于<code>new Promise((resolve, reject) =&gt; reject())</code>)</li></ul></li></ul><blockquote><p>应用场景</p></blockquote><ul><li>  加载图片</li><li>  AJAX转Promise对象</li></ul><blockquote><p>重点难点</p></blockquote><ul><li>  只有异步操作的结果可决定当前状态是哪一种，其他操作都无法改变这个状态</li><li>  状态改变只有两种可能：从<code>pending</code>变为<code>resolved</code>、从<code>pending</code>变为<code>rejected</code></li><li>  一旦新建<code>Promise对象</code>就会立即执行，无法中途取消</li><li>  不设置回调函数，内部抛错不会反应到外部</li><li>  当处于<code>pending</code>时，无法得知目前进展到哪一个阶段</li><li>  实例状态变为<code>resolved</code>或<code>rejected</code>时，会触发<code>then()</code>绑定的回调函数</li><li>  <code>resolve()</code>和<code>reject()</code>的执行总是晚于本轮循环的同步任务</li><li>  <code>then()</code>返回新实例，其后可再调用另一个<code>then()</code></li><li>  <code>then()</code>运行中抛出错误会被<code>catch()</code>捕获</li><li>  <code>reject()</code>的作用等同于抛出错误</li><li>  实例状态已变成<code>resolved</code>时，再抛出错误是无效的，不会被捕获，等于没有抛出</li><li>  实例状态的错误具有<code>冒泡</code>性质，会一直向后传递直到被捕获为止，错误总是会被下一个<code>catch()</code>捕获</li><li>  不要在<code>then()</code>里定义<code>rejected</code>状态的回调函数(不使用其第二参数)</li><li>  建议使用<code>catch()</code>捕获错误，不要使用<code>then()</code>第二个参数捕获</li><li>  没有使用<code>catch()</code>捕获错误，实例抛错不会传递到外层代码，即<code>不会有任何反应</code></li><li>  作为参数的实例定义了<code>catch()</code>，一旦被<code>rejected</code>并不会触发<code>Promise.all()</code>的<code>catch()</code></li><li>  <code>Promise.reject()</code>的参数会原封不动地作为<code>rejected</code>的理由，变成后续方法的参数</li></ul><h3 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h3><ul><li>  定义：封装多个内部状态的异步编程解决方案</li><li>  形式：调用<code>Generator函数</code>(该函数不执行)返回指向内部状态的指针对象(不是运行结果)</li><li>  声明：<code>function* Func() &#123;&#125;</code></li><li>方法<ul><li>  **next()**：使指针移向下一个状态，返回<code>&#123; done, value &#125;</code>(入参会被当作上一个<code>yield命令表达式</code>的返回值)</li><li>  **return()**：返回指定值且终结遍历<code>Generator函数</code>，返回<code>&#123; done: true, value: 入参 &#125;</code></li><li>  **throw()**：在<code>Generator函数</code>体外抛出错误，在<code>Generator函数</code>体内捕获错误，返回自定义的<code>new Errow()</code></li></ul></li><li>yield命令：声明内部状态的值(<code>return</code>声明结束返回的值)<ul><li>  遇到<code>yield命令</code>就暂停执行后面的操作，并将其后表达式的值作为返回对象的<code>value</code></li><li>  下次调用<code>next()</code>时，再继续往下执行直到遇到下一个<code>yield命令</code></li><li>  没有再遇到<code>yield命令</code>就一直运行到<code>Generator函数</code>结束，直到遇到<code>return语句</code>为止并将其后表达式的值作为返回对象的<code>value</code></li><li>  <code>Generator函数</code>没有<code>return语句</code>则返回对象的<code>value</code>为<code>undefined</code></li></ul></li><li>  yield*命令：在一个<code>Generator函数</code>里执行另一个<code>Generator函数</code>(后随具有<code>Iterator接口</code>的数据结构)</li><li>  遍历：通过<code>for-of</code>自动调用<code>next()</code></li><li>作为对象属性<ul><li>  全写：<code>const obj = &#123; method: function*() &#123;&#125; &#125;</code></li><li>  简写：<code>const obj = &#123; * method() &#123;&#125; &#125;</code></li></ul></li><li>  上下文：执行产生的<code>上下文环境</code>一旦遇到<code>yield命令</code>就会暂时退出堆栈(但并不消失)，所有变量和对象会冻结在<code>当前状态</code>，等到对它执行<code>next()</code>时，这个<code>上下文环境</code>又会重新加入调用栈，冻结的变量和对象恢复执行</li></ul><blockquote><p>方法异同</p></blockquote><ul><li>  相同点：<code>next()</code>、<code>throw()</code>、<code>return()</code>本质上是同一件事，作用都是让函数恢复执行且使用不同的语句替换<code>yield命令</code></li><li>不同点<ul><li>  **next()**：将<code>yield命令</code>替换成一个<code>值</code></li><li>  **return()**：将<code>yield命令</code>替换成一个<code>return语句</code></li><li>  **throw()**：将<code>yield命令</code>替换成一个<code>throw语句</code></li></ul></li></ul><blockquote><p>应用场景</p></blockquote><ul><li>  异步操作同步化表达</li><li>  控制流管理</li><li>  为对象部署Iterator接口：把<code>Generator函数</code>赋值给对象的<code>Symbol.iterator</code>，从而使该对象具有<code>Iterator接口</code></li><li>  作为具有Iterator接口的数据结构</li></ul><blockquote><p>重点难点</p></blockquote><ul><li>  每次调用<code>next()</code>，指针就从<code>函数头部</code>或<code>上次停下的位置</code>开始执行，直到遇到下一个<code>yield命令</code>或<code>return语句</code>为止</li><li>  函数内部可不用<code>yield命令</code>，但会变成单纯的<code>暂缓执行函数</code>(还是需要<code>next()</code>触发)</li><li>  <code>yield命令</code>是暂停执行的标记，<code>next()</code>是恢复执行的操作</li><li>  <code>yield命令</code>用在另一个表达式中必须放在<code>圆括号</code>里</li><li>  <code>yield命令</code>用作函数参数或放在赋值表达式的右边，可不加<code>圆括号</code></li><li>  <code>yield命令</code>本身没有返回值，可认为是返回<code>undefined</code></li><li>  <code>yield命令表达式</code>为惰性求值，等<code>next()</code>执行到此才求值</li><li>  函数调用后生成遍历器对象，此对象的<code>Symbol.iterator</code>是此对象本身</li><li>  在函数运行的不同阶段，通过<code>next()</code>从外部向内部注入不同的值，从而调整函数行为</li><li>  首个<code>next()</code>用来启动遍历器对象，后续才可传递参数</li><li>  想首次调用<code>next()</code>时就能输入值，可在函数外面再包一层</li><li>  一旦<code>next()</code>返回对象的<code>done</code>为<code>true</code>，<code>for-of</code>遍历会中止且不包含该返回对象</li><li>  函数内部部署<code>try-finally</code>且正在执行<code>try</code>，那么<code>return()</code>会导致立刻进入<code>finally</code>，执行完<code>finally</code>以后整个函数才会结束</li><li>  函数内部没有部署<code>try-catch</code>，<code>throw()</code>抛错将被外部<code>try-catch</code>捕获</li><li>  <code>throw()</code>抛错要被内部捕获，前提是必须<code>至少执行过一次next()</code></li><li>  <code>throw()</code>被捕获以后，会附带执行下一条<code>yield命令</code></li><li>  函数还未开始执行，这时<code>throw()</code>抛错只可能抛出在函数外部</li></ul><blockquote><p>首次next()可传值</p></blockquote><pre><code>function Wrapper(func) &#123;    return function(...args) &#123;        const generator = func(...args);        generator.next();        return generator;    &#125;&#125;const print = Wrapper(function*() &#123;    console.log(`First Input: $&#123;yield&#125;`);    return &quot;done&quot;;&#125;);print().next(&quot;hello&quot;);复制代码</code></pre></div><h2 id="ES2016"><a href="#ES2016" class="headerlink" title="ES2016"></a>ES2016</h2><div class="story post-story"><p><img src="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20201023110400.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20201023110400.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="20201023110400"></p><h3 id="数值扩展-1"><a href="#数值扩展-1" class="headerlink" title="数值扩展"></a>数值扩展</h3><ul><li>  **指数运算符(**)**：数值求幂(相当于<code>Math.pow()</code>)</li></ul><h3 id="数组扩展-1"><a href="#数组扩展-1" class="headerlink" title="数组扩展"></a>数组扩展</h3><ul><li>  **includes()**：是否存在指定成员</li></ul></div><h2 id="ES2017"><a href="#ES2017" class="headerlink" title="ES2017"></a>ES2017</h2><div class="story post-story"><p><img src="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20201023110427.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20201023110427.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="20201023110427"></p><h3 id="声明-1"><a href="#声明-1" class="headerlink" title="声明"></a>声明</h3><ul><li>  <strong>共享内存和原子操作</strong>：由全局对象<code>SharedArrayBuffer</code>和<code>Atomics</code>实现，将数据存储在一块共享内存空间中，这些数据可在<code>JS主线程</code>和<code>web-worker线程</code>之间共享</li></ul><h3 id="字符串扩展-1"><a href="#字符串扩展-1" class="headerlink" title="字符串扩展"></a>字符串扩展</h3><ul><li>  **padStart()**：把指定字符串填充到字符串头部，返回新字符串</li><li>  **padEnd()**：把指定字符串填充到字符串尾部，返回新字符串</li></ul><h3 id="对象扩展-1"><a href="#对象扩展-1" class="headerlink" title="对象扩展"></a>对象扩展</h3><ul><li>  **Object.getOwnPropertyDescriptors()**：返回对象所有自身属性(非继承属性)的描述对象</li><li>  **Object.values()**：返回以值组成的数组</li><li>  **Object.entries()**：返回以键和值组成的数组</li></ul><h3 id="函数扩展-1"><a href="#函数扩展-1" class="headerlink" title="函数扩展"></a>函数扩展</h3><ul><li>  <strong>函数参数尾逗号</strong>：允许函数最后一个参数有尾逗号</li></ul><h3 id="Async"><a href="#Async" class="headerlink" title="Async"></a>Async</h3><ul><li>  定义：使异步函数以同步函数的形式书写(Generator函数语法糖)</li><li>  原理：将<code>Generator函数</code>和自动执行器<code>spawn</code>包装在一个函数里</li><li>  形式：将<code>Generator函数</code>的<code>*</code>替换成<code>async</code>，将<code>yield</code>替换成<code>await</code></li><li>声明<ul><li>  具名函数：<code>async function Func() &#123;&#125;</code></li><li>  函数表达式：<code>const func = async function() &#123;&#125;</code></li><li>  箭头函数：<code>const func = async() =&gt; &#123;&#125;</code></li><li>  对象方法：<code>const obj = &#123; async func() &#123;&#125; &#125;</code></li><li>  类方法：<code>class Cla &#123; async Func() &#123;&#125; &#125;</code></li></ul></li><li>await命令：等待当前Promise对象状态变更完毕<ul><li>  正常情况：后面是Promise对象则返回其结果，否则返回对应的值</li><li>  后随<code>Thenable对象</code>：将其等同于Promise对象返回其结果</li></ul></li><li>  错误处理：将<code>await命令Promise对象</code>放到<code>try-catch</code>中(可放多个)</li></ul><blockquote><p>Async对Generator改进</p></blockquote><ul><li>  内置执行器</li><li>  更好的语义</li><li>  更广的适用性</li><li>  返回值是Promise对象</li></ul><blockquote><p>应用场景</p></blockquote><ul><li>  按顺序完成异步操作</li></ul><blockquote><p>重点难点</p></blockquote><ul><li>  <code>Async函数</code>返回<code>Promise对象</code>，可使用<code>then()</code>添加回调函数</li><li>  内部<code>return返回值</code>会成为后续<code>then()</code>的出参</li><li>  内部抛出错误会导致返回的Promise对象变为<code>rejected状态</code>，被<code>catch()</code>接收到</li><li>  返回的Promise对象必须等到内部所有<code>await命令Promise对象</code>执行完才会发生状态改变，除非遇到<code>return语句</code>或<code>抛出错误</code></li><li>  任何一个<code>await命令Promise对象</code>变为<code>rejected状态</code>，整个<code>Async函数</code>都会中断执行</li><li>希望即使前一个异步操作失败也不要中断后面的异步操作<ul><li>  将<code>await命令Promise对象</code>放到<code>try-catch</code>中</li><li>  <code>await命令Promise对象</code>跟一个<code>catch()</code></li></ul></li><li>  <code>await命令Promise对象</code>可能变为<code>rejected状态</code>，最好把其放到<code>try-catch</code>中</li><li>  多个<code>await命令Promise对象</code>若不存在继发关系，最好让它们同时触发</li><li>  <code>await命令</code>只能用在<code>Async函数</code>之中，否则会报错</li><li>  数组使用<code>forEach()</code>执行<code>async/await</code>会失效，可使用<code>for-of</code>和<code>Promise.all()</code>代替</li><li>  可保留运行堆栈，函数上下文随着<code>Async函数</code>的执行而存在，执行完成就消失</li></ul></div><h2 id="ES2018"><a href="#ES2018" class="headerlink" title="ES2018"></a>ES2018</h2><div class="story post-story"><p><img src="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20201023110442.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20201023110442.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="20201023110442"></p><h3 id="字符串扩展-2"><a href="#字符串扩展-2" class="headerlink" title="字符串扩展"></a>字符串扩展</h3><ul><li>  <strong>放松对标签模板里字符串转义的限制</strong>：遇到不合法的字符串转义返回<code>undefined</code>，并且从<code>raw</code>上可获取原字符串</li></ul><h3 id="对象扩展-2"><a href="#对象扩展-2" class="headerlink" title="对象扩展"></a>对象扩展</h3><ul><li>  **扩展运算符(...)**：转换对象为用逗号分隔的参数序列(<code>&#123; ...obj &#125;</code>，相当于<code>rest/spread参数</code>的逆运算)</li></ul><blockquote><p>扩展应用</p></blockquote><ul><li>  克隆对象：<code>const obj = &#123; __proto__: Object.getPrototypeOf(obj1), ...obj1 &#125;</code></li><li>  合并对象：<code>const obj = &#123; ...obj1, ...obj2 &#125;</code></li><li>  转换字符串为对象：<code>&#123; ...&quot;hello&quot; &#125;</code></li><li>  转换数组为对象：<code>&#123; ...[1, 2] &#125;</code></li><li>  与对象解构赋值结合：<code>const &#123; x, ...rest/spread &#125; = &#123; x: 1, y: 2, z: 3 &#125;</code>(不能复制继承自原型对象的属性)</li><li>  修改现有对象部分属性：<code>const obj = &#123; x: 1, ...&#123; x: 2 &#125; &#125;</code></li></ul><h3 id="正则扩展-1"><a href="#正则扩展-1" class="headerlink" title="正则扩展"></a>正则扩展</h3><ul><li>  <strong>s修饰符</strong>：dotAll模式修饰符，使<code>.</code>匹配任意单个字符(<code>dotAll模式</code>)</li><li>  <strong>dotAll</strong>：是否设置<code>s修饰符</code></li><li>  <strong>后行断言</strong>：<code>x</code>只有在<code>y</code>后才匹配</li><li>  <strong>后行否定断言</strong>：<code>x</code>只有不在<code>y</code>后才匹配</li><li><strong>Unicode属性转义</strong>：匹配符合<code>Unicode某种属性</code>的所有字符<ul><li>  正向匹配：<code>\p&#123;PropRule&#125;</code></li><li>  反向匹配：<code>\P&#123;PropRule&#125;</code></li><li>  限制：<code>\p&#123;...&#125;</code>和<code>\P&#123;...&#125;</code>只对<code>Unicode字符</code>有效，使用时需加上<code>u修饰符</code></li></ul></li><li><strong>具名组匹配</strong>：为每组匹配指定名字(<code>?&lt;GroupName&gt;</code>)<ul><li>  形式：<code>str.exec().groups.GroupName</code></li><li>解构赋值替换<ul><li>  声明：<code>const time = &quot;2017-09-11&quot;</code>、<code>const regexp = /(?&lt;year&gt;\d&#123;4&#125;)-(?&lt;month&gt;\d&#123;2&#125;)-(?&lt;day&gt;\d&#123;2&#125;)/u</code></li><li>  匹配：<code>time.replace(regexp, &quot;$&lt;day&gt;/$&lt;month&gt;/$&lt;year&gt;&quot;)</code></li></ul></li></ul></li></ul><h3 id="Promise-1"><a href="#Promise-1" class="headerlink" title="Promise"></a>Promise</h3><ul><li>  **finally()**：指定不管最后状态如何都会执行的回调函数</li></ul><h3 id="Async-1"><a href="#Async-1" class="headerlink" title="Async"></a>Async</h3><ul><li>  **异步迭代器(for-await-of)**：循环等待每个<code>Promise对象</code>变为<code>resolved状态</code>才进入下一步</li></ul></div><h2 id="ES2019"><a href="#ES2019" class="headerlink" title="ES2019"></a>ES2019</h2><div class="story post-story"><p><img src="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20201023110456.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20201023110456.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="20201023110456"></p><h3 id="字符串扩展-3"><a href="#字符串扩展-3" class="headerlink" title="字符串扩展"></a>字符串扩展</h3><ul><li>  <strong>直接输入U+2028和U+2029</strong>：字符串可直接输入<code>行分隔符</code>和<code>段分隔符</code></li><li>  <strong>JSON.stringify()改造</strong>：可返回不符合UTF-8标准的字符串</li><li>  **trimStart()**：消除字符串头部空格，返回新字符串</li><li>  **trimEnd()**：消除字符串尾部空格，返回新字符串</li></ul><h3 id="对象扩展-3"><a href="#对象扩展-3" class="headerlink" title="对象扩展"></a>对象扩展</h3><ul><li>  **Object.fromEntries()**：返回以键和值组成的对象(<code>Object.entries()</code>的逆操作)</li></ul><h3 id="数组扩展-2"><a href="#数组扩展-2" class="headerlink" title="数组扩展"></a>数组扩展</h3><ul><li>  <strong>sort()稳定性</strong>：排序关键字相同的项目其排序前后的顺序不变，默认为<code>稳定</code></li><li>  **flat()**：扁平化数组，返回新数组</li><li>  **flatMap()**：映射且扁平化数组，返回新数组(只能展开一层数组)</li></ul><h3 id="函数扩展-2"><a href="#函数扩展-2" class="headerlink" title="函数扩展"></a>函数扩展</h3><ul><li>  <strong>toString()改造</strong>：返回函数原始代码(与编码一致)</li><li>  <strong>catch()参数可省略</strong>：<code>catch()</code>中的参数可省略</li></ul><h3 id="Symbol-1"><a href="#Symbol-1" class="headerlink" title="Symbol"></a>Symbol</h3><ul><li>  <strong>description</strong>：返回<code>Symbol值</code>的描述</li></ul></div><h2 id="ES2020"><a href="#ES2020" class="headerlink" title="ES2020"></a>ES2020</h2><div class="story post-story"><p><img src="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20201023110521.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20201023110521.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="20201023110521"></p><h3 id="声明-2"><a href="#声明-2" class="headerlink" title="声明"></a>声明</h3><ul><li><strong>globalThis</strong>：作为顶层对象，指向全局环境下的<code>this</code><ul><li>  Browser：顶层对象是<code>window</code></li><li>  Node：顶层对象是<code>global</code></li><li>  WebWorker：顶层对象是<code>self</code></li><li>  以上三者：通用顶层对象是<code>globalThis</code></li></ul></li></ul><h3 id="数值扩展-2"><a href="#数值扩展-2" class="headerlink" title="数值扩展"></a>数值扩展</h3><ul><li><strong>BigInt</strong>：任何位数的整数(新增的数据类型，使用<code>n</code>结尾)<ul><li>  **BigInt()**：转换普通数值为BigInt类型</li><li>  **BigInt.asUintN()**：转换BigInt为0到2n-1之间对应的值</li><li>  **BigInt.asIntN()**：转换BigInt为-2n-1 到2n-1-1</li><li>  **BigInt.parseInt()**：近似于<code>Number.parseInt()</code>，将一个字符串转换成指定进制的BigInt类型</li></ul></li></ul><blockquote><p>重点难点</p></blockquote><ul><li>  BigInt同样可使用各种进制表示，都要加上后缀</li><li>  BigInt与普通整数是两种值，它们之间并不相等</li><li>  typeof运算符对于BigInt类型的数据返回<code>bigint</code></li></ul><h3 id="对象扩展-4"><a href="#对象扩展-4" class="headerlink" title="对象扩展"></a>对象扩展</h3><ul><li>**链判断操作符(?.)**：是否存在对象属性(不存在返回<code>undefined</code>且不再往下执行)<ul><li>  对象属性：<code>obj?.prop</code>、<code>obj?.[expr]</code></li><li>  函数调用：<code>func?.(...args)</code></li></ul></li><li>  **空判断操作符(??)**：是否值为<code>undefined</code>或<code>null</code>，是则使用默认值</li></ul><h3 id="正则扩展-2"><a href="#正则扩展-2" class="headerlink" title="正则扩展"></a>正则扩展</h3><ul><li>  **matchAll()**：返回所有匹配的遍历器</li></ul><h3 id="Module-1"><a href="#Module-1" class="headerlink" title="Module"></a>Module</h3><ul><li>**import()**：动态导入(返回<code>Promise</code>)<ul><li>  背景：<code>import命令</code>被JS引擎静态分析，先于模块内的其他语句执行，无法取代<code>require()</code>的动态加载功能，提案建议引入<code>import()</code>来代替<code>require()</code></li><li>  位置：可在任何地方使用</li><li>  区别：<code>require()</code>是<strong>同步加载</strong>，<code>import()</code>是<strong>异步加载</strong></li><li>  场景：按需加载、条件加载、模块路径动态化</li></ul></li></ul><h3 id="Iterator-1"><a href="#Iterator-1" class="headerlink" title="Iterator"></a>Iterator</h3><ul><li>  <strong>for-in遍历顺序</strong>：不同的引擎已就如何迭代属性达成一致，从而使行为标准化</li></ul><h3 id="Promise-2"><a href="#Promise-2" class="headerlink" title="Promise"></a>Promise</h3><ul><li>**Promise.allSettled()**：将多个实例包装成一个新实例，返回全部实例状态变更后的状态数组(齐变更再返回)<ul><li>  入参：具有<code>Iterator接口</code>的数据结构</li><li>  成功：成员包含<code>status</code>和<code>value</code>，<code>status</code>为<code>fulfilled</code>，<code>value</code>为返回值</li><li>  失败：成员包含<code>status</code>和<code>reason</code>，<code>status</code>为<code>rejected</code>，<code>value</code>为错误原因</li></ul></li></ul></div><h2 id="ES提案"><a href="#ES提案" class="headerlink" title="ES提案"></a>ES提案</h2><div class="story post-story"><p><img src="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20201023110554.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20201023110554.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="20201023110554"></p><h3 id="声明-3"><a href="#声明-3" class="headerlink" title="声明"></a>声明</h3><ul><li>  <strong>do表达式</strong>：封装块级作用域的操作，返回内部最后执行表达式的值(<code>do&#123;&#125;</code>)</li><li>  <strong>throw表达式</strong>：直接使用<code>throw new Error()</code>，无需<code>()</code>或<code>&#123;&#125;</code>包括</li><li>  <strong>!#命令</strong>：指定脚本执行器(写在文件首行)</li></ul><h3 id="数值扩展-3"><a href="#数值扩展-3" class="headerlink" title="数值扩展"></a>数值扩展</h3><ul><li>  **数值分隔符(_)**：使用<code>_</code>作为千分位分隔符(增加数值的可读性)</li><li>  **Math.signbit()**：返回数值符号是否设置</li></ul><h3 id="函数扩展-3"><a href="#函数扩展-3" class="headerlink" title="函数扩展"></a>函数扩展</h3><ul><li>  <strong>函数部分执行</strong>：复用函数功能(<code>?</code>表示单个参数占位符，<code>...</code>表示多个参数占位符)</li><li>  **管道操作符(|&gt;)**：把左边表达式的值传入右边的函数进行求值(<code>f(x)</code> =&gt; <code>x |&gt; f</code>)</li><li>**绑定运算符(::)**：函数绑定(左边是对象右边是函数，取代<code>bind</code>、<code>apply</code>、<code>call</code>调用)<ul><li>  bind：<code>bar.bind(foo)</code> =&gt; <code>foo::bar</code></li><li>  apply：<code>bar.apply(foo, arguments)</code> =&gt; <code>foo::bar(...arguments)</code></li></ul></li></ul><h3 id="Realm"><a href="#Realm" class="headerlink" title="Realm"></a>Realm</h3><ul><li>  定义：提供<code>沙箱功能</code>，允许隔离代码，防止被隔离的代码拿到全局对象</li><li>  声明：<code>new Realm().global</code></li></ul><h3 id="Class-1"><a href="#Class-1" class="headerlink" title="Class"></a>Class</h3><ul><li>  <strong>静态属性</strong>：使用<code>static</code>定义属性，该属性<code>不会被实例继承</code>，只能通过类来调用</li><li>  <strong>私有属性</strong>：使用<code>#</code>定义属性，该属性只能在类内部访问</li><li>  <strong>私有方法</strong>：使用<code>#</code>定义方法，该方法只能在类内部访问</li><li>  <strong>装饰器</strong>：使用<code>@</code>注释或修改类和类方法</li></ul><h3 id="Module-2"><a href="#Module-2" class="headerlink" title="Module"></a>Module</h3><ul><li>  <strong>import.meta</strong>：返回脚本元信息</li></ul><h3 id="Promise-3"><a href="#Promise-3" class="headerlink" title="Promise"></a>Promise</h3><ul><li>**Promise.any()**：将多个实例包装成一个新实例，返回全部实例状态变更后的结果数组(齐变更再返回)<ul><li>  入参：具有<code>Iterator接口</code>的数据结构</li><li>  成功：其中一个实例状态变成<code>fulfilled</code>，最终状态就会变成<code>fulfilled</code></li><li>  失败：只有全部实例状态变成<code>rejected</code>，最终状态才会变成<code>rejected</code></li></ul></li><li>  **Promise.try()**：不想区分是否同步异步函数，包装函数为实例，使用<code>then()</code>指定下一步流程，使用<code>catch()</code>捕获错误</li></ul><h3 id="Async-2"><a href="#Async-2" class="headerlink" title="Async"></a>Async</h3><ul><li>  <strong>顶层Await</strong>：允许在模块的顶层独立使用<code>await命令</code>(借用<code>await</code>解决模块异步加载的问题)</li></ul><p><a href="https://juejin.im/post/6844903959283367950" target="_blank" rel="noopener external nofollow noreferrer">原文链接</a></p></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;本文的知识点完全是参考或摘录&lt;a href=&quot;https://es6.ruanyifeng.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener external nofollow noreferrer&quot;&gt;《ES6》&lt;/a&gt;里的语句，有部分语句为了方便理解和记忆，进行了相同意思的转义，同时对知识点进行归类划分。为了让大家能集中精力来记住这些特性，全文一句废话和题外话都没有，全部模块以笔记的形式进行书写，如果看得不是很惯建议对照&lt;a href=&quot;https://es6.ruanyifeng.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener external nofollow noreferrer&quot;&gt;《ES6》&lt;/a&gt;的内容来学习。&lt;/p&gt;
&lt;p&gt;本文整理出来的笔记都是书中的精华内容，囊括了整个&lt;code&gt;ES6体系&lt;/code&gt;的所有特性，非常方便大家重新认识&lt;code&gt;全部ES6特性&lt;/code&gt;。半小时的阅读就可对&lt;code&gt;ES6&lt;/code&gt;有一个全面的了解，可认为是一本&lt;code&gt;ES6特性小字典&lt;/code&gt;，收藏后可随时查阅。即使看不完也要拉到本文末尾喔，有个大彩蛋，嘻嘻！&lt;/p&gt;</summary>
    
    
    
    <category term="javascript" scheme="https://kobingogo.github.io/categories/javascript/"/>
    
    
    <category term="ES6" scheme="https://kobingogo.github.io/tags/es6/"/>
    
  </entry>
  
  <entry>
    <title>IntersectionObserver原理分析</title>
    <link href="https://kobingogo.github.io/Chrome%E6%BA%90%E7%A0%81-IntersectionObserver/"/>
    <id>https://kobingogo.github.io/Chrome%E6%BA%90%E7%A0%81-IntersectionObserver/</id>
    <published>2020-10-14T08:35:29.000Z</published>
    <updated>2022-02-07T02:52:27.794Z</updated>
    
    <content type="html"><![CDATA[<p>在介绍<code>IntersectionObserver</code>的时候曾提到过这个接口目前使用的最大问题就是浏览器的兼容性问题。所以，我们平时在使用的时候切记不要忘记判断这个API在我们的宿主环境中是否存在。如果不存在，我们可以通过引入其<code>polyfill</code>来作部分功能的兼容。</p><p><code>IntersectionObserver-polyfill</code>是<code>w3c</code>官方创建的<a href="https://github.com/w3c/IntersectionObserver" target="_blank" rel="noopener external nofollow noreferrer">https://github.com/w3c/IntersectionObserver</a>。我们可以在浏览器不支持<code>IntersectionObserver</code>的情况下引入它。当然，你也可以直接引入它，其内部也只会在浏览器不支持其的情况下进行<code>polyfill</code>。</p><span id="more"></span><p><code>IntersectionObserver</code>的使用前面做了简单的叙述</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> target = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;target&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">IntersectionObserver</span>(<span class="function">(<span class="params">entries</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [entry] = entries</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (entry.<span class="property">isIntersecting</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;元素曝光了&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">observer.<span class="title function_">observe</span>(target)</span><br></pre></td></tr></table></figure><p>下面我们就从其<code>polyfill</code>的源码中来了解其基本原理</p><h2 id="IntersectionObserver"><a href="#IntersectionObserver" class="headerlink" title="IntersectionObserver"></a>IntersectionObserver</h2><div class="story post-story"><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">IntersectionObserver</span>(<span class="params">callback, opt_options</span>) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> options = opt_options || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> callback != <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;callback must be a function&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (options.<span class="property">root</span> &amp;&amp; options.<span class="property">root</span>.<span class="property">nodeType</span> != <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;root must be an Element&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Binds and throttles `this._checkForIntersections`.</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_checkForIntersections</span> = <span class="title function_">throttle</span>(</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">_checkForIntersections</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>), <span class="variable language_">this</span>.<span class="property">THROTTLE_TIMEOUT</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Private properties.</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_callback</span> = callback;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_observationTargets</span> = [];</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_queuedEntries</span> = [];</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_rootMarginValues</span> = <span class="variable language_">this</span>.<span class="title function_">_parseRootMargin</span>(options.<span class="property">rootMargin</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Public properties.</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">thresholds</span> = <span class="variable language_">this</span>.<span class="title function_">_initThresholds</span>(options.<span class="property">threshold</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">root</span> = options.<span class="property">root</span> || <span class="literal">null</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">rootMargin</span> = <span class="variable language_">this</span>.<span class="property">_rootMarginValues</span>.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">margin</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> margin.<span class="property">value</span> + margin.<span class="property">unit</span>;</span><br><span class="line">      &#125;).<span class="title function_">join</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><code>IntersectionObserver</code>是一个构造函数。当我们创建其实例的时候，可以传递两个参数。第一个参数必须是一个函数，否则会抛出一个错误。第二个参数是一个可选的对象，唯一的要求就是我们指定的<code>root</code>属性的值必须是一个<code>Element</code>。构造函数会在创建实例的时候添加很多私有属性。有些属性后面用到的时候会讲解，这里我们先看几个用来保存我们传递的选项的属性。</p><p>在创建<code>IntersectionObserver</code>实例的时候，我们可以在第二个参数对象中传入以下几个属性</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">root</span>: <span class="title class_">Element</span>,</span><br><span class="line">  <span class="attr">rootMargin</span>: string,</span><br><span class="line">  <span class="attr">threshold</span>: number | number[]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在构造函数中首先会调用私有方法解析我们传入的<code>rootMargin</code>属性，下面是这个方法的基本实现</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">IntersectionObserver</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_parseRootMargin</span> = <span class="keyword">function</span>(<span class="params">opt_rootMargin</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> marginString = opt_rootMargin || <span class="string">&#x27;0px&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> margins = marginString.<span class="title function_">split</span>(<span class="regexp">/\s+/</span>).<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">margin</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> parts = <span class="regexp">/^(-?\d*\.?\d+)(px|%)$/</span>.<span class="title function_">exec</span>(margin);</span><br><span class="line">    <span class="keyword">if</span> (!parts) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;rootMargin must be specified in pixels or percent&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">value</span>: <span class="built_in">parseFloat</span>(parts[<span class="number">1</span>]), <span class="attr">unit</span>: parts[<span class="number">2</span>]&#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Handles shorthand.</span></span><br><span class="line">  margins[<span class="number">1</span>] = margins[<span class="number">1</span>] || margins[<span class="number">0</span>];</span><br><span class="line">  margins[<span class="number">2</span>] = margins[<span class="number">2</span>] || margins[<span class="number">0</span>];</span><br><span class="line">  margins[<span class="number">3</span>] = margins[<span class="number">3</span>] || margins[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> margins;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个方法就是将我们传入的<code>rootMargin</code>解析成数组，这个数组包含四个元素代表的分别是<code>上，右，下，左</code>边距的值和单位。<code>rootMargin</code>设置的时候和<code>css margin</code>设置的方式一样，可以传入<code>1,2,3,4</code>个值。比如</p><pre><code>rootMargin: &#39;10px&#39; --&gt; _parseRootMargin(rootMargin) --&gt; [&#123;value: 10, unit: &#39;px&#39;&#125;,&#123;value: 10, unit: &#39;px&#39;&#125;,&#123;value: 10, unit: &#39;px&#39;&#125;,&#123;value: 10, unit: &#39;px&#39;&#125;]// 传入2，3，4个值的解析规则和css margin的解析规则其实是一样的</code></pre><p>解析完<code>rootMargin</code>后，私有属性<code>this._rootMarginValues</code>就是如下形式</p><pre><code>[  &#123;value: 10, unit: &#39;px&#39;&#125;,  &#123;value: 10, unit: &#39;px&#39;&#125;,  &#123;value: 10, unit: &#39;px&#39;&#125;,  &#123;value: 10, unit: &#39;px&#39;&#125;]</code></pre><p>后面又将其转化为<code>this.rootMargin</code>的值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">rootMargin</span> = <span class="variable language_">this</span>.<span class="property">_rootMarginValues</span>.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">margin</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> margin.<span class="property">value</span> + margin.<span class="property">unit</span>;</span><br><span class="line">  &#125;).<span class="title function_">join</span>(<span class="string">&#x27; &#x27;</span>);</span><br></pre></td></tr></table></figure><p>所以，无论我们传入的<code>rootMargin</code>是什么样的形式，构造函数执行结束后都会变成<code>10px 10px 10px 10px</code>的形式。</p><p>在构造函数中还有一个步骤是初始化我们传入的<code>threshold</code>。我们知道，<code>threshold</code>可以是一个数字，也可以是由数字组成的数组。构造函数执行的时候，会统一将其转换成数组的形式并保存在<code>this.thresholds</code>属性中</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">thresholds</span> = <span class="variable language_">this</span>.<span class="title function_">_initThresholds</span>(options.<span class="property">threshold</span>);</span><br></pre></td></tr></table></figure><p>下面是解析<code>threshold</code>的<code>_initThreshold</code>方法的实现</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">IntersectionObserver</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_initThresholds</span> = <span class="keyword">function</span>(<span class="params">opt_threshold</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> threshold = opt_threshold || [<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(threshold)) threshold = [threshold];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> threshold.<span class="title function_">sort</span>().<span class="title function_">filter</span>(<span class="keyword">function</span>(<span class="params">t, i, a</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> t != <span class="string">&#x27;number&#x27;</span> || <span class="built_in">isNaN</span>(t) || t &lt; <span class="number">0</span> || t &gt; <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;threshold must be a number between 0 and 1 inclusively&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> t !== a[i - <span class="number">1</span>];</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个方法接收我们传入的<code>options.threshold</code>选项的值作为参数，如果我们没有传入这个值，则默认为0。如果我们传入的不是一个数组，就将其转化为数组。下面的<code>filter</code>是对一个数组进行去重的方法，即如果我们对<code>threshold</code>传入了重复的值，只会取一个。而且<code>threshold</code>中的每一个值都必须是数字，并且在<code>[0, 1]</code>之间。所以，<code>this.threshold</code>最终保存的值是如下形式</p><pre><code>this.threshold = [0]this.threshold = [0.25, 0.5, 1]</code></pre><p>上面就是<code>IntersectionObserver</code>构造函数大致的执行过程，实例创建好后，我们会调用<code>observe</code>方法监测元素。下面我们看一下<code>observe</code>方法的具体实现</p><h3 id="observe"><a href="#observe" class="headerlink" title="observe"></a>observe</h3><p><code>observe</code>方法定义在<code>IntersectionObserver.prototype</code>上</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">IntersectionObserver</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">observe</span> = <span class="keyword">function</span>(<span class="params">target</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> isTargetAlreadyObserved = <span class="variable language_">this</span>.<span class="property">_observationTargets</span>.<span class="title function_">some</span>(<span class="keyword">function</span>(<span class="params">item</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> item.<span class="property">element</span> == target;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isTargetAlreadyObserved) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!(target &amp;&amp; target.<span class="property">nodeType</span> == <span class="number">1</span>)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;target must be an Element&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">_registerInstance</span>();</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">_observationTargets</span>.<span class="title function_">push</span>(&#123;<span class="attr">element</span>: target, <span class="attr">entry</span>: <span class="literal">null</span>&#125;);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">_monitorIntersections</span>();</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">_checkForIntersections</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接收的参数就是我们需要监测的dom元素。首先会遍历<code>this._observationTargets</code>，这个属性是一个数组，它也是在初始化<code>IntersectionObserver</code>的时候创建的</p><pre><code>this._observationTargets = [];</code></pre><p>对这个属性的遍历，其实就是为了判断当前的<code>observer</code>是否已经通过<code>observe</code>方法监测过<code>target</code>元素。如果已经监测过，就直接<code>return</code>，防止同一个<code>observer</code>实例对同一个<code>target</code>元素进行多次监测。</p><p>如果没有监测过<code>target</code>元素，这里同样会对<code>target</code>的类型进行判断。如果不是一个dom结点，同样会抛出一个错误。</p><p>接着，会调用<code>this._registerInstance</code>方法。这个方法的主要作用就是将当前的<code>observer</code>实例添加到全局数组<code>registry</code>中，主要是为了防止我们的<code>observer</code>实例被垃圾回收进行清除</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">IntersectionObserver</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_registerInstance</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (registry.<span class="title function_">indexOf</span>(<span class="variable language_">this</span>) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    registry.<span class="title function_">push</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后，将我们<code>target</code>元素保存在<code>this._observationTargets</code>中。从上面代码中可以看到，<code>this._observationTargets</code>并不只是保存<code>target</code>元素。它会将<code>target</code>元素作为一个对象的<code>element</code>属性的值进行保存，同时这个对象还有一个<code>entry</code>属性。这个属性初始的时候是一个<code>null</code>，后续是<code>IntersectionObserverEntry</code>的一个实例对象。</p><p>之后调用<code>this._monitorIntersections</code>方法，这个方法后面我们会说。它的作用主要就是采用什么样的方式来检测<code>target</code>的状态。</p><p>最后调用<code>this._checkForIntersections</code>方法，这个方法同样会在后面讲解。这里它主要就是对<code>target</code>元素的状态进行一次初始的判断。如果<code>target</code>元素在初始的时候已经满足了和<code>root</code>元素的交集的状态，在调用这个方法的时候就会触发我们的回调函数。</p><h3 id="monitorIntersections"><a href="#monitorIntersections" class="headerlink" title="_monitorIntersections"></a>_monitorIntersections</h3><p>调用<code>observe</code>方法之后，我们就能够监测<code>target</code>元素的状态了。对<code>target</code>元素状态的监测，就是通过调用上面我们所提到的<code>this._monitorIntersections</code>方法。这里我们来看一下这个方法是怎么实现对元素的监测的</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">IntersectionObserver</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_monitorIntersections</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">_monitoringIntersections</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_monitoringIntersections</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If a poll interval is set, use polling instead of listening to</span></span><br><span class="line">    <span class="comment">// resize and scroll events or DOM mutations.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">POLL_INTERVAL</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_monitoringInterval</span> = <span class="built_in">setInterval</span>(</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">_checkForIntersections</span>, <span class="variable language_">this</span>.<span class="property">POLL_INTERVAL</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">addEvent</span>(<span class="variable language_">window</span>, <span class="string">&#x27;resize&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_checkForIntersections</span>, <span class="literal">true</span>);</span><br><span class="line">      <span class="title function_">addEvent</span>(<span class="variable language_">document</span>, <span class="string">&#x27;scroll&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_checkForIntersections</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">USE_MUTATION_OBSERVER</span> &amp;&amp; <span class="string">&#x27;MutationObserver&#x27;</span> <span class="keyword">in</span> <span class="variable language_">window</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_domObserver</span> = <span class="keyword">new</span> <span class="title class_">MutationObserver</span>(<span class="variable language_">this</span>.<span class="property">_checkForIntersections</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_domObserver</span>.<span class="title function_">observe</span>(<span class="variable language_">document</span>, &#123;</span><br><span class="line">          <span class="attr">attributes</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">childList</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">characterData</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">subtree</span>: <span class="literal">true</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个方法提供了两种方式用来监测元素状态的变化。第一种很简单，也很粗暴 -- <code>polling</code>。这种方式默认是关闭的</p><pre><code>IntersectionObserver.prototype.POLL_INTERVAL = null;</code></pre><p>如果你想使用<code>polling</code>的方式监测元素的状态，则需要在创建<code>IntersectionObserver</code>实例之后，调用<code>observe</code>方法之前设置<code>observer.POLL_INTERVAL</code>属性，比如</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">IntersectionObserver</span>(<span class="function">() =&gt;</span> &#123;&#125;)</span><br><span class="line"></span><br><span class="line">observer.<span class="property">POLL_INTERVAL</span> = <span class="number">300</span></span><br><span class="line"></span><br><span class="line">observer.<span class="title function_">observe</span>(target)</span><br></pre></td></tr></table></figure><p>如果按照上面代码的设置，浏览器就会开启一个定时器，每300毫秒判断一下元素的状态</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">_monitoringInterval</span> = <span class="built_in">setInterval</span>(</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">_checkForIntersections</span>, <span class="variable language_">this</span>.<span class="property">POLL_INTERVAL</span>);</span><br></pre></td></tr></table></figure><p>但是，这种方式不推荐；所以在<code>polyfill</code>的源码中默认将这种方式关闭，采用更高效的事件监听的方式来监测元素状态的变化。首先需要监听<code>window</code>的<code>resize</code>和<code>document</code>的<code>scroll</code>事件。监听这两种事件能够满足大多数对元素状态判断的情况。如果一个元素自身的属性没有变化，当窗口滚动或者大小改变的时候都会影响元素和&quot;视窗&quot;的交集。但是，在某些业务场景下这两种事件是无法监测到元素状态的变化的。比如选项卡切换，元素自身的显示和隐藏等。对于这种情况，<code>polyfill</code>中同样采用一种粗暴的方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">USE_MUTATION_OBSERVER</span> &amp;&amp; <span class="string">&#x27;MutationObserver&#x27;</span> <span class="keyword">in</span> <span class="variable language_">window</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">_domObserver</span> = <span class="keyword">new</span> <span class="title class_">MutationObserver</span>(<span class="variable language_">this</span>.<span class="property">_checkForIntersections</span>);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">_domObserver</span>.<span class="title function_">observe</span>(<span class="variable language_">document</span>, &#123;</span><br><span class="line">    <span class="attr">attributes</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">childList</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">characterData</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">subtree</span>: <span class="literal">true</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过<code>MutationObserver</code>接口监测<code>document</code>元素下所有节点的<code>attributes</code>，<code>childList</code>和<code>characterData</code>的变化。每当有子节点状态变化的时候都会去检测<code>target</code>元素和<code>root</code>元素的交集状态。这种方式很粗暴，但是某些业务场景下我们也不得不这样做。</p><p>上面监测元素所有的方式中，其回调函数都是<code>this._checkForIntersections</code>方法。这个方法在上面也提到过，在调用<code>observe</code>方法的时候同样也会调用这个方法。这个方法到底做了什么，下面就详细的看一下。</p><h3 id="checkForIntersections"><a href="#checkForIntersections" class="headerlink" title="_checkForIntersections"></a>_checkForIntersections</h3><p>在详细讲解这个方法之前，先来简单的总结一下这个方法会在什么样的条件下被调用</p><ul><li>  调用<code>observer.observe(target)</code>方法的时候</li><li>  采用轮询的方式监测元素，作为<code>setInterval</code>回调函数</li><li>  采用事件的方式监测元素，作为<code>document</code>的<code>scroll</code>事件的回调函数</li><li>  采用事件的方式监测元素，作为<code>window</code>的<code>resize</code>事件的回调函数</li><li>  采用事件的方式监测元素，作为<code>MutationObserver</code>的回调函数</li></ul><p>总之，在<code>this._checkForIntersections</code>方法被调用的时候，主要就是为了判断<code>target</code>元素和<code>root</code>元素的交集状态有没有发生变化，如果交集状态发生了变化，就会触发我们的回调函数。下面就详细的看一下这个方法到底做了哪些事情</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">IntersectionObserver</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_checkForIntersections</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> rootIsInDom = <span class="variable language_">this</span>.<span class="title function_">_rootIsInDom</span>();</span><br><span class="line">  <span class="keyword">var</span> rootRect = rootIsInDom ? <span class="variable language_">this</span>.<span class="title function_">_getRootRect</span>() : <span class="title function_">getEmptyRect</span>();</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">_observationTargets</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">item</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> target = item.<span class="property">element</span>;</span><br><span class="line">    <span class="keyword">var</span> targetRect = <span class="title function_">getBoundingClientRect</span>(target);</span><br><span class="line">    <span class="keyword">var</span> rootContainsTarget = <span class="variable language_">this</span>.<span class="title function_">_rootContainsTarget</span>(target);</span><br><span class="line">    <span class="keyword">var</span> oldEntry = item.<span class="property">entry</span>;</span><br><span class="line">    <span class="keyword">var</span> intersectionRect = rootIsInDom &amp;&amp; rootContainsTarget &amp;&amp;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">_computeTargetAndRootIntersection</span>(target, rootRect);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> newEntry = item.<span class="property">entry</span> = <span class="keyword">new</span> <span class="title class_">IntersectionObserverEntry</span>(&#123;</span><br><span class="line">      <span class="attr">time</span>: <span class="title function_">now</span>(),</span><br><span class="line">      <span class="attr">target</span>: target,</span><br><span class="line">      <span class="attr">boundingClientRect</span>: targetRect,</span><br><span class="line">      <span class="attr">rootBounds</span>: rootRect,</span><br><span class="line">      <span class="attr">intersectionRect</span>: intersectionRect</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!oldEntry) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_queuedEntries</span>.<span class="title function_">push</span>(newEntry);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (rootIsInDom &amp;&amp; rootContainsTarget) &#123;</span><br><span class="line">      <span class="comment">// If the new entry intersection ratio has crossed any of the</span></span><br><span class="line">      <span class="comment">// thresholds, add a new entry.</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">_hasCrossedThreshold</span>(oldEntry, newEntry)) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_queuedEntries</span>.<span class="title function_">push</span>(newEntry);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// If the root is not in the DOM or target is not contained within</span></span><br><span class="line">      <span class="comment">// root but the previous entry for this target had an intersection,</span></span><br><span class="line">      <span class="comment">// add a new record indicating removal.</span></span><br><span class="line">      <span class="keyword">if</span> (oldEntry &amp;&amp; oldEntry.<span class="property">isIntersecting</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_queuedEntries</span>.<span class="title function_">push</span>(newEntry);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="variable language_">this</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_queuedEntries</span>.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">_callback</span>(<span class="variable language_">this</span>.<span class="title function_">takeRecords</span>(), <span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>首先会判断<code>root</code>元素是不是在<code>dom</code>结构中</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">IntersectionObserver</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_rootIsInDom</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> !<span class="variable language_">this</span>.<span class="property">root</span> || <span class="title function_">containsDeep</span>(<span class="variable language_">document</span>, <span class="variable language_">this</span>.<span class="property">root</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">containsDeep</span>(<span class="params">parent, child</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> node = child;</span><br><span class="line">  <span class="keyword">while</span> (node) &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == parent) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    node = <span class="title function_">getParentNode</span>(node);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getParentNode</span>(<span class="params">node</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> parent = node.<span class="property">parentNode</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (parent &amp;&amp; parent.<span class="property">nodeType</span> == <span class="number">11</span> &amp;&amp; parent.<span class="property">host</span>) &#123;</span><br><span class="line">    <span class="comment">// If the parent is a shadow root, return the host element.</span></span><br><span class="line">    <span class="keyword">return</span> parent.<span class="property">host</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (parent &amp;&amp; parent.<span class="property">assignedSlot</span>) &#123;</span><br><span class="line">    <span class="comment">// If the parent is distributed in a &lt;slot&gt;, return the parent of a slot.</span></span><br><span class="line">    <span class="keyword">return</span> parent.<span class="property">assignedSlot</span>.<span class="property">parentNode</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> parent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的代码主要就是用来判断<code>root</code>元素是不是在<code>dom</code>结构中。所以这就要求我们传入的<code>options.root</code>选项一定要是<code>target</code>的祖先元素。</p><p>接着会获取<code>root</code>元素的区域数据</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">IntersectionObserver</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_getRootRect</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> rootRect;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">root</span>) &#123;</span><br><span class="line">    rootRect = <span class="title function_">getBoundingClientRect</span>(<span class="variable language_">this</span>.<span class="property">root</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Use &lt;html&gt;/&lt;body&gt; instead of window since scroll bars affect size.</span></span><br><span class="line">    <span class="keyword">var</span> html = <span class="variable language_">document</span>.<span class="property">documentElement</span>;</span><br><span class="line">    <span class="keyword">var</span> body = <span class="variable language_">document</span>.<span class="property">body</span>;</span><br><span class="line">    rootRect = &#123;</span><br><span class="line">      <span class="attr">top</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">left</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">right</span>: html.<span class="property">clientWidth</span> || body.<span class="property">clientWidth</span>,</span><br><span class="line">      <span class="attr">width</span>: html.<span class="property">clientWidth</span> || body.<span class="property">clientWidth</span>,</span><br><span class="line">      <span class="attr">bottom</span>: html.<span class="property">clientHeight</span> || body.<span class="property">clientHeight</span>,</span><br><span class="line">      <span class="attr">height</span>: html.<span class="property">clientHeight</span> || body.<span class="property">clientHeight</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_expandRectByRootMargin</span>(rootRect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果我们自己传递了<code>root</code>元素，就会通过<code>root.getBoundingClientRect</code>方法获取到<code>root</code>的区域数据。如果采用默认的<code>document</code>元素，则会使用视窗的区域数据。后面又调用了<code>_expandRectByRootMargin</code>方法，这个方法主要是用来将我们传入的<code>rootMargin</code>和<code>rootRect</code>数据结合得出新的<code>newRootRect</code>数据。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">IntersectionObserver</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_expandRectByRootMargin</span> = <span class="keyword">function</span>(<span class="params">rect</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> margins = <span class="variable language_">this</span>.<span class="property">_rootMarginValues</span>.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">margin, i</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> margin.<span class="property">unit</span> == <span class="string">&#x27;px&#x27;</span> ? margin.<span class="property">value</span> :</span><br><span class="line">        margin.<span class="property">value</span> * (i % <span class="number">2</span> ? rect.<span class="property">width</span> : rect.<span class="property">height</span>) / <span class="number">100</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">var</span> newRect = &#123;</span><br><span class="line">    <span class="attr">top</span>: rect.<span class="property">top</span> - margins[<span class="number">0</span>],</span><br><span class="line">    <span class="attr">right</span>: rect.<span class="property">right</span> + margins[<span class="number">1</span>],</span><br><span class="line">    <span class="attr">bottom</span>: rect.<span class="property">bottom</span> + margins[<span class="number">2</span>],</span><br><span class="line">    <span class="attr">left</span>: rect.<span class="property">left</span> - margins[<span class="number">3</span>]</span><br><span class="line">  &#125;;</span><br><span class="line">  newRect.<span class="property">width</span> = newRect.<span class="property">right</span> - newRect.<span class="property">left</span>;</span><br><span class="line">  newRect.<span class="property">height</span> = newRect.<span class="property">bottom</span> - newRect.<span class="property">top</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> newRect;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>_expandRectByRootMargin</code>方法很好理解，就是将<code>rootRect</code>和<code>rootMargin</code>结合计算出新的<code>rootRect</code>区域的大小。</p><p>在<code>root</code>的区域确定后，会遍历<code>this._observationTargets</code>属性。这个属性上面我们也提过，它用来保存被<code>observer</code>所监测的所有的<code>target</code>元素。遍历的过程先不看，后面还有一小段代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_queuedEntries</span>.<span class="property">length</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">_callback</span>(<span class="variable language_">this</span>.<span class="title function_">takeRecords</span>(), <span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>this._queuedEntries</code>这个属性一个数组，其中每一个元素都是<code>IntersectionObserverEntry</code>实例对象。只有当这个属性的长度大于0的时候，才会触发回调函数。在讲解<code>IntersectionObserver</code>方法的基本使用的时候我们曾经说过，<code>callback</code>的第一个参数是由<code>IntersectionObserverEntry</code>实例组成的数组，那这里是通过<code>this.takeRecords()</code>方法获取的，这个方法做了什么？</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">IntersectionObserver</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">takeRecords</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> records = <span class="variable language_">this</span>.<span class="property">_queuedEntries</span>.<span class="title function_">slice</span>();</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">_queuedEntries</span> = [];</span><br><span class="line">  <span class="keyword">return</span> records;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个方法很简单，就是通过<code>slice</code>方法对<code>this._queuedEntries</code>数据做个备份，然后清空<code>this._queuedEntries</code>。这表示在这个时间段内和<code>root</code>发生交集变化的<code>target</code>会在调用<code>this._checkForIntersections</code>后交给我们的<code>callback</code>统一处理。也就是说，每个时间段都是重新收集发生变化的<code>target</code>的。</p><p>下面我们来看一下对<code>this._observationTargets</code>的遍历会做哪些事情？估计大家也能想到，它主要就是用来收集在这个阶段中和<code>root</code>元素发生交集变化的<code>target</code>元素，并将新的交集状态(<code>IntersectionObserverEntry</code>实例对象) 保存在<code>this._queuedEntries</code>队列中</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">_observationTargets</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">item</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> target = item.<span class="property">element</span>;</span><br><span class="line">  <span class="keyword">var</span> targetRect = <span class="title function_">getBoundingClientRect</span>(target);</span><br><span class="line">  <span class="keyword">var</span> rootContainsTarget = <span class="variable language_">this</span>.<span class="title function_">_rootContainsTarget</span>(target);</span><br><span class="line">  <span class="keyword">var</span> oldEntry = item.<span class="property">entry</span>;</span><br><span class="line">  <span class="keyword">var</span> intersectionRect = rootIsInDom &amp;&amp; rootContainsTarget &amp;&amp;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">_computeTargetAndRootIntersection</span>(target, rootRect);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> newEntry = item.<span class="property">entry</span> = <span class="keyword">new</span> <span class="title class_">IntersectionObserverEntry</span>(&#123;</span><br><span class="line">    <span class="attr">time</span>: <span class="title function_">now</span>(),</span><br><span class="line">    <span class="attr">target</span>: target,</span><br><span class="line">    <span class="attr">boundingClientRect</span>: targetRect,</span><br><span class="line">    <span class="attr">rootBounds</span>: rootRect,</span><br><span class="line">    <span class="attr">intersectionRect</span>: intersectionRect</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!oldEntry) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_queuedEntries</span>.<span class="title function_">push</span>(newEntry);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (rootIsInDom &amp;&amp; rootContainsTarget) &#123;</span><br><span class="line">    <span class="comment">// If the new entry intersection ratio has crossed any of the</span></span><br><span class="line">    <span class="comment">// thresholds, add a new entry.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">_hasCrossedThreshold</span>(oldEntry, newEntry)) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_queuedEntries</span>.<span class="title function_">push</span>(newEntry);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// If the root is not in the DOM or target is not contained within</span></span><br><span class="line">    <span class="comment">// root but the previous entry for this target had an intersection,</span></span><br><span class="line">    <span class="comment">// add a new record indicating removal.</span></span><br><span class="line">    <span class="keyword">if</span> (oldEntry &amp;&amp; oldEntry.<span class="property">isIntersecting</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_queuedEntries</span>.<span class="title function_">push</span>(newEntry);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="variable language_">this</span>);</span><br></pre></td></tr></table></figure><p>在遍历的过程中，首先获取每个<code>target</code>元素的区域数据，然后调用<code>this._rootContainsTarget</code>方法，这个方法就是用来判断<code>root</code>元素是不是<code>target</code>元素的祖先元素</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">IntersectionObserver</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_rootContainsTarget</span> = <span class="keyword">function</span>(<span class="params">target</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">containsDeep</span>(<span class="variable language_">this</span>.<span class="property">root</span> || <span class="variable language_">document</span>, target);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面，我们先看一下这段代码做了啥，后面再看看<code>item.entry</code>是什么</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> intersectionRect = rootIsInDom &amp;&amp; rootContainsTarget &amp;&amp;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">_computeTargetAndRootIntersection</span>(target, rootRect);</span><br></pre></td></tr></table></figure><p>如果<code>rootIsInDom</code>为真（表示root元素在dom结构中）且<code>rootContainsTarget</code>为真（表示<code>root</code>是<code>target</code>元素的祖先元素），就调用<code>this._computeTargetAndRootIntersection</code>方法。这个方法从名称上应该都能理解它的作用：计算<code>target</code>元素和<code>root</code>元素的相交区域。其实就是用来计算相交面积<code>intersectionRect</code>的大小。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">IntersectionObserver</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_computeTargetAndRootIntersection</span> =</span><br><span class="line">    <span class="keyword">function</span>(<span class="params">target, rootRect</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If the element isn&#x27;t displayed, an intersection can&#x27;t happen.</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>(target).<span class="property">display</span> == <span class="string">&#x27;none&#x27;</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> targetRect = <span class="title function_">getBoundingClientRect</span>(target);</span><br><span class="line">  <span class="keyword">var</span> intersectionRect = targetRect;</span><br><span class="line">  <span class="keyword">var</span> parent = <span class="title function_">getParentNode</span>(target);</span><br><span class="line">  <span class="keyword">var</span> atRoot = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (!atRoot) &#123;</span><br><span class="line">    <span class="keyword">var</span> parentRect = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">var</span> parentComputedStyle = parent.<span class="property">nodeType</span> == <span class="number">1</span> ?</span><br><span class="line">        <span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>(parent) : &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If the parent isn&#x27;t displayed, an intersection can&#x27;t happen.</span></span><br><span class="line">    <span class="keyword">if</span> (parentComputedStyle.<span class="property">display</span> == <span class="string">&#x27;none&#x27;</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (parent == <span class="variable language_">this</span>.<span class="property">root</span> || parent == <span class="variable language_">document</span>) &#123;</span><br><span class="line">      atRoot = <span class="literal">true</span>;</span><br><span class="line">      parentRect = rootRect;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// If the element has a non-visible overflow, and it&#x27;s not the &lt;body&gt;</span></span><br><span class="line">      <span class="comment">// or &lt;html&gt; element, update the intersection rect.</span></span><br><span class="line">      <span class="comment">// Note: &lt;body&gt; and &lt;html&gt; cannot be clipped to a rect that&#x27;s not also</span></span><br><span class="line">      <span class="comment">// the document rect, so no need to compute a new intersection.</span></span><br><span class="line">      <span class="keyword">if</span> (parent != <span class="variable language_">document</span>.<span class="property">body</span> &amp;&amp;</span><br><span class="line">          parent != <span class="variable language_">document</span>.<span class="property">documentElement</span> &amp;&amp;</span><br><span class="line">          parentComputedStyle.<span class="property">overflow</span> != <span class="string">&#x27;visible&#x27;</span>) &#123;</span><br><span class="line">        parentRect = <span class="title function_">getBoundingClientRect</span>(parent);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If either of the above conditionals set a new parentRect,</span></span><br><span class="line">    <span class="comment">// calculate new intersection data.</span></span><br><span class="line">    <span class="keyword">if</span> (parentRect) &#123;</span><br><span class="line">      intersectionRect = <span class="title function_">computeRectIntersection</span>(parentRect, intersectionRect);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!intersectionRect) <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    parent = <span class="title function_">getParentNode</span>(parent);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> intersectionRect;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个方法接收的两个参数分别是<code>target</code>元素和<code>root</code>元素区域的大小。如果元素是隐藏的，是不可能存在相交的，所以直接返回就行了。接着会获取<code>target</code>区域数据和其parentNode元素，并设置一个标志位用来表示下面的while循环是否循环到了<code>this.root</code>或者是<code>document</code>。在while循环中先会判断<code>target.parentNode</code>是否显示，如果其隐藏的话，<code>target</code>和<code>root</code>元素同样是不可能存在交集的。这里我们先假设我们采用默认的<code>root</code>即<code>document</code>，而且<code>parentNode</code>就是<code>document</code>，那么循环将会进入<code>if</code>分支，并将<code>parentRect</code>设置<code>rootRect</code>的大小，atRoot设置为<code>true</code>。接着会执行如下代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (parentRect) &#123;</span><br><span class="line">  intersectionRect = <span class="title function_">computeRectIntersection</span>(parentRect, intersectionRect);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!intersectionRect) <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">parent = <span class="title function_">getParentNode</span>(parent);</span><br></pre></td></tr></table></figure><p>在这个分支中会执行<code>computeRectIntersection</code>函数，这个函数才是真正的计算<code>target</code>和<code>root</code>相交区域的大小</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">computeRectIntersection</span>(<span class="params">rect1, rect2</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> top = <span class="title class_">Math</span>.<span class="title function_">max</span>(rect1.<span class="property">top</span>, rect2.<span class="property">top</span>);</span><br><span class="line">  <span class="keyword">var</span> bottom = <span class="title class_">Math</span>.<span class="title function_">min</span>(rect1.<span class="property">bottom</span>, rect2.<span class="property">bottom</span>);</span><br><span class="line">  <span class="keyword">var</span> left = <span class="title class_">Math</span>.<span class="title function_">max</span>(rect1.<span class="property">left</span>, rect2.<span class="property">left</span>);</span><br><span class="line">  <span class="keyword">var</span> right = <span class="title class_">Math</span>.<span class="title function_">min</span>(rect1.<span class="property">right</span>, rect2.<span class="property">right</span>);</span><br><span class="line">  <span class="keyword">var</span> width = right - left;</span><br><span class="line">  <span class="keyword">var</span> height = bottom - top;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (width &gt;= <span class="number">0</span> &amp;&amp; height &gt;= <span class="number">0</span>) &amp;&amp; &#123;</span><br><span class="line">    <span class="attr">top</span>: top,</span><br><span class="line">    <span class="attr">bottom</span>: bottom,</span><br><span class="line">    <span class="attr">left</span>: left,</span><br><span class="line">    <span class="attr">right</span>: right,</span><br><span class="line">    <span class="attr">width</span>: width,</span><br><span class="line">    <span class="attr">height</span>: height</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们将这段代码用下面的图片来表示，就能看出它到底在做啥</p><p><img src="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20201014163228.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20201014163228.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>上图中红色的线段就是相交区域的<code>上，下，左，右</code>的长度。所以，相交区域的大小就是图中橙色实心部分的大小。如果<code>target</code>位于<code>root</code>的区域外，则表示<code>width</code>或者<code>height</code>至少有一个<code>&lt;=0</code>。那么计算出来的相交区域的大小也就为<code>0</code>。</p><p>假设<code>target.parentNode</code>不是<code>document</code>，那么while循环会执行<code>else</code>分支。其中执行<code>else</code>分支有一个条件<code>parentComputedStyle.overflow != &#39;visible&#39;</code>。如果<code>parentComputedStyle.overflow</code>的值为<code>visible</code>，那么<code>target</code>和<code>root</code>最大的交叉面积就是<code>target</code>的大小，如果<code>parentComputedStyle.overflow</code>的值不为<code>visible</code>，那么<code>target</code>和<code>root</code>最大的交叉面积是多少呢？最大的交叉面积就是<code>target</code>最大能显示出来的面积的大小。</p><p>交叉面积计算出来后，我们接着分析下面的代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> oldEntry = item.<span class="property">entry</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> newEntry = item.<span class="property">entry</span> = <span class="keyword">new</span> <span class="title class_">IntersectionObserverEntry</span>(&#123;</span><br><span class="line">  <span class="attr">time</span>: <span class="title function_">now</span>(),</span><br><span class="line">  <span class="attr">target</span>: target,</span><br><span class="line">  <span class="attr">boundingClientRect</span>: targetRect,</span><br><span class="line">  <span class="attr">rootBounds</span>: rootRect,</span><br><span class="line">  <span class="attr">intersectionRect</span>: intersectionRect</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>先看对<code>newEntry</code>的赋值。我们上面说过<code>this._observationTargets</code>保存的数据的结构为<code>&#123;element: target, entry: null&#125;</code>这种类型。从这里就能看到<code>entry</code>就是通过<code>new IntersectionObserverEntry</code>就是创建的实例对象。那<code>oldEntry</code>是什么呢？<code>oldEntry</code>就是上一次调用<code>this._checkForIntersections</code>方法的时候所创建的<code>entry</code>对象。这里为什么取新老两次<code>entry</code>对象，后面我们会分析。这里我们先看一下<code>IntersectionObserverEntry</code>构造函数的执行流程</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">IntersectionObserverEntry</span>(<span class="params">entry</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">time</span> = entry.<span class="property">time</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">target</span> = entry.<span class="property">target</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">rootBounds</span> = entry.<span class="property">rootBounds</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">boundingClientRect</span> = entry.<span class="property">boundingClientRect</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">intersectionRect</span> = entry.<span class="property">intersectionRect</span> || <span class="title function_">getEmptyRect</span>();</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">isIntersecting</span> = !!entry.<span class="property">intersectionRect</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Calculates the intersection ratio.</span></span><br><span class="line">  <span class="keyword">var</span> targetRect = <span class="variable language_">this</span>.<span class="property">boundingClientRect</span>;</span><br><span class="line">  <span class="keyword">var</span> targetArea = targetRect.<span class="property">width</span> * targetRect.<span class="property">height</span>;</span><br><span class="line">  <span class="keyword">var</span> intersectionRect = <span class="variable language_">this</span>.<span class="property">intersectionRect</span>;</span><br><span class="line">  <span class="keyword">var</span> intersectionArea = intersectionRect.<span class="property">width</span> * intersectionRect.<span class="property">height</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Sets intersection ratio.</span></span><br><span class="line">  <span class="keyword">if</span> (targetArea) &#123;</span><br><span class="line">    <span class="comment">// Round the intersection ratio to avoid floating point math issues:</span></span><br><span class="line">    <span class="comment">// https://github.com/w3c/IntersectionObserver/issues/324</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">intersectionRatio</span> = <span class="title class_">Number</span>((intersectionArea / targetArea).<span class="title function_">toFixed</span>(<span class="number">4</span>));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// If area is zero and is intersecting, sets to 1, otherwise to 0</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">intersectionRatio</span> = <span class="variable language_">this</span>.<span class="property">isIntersecting</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>IntersectionObserverEntry</code>函数的执行流程十分简单，就是计算出其各个属性的值。其它的属性我们就不多说了，这里我们主要看以下三个属性值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">intersectionRect</span> = entry.<span class="property">intersectionRect</span> || <span class="title function_">getEmptyRect</span>();</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">isIntersecting</span> = !!entry.<span class="property">intersectionRect</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (targetArea) &#123;</span><br><span class="line">    <span class="comment">// Round the intersection ratio to avoid floating point math issues:</span></span><br><span class="line">    <span class="comment">// https://github.com/w3c/IntersectionObserver/issues/324</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">intersectionRatio</span> = <span class="title class_">Number</span>((intersectionArea / targetArea).<span class="title function_">toFixed</span>(<span class="number">4</span>));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// If area is zero and is intersecting, sets to 1, otherwise to 0</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">intersectionRatio</span> = <span class="variable language_">this</span>.<span class="property">isIntersecting</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>其中<code>this.intersectionRect</code>就是上面通过<code>this._computeTargetAndRootIntersection</code>方法计算出来的。<code>this.isIntersecting</code>的判定也十分简单，如果存在相交面积，就表示相交。不存在相交面积，就表示不想交。最后是相交比<code>this.intersectionRatio</code>的计算，正常情况下(target的width和height都不为0)就是<code>intersectionArea</code>和<code>target</code>区域面积的比值。</p><p>然后就会判断<code>oldEntry</code>是否存在，<code>oldEntry</code>在什么状态下不会存在？在初始调用，也就是调用<code>observer.observe</code>方法监测<code>target</code>元素的时候<code>item.entry</code>是不存在的。然后就会将<code>newEntry</code>添加到<code>this._queuedEntries</code>队列中，当执行到</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_queuedEntries</span>.<span class="property">length</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">_callback</span>(<span class="variable language_">this</span>.<span class="title function_">takeRecords</span>(), <span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>的时候，就会调用我们传入的回调函数。</p><p>如果不是在初始状态下，在<code>rootIsInDom &amp;&amp; rootContainsTarget</code>为真的时候，会调用<code>this._hasCrossedThreshold</code>方法，那这个方法是干啥的？我们在介绍<code>IntersectionObserver</code>的时候曾经提到在创建<code>IntersectionObserver</code>实例的时候，我们传入一个选项，可以通过这个选项的<code>threshold</code>属性指定相交比达到什么样的条件才需要触发我们的回调函数。<code>this._hasCrossedThreshold</code>就是用来判断这种情况的。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">IntersectionObserver</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_hasCrossedThreshold</span> =</span><br><span class="line">    <span class="keyword">function</span>(<span class="params">oldEntry, newEntry</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// To make comparing easier, an entry that has a ratio of 0</span></span><br><span class="line">  <span class="comment">// but does not actually intersect is given a value of -1</span></span><br><span class="line">  <span class="keyword">var</span> oldRatio = oldEntry &amp;&amp; oldEntry.<span class="property">isIntersecting</span> ?</span><br><span class="line">      oldEntry.<span class="property">intersectionRatio</span> || <span class="number">0</span> : -<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">var</span> newRatio = newEntry.<span class="property">isIntersecting</span> ?</span><br><span class="line">      newEntry.<span class="property">intersectionRatio</span> || <span class="number">0</span> : -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Ignore unchanged ratios</span></span><br><span class="line">  <span class="keyword">if</span> (oldRatio === newRatio) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">thresholds</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> threshold = <span class="variable language_">this</span>.<span class="property">thresholds</span>[i];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return true if an entry matches a threshold or if the new ratio</span></span><br><span class="line">    <span class="comment">// and the old ratio are on the opposite sides of a threshold.</span></span><br><span class="line">    <span class="keyword">if</span> (threshold == oldRatio || threshold == newRatio ||</span><br><span class="line">        threshold &lt; oldRatio !== threshold &lt; newRatio) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从<code>_hasCrossedThreshold</code>代码中我们可以看到。如果<code>target</code>完全没有显示<code>oldRatio === newRatio === -1</code>，直接<code>return</code>。这种情况下是不会执行我们的回调函数的。如果<code>target</code>完全显示<code>oldRatio === newRatio === newEntry.intersectionRatio</code>，这种情况下也不会执行我们的回调函数。那什么时候才会执行我们的回调函数呢，从这段代码的<code>for</code>循环中我们可以总结出<strong>只有当threshold设置的值在oldRatio和newRatio之间的时候才会执行我们的回调</strong>。这里大家可以画图分析一下。</p><p>上面就是关于怎么监测<code>target</code>和执行回调函数时机的分析，下面我们看一下<code>unobserve</code>的过程</p><h3 id="unobserve"><a href="#unobserve" class="headerlink" title="unobserve"></a>unobserve</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">IntersectionObserver</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">unobserve</span> = <span class="keyword">function</span>(<span class="params">target</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">_observationTargets</span> =</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_observationTargets</span>.<span class="title function_">filter</span>(<span class="keyword">function</span>(<span class="params">item</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> item.<span class="property">element</span> != target;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">_observationTargets</span>.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">_unmonitorIntersections</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">_unregisterInstance</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>unobserve</code>的执行流程十分简单，首先是从<code>this._observationTargets</code>将<code>target</code>删除。如果<code>this._observationTargets</code>队列长度为0，表示当前的<code>observer</code>没有监听任何<code>target</code>，那么就可以将当前<code>observer</code>从全局的<code>registry</code>数组中删除。如果<code>registry</code>也为空，那么就可以卸载相关事件。这个过程主要是通过<code>this._unmonitorIntersections</code>和<code>this._unregisterInstance</code>方法来实现的</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">IntersectionObserver</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_unmonitorIntersections</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_monitoringIntersections</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_monitoringIntersections</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">_monitoringInterval</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_monitoringInterval</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">removeEvent</span>(<span class="variable language_">window</span>, <span class="string">&#x27;resize&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_checkForIntersections</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="title function_">removeEvent</span>(<span class="variable language_">document</span>, <span class="string">&#x27;scroll&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_checkForIntersections</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_domObserver</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_domObserver</span>.<span class="title function_">disconnect</span>();</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_domObserver</span> = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">IntersectionObserver</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_unregisterInstance</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> index = registry.<span class="title function_">indexOf</span>(<span class="variable language_">this</span>);</span><br><span class="line">  <span class="keyword">if</span> (index != -<span class="number">1</span>) registry.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="disconnect"><a href="#disconnect" class="headerlink" title="disconnect"></a>disconnect</h3><p><code>disconnect</code>可以一次性取消<code>observer</code>对所有<code>target</code>的监测，这个方法的实现同样很简单</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">IntersectionObserver</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">disconnect</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">_observationTargets</span> = [];</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">_unmonitorIntersections</span>();</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">_unregisterInstance</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面就是对<code>IntersectionObserver polyfill</code>源码的大致分析。如有错误，欢迎指正。</p><h3 id="使用IntersectionObserver实现一个简单的无限滚动"><a href="#使用IntersectionObserver实现一个简单的无限滚动" class="headerlink" title="使用IntersectionObserver实现一个简单的无限滚动"></a>使用IntersectionObserver实现一个简单的无限滚动</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.img-area</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">500px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">320px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">margin</span>: <span class="number">0</span> auto;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.my-photo</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">500px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">opacity</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      -webkit-<span class="attribute">transition</span>: opacity <span class="number">0.25s</span> ease-in-out;</span></span><br><span class="line"><span class="language-css">      -moz-<span class="attribute">transition</span>: opacity <span class="number">0.25s</span> ease-in-out;</span></span><br><span class="line"><span class="language-css">      -o-<span class="attribute">transition</span>: opacity <span class="number">0.25s</span> ease-in-out;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">transition</span>: opacity <span class="number">0.25s</span> ease-in-out;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">&quot;body&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;img-area&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;my-photo&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;loading&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;./img/1.png&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;img-area&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;my-photo&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;loading&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;./img/1.png&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;img-area&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;my-photo&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;loading&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;./img/1.png&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;img-area&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;my-photo&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;loading&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;./img/1.png&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;img-area&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;my-photo&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;loading&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;./img/1.png&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;img-area&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;my-photo&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;loading&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;./img/1.png&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;img-area&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;my-photo&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;loading&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;./img/1.png&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;img-area&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;my-photo&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;loading&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;./img/1.png&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;img-area&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;my-photo&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;loading&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;./img/1.png&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;img-area&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;my-photo&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;loading&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;./img/1.png&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> <span class="comment">&lt;!-- 页尾标志，判断是否需要新添加节点到文档流中 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">loadItems</span>(<span class="params">io, count = <span class="number">10</span></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> container = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.container&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> fragment = <span class="variable language_">document</span>.<span class="title function_">createDocumentFragment</span>();</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> li = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        li.<span class="property">className</span> = <span class="string">&#x27;img-area&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> img = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;img&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        img.<span class="property">className</span> = <span class="string">&#x27;my-photo&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        img.<span class="property">alt</span> = <span class="string">&#x27;loading&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        img.<span class="property">dataset</span>.<span class="property">src</span> = <span class="string">&#x27;./img/1.png&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        li.<span class="title function_">appendChild</span>(img);</span></span><br><span class="line"><span class="language-javascript">        fragment.<span class="title function_">appendChild</span>(li);</span></span><br><span class="line"><span class="language-javascript">        io.<span class="title function_">observe</span>(img)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      container.<span class="title function_">appendChild</span>(fragment)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">lazyLoad</span>(<span class="params">imgClassName</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> imgList = <span class="title class_">Array</span>.<span class="title function_">from</span>(<span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(imgClassName));</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> opts = &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">root</span>: <span class="variable language_">document</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">rootMargin</span>: <span class="string">&quot;500px 0px&quot;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> io = <span class="keyword">new</span> <span class="title class_">IntersectionObserver</span>(<span class="keyword">function</span> (<span class="params">ioes</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        ioes.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">ioe</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> el = ioe.<span class="property">target</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> cn = el.<span class="property">className</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// const intersectionRatio = ioe.intersectionRatio;</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (cn === <span class="string">&#x27;footer&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (!ioe.<span class="property">isIntersecting</span>) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">loadItems</span>(io);</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;loaded new items&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ioe.<span class="property">isIntersecting</span>) &#123; <span class="comment">//对于图片节点，当其进入范围内，则load其src</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (!el.<span class="property">src</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">              el.<span class="property">src</span> = el.<span class="property">dataset</span>.<span class="property">src</span>;</span></span><br><span class="line"><span class="language-javascript">              el.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                el.<span class="property">style</span>.<span class="property">opacity</span> = <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">              &#125;</span></span><br><span class="line"><span class="language-javascript">              io.<span class="title function_">unobserve</span>(el); <span class="comment">//加载图片后停止观察该节点</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">      &#125;, opts);</span></span><br><span class="line"><span class="language-javascript">      imgList.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">item</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        io.<span class="title function_">observe</span>(item)</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">      io.<span class="title function_">observe</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.footer&quot;</span>)) <span class="comment">//观察footer节点，判断添加新节点的时机</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">lazyLoad</span>(<span class="string">&#x27;.my-photo&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>效果图：<br><img src="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/Jietu20201014-172126.gif" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/Jietu20201014-172126.gif" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Jietu20201014-172126"></p><!-- 转发自[赵赛赛个人博客](https://zhaosaisai.com/blog/2019/IntersectionObserver-polyfill%E8%A7%A3%E6%9E%90.html) --></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;在介绍&lt;code&gt;IntersectionObserver&lt;/code&gt;的时候曾提到过这个接口目前使用的最大问题就是浏览器的兼容性问题。所以，我们平时在使用的时候切记不要忘记判断这个API在我们的宿主环境中是否存在。如果不存在，我们可以通过引入其&lt;code&gt;polyfill&lt;/code&gt;来作部分功能的兼容。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;IntersectionObserver-polyfill&lt;/code&gt;是&lt;code&gt;w3c&lt;/code&gt;官方创建的&lt;a href=&quot;https://github.com/w3c/IntersectionObserver&quot; target=&quot;_blank&quot; rel=&quot;noopener external nofollow noreferrer&quot;&gt;https://github.com/w3c/IntersectionObserver&lt;/a&gt;。我们可以在浏览器不支持&lt;code&gt;IntersectionObserver&lt;/code&gt;的情况下引入它。当然，你也可以直接引入它，其内部也只会在浏览器不支持其的情况下进行&lt;code&gt;polyfill&lt;/code&gt;。&lt;/p&gt;</summary>
    
    
    
    <category term="浏览器" scheme="https://kobingogo.github.io/categories/%E6%B5%8F%E8%A7%88%E5%99%A8/"/>
    
    
    <category term="IntersectionObserver" scheme="https://kobingogo.github.io/tags/intersectionobserver/"/>
    
  </entry>
  
  <entry>
    <title>男士洗面奶</title>
    <link href="https://kobingogo.github.io/%E7%94%9F%E6%B4%BB-%E7%94%B7%E5%A3%AB%E6%B4%97%E9%9D%A2%E5%A5%B6%E6%8E%A8%E8%8D%90/"/>
    <id>https://kobingogo.github.io/%E7%94%9F%E6%B4%BB-%E7%94%B7%E5%A3%AB%E6%B4%97%E9%9D%A2%E5%A5%B6%E6%8E%A8%E8%8D%90/</id>
    <published>2020-09-30T09:37:27.000Z</published>
    <updated>2022-02-07T02:52:27.802Z</updated>
    
    <content type="html"><![CDATA[<p>作为全虎扑拥有洗面奶最多的男人，我评价一款洗面奶永远不是嘴上说好用不好用那么简单。好用要有好用的理由，不好用也要说出不好用的地方。</p><span id="more"></span><p>今天就虎扑权威男性洗面奶排行榜，来说一说到底哪些洗面奶值得买。我会从成分分析、酸碱测试、使用体验和适用肤质4个方面来具体盘一盘。</p><p>不懂选择的，对比虎扑洗面奶排行榜，参考文章，对应肤质和预算，直接入就完事了！</p><p>OK，上菜单：<br><img src="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20200930172848.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20200930172848.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="20200930172848"></p><hr><p> 个人建议，选择购入产品，直接选择天猫官方店，价格透明，买的放心，其他平台容易出假，仿货！</p><h4 id="◎NO-1芙丽芳丝-（150元-100g）"><a href="#◎NO-1芙丽芳丝-（150元-100g）" class="headerlink" title="◎NO.1芙丽芳丝 （150元/100g）"></a><a href="https://s.click.taobao.com/cIUdzvu" target="_blank" rel="noopener external nofollow noreferrer">◎NO.1芙丽芳丝</a> （150元/100g）</h4><p>1【成分分析】</p><p>成分分析这块儿讲的会有点小枯燥，不喜欢看的直接跳到下一趴！</p><p>这几年芙丽芳丝应该没少在广告上砸钱，洁面界第一网红的称号不是白来的。</p><p>宣传适合敏感肌的洁面，没有刺激性香精防腐剂，靠柠檬酸+丁二醇来防腐，还算靠谱。</p><p>清洁方面主要靠的是氨基酸表活-椰油酰甘氨酸钾，中等偏上清洁力。甘油排位第一为了保湿。添加有两种致痘风险的乳化剂，从消费者反馈来说，有一定致痘风险，我自己用着期间，还没长嘿嘿。</p><p>从烟酰胺开始的各种活性成分，添加量很低很低，而且不在脸上停留，不说也罢！</p><p>2【酸碱测试】</p><p>PH值介于6-7之间，还算过关！比较温和，对肌肤基本没什么刺激。我换季过敏用都毫无压力。</p><p>3【使用体验】</p><p>乳膏质地，洗出来的泡泡跟棉花一样，细密温和。味道有点像宝宝身上的奶香味儿，个人能接受，但是看淘宝评价有人说像塑料……让人有点方。</p><p>洗的干净，洗完不绷，是一款过敏或日常用都可的安全洗面奶。</p><p>4【适用肤质】</p><p>除了塔克拉玛干和大庆油田，基本所有肤质都适用。但是含有烟酰胺，重敏皮要避雷。</p><hr><h4 id="◎NO-2-简男六角瓶-（39-9元）"><a href="#◎NO-2-简男六角瓶-（39-9元）" class="headerlink" title="◎NO.2 简男六角瓶 （39.9元）"></a><a href="https://detail.tmall.com/item.htm?id=624915003970&spm=a1z10.5-b-s.w4023-23052492309.17.27651c92T8yG5B&skuId=4418147024711" target="_blank" rel="noopener external nofollow noreferrer">◎NO.2 简男六角瓶</a> （39.9元）</h4><p> 这是我多次回购的，油性肌肤用它没错了！</p><p>1【成分分析】</p><p>作为新型氨基酸粉末洁面，有着比传统乳状洗面奶更明显的优势，溶解速度快，上脸不黏腻，不担心像乳状一样可能会残留，用着舒心方便</p><p>备案没有任何乱七八糟的防腐剂香精成分，巨巨巨温和！甘露糖醇复配聚乙二醇负责保湿，氨基酸表活负责清洁，用之后才知道什么叫真正嫩滑不拔干，学术派护肤党我爱了。</p><p>2【酸碱测试】</p><p>跟皮肤贴合的完美酸碱值，接近于6，上脸一点刺激也没有。</p><p>3【使用体验】</p><p>相比于膏状和乳状以及泡泡洁面，粉状洁面使用感上升了好几个档次，用过的人都懂。</p><p>每次洗脸用一小盒，携带方便，干净卫生，出差日常都可。清洁效果的确挺神奇，每次都能感到颗粒感的粉质能够搓出来一些死皮和附着在毛孔表面的小白头，太加分了！</p><p>没有用过洁颜粉的，墙裂建议试试。</p><p>4【适用肤质】</p><p>尤其适合油皮男士！</p><hr><h4 id="◎NO3-旁氏米粹洗面奶（29-9-59元之间）"><a href="#◎NO3-旁氏米粹洗面奶（29-9-59元之间）" class="headerlink" title="◎NO3. 旁氏米粹洗面奶（29.9-59元之间）"></a><a href="https://s.click.taobao.com/yY8dzvu" target="_blank" rel="noopener external nofollow noreferrer">◎NO3. 旁氏米粹洗面奶</a>（29.9-59元之间）</h4><p>上榜的那位，虽然便宜量足。但是含有二氧化钛，洗完假白。相对来说旁氏米粹洁面泡泡这个亲兄弟更值得入。</p><p>不吹说，也就旁氏泡泡能摊得上便宜大碗，30块钱这么大一管，其他牌子就别来凑热闹了行么？</p><p>因为便宜，表活用的也是最便宜的椰油酰甘氨酸钾，氨基酸类，温和。</p><p>插一句，氨基酸洗面奶真的是很普通的一种洗面奶类型，工作关系总是看到各种洗面奶用氨基酸给自己抬身价，没啥稀罕的呀。</p><p>2【酸碱测试】</p><p>作为一款老实本分的温和型洁面，pH在6～7之间，接近皮肤本身的pH值，无论油皮干皮敏感肌都可以放心pick。</p><p>3【使用体验】</p><p>按压出来就是泡泡，不像珂润，旁氏的泡泡挤出来啥样上脸还啥样，不会变虚变薄。洗的时候有淡淡的淘米水味，搞得我每次洗脸都感到有点饿怎么肥四。洗完不干不紧绷，价格也很学生党，是我大学时期回购次数最多的洗面奶，谁让我穷呢～～</p><p>4【适用肤质】</p><p>只要不是两极分化的大庆油田或撒哈拉沙漠，大部分肤质都可。有香精，重敏的人不要用。</p><p>篇幅有限，其他洗面奶就来简单说一说。</p><hr><h4 id="◎NO4-日本UNO洗面奶-（55元）"><a href="#◎NO4-日本UNO洗面奶-（55元）" class="headerlink" title="◎NO4. 日本UNO洗面奶 （55元）"></a><a href="https://s.click.taobao.com/BM3f1wu" target="_blank" rel="noopener external nofollow noreferrer">◎NO4. 日本UNO洗面奶 （55元）</a></h4><p>NUO？我傻了。</p><p>UNO吾诺男士洗面奶有黑管、蓝管、绿管三种颜色，这76个泡泡值估计都是投给黑管的。</p><p>成分分析：皂基表活，清洁力强大。添加辣薄荷，洗感清凉。</p><p>使用体验：一个字爽，两个字凉爽。夏天用还好，秋冬真的有种抹风油精的感觉。洗完略紧绷，需要及时补水。</p><p>适用肤质：油性耐受肌。</p><hr><h4 id="◎NO5-碧欧泉洗面奶"><a href="#◎NO5-碧欧泉洗面奶" class="headerlink" title="◎NO5.  碧欧泉洗面奶"></a><a href="https://s.click.taobao.com/YKeczvu" target="_blank" rel="noopener external nofollow noreferrer">◎NO5.  碧欧泉洗面奶</a></h4><p>说实话，碧欧泉排行第五有点亏，可能价格有点小贵，用的人不多。所以给他投票的人也不多。</p><p>成分分析：同为皂基表活，但是整体比UNO要温和得多，添加了很多活性成分，贵有贵的理由。</p><p>使用体验：调香高级，淡淡的茶香，清洁力、温和性也平衡得很好，洗完完全不会感到拔干。</p><p>适用肤质：中性-油性耐受肌。</p><hr><h4 id="◎NO-6-Elta-MD（80-188元）"><a href="#◎NO-6-Elta-MD（80-188元）" class="headerlink" title="◎NO.6 Elta MD（80-188元）"></a><a href="https://s.click.taobao.com/ZFje1wu" target="_blank" rel="noopener external nofollow noreferrer">◎NO.6 Elta MD（80-188元）</a></h4><p>这款洗面奶JR用得不多，但在小红书上可是火的一塌糊涂。是美国各大皮肤科医生也会推荐的温和型洁面。</p><p>成分分析：典型的氨基酸洁面，加入了沸点很低的醚类，上脸30秒后可自动起泡。</p><p>使用体验：成也萧何，败也萧何。虽然这款洗面奶的亮点是可以自动发泡。但麻烦的是每次用完都要旋转泵头锁住洗面奶，不然它会吐泡泡到你怀疑人生。</p><p>适用肤质：全肤质适用。</p><hr><h4 id="◎NO-7理肤泉洗面奶"><a href="#◎NO-7理肤泉洗面奶" class="headerlink" title="◎NO.7理肤泉洗面奶"></a><a href="https://s.click.taobao.com/OuEe1wu" target="_blank" rel="noopener external nofollow noreferrer">◎NO.7理肤泉洗面奶</a></h4><p>相信很多人都是从理肤泉雅漾这类外国牌子开始接触药妆的。这款理肤泉特安洁面，从名字就能看出来非常适合敏感肌。</p><p>成分分析：宣传适合敏感肌的洁面却含有5种皂基表活成分，我有点方。感觉这个洁面更适合油皮才对。</p><p>适用体验：清洁力好，无香精防腐剂，虽然是皂基表活，但还算温和。</p><p>适用肤质：油皮、油皮敏感肌</p><hr><h4 id="◎NO-8欧莱雅"><a href="#◎NO-8欧莱雅" class="headerlink" title="◎NO.8欧莱雅"></a><a href="https://s.click.taobao.com/bcZe1wu" target="_blank" rel="noopener external nofollow noreferrer">◎NO.8欧莱雅</a></h4><p>火山泥在JR心中是永远的神和永远的shi。</p><p>成分分析：典型的皂基表活，含有水杨酸，红色质地来自于高岭土。</p><p>使用体验：所谓男性去油系列，就是挂掉你脸上的油，刮油效果不是盖的，用完绷的感觉自己像干尸。油皮瞬间变干皮。对付直男就是要狠。但是这种刮油的方式只会加重痘痘，刺激痘痘，搞不好就会引起外油内干的情况出现。</p><p>适用肤质：油皮，不推荐。</p><hr><h4 id="◎NO-9雅诗兰黛白金洗面奶"><a href="#◎NO-9雅诗兰黛白金洗面奶" class="headerlink" title="◎NO.9雅诗兰黛白金洗面奶"></a>◎NO.9雅诗兰黛白金洗面奶</h4><p>雅诗兰黛白金洗面奶号称可以温和卸妆。这款分为有泡板和无泡板。看包装，有泡foam，无泡creme.</p><p>成分分析：氨基酸系贵妇洗面奶。大牌们可能是商量好的，只要出氨基酸洗面奶就要可着劲儿的添加活性成分，不管这些活性成分有没有用，加上去就能宣传卖高价。</p><p>适用体验：贵妇洗面奶使用感就是好呀，质地、泡沫、调香没得说。但是这些活性成分没卵用，要知道洗面奶只在脸上停留几十秒钟，这么短的时间内，活性成分是不可能被吸收的。</p><p>适用肤质：全肤质适用</p><hr><h4 id="◎NO-10丝塔芙洗面奶"><a href="#◎NO-10丝塔芙洗面奶" class="headerlink" title="◎NO.10丝塔芙洗面奶"></a><a href="https://s.click.taobao.com/8eJczvu" target="_blank" rel="noopener external nofollow noreferrer">◎NO.10丝塔芙洗面奶</a></h4><p>没有想到丝塔芙这种毫无清洁力的洗面奶，还能在JR心中占有一席之地。</p><p>成分分析：备案成分一共8种。清洁剂一种，防腐剂三种，神了。清洁剂虽然是我们常说的刺激性较大的SLS，但是添加量较低，对皮肤造不成什么伤害。</p><p>使用体验：个人油性皮肤，对这种几乎无泡无清洁力的洗面奶不感冒，洗完感觉滑滑的，一点都没洗干净。可能干皮会比较喜欢它的温和吧。</p><p>适用肤质：干皮</p><hr><p><a href="https://bbs.hupu.com/38273427.html" target="_blank" rel="noopener external nofollow noreferrer">Source</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;作为全虎扑拥有洗面奶最多的男人，我评价一款洗面奶永远不是嘴上说好用不好用那么简单。好用要有好用的理由，不好用也要说出不好用的地方。&lt;/p&gt;</summary>
    
    
    
    
    <category term="生活" scheme="https://kobingogo.github.io/tags/%E7%94%9F%E6%B4%BB/"/>
    
  </entry>
  
  <entry>
    <title>npm依赖管理中容易被忽略细节</title>
    <link href="https://kobingogo.github.io/node-2020-09-15-npm%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86%E4%B8%AD%E5%AE%B9%E6%98%93%E8%A2%AB%E5%BF%BD%E7%95%A5%E7%BB%86%E8%8A%82/"/>
    <id>https://kobingogo.github.io/node-2020-09-15-npm%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86%E4%B8%AD%E5%AE%B9%E6%98%93%E8%A2%AB%E5%BF%BD%E7%95%A5%E7%BB%86%E8%8A%82/</id>
    <published>2020-09-15T15:38:27.000Z</published>
    <updated>2022-02-07T02:52:27.799Z</updated>
    
    <content type="html"><![CDATA[<p>提起 npm，大家第一个想到的应该就是 npm install 了，但是 npm install 之后生成的 node_modules 大家有观察过吗？package-lock.json 文件的作用大家知道吗？除了 dependencies 和 devDependencies，其他的依赖有什么作用呢？接下来，本文将针对 npm 中的你可能忽略的细节和大家分享一些经验 。</p><span id="more"></span><h3 id="npm-安装机制"><a href="#npm-安装机制" class="headerlink" title="npm 安装机制"></a>npm 安装机制</h3><p>A 和 B 同时依赖 C，C 这个包会被安装在哪里呢？C 的版本相同和版本不同时安装会有什么差异呢？package.json 中包的前后顺序对于安装时有什么影响吗？这些问题平时大家可能没有注意过，今天我们就来一起研究一下吧。</p><h3 id="A-和-B-同时依赖-C，这个包会被安装在哪里呢？"><a href="#A-和-B-同时依赖-C，这个包会被安装在哪里呢？" class="headerlink" title="A 和 B 同时依赖 C，这个包会被安装在哪里呢？"></a>A 和 B 同时依赖 C，这个包会被安装在哪里呢？</h3><p>假如有 A 和 B 两个包，两个包都依赖 C 这个包，npm 2 会依次递归安装 A 和 B 两个包及其子依赖包到 node_modules 中。执行完毕后，我们会看到 <code>./node_modules </code>这层目录只含有这两个子目录：</p><p>node_modules/<br>├─┬ A<br>│ ├── C<br>├─┬ B<br>│ └── C</p><p>如果使用 npm 3 来进行安装的话，<code>./node_modules</code> 下的目录将会包含三个子目录：</p><p>node_modules/<br>├─┬ A<br>├─┬ B<br>├─┬ C</p><p>为什么会出现这样的区别呢？这就要从 npm 的工作方式说起了：</p><h3 id="npm-2-和-npm-3-模块安装机制的差异"><a href="#npm-2-和-npm-3-模块安装机制的差异" class="headerlink" title="npm 2 和 npm 3 模块安装机制的差异"></a>npm 2 和 npm 3 模块安装机制的差异</h3><p>虽然目前最新的 npm 版本是 npm 6，但 npm 2 到 npm 3 的版本变更中实现了目录打平，与其他版本相比差别较大。因此，让我们具体看下这两个版本的差异​。</p><p>npm 2 在安装依赖包时，采用简单的递归安装方法。执行 npm install 后，npm 根据 dependencies 和 devDependencies 属性中指定的包来确定第一层依赖，npm 2 会根据第一层依赖的子依赖，递归安装各个包到子依赖的 node_modules 中，直到子依赖不再依赖其他模块。执行完毕后，我们会看到 ./node_modules 这层目录中包含有我们 package.json 文件中所有的依赖包，而这些依赖包的子依赖包都安装在了自己的 node_modules 中 ，形成类似于下面的依赖树：<br><img src="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20200915234216.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20200915234216.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="20200915234216"></p><p>这样的目录有较为明显的好处：</p><ol><li>层级结构非常明显，可以清楚的在第一层的 node_modules 中看到我们安装的所有包的子目录；</li><li>在已知自己所需包的名字以及版本号时，可以复制粘贴相应的文件到 node_modules 中，然后手动更改 package.json 中的配置；</li><li>如果想要删除某个包，只需要简单的删除 package.json 文件中相应的某一行，然后删除 node_modules 中该包的目录；</li></ol><p>但是这样的层级结构也有较为明显的缺陷，当我的 A，B，C 三个包中有相同的依赖 D 时，执行 <code>npm install</code> 后，D 会被重复下载三次，而随着我们的项目越来越复杂，node_modules 中的依赖树也会越来越复杂，像 D 这样的包也会越来越多，造成了大量的冗余；在 windows 系统中，甚至会因为目录的层级太深导致文件的路径过长，触发文件路径不能超过 280 个字符的错误；</p><p>​ 为了解决以上问题，npm 3 的 node_modules 目录改成了更为扁平状的层级结构，尽量把依赖以及依赖的依赖平铺在 node_modules 文件夹下共享使用。</p><h3 id="npm-3-对于同一依赖的不同版本会怎么处理呢？"><a href="#npm-3-对于同一依赖的不同版本会怎么处理呢？" class="headerlink" title="npm 3 对于同一依赖的不同版本会怎么处理呢？"></a>npm 3 对于同一依赖的不同版本会怎么处理呢？</h3><p>npm 3 会遍历所有的节点，逐个将模块放在 node_modules 的第一层，当发现有重复模块时，则丢弃， 如果遇到某些依赖版本不兼容的问题，则继续采用 npm 2 的处理方式，前面的放在 node_modules 目录中，后面的放在依赖树中。举个例子： A，B，依赖 D(v 0.0.1)，C 依赖 D(v 0.0.2):</p><p><img src="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20200915234325.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20200915234325.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="20200915234325"></p><p>但是 npm 3 会带来一个新的问题：由于在执行 <code>npm install</code> 的时候，按照 <code>package.json </code>里依赖的顺序依次解析，上图如果 C 的顺序在 A，B 的前边，node_modules 树则会改变，会出现下边的情况：</p><p><img src="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20200915234354.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20200915234354.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="20200915234354"></p><p>由此可见，npm 3 并未完全解决冗余的问题，甚至还会带来新的问题。</p><h3 id="为什么会出现-package-lock-json-呢？"><a href="#为什么会出现-package-lock-json-呢？" class="headerlink" title="为什么会出现 package-lock.json 呢？"></a>为什么会出现 package-lock.json 呢？</h3><p>为什么会有 package-lock.json 文件呢？这个我们就要先从 package.json 文件说起了。</p><h3 id="package-json-的不足之处"><a href="#package-json-的不足之处" class="headerlink" title="package.json 的不足之处"></a>package.json 的不足之处</h3><p>npm install 执行后，会生成一个 node_modules 树，在理想情况下， 希望对于同一个 package.json 总是生成完全相同 node_modules 树。在某些情况下，确实如此。但在多数情况下，npm 无法做到这一点。有以下两个原因：</p><p>1）某些依赖项自上次安装以来，可能已发布了新版本 。比如：A 包在团队中第一个人安装的时候是 1.0.5 版本，package.json 中的配置项为 A: &#39;^1.0.5&#39; ；团队中第二个人把代码拉下来的时候，A 包的版本已经升级成了 1.0.8，根据 package.json 中的 semver-range version 规范，此时第二个人 npm install 后 A 的版本为 1.0.8； 可能会造成因为依赖版本不同而导致的 bug；</p><p>2）针对 1）中的问题，可能有的小伙伴会想，把 A 的版本号固定为 A: &#39;1.0.5&#39; 不就可以了吗？但是这样的做法其实并没有解决问题， 比如 A 的某个依赖在第一个人下载的时候是 2.1.3 版本，但是第二个人下载的时候已经升级到了 2.2.5 版本，此时生成的 node_modules 树依旧不完全相同 ，固定版本只是固定来自身的版本，依赖的版本无法固定。</p><h3 id="针对-package-json-不足的解决方法"><a href="#针对-package-json-不足的解决方法" class="headerlink" title="针对 package.json 不足的解决方法"></a>针对 package.json 不足的解决方法</h3><p>为了解决上述问题以及 npm 3 的问题，在 npm 5.0 版本后，npm install 后都会自动生成一个 package-lock.json 文件 ，当包中有 package-lock.json 文件时，npm install 执行时，如果 package.json 和 package-lock.json 中的版本兼容，会根据 package-lock.json 中的版本下载；如果不兼容，将会根据 package.json 的版本，更新 package-lock.json 中的版本，已保证 package-lock.json 中的版本兼容 package.json。</p><h3 id="package-lock-json-文件的结构"><a href="#package-lock-json-文件的结构" class="headerlink" title="package-lock.json 文件的结构"></a>package-lock.json 文件的结构</h3><p>package-lock.json 文件中的 name、version 与 package.json 中的 name、version 一样，描述了当前包的名字和版本，dependencies 是一个对象，该对象和 node_modules 中的包结构一一对应，对象的 key 为包的名称，值为包的一些描述信息， 根据 <a href="https://docs.npmjs.com/configuring-npm/package-lock-json.html#requires" target="_blank" rel="noopener external nofollow noreferrer">package-lock-json</a>官方文档，主要的结构如下：</p><ul><li>version ：包版本，即这个包当前安装在 node_modules 中的版本</li><li>resolved ：包具体的安装来源</li><li>integrity ：包 hash 值，验证已安装的软件包是否被改动过、是否已失效</li><li>requires ：对应子依赖的依赖，与子依赖的 package.json 中 dependencies 的依赖项相同</li><li>dependencies ：结构和外层的 dependencies 结构相同，存储安装在子依赖 node_modules 中的依赖包</li></ul><p>需要注意的是，并不是所有的子依赖都有 <code>dependencies</code> 属性，只有子依赖的依赖和当前已安装在根目录的 <code>node_modules</code> 中的依赖冲突之后，才会有这个属性。</p><h3 id="package-lock-json-文件的作用"><a href="#package-lock-json-文件的作用" class="headerlink" title="package-lock.json 文件的作用"></a>package-lock.json 文件的作用</h3><ul><li>在团队开发中，确保每个团队成员安装的依赖版本是一致的，确定一棵唯一的 node_modules 树；</li><li>node_modules 目录本身是不会被提交到代码库的，但是 package-lock.json 可以提交到代码库，如果开发人员想要回溯到某一天的目录状态，只需要把 package.json 和 package-lock.json 这两个文件回退到那一天即可 。</li><li>由于 package-lock.json 和 node_modules 中的依赖嵌套完全一致，可以更加清楚的了解树的结构及其变化。</li><li>在安装时，npm 会比较 node_modules 已有的包，和 package-lock.json 进行比较，如果重复的话，就跳过安装 ，从而优化了安装的过程。</li></ul><h3 id="依赖的区别与使用场景"><a href="#依赖的区别与使用场景" class="headerlink" title="依赖的区别与使用场景"></a>依赖的区别与使用场景</h3><p>npm 目前支持以下几类依赖包管理包括</p><ul><li>dependencies</li><li>devDependencies</li><li>optionalDependencies 可选择的依赖包</li><li>peerDependencies 同等依赖</li><li>bundledDependencies 捆绑依赖包</li></ul><p>下面我们来看一下这几种依赖的区别以及各自的应用场景：</p><h4 id="dependencies"><a href="#dependencies" class="headerlink" title="dependencies"></a>dependencies</h4><p>dependencies 是无论在开发环境还是在生产环境都必须使用的依赖，是我们最常用的依赖包管理对象，例如 React，Loadsh，Axios 等，通过 npm install XXX 下载的包都会默认安装在 dependencies 对象中，也可以使用 npm install XXX --save 下载 dependencies 中的包；</p><h4 id="devDependencies"><a href="#devDependencies" class="headerlink" title="devDependencies"></a>devDependencies</h4><p>devDependencies 是指可以在开发环境使用的依赖，例如 eslint，debug 等，通过 npm install packageName --save-dev 下载的包都会在 devDependencies 对象中；</p><p>dependencies 和 devDependencies 最大的区别是在打包运行时，执行 npm install 时默认会把所有依赖全部安装，但是如果使用 <code>npm install --production</code> 时就只会安装 dependencies 中的依赖，如果是 node 服务项目，就可以采用这样的方式用于服务运行时安装和打包，减少包大小。</p><h4 id="optionalDependencies"><a href="#optionalDependencies" class="headerlink" title="optionalDependencies"></a>optionalDependencies</h4><p>optionalDependencies 指的是可以选择的依赖，当你希望某些依赖即使下载失败或者没有找到时，项目依然可以正常运行或者 npm 继续运行的时，就可以把这些依赖放在 optionalDependencies 对象中，但是 optionalDependencies 会覆盖 dependencies 中的同名依赖包，所以不要把一个包同时写进两个对象中。</p><p>optionalDependencies 就像是我们的代码的一种保护机制一样，如果包存在的话就走存在的逻辑，不存在的就走不存在的逻辑。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> axios = <span class="built_in">require</span>(<span class="string">&#x27;axios&#x27;</span>)</span><br><span class="line">  <span class="keyword">var</span> fooVersion = <span class="built_in">require</span>(<span class="string">&#x27;axios/package.json&#x27;</span>).<span class="property">version</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (er) &#123;</span><br><span class="line">  foo = <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// .. then later in your program ..</span></span><br><span class="line"><span class="keyword">if</span> (foo) &#123;</span><br><span class="line">  foo.<span class="title function_">doFooThings</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="peerDependencies"><a href="#peerDependencies" class="headerlink" title="peerDependencies"></a>peerDependencies</h4><p>peerDependencies 用于指定你当前的插件兼容的宿主必须要安装的包的版本，这个是什么意思呢？举个例子🌰：我们常用的 react 组件库 <a href="mailto:&#x61;&#x6e;&#x74;&#45;&#x64;&#x65;&#x73;&#x69;&#103;&#x6e;&#x40;&#x33;&#46;&#x78;">&#x61;&#x6e;&#x74;&#45;&#x64;&#x65;&#x73;&#x69;&#103;&#x6e;&#x40;&#x33;&#46;&#x78;</a> 的 package.json 中的配置如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;peerDependencies&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;react&quot;</span>: <span class="string">&quot;&gt;=16.9.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;react-dom&quot;</span>: <span class="string">&quot;&gt;=16.9.0&quot;</span></span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure><p> 假设我们创建了一个名为 project 的项目，在此项目中我们要使用 <a href="mailto:&#97;&#x6e;&#x74;&#x2d;&#100;&#101;&#x73;&#105;&#103;&#110;&#64;&#x33;&#46;&#x78;">&#97;&#x6e;&#x74;&#x2d;&#100;&#101;&#x73;&#105;&#103;&#110;&#64;&#x33;&#46;&#x78;</a> 这个插件，此时我们的项目就必须先安装 React &gt;= 16.9.0 和 React-dom &gt;= 16.9.0 的版本。​</p><p>在 npm 2 中，当我们下载 <a href="mailto:&#97;&#x6e;&#116;&#45;&#x64;&#x65;&#115;&#105;&#x67;&#x6e;&#x40;&#51;&#x2e;&#x78;">&#97;&#x6e;&#116;&#45;&#x64;&#x65;&#115;&#105;&#x67;&#x6e;&#x40;&#51;&#x2e;&#x78;</a> 时，peerDependencies 中指定的依赖会随着 <a href="mailto:&#97;&#110;&#116;&#45;&#100;&#x65;&#115;&#x69;&#x67;&#x6e;&#x40;&#x33;&#x2e;&#x78;">&#97;&#110;&#116;&#45;&#100;&#x65;&#115;&#x69;&#x67;&#x6e;&#x40;&#x33;&#x2e;&#x78;</a> 一起被强制安装，所以我们不需要在宿主项目的 package.json 文件中指定 peerDependencies 中的依赖，但是在 npm 3 中，不会再强制安装 peerDependencies 中所指定的包，而是通过警告的方式来提示我们，此时就需要手动在 package.json 文件中手动添加依赖；</p><h4 id="bundledDependencies"><a href="#bundledDependencies" class="headerlink" title="bundledDependencies"></a>bundledDependencies</h4><p>这个依赖项也可以记为 bundleDependencies，与其他几种依赖项不同，他不是一个键值对的对象，而是一个数组，数组里是包名的字符串，例如：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;project&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;bundleDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;axios&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;lodash&quot;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>当使用 npm pack 的方式来打包时，上述的例子会生成一个 project-1.0.0.tgz 的文件，在使用了 bundledDependencies 后，打包时会把 Axios 和 Lodash 这两个依赖一起放入包中，之后有人使用 npm install project-1.0.0.tgz 下载包时，Axios 和 Lodash 这两个依赖也会被安装。需要注意的是安装之后 Axios 和 Lodash 这两个包的信息在 dependencies 中，并且不包括版本信息。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;bundleDependencies&quot;</span>: [</span><br><span class="line">  <span class="string">&quot;axios&quot;</span>,</span><br><span class="line">  <span class="string">&quot;lodash&quot;</span></span><br><span class="line">],</span><br><span class="line"><span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;axios&quot;</span>: <span class="string">&quot;*&quot;</span>,</span><br><span class="line">  <span class="string">&quot;lodash&quot;</span>: <span class="string">&quot;*&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果我们使用常规的 npm publish 来发布的话，这个属性是不会生效的，所以日常情况中使用的较少。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>本文介绍的是 npm 2，npm 3，package-lock.json 以及几种依赖的区别和使用场景，希望能够让大家对 npm 的了解更加多一点，有什么不清楚的地方或者不足之处欢迎大家在评论区留言。</p><p>原文转载自：<a href="https://www.zoo.team/article/npm-details" target="_blank" rel="noopener external nofollow noreferrer">https://www.zoo.team/article/npm-details</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;提起 npm，大家第一个想到的应该就是 npm install 了，但是 npm install 之后生成的 node_modules 大家有观察过吗？package-lock.json 文件的作用大家知道吗？除了 dependencies 和 devDependencies，其他的依赖有什么作用呢？接下来，本文将针对 npm 中的你可能忽略的细节和大家分享一些经验 。&lt;/p&gt;</summary>
    
    
    
    <category term="npm" scheme="https://kobingogo.github.io/categories/npm/"/>
    
    
    <category term="npm" scheme="https://kobingogo.github.io/tags/npm/"/>
    
  </entry>
  
  <entry>
    <title>在 React 中实现 keep alive</title>
    <link href="https://kobingogo.github.io/framework-react-keep-alive/"/>
    <id>https://kobingogo.github.io/framework-react-keep-alive/</id>
    <published>2020-09-15T15:25:43.000Z</published>
    <updated>2022-02-07T02:52:27.796Z</updated>
    
    <content type="html"><![CDATA[<p>本文介绍一种在react中实现Vue的keep alive功能的方案。</p><span id="more"></span><h3 id="什么是-keep-alive"><a href="#什么是-keep-alive" class="headerlink" title="什么是 keep alive"></a>什么是 keep alive</h3><p>在 Vue 中，我们可以使用 keep-alive 包裹一个动态组件，从而缓存不活跃的实例，而不是直接销毁他们：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;view&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这对于某些路由切换等场景非常好用，例如，如果我们需要实现一个列表页和详情页，但在用户从详情页返回列表的时候，我们不希望重新请求接口获取，也不希望重置列表的过滤、排序等条件，那这时就可以对列表页的组件用 keep-alive 包裹一下，这样，当路由切换时，Vue 会将这个组件“失活”并缓存起来，而不是直接卸载掉。</p><h3 id="最简单的方案"><a href="#最简单的方案" class="headerlink" title="最简单的方案"></a>最简单的方案</h3><p>而在 React 中，其实一直以来都没有官方的 keep alive 解决方案，大部分开发者可能都会直接使用 display: none 来将 DOM 隐藏：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style=&#123;shouldHide ? &#123;<span class="attr">display</span>: <span class="string">&#x27;none&#x27;</span>&#125; : &#123;&#125;&#125;&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Foo</span>/&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>但这种方案其实只是在“视觉上”将元素隐藏起来了，并没有真正的移除，那有没有可能把 DOM 树真的移除掉，同时又让组件不被销毁呢？</p><h3 id="Portal实现"><a href="#Portal实现" class="headerlink" title="Portal实现"></a>Portal实现</h3><blockquote><p>Portal 提供了一种将子节点渲染到存在于父组件以外的 DOM 节点的优秀的方案。</p></blockquote><p>这是 React <a href="https://zh-hans.reactjs.org/docs/portals.html" target="_blank" rel="noopener external nofollow noreferrer">官方文档</a>上对 Portal 特性的介绍，值得注意的是，这里只是说“父组件以外的 DOM 节点”，但没有要求这个 DOM 节点是真的在页面上，还是只是存在于内存中。 因此，我们可以先通过 document.createElement 在内存中创建一个元素，然后再通过 React.createPoral 把 React 子节点渲染到这个元素上，这样就实现了“空渲染”。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> targetElement = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">createPortal</span>(child, targetElement)</span><br></pre></td></tr></table></figure><p>基于这种方案，我们可以进一步封装出一个 Conditional 组件，从而实现通用性的条件渲染逻辑：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">Conditional</span> = props =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [targetElement] = <span class="title function_">useState</span>(<span class="function">() =&gt;</span> <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>))</span><br><span class="line">  <span class="keyword">const</span> containerRef = <span class="title function_">useRef</span>()</span><br><span class="line">  <span class="title function_">useLayoutEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">active</span>) &#123;</span><br><span class="line">      containerRef.<span class="property">current</span>.<span class="title function_">appendChild</span>(targetElement)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        containerRef.<span class="property">current</span>.<span class="title function_">removeChild</span>(targetElement)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [props.<span class="property">active</span>])</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;containerRef&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;ReactDOM.createPortal(props.children, targetElement)&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>首先，我们创建了一个 targetElement ，并且通过 createPortal 将 children 渲染到 targetElement 。 然后，我们会创建一个容器 div 元素，并且通过 containerRef 拿到它的引用。 最后，当 active 为 true 时，我们会把 targetElement 手动添加到 containerRef.current 的内部，反之，则会从其内部移除掉 targetElement 。 实际使用的方式如下：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Conditional</span> active=&#123;!shouldHide&#125;&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Foo</span>/&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">Conditional</span>&gt;</span><br></pre></td></tr></table></figure><h3 id="懒加载"><a href="#懒加载" class="headerlink" title="懒加载"></a>懒加载</h3><p>细心的读者可能会发现，目前我们的 Conditional 组件还有一点小小的瑕疵：当组件初次渲染时，不论当前的 active 是 true 还是 false ， Conditional 组件都会将 props.children 渲染。这对大型应用可能会带来非常明显的性能问题，所以，我们可以为其增加“懒加载”的特性：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">Conditional</span> = props =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [targetElement] = <span class="title function_">useState</span>(<span class="function">() =&gt;</span> <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>))</span><br><span class="line">  <span class="keyword">const</span> containerRef = <span class="title function_">useRef</span>()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 增加一个 ref 记录组件是否“被激活过”</span></span><br><span class="line">  <span class="keyword">const</span> activatedRef = <span class="title function_">useRef</span>(<span class="literal">false</span>)</span><br><span class="line">  activatedRef.<span class="property">current</span> = activatedRef.<span class="property">current</span> || props.<span class="property">active</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">useLayoutEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">active</span>) &#123;</span><br><span class="line">      containerRef.<span class="property">current</span>.<span class="title function_">appendChild</span>(targetElement)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        containerRef.<span class="property">current</span>.<span class="title function_">removeChild</span>(targetElement)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [props.<span class="property">active</span>])</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;containerRef&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;activatedRef.current &amp;&amp; ( // 如果“被激活过”，才渲染 children</span></span><br><span class="line"><span class="language-xml">        ReactDOM.createPortal(props.children, targetElement)</span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="一些遗憾"><a href="#一些遗憾" class="headerlink" title="一些遗憾"></a>一些遗憾</h3><p>不得不承认的是，基于 Portal 方案的 Conditional 组件并不能包治百病，和 Vue 的 keep-alive 相比，也存在不少缺憾：</p><ol><li>需要手动控制 active ，不能直接基于子组件销毁/创建的生命周期事件</li><li>缺少失活/激活的生命周期时间，子组件无法感知自己是不是被缓存起来了</li><li>依赖了 ReactDOM ，对 SSR 不够友好</li></ol><p>原文转载自知乎：<a href="https://zhuanlan.zhihu.com/p/214166951" target="_blank" rel="noopener external nofollow noreferrer">在 React 中实现 keep alive</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;本文介绍一种在react中实现Vue的keep alive功能的方案。&lt;/p&gt;</summary>
    
    
    
    <category term="react" scheme="https://kobingogo.github.io/categories/react/"/>
    
    
    <category term="react" scheme="https://kobingogo.github.io/tags/react/"/>
    
    <category term="keep alice" scheme="https://kobingogo.github.io/tags/keep-alice/"/>
    
  </entry>
  
  <entry>
    <title>数据结构与算法知识点汇总</title>
    <link href="https://kobingogo.github.io/algorithms-%E5%BC%80%E7%AF%87/"/>
    <id>https://kobingogo.github.io/algorithms-%E5%BC%80%E7%AF%87/</id>
    <published>2020-06-22T10:09:54.000Z</published>
    <updated>2022-02-07T02:52:27.795Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20200622182516.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20200622182516.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p>]]></content>
    
    
    <summary type="html">数据结构与算法知识点汇总</summary>
    
    
    
    <category term="数据结构与算法" scheme="https://kobingogo.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="数据结构与算法" scheme="https://kobingogo.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>LeetCode题解记录</title>
    <link href="https://kobingogo.github.io/algorithms-leetcode/"/>
    <id>https://kobingogo.github.io/algorithms-leetcode/</id>
    <published>2020-06-21T13:56:01.000Z</published>
    <updated>2022-02-07T02:52:27.795Z</updated>
    
    <content type="html"><![CDATA[<h1 id="leetCode题解记录"><a href="#leetCode题解记录" class="headerlink" title="leetCode题解记录"></a>leetCode题解记录</h1><ul><li><a href="#leetcode%E9%A2%98%E8%A7%A3%E8%AE%B0%E5%BD%95">leetCode题解记录</a><ul><li><a href="#%E6%95%B0%E7%BB%84%E7%B1%BB">数组类</a><ul><li><a href="#%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93">常用方法总结：</a></li><li><a href="#%E4%B8%A4%E6%95%B0%E4%B9%8B%E5%92%8C">两数之和</a></li><li><a href="#15-%E4%B8%89%E6%95%B0%E4%B9%8B%E5%92%8C">15. 三数之和</a></li><li><a href="#16-%E6%9C%80%E6%8E%A5%E8%BF%91%E7%9A%84%E4%B8%89%E6%95%B0%E4%B9%8B%E5%92%8C">16. 最接近的三数之和</a></li><li><a href="#%E6%9C%80%E5%A4%A7%E5%AD%90%E5%BA%8F%E5%92%8C">最大子序和</a></li><li><a href="#239-%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E6%9C%80%E5%A4%A7%E5%80%BC">239. 滑动窗口最大值</a></li><li><a href="#%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84">合并两个有序数组</a></li><li><a href="#14-%E6%9C%80%E9%95%BF%E5%85%AC%E5%85%B1%E5%89%8D%E7%BC%80">14. 最长公共前缀</a></li></ul></li><li><a href="#%E9%93%BE%E8%A1%A8%E7%B1%BB">链表类</a><ul><li><a href="#%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93-1">常用方法总结：</a></li><li><a href="#%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E9%93%BE%E8%A1%A8">合并两个有序链表</a></li><li><a href="#141-%E7%8E%AF%E5%BD%A2%E9%93%BE%E8%A1%A8">141. 环形链表</a></li><li><a href="#142-%E7%8E%AF%E5%BD%A2%E9%93%BE%E8%A1%A8-ii">142. 环形链表 II</a></li><li><a href="#%E5%8F%8D%E8%BD%AC%E9%93%BE%E8%A1%A8">反转链表</a></li><li><a href="#19-%E5%88%A0%E9%99%A4%E9%93%BE%E8%A1%A8%E7%9A%84%E5%80%92%E6%95%B0%E7%AC%ACn%E4%B8%AA%E8%8A%82%E7%82%B9">19. 删除链表的倒数第N个节点</a></li><li><a href="#876-%E9%93%BE%E8%A1%A8%E7%9A%84%E4%B8%AD%E9%97%B4%E7%BB%93%E7%82%B9">876. 链表的中间结点</a></li></ul></li><li><a href="#%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E7%B1%BB">动态规划类</a><ul><li><a href="#309-%E6%9C%80%E4%BD%B3%E4%B9%B0%E5%8D%96%E8%82%A1%E7%A5%A8%E6%97%B6%E6%9C%BA%E5%90%AB%E5%86%B7%E5%86%BB%E6%9C%9F">309. 最佳买卖股票时机含冷冻期</a></li><li><a href="#%E9%9D%A2%E8%AF%95%E9%A2%98-1713-%E6%81%A2%E5%A4%8D%E7%A9%BA%E6%A0%BC">面试题 17.13. 恢复空格</a></li><li><a href="#96-%E4%B8%8D%E5%90%8C%E7%9A%84%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91">96. 不同的二叉搜索树</a></li></ul></li></ul></li></ul><h2 id="数组类"><a href="#数组类" class="headerlink" title="数组类"></a>数组类</h2><div class="story post-story"><h3 id="常用方法总结："><a href="#常用方法总结：" class="headerlink" title="常用方法总结："></a>常用方法总结：</h3><ul><li>结合Object(Map/set)等数据结构来解题；</li><li>滑动窗口方法（最小（大）子集等问题适用）</li><li>Trie 树</li></ul><h3 id="两数之和"><a href="#两数之和" class="headerlink" title="两数之和"></a><a href="https://leetcode-cn.com/problems/two-sum/" target="_blank" rel="noopener external nofollow noreferrer">两数之和</a></h3><p>给定一个整数数组 nums 和一个目标值 target，请你在该数组中找出和为目标值的那 两个 整数，并返回他们的数组下标。</p><p>你可以假设每种输入只会对应一个答案。但是，数组中同一个元素不能使用两遍。</p><p>示例:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">给定 nums = [<span class="number">2</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">15</span>], target = <span class="number">9</span></span><br><span class="line"></span><br><span class="line">因为 nums[<span class="number">0</span>] + nums[<span class="number">1</span>] = <span class="number">2</span> + <span class="number">7</span> = <span class="number">9</span></span><br><span class="line">所以返回 [<span class="number">0</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></figure><p>方法一：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number[]</span>&#125; <span class="variable">nums</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; <span class="variable">target</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">number[]</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> twoSum = <span class="keyword">function</span>(<span class="params">nums, target</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> result = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>, length = nums.<span class="property">length</span>; i &lt; length; i++)&#123;</span><br><span class="line">        <span class="keyword">const</span> left = target - nums[i];</span><br><span class="line">        <span class="keyword">const</span> leftIndex = nums.<span class="title function_">lastIndexOf</span>(left);</span><br><span class="line">        <span class="keyword">if</span>(leftIndex &gt; i)&#123;</span><br><span class="line">            result = [i ,leftIndex];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>复杂度分析：</strong></p><ul><li>时间复杂度：O(n<sup>2</sup>)</li><li>空间复杂度：o(1)</li></ul><p>方法二：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> twoSum = <span class="keyword">function</span>(<span class="params">nums, target</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i&lt; nums.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> k = target-nums[i]</span><br><span class="line">        <span class="keyword">if</span>(map.<span class="title function_">has</span>(k)) &#123;</span><br><span class="line">            <span class="keyword">return</span> [map.<span class="title function_">get</span>(k), i]</span><br><span class="line">        &#125;</span><br><span class="line">        map.<span class="title function_">set</span>(nums[i], i)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>复杂度分析：</strong></p><ul><li>时间复杂度：O(n)</li><li>空间复杂度：o(n)</li></ul><h3 id="15-三数之和"><a href="#15-三数之和" class="headerlink" title="15. 三数之和"></a><a href="https://leetcode-cn.com/problems/3sum" target="_blank" rel="noopener external nofollow noreferrer">15. 三数之和</a></h3><p><strong>解题思路：</strong></p><ol><li>首先对数组从大到小进行排序；</li><li>遍历数组，设置左右俩指针初始位置在数组左右边界（first = i + 1,last = length -1）;</li><li>如果i, first, last 三个数值大于0，则last左移，如果小于0，则first右移；</li><li>使得最终三数之和等于0，则成功找出一组。重复步骤2。</li></ol><p><strong>实现代码:</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> threeSum = <span class="keyword">function</span> (<span class="params">nums</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> res = [];</span><br><span class="line">  <span class="keyword">let</span> length = nums.<span class="property">length</span>;</span><br><span class="line">  nums.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a - b); <span class="comment">// 先排个队，最左边是最弱（小）的，最右边是最强(大)的</span></span><br><span class="line">  <span class="keyword">if</span> (nums[<span class="number">0</span>] &gt; <span class="number">0</span> || nums[length - <span class="number">1</span>] &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length - <span class="number">2</span>; i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nums[i] &gt; <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">let</span> first = i + <span class="number">1</span>, last = length - <span class="number">1</span>, sum;</span><br><span class="line">    <span class="keyword">while</span> (first &lt; last) &#123;</span><br><span class="line">      sum = nums[i] + nums[first] + nums[last];</span><br><span class="line">      <span class="keyword">if</span> (sum === <span class="number">0</span>) &#123;</span><br><span class="line">        res.<span class="title function_">push</span>([nums[i], nums[first], nums[last]]);</span><br><span class="line">        <span class="keyword">while</span> (first &lt; last &amp;&amp; nums[first] === nums[++first]) &#123; &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sum &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span> (first &lt; last &amp;&amp; nums[first] === nums[++first]) &#123; &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (first &lt; last &amp;&amp; nums[last] === nums[--last]) &#123; &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (nums[i] === nums[++i]) &#123; &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>复杂度分析</strong></p><ul><li>时间复杂度： O(n<sup>2</sup>)</li></ul><h3 id="16-最接近的三数之和"><a href="#16-最接近的三数之和" class="headerlink" title="16. 最接近的三数之和"></a><a href="https://leetcode-cn.com/problems/3sum-closest/" target="_blank" rel="noopener external nofollow noreferrer">16. 最接近的三数之和</a></h3><p><strong>解题思路</strong></p><p>思路同上一题类似，不同点在于此题是求最接近给定值的解。</p><p><strong>实现代码</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> threeSumClosest = <span class="keyword">function</span> (<span class="params">nums, target</span>) &#123;</span><br><span class="line">  nums.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a - b);</span><br><span class="line">  <span class="keyword">let</span> length = nums.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">let</span> result = nums[<span class="number">0</span>] + nums[<span class="number">1</span>] + nums[length - <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length - <span class="number">2</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> first = i + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">let</span> last = length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">let</span> sum;</span><br><span class="line">    <span class="keyword">while</span> (first &lt; last) &#123;</span><br><span class="line">      sum = nums[i] + nums[first] + nums[last];</span><br><span class="line">      sum &gt; target ? last-- : first++;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">abs</span>(target - result) &gt; <span class="title class_">Math</span>.<span class="title function_">abs</span>(target - sum)) &#123;</span><br><span class="line">        result = sum;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>复杂度分析</strong></p><ul><li>时间复杂度： O(n<sup>2</sup>)</li></ul><h3 id="最大子序和"><a href="#最大子序和" class="headerlink" title="最大子序和"></a>最大子序和</h3><p>算法：</p><p>在整个数组或在固定大小的滑动窗口中找到总和或最大值或最小值的问题可以通过动态规划（DP）在线性时间内解决。<br>有两种标准 DP 方法适用于数组：</p><ol><li>常数空间，沿数组移动并在原数组修改。</li><li>线性空间，首先沿 left-&gt;right 方向移动，然后再沿 right-&gt;left 方向移动。 合并结果。</li></ol><p>我们在这里使用第一种方法，因为可以修改数组跟踪当前位置的最大和。<br>下一步是在知道当前位置的最大和后更新全局最大和。</p><p><img src="https://s1.ax1x.com/2020/04/16/Jk1psf.png" class="lazyload" data-srcset="https://s1.ax1x.com/2020/04/16/Jk1psf.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Jk1psf.png"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number[]</span>&#125; <span class="variable">nums</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">number</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span><span class="keyword">var</span> maxSubArray = <span class="keyword">function</span> (<span class="params">nums</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (nums.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> maxSum = nums[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>, length = nums.<span class="property">length</span>; i &lt; length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nums[i - <span class="number">1</span>] &gt; <span class="number">0</span>) nums[i] += nums[i - <span class="number">1</span>]; <span class="comment">// index位上的值变为到这位为止的最大值</span></span><br><span class="line">    maxSum = <span class="title class_">Math</span>.<span class="title function_">max</span>(nums[i], maxSum); <span class="comment">// 取当前位与历史位的最大值</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> maxSum;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>复杂度分析:</strong></p><ul><li><p>时间复杂度：O(N)。只遍历了一次数组。</p></li><li><p>空间复杂度：O(1)，使用了常数的空间。</p></li></ul><h3 id="239-滑动窗口最大值"><a href="#239-滑动窗口最大值" class="headerlink" title="239. 滑动窗口最大值"></a><a href="https://leetcode-cn.com/problems/sliding-window-maximum/" target="_blank" rel="noopener external nofollow noreferrer">239. 滑动窗口最大值</a></h3><p><strong>解题思路</strong></p><ul><li>使用 队列 方式维护一个滑动窗口内的数值索引，并确保队列队首值是当前滑动窗口的最大值索引</li><li>对应索引i来说，在i前面并且比i的值小的数值是没有价值的，可以剔除掉</li></ul><p><strong>实现代码</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> maxSlidingWindow = <span class="keyword">function</span> (<span class="params">nums, k</span>) &#123;</span><br><span class="line">  <span class="comment">//queue保存 SlidingWindow 数据，其中首位是最大值的索引</span></span><br><span class="line">  <span class="keyword">const</span> queue = [], result = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; nums.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="comment">//剔除SlidingWindow外的数据</span></span><br><span class="line">    <span class="keyword">if</span> (i - queue[<span class="number">0</span>] &gt;= k) &#123;</span><br><span class="line">      queue.<span class="title function_">shift</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 剔除queue元素，确保queue首位保存的是最大值的索引</span></span><br><span class="line">    <span class="keyword">while</span> (nums[i] &gt; nums[queue[queue.<span class="property">length</span> - <span class="number">1</span>]]) &#123;</span><br><span class="line">      queue.<span class="title function_">pop</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    queue.<span class="title function_">push</span>(i)</span><br><span class="line">    <span class="comment">//从k-1开始输出结果</span></span><br><span class="line">    <span class="keyword">if</span> (i &gt;= k - <span class="number">1</span>) &#123;</span><br><span class="line">      result.<span class="title function_">push</span>(nums[queue[<span class="number">0</span>]])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="合并两个有序数组"><a href="#合并两个有序数组" class="headerlink" title="合并两个有序数组"></a><a href="https://leetcode-cn.com/problems/merge-sorted-array/" target="_blank" rel="noopener external nofollow noreferrer">合并两个有序数组</a></h3><p>给你两个有序整数数组 nums1 和 nums2，请你将 nums2 合并到 nums1 中，使 nums1 成为一个有序数组。</p><p>说明:</p><p>初始化 nums1 和 nums2 的元素数量分别为 m 和 n 。<br>你可以假设 nums1 有足够的空间（空间大小大于或等于 m + n）来保存 nums2 中的元素。<br>示例:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">输入:</span><br><span class="line">nums1 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>], m = <span class="number">3</span></span><br><span class="line">nums2 = [<span class="number">2</span>,<span class="number">5</span>,<span class="number">6</span>],       n = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">输出: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br></pre></td></tr></table></figure><p><strong>思路分析</strong>：<br>nums1 、 nums2 有序，若把 nums2 全部合并到 nums1 ，则合并后的 nums1 长度为 m+n<br>我们可以从下标 m+n-1 的位置填充 nums1，循环比较 nums1[len1] 与 nums2[len2] 的大小，将最大值写入 nums1[len]。<br>边界条件：</p><ul><li>若 len1 &lt; 0， len2 &gt;= 0 ，此时 nums1 已重写入， nums2 还未合并完，只需将 nums2 的剩余元素写入 nums1 即可，写入后，合并完成；</li><li>若 len2 &lt; 0，此时 nums2 已全部合并到 nums1 ，合并完成。</li></ul><p><strong>实现代码：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number[]</span>&#125; <span class="variable">nums1</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; <span class="variable">m</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number[]</span>&#125; <span class="variable">nums2</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; <span class="variable">n</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">void</span>&#125; Do not return anything, modify nums1 in-place instead.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> merge = <span class="keyword">function</span> (<span class="params">nums1, m, nums2, n</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> len1 = m - <span class="number">1</span>,</span><br><span class="line">    len2 = n - <span class="number">1</span>,</span><br><span class="line">    len = m + n - <span class="number">1</span>;</span><br><span class="line">  <span class="comment">//若len2 &lt; 0,说明 nums2 已全部合并到 nums1 ，合并完成</span></span><br><span class="line">  <span class="keyword">while</span> (len2 &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (len1 &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">// 此时 nums1 已重写入， nums2 还未合并完，仅仅需要将 nums2 的剩余元素写入 nums1 即可</span></span><br><span class="line">      nums1[len--] = nums2[len2--];</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    nums1[len--] = nums1[len1] &gt;= nums2[len2] ? nums1[len1--] : nums2[len2--]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>复杂度分析：</strong></p><ul><li>时间复杂度为 O(m+n)</li><li>空间复杂度为 O(1）</li></ul><h3 id="14-最长公共前缀"><a href="#14-最长公共前缀" class="headerlink" title="14. 最长公共前缀"></a><a href="https://leetcode-cn.com/problems/longest-common-prefix/" target="_blank" rel="noopener external nofollow noreferrer">14. 最长公共前缀</a></h3><p>编写一个函数来查找字符串数组中的最长公共前缀。</p><p>如果不存在公共前缀，返回空字符串 &quot;&quot;。<br>示例 1:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入: [<span class="string">&quot;flower&quot;</span>,<span class="string">&quot;flow&quot;</span>,<span class="string">&quot;flight&quot;</span>]</span><br><span class="line">输出: <span class="string">&quot;fl&quot;</span></span><br></pre></td></tr></table></figure><p>示例 2:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入: [<span class="string">&quot;dog&quot;</span>,<span class="string">&quot;racecar&quot;</span>,<span class="string">&quot;car&quot;</span>]</span><br><span class="line">输出: <span class="string">&quot;&quot;</span></span><br><span class="line">解释: 输入不存在公共前缀。</span><br></pre></td></tr></table></figure><p><strong>解题思路</strong>：</p><p>本题的解题方法很多，比如：</p><ol><li>直接逐个比较;</li><li>寻找最大字符串与最小字符串，将问题化解为比较这两个字符串的大小（ace &gt; acd &gt; abc =&gt; 这三个字符串的最长公共前缀一定是ace与abc两者的最长公共前缀）</li><li>分治/归并策略： 将问题分解为每两个字符串的最长公共前缀，再归并为一，求得最后值。如下图：</li></ol><p><img src="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20200622161032.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20200622161032.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><ol start="4"><li>利用Trie 树（字典树）<br>Trie 树，也称为字典树或前缀树，顾名思义，它是用来处理字符串匹配问题的数据结构，以及用来解决集合中查找固定前缀字符串的数据结构。</li></ol><p>下面以Trie树方式为例来实现，思路如下：<br>构建一个 Trie 树，字符串数组的最长公共序列就为从根节点开始遍历树，直到：</p><ul><li><p>遍历节点存在超过一个子节点的节点</p></li><li><p>或遍历节点为一个字符串的结束字符</p></li></ul><p>为止，走过的字符为字符串数组的最长公共前缀。</p><p>如图，以[&quot;flower&quot;,&quot;flow&quot;,&quot;flight&quot;]为例，最终结果为<code>&quot;fl&quot;</code><br><img src="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20200622162347.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20200622162347.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="20200622162347"></p><p><strong>实现代码</strong>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> longestCommonPrefix = <span class="keyword">function</span> (<span class="params">strs</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (strs === <span class="literal">null</span> || strs.<span class="property">length</span> === <span class="number">0</span>) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="comment">// 初始化 Trie 树</span></span><br><span class="line">  <span class="keyword">let</span> trie = <span class="keyword">new</span> <span class="title class_">Trie</span>()</span><br><span class="line">  <span class="comment">// 构建 Trie 树</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; strs.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!trie.<span class="title function_">insert</span>(strs[i])) <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 返回最长公共前缀</span></span><br><span class="line">  <span class="keyword">return</span> trie.<span class="title function_">searchLongestPrefix</span>()</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">TrieNode</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// next 放入当前节点的子节点</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">next</span> = &#123;&#125;;</span><br><span class="line">  <span class="comment">// 当前是否是结束节点</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">isEnd</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Trie 树</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Trie</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">root</span> = <span class="keyword">new</span> <span class="title class_">TrieNode</span>()</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Trie</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">insert</span> = <span class="keyword">function</span> (<span class="params">word</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!word) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  <span class="keyword">let</span> node = <span class="variable language_">this</span>.<span class="property">root</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; word.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!node.<span class="property">next</span>[word[i]]) &#123;</span><br><span class="line">      node.<span class="property">next</span>[word[i]] = <span class="keyword">new</span> <span class="title class_">TrieNode</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    node = node.<span class="property">next</span>[word[i]]</span><br><span class="line">  &#125;</span><br><span class="line">  node.<span class="property">isEnd</span> = <span class="literal">true</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">Trie</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">searchLongestPrefix</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> node = <span class="variable language_">this</span>.<span class="property">root</span></span><br><span class="line">  <span class="keyword">let</span> prevs = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="keyword">while</span> (node.<span class="property">next</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(node.<span class="property">next</span>)</span><br><span class="line">    <span class="keyword">if</span> (keys.<span class="property">length</span> !== <span class="number">1</span>) <span class="keyword">break</span>; <span class="comment">//超过一个子节点的节点</span></span><br><span class="line">    <span class="keyword">if</span> (node.<span class="property">next</span>[keys[<span class="number">0</span>]].<span class="property">isEnd</span>) &#123; <span class="comment">//节点为一个字符串的结束字符</span></span><br><span class="line">      prevs += keys[<span class="number">0</span>]</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    prevs += keys[<span class="number">0</span>]</span><br><span class="line">    node = node.<span class="property">next</span>[keys[<span class="number">0</span>]]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> prevs</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> res = <span class="title function_">longestCommonPrefix</span>([<span class="string">&quot;flower&quot;</span>, <span class="string">&quot;flow&quot;</span>, <span class="string">&quot;flight&quot;</span>])</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h2 id="链表类"><a href="#链表类" class="headerlink" title="链表类"></a>链表类</h2><div class="story post-story"><h3 id="常用方法总结：-1"><a href="#常用方法总结：-1" class="headerlink" title="常用方法总结："></a>常用方法总结：</h3><ul><li>快慢指针</li><li>标记位法</li></ul><h3 id="合并两个有序链表"><a href="#合并两个有序链表" class="headerlink" title="合并两个有序链表"></a><a href="https://leetcode-cn.com/problems/merge-two-sorted-lists/" target="_blank" rel="noopener external nofollow noreferrer">合并两个有序链表</a></h3><p>将两个升序链表合并为一个新的 升序 链表并返回。新链表是通过拼接给定的两个链表的所有节点组成的。<br>示例：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：<span class="number">1</span>-&gt;<span class="number">2</span>-&gt;<span class="number">4</span>, <span class="number">1</span>-&gt;<span class="number">3</span>-&gt;<span class="number">4</span></span><br><span class="line">输出：<span class="number">1</span>-&gt;<span class="number">1</span>-&gt;<span class="number">2</span>-&gt;<span class="number">3</span>-&gt;<span class="number">4</span>-&gt;<span class="number">4</span></span><br></pre></td></tr></table></figure><p><strong>思路</strong><br>从链表头开始比较，l1 与 l2 是有序递增的，所以比较 l1.val 与 l2.val 的较小值就是合并后链表的最小值，次小值就是小节点的 next.val 与大节点的 val 比较的较小值，依次递归，直到递归到 l1 l2 均为 null</p><p>确定边界条件： 当递归到任意链表为 null ，直接将 next 指向另外的链表即可，不需要继续递归了</p><p>代码实现：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mergeTwoLists</span>(<span class="params">l1, l2</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(l1 === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> l2</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(l2 === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> l1</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(l1.<span class="property">val</span> &lt;= l2.<span class="property">val</span>) &#123;</span><br><span class="line">        l1.<span class="property">next</span> = <span class="title function_">mergeTwoLists</span>(l1.<span class="property">next</span>, l2)</span><br><span class="line">        <span class="keyword">return</span> l1</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        l2.<span class="property">next</span> = <span class="title function_">mergeTwoLists</span>(l2.<span class="property">next</span>, l1)</span><br><span class="line">        <span class="keyword">return</span> l2</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="141-环形链表"><a href="#141-环形链表" class="headerlink" title="141. 环形链表"></a><a href="https://leetcode-cn.com/problems/linked-list-cycle/" target="_blank" rel="noopener external nofollow noreferrer">141. 环形链表</a></h3><p>给定一个链表，判断链表中是否有环。</p><p>为了表示给定链表中的环，我们使用整数 pos 来表示链表尾连接到链表中的位置（索引从 0 开始）。 如果 pos 是 -1，则在该链表中没有环。</p><p>示例 1：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：head = [<span class="number">3</span>,<span class="number">2</span>,<span class="number">0</span>,-<span class="number">4</span>], pos = <span class="number">1</span></span><br><span class="line">输出：<span class="literal">true</span></span><br><span class="line">解释：链表中有一个环，其尾部连接到第二个节点。</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20200622140709.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20200622140709.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="20200622140709"></p><p>示例 2：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：head = [<span class="number">1</span>,<span class="number">2</span>], pos = <span class="number">0</span></span><br><span class="line">输出：<span class="literal">true</span></span><br><span class="line">解释：链表中有一个环，其尾部连接到第一个节点。</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20200622140800.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20200622140800.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>示例 3：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：head = [<span class="number">1</span>], pos = -<span class="number">1</span></span><br><span class="line">输出：<span class="literal">false</span></span><br><span class="line">解释：链表中没有环。</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20200622140841.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20200622140841.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>方法一：标志法<br>给每个已遍历过的节点加标志位，遍历链表，当出现下一个节点已被标志时，则证明单链表有环</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * function ListNode(val) &#123;</span></span><br><span class="line"><span class="comment"> *     this.val = val;</span></span><br><span class="line"><span class="comment"> *     this.next = null;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">ListNode</span>&#125; <span class="variable">head</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">boolean</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> hasCycle = <span class="keyword">function</span>(<span class="params">head</span>) &#123;</span><br><span class="line">    <span class="keyword">while</span>(head)&#123;</span><br><span class="line">        <span class="keyword">if</span>(head.<span class="property">flag</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        head.<span class="property">flag</span> = <span class="number">1</span>;</span><br><span class="line">        head = head.<span class="property">next</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>方法二： 快慢指针法<br>设置快慢两个指针，遍历单链表，快指针一次走两步，慢指针一次走一步，如果单链表中存在环，则快慢指针终会指向同一个节点，否则直到快指针指向 null 时，快慢指针都不可能相遇。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hasCycle = <span class="keyword">function</span>(<span class="params">head</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(!head || !head.<span class="property">next</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> fast = head.<span class="property">next</span>.<span class="property">next</span>, slow = head.<span class="property">next</span>;</span><br><span class="line">    <span class="keyword">while</span>(fast &amp;&amp; fast.<span class="property">next</span>)&#123; <span class="comment">// fast.next为null说明fast是链表终点，无环</span></span><br><span class="line">        <span class="keyword">if</span>(fast === slow )&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        fast = fast.<span class="property">next</span>.<span class="property">next</span>;</span><br><span class="line">        slow = slow.<span class="property">next</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>方法三： 利用 JSON.stringify() 不能序列化含有循环引用的结构</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hasCycle = <span class="keyword">function</span>(<span class="params">head</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(head);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(err)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="142-环形链表-II"><a href="#142-环形链表-II" class="headerlink" title="142. 环形链表 II"></a><a href="https://leetcode-cn.com/problems/linked-list-cycle-ii/" target="_blank" rel="noopener external nofollow noreferrer">142. 环形链表 II</a></h3><p>给定一个链表，返回链表开始入环的第一个节点。 如果链表无环，则返回 null。</p><p>为了表示给定链表中的环，我们使用整数 pos 来表示链表尾连接到链表中的位置（索引从 0 开始）。 如果 pos 是 -1，则在该链表中没有环。</p><p>说明：不允许修改给定的链表。</p><p><strong>解题思路：</strong></p><p>本题与上一题类似，增加的难度在于需要返回入环点。所以无法基于<code>JSON.stringify()</code>来实现了。<br>方法一： 标志法<br>此方法实现代码与上一题基本一样，只是返回值有所区别。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * function ListNode(val) &#123;</span></span><br><span class="line"><span class="comment"> *     this.val = val;</span></span><br><span class="line"><span class="comment"> *     this.next = null;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">ListNode</span>&#125; <span class="variable">head</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">ListNode</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> detectCycle = <span class="keyword">function</span> (<span class="params">head</span>) &#123;</span><br><span class="line">    <span class="keyword">while</span>(head)&#123;</span><br><span class="line">        <span class="keyword">if</span>(head.<span class="property">flag</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        &#125;</span><br><span class="line">        head.<span class="property">flag</span> = <span class="number">1</span>;</span><br><span class="line">        head = head.<span class="property">next</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>方法二： 快慢指针法</p><p>上一题中快慢指针相遇点（即<code>fast === slow</code>）肯定是环内某一点（注意不一定是入环点，所以本题不能直接返回这个节点）。</p><p>所以接下去主要工作是如何判断入环点？</p><p>基于上一题，我们设置fast指针速度是2，slow指针速度是1, fast速度是slow速度的2倍，所以最终相遇（<code>fast === slow</code>）时，fast走的距离也是slow走的距离的2倍。<br>具体分析如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">A - 起点</span><br><span class="line">B - 第一次相遇点</span><br><span class="line">X - 入环点</span><br><span class="line">d1 - A-X距离</span><br><span class="line">d2 - X-B距离</span><br><span class="line">d3 - B-X距离</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20200622145207.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20200622145207.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="20200622145207"></p><p>最后得出<code>d1 = d3</code>。那么就可以在上题基础上进行寻找入环点：</p><p>当fast和slow在B点相遇后，将fast重回A点。将两个指针均以速度1向前走，最终会在X点相遇（距离一样，速度一样，所以到X点的时间也一样），相遇时返回节点即可。</p><p>实现代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> detectCycle = <span class="keyword">function</span> (<span class="params">head</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(!head || !head.<span class="property">next</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> fast = head.<span class="property">next</span>.<span class="property">next</span>, slow = head.<span class="property">next</span>;</span><br><span class="line">    <span class="keyword">while</span>(fast &amp;&amp; fast.<span class="property">next</span>)&#123;<span class="comment">//fast.next为null说明fast是链表终点，无环</span></span><br><span class="line">        <span class="keyword">if</span>(fast === slow )&#123;</span><br><span class="line">            fast = head;</span><br><span class="line">            <span class="keyword">while</span>(fast !== slow)&#123;</span><br><span class="line">                fast = fast.<span class="property">next</span>;</span><br><span class="line">                slow = slow.<span class="property">next</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> slow;</span><br><span class="line">        &#125;</span><br><span class="line">        fast = fast.<span class="property">next</span>.<span class="property">next</span>;</span><br><span class="line">        slow = slow.<span class="property">next</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="反转链表"><a href="#反转链表" class="headerlink" title="反转链表"></a><a href="https://leetcode-cn.com/problems/fan-zhuan-lian-biao-lcof/" target="_blank" rel="noopener external nofollow noreferrer">反转链表</a></h3><p><strong>解题思路</strong>：</p><p>定义一个反转链表prev, 循环head指针，将当前head指向prev，实现反转效果。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * function ListNode(val) &#123;</span></span><br><span class="line"><span class="comment"> *     this.val = val;</span></span><br><span class="line"><span class="comment"> *     this.next = null;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">ListNode</span>&#125; <span class="variable">head</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">ListNode</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> reverseList = <span class="keyword">function</span>(<span class="params">head</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> prev = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">while</span>(head)&#123;</span><br><span class="line">        <span class="comment">//临时存放下一个指针</span></span><br><span class="line">        <span class="keyword">let</span> next = head.<span class="property">next</span>;</span><br><span class="line">        <span class="comment">//将当前节点指向prev，实现反转效果</span></span><br><span class="line">        head.<span class="property">next</span> = prev;</span><br><span class="line">        <span class="comment">// 变更prev、head</span></span><br><span class="line">        prev = head;</span><br><span class="line">        head = next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> prev;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>复杂度分析：</p><ul><li>时间复杂度：O(n)</li><li>空间复杂度：O(1)</li></ul><h3 id="19-删除链表的倒数第N个节点"><a href="#19-删除链表的倒数第N个节点" class="headerlink" title="19. 删除链表的倒数第N个节点"></a><a href="https://leetcode-cn.com/problems/remove-nth-node-from-end-of-list/" target="_blank" rel="noopener external nofollow noreferrer">19. 删除链表的倒数第N个节点</a></h3><p>给定一个链表，删除链表的倒数第 n 个节点，并且返回链表的头结点。<br>示例：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">给定一个链表: <span class="number">1</span>-&gt;<span class="number">2</span>-&gt;<span class="number">3</span>-&gt;<span class="number">4</span>-&gt;<span class="number">5</span>, 和 n = <span class="number">2.</span></span><br><span class="line"></span><br><span class="line">当删除了倒数第二个节点后，链表变为 <span class="number">1</span>-&gt;<span class="number">2</span>-&gt;<span class="number">3</span>-&gt;<span class="number">5.</span></span><br></pre></td></tr></table></figure><p><strong>解题思路</strong>：<br>需要删除链表中的倒数第 n 个节点，我们需要知道的就是倒数第 n+1 个节点，然后删除删除倒数第 n+1 节点的后继节点即可.</p><p>使用快慢指针思想来解决此问题：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> removeNthFromEnd = <span class="keyword">function</span>(<span class="params">head, n</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> fast = head, slow = head</span><br><span class="line">    <span class="comment">// 快先走 n - 1 步</span></span><br><span class="line">    <span class="keyword">while</span>(--n) &#123;</span><br><span class="line">        fast = fast.<span class="property">next</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!fast.<span class="property">next</span>) <span class="keyword">return</span> head.<span class="property">next</span>;<span class="comment">//说明列表长度为n,删除头结点</span></span><br><span class="line">    fast = fast.<span class="property">next</span></span><br><span class="line">    <span class="comment">// fast、slow 一起前进</span></span><br><span class="line">    <span class="keyword">while</span>(fast &amp;&amp; fast.<span class="property">next</span>) &#123;</span><br><span class="line">        fast = fast.<span class="property">next</span></span><br><span class="line">        slow = slow.<span class="property">next</span></span><br><span class="line">    &#125;</span><br><span class="line">    slow.<span class="property">next</span> = slow.<span class="property">next</span>.<span class="property">next</span></span><br><span class="line">    <span class="keyword">return</span> head</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="876-链表的中间结点"><a href="#876-链表的中间结点" class="headerlink" title="876. 链表的中间结点"></a><a href="https://leetcode-cn.com/problems/middle-of-the-linked-list/" target="_blank" rel="noopener external nofollow noreferrer">876. 链表的中间结点</a></h3><p><strong>解题思路</strong>：<br>使用快慢指针方法： 快指针速度2，慢指针速度1，当快指针到达终点时，慢指针刚好在中间节点。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> middleNode = <span class="keyword">function</span>(<span class="params">head</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> fast = head, slow = head;</span><br><span class="line">    <span class="keyword">while</span>(fast &amp;&amp; fast.<span class="property">next</span>)&#123;</span><br><span class="line">        fast = fast.<span class="property">next</span>.<span class="property">next</span>;</span><br><span class="line">        slow = slow.<span class="property">next</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> slow;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>复杂度分析：</p><ul><li>时间复杂度：O(n)</li><li>空间复杂度：O(1)</li></ul></div><h2 id="动态规划类"><a href="#动态规划类" class="headerlink" title="动态规划类"></a>动态规划类</h2><div class="story post-story"><h3 id="309-最佳买卖股票时机含冷冻期"><a href="#309-最佳买卖股票时机含冷冻期" class="headerlink" title="309. 最佳买卖股票时机含冷冻期"></a><a href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-with-cooldown/" target="_blank" rel="noopener external nofollow noreferrer">309. 最佳买卖股票时机含冷冻期</a></h3><p>分析：</p><p>  第i天主要有三种情况，当天收益取三者最大值：</p><ol><li><p>当天持有此股票，那么股票可能是：<br>a. 前一天就持有的, 取值(dp[i - 1][0])，<br>b. 或者当天刚买的,取值(dp[i - 1][2] - prices[i]))，<br>这种情况的最大收益为： Math.max(dp[i - 1][0], dp[i - 1][2] - prices[i]);</p></li><li><p>当天卖出股票，则收益为前一天的持有收益 + 当天的股票价格收益， 即： dp[i - 1][0] + prices[i];</p></li><li><p>当天未持有，并且当天未卖出过，则有两种情况：<br>a. 前一天卖出过，dp[i-1][1]<br>b. 前一天未卖出， dp[i-1][2]。<br>这种情况的最大收益为： Math.max(dp[i - 1][1], dp[i - 1][2]);</p></li></ol><p>  第一天的初始值：dp[0] = [-prices[0], 0, 0];</p><p>  代码实现：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 最终的收益是当天的三种情况取最大</span></span><br><span class="line"><span class="comment"> * @param &#123;number[]&#125; prices</span></span><br><span class="line"><span class="comment"> * @return &#123;number&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> maxProfit = <span class="keyword">function</span> (<span class="params">prices</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> len = prices.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">if</span> (len &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">  <span class="keyword">const</span> dp = [];</span><br><span class="line">  dp.<span class="title function_">push</span>([-prices[<span class="number">0</span>], <span class="number">0</span>, <span class="number">0</span>]);</span><br><span class="line">  <span class="keyword">let</span> t0, t1, t2;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; len; i++) &#123;</span><br><span class="line">    t0 = <span class="title class_">Math</span>.<span class="title function_">max</span>(dp[i - <span class="number">1</span>][<span class="number">0</span>], dp[i - <span class="number">1</span>][<span class="number">2</span>] - prices[i]); <span class="comment">// 当天持有此股票</span></span><br><span class="line">    t1 = dp[i - <span class="number">1</span>][<span class="number">0</span>] + prices[i]; <span class="comment">// 当天未持有，并且当天卖出</span></span><br><span class="line">    t2 = <span class="title class_">Math</span>.<span class="title function_">max</span>(dp[i - <span class="number">1</span>][<span class="number">1</span>], dp[i - <span class="number">1</span>][<span class="number">2</span>]); <span class="comment">//当天未持有，并且不是当天卖出</span></span><br><span class="line">    dp.<span class="title function_">push</span>([t0, t1, t2]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">max</span>(...dp.<span class="title function_">pop</span>())</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="面试题-17-13-恢复空格"><a href="#面试题-17-13-恢复空格" class="headerlink" title="面试题 17.13. 恢复空格"></a><a href="https://leetcode-cn.com/problems/re-space-lcci/" target="_blank" rel="noopener external nofollow noreferrer">面试题 17.13. 恢复空格</a></h3><p>分析：<br>  遍历 sentence，如果i-1结尾的子字符串 等于 dictionary的某个word, 说明dp[i] 可以等于 dp[i - word.length]；</p><p>代码实现：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Array</span>&#125; <span class="variable">dictionary</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; <span class="variable">sentence</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">number</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">respace</span> = (<span class="params">dictionary, sentence</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> len = sentence.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">if</span> (len === <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">const</span> dp = <span class="keyword">new</span> <span class="title class_">Array</span>(len + <span class="number">1</span>);</span><br><span class="line">  dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= len; i++) &#123; <span class="comment">//i代表 Length(sentence)</span></span><br><span class="line">    dp[i] = dp[i - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> word <span class="keyword">of</span> dictionary) &#123;</span><br><span class="line">      <span class="keyword">if</span> (word === sentence.<span class="title function_">substring</span>(i - word.<span class="property">length</span>, i)) &#123;</span><br><span class="line">        dp[i] = <span class="title class_">Math</span>.<span class="title function_">min</span>(dp[i], dp[i - word.<span class="property">length</span>])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> dp[len]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="96-不同的二叉搜索树"><a href="#96-不同的二叉搜索树" class="headerlink" title="96. 不同的二叉搜索树"></a><a href="https://leetcode-cn.com/problems/unique-binary-search-trees/" target="_blank" rel="noopener external nofollow noreferrer">96. 不同的二叉搜索树</a></h3><ul><li>思路:<br>标签：动态规划<br>假设n个节点存在二叉排序树的个数是dp(n)，令f(i)为以i为根的二叉搜索树的个数，则<br>dp(n) = f(1) + f(2) + f(3) + f(4) + ... + f(n)</li></ul><p>当i为根节点时，其左子树节点个数为i-1个，右子树节点为n-i，则<br>f(i) = dp(i-1)*dp(n-i)</p><p>综合两个公式可以得到 <a href="https://segmentfault.com/a/1190000021666634" target="_blank" rel="noopener external nofollow noreferrer">卡特兰数</a> 公式<br>dp(n) = dp(0)<em>dp(n-1)+dp(1)</em>(n-2)+...+dp(n-1)*dp(0)</p><ul><li>代码实现：</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> numTrees = <span class="keyword">function</span> (<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> dp = <span class="keyword">new</span> <span class="title class_">Array</span>(n + <span class="number">1</span>).<span class="title function_">fill</span>(<span class="number">0</span>);</span><br><span class="line">  dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">1</span>; j &lt;= i; j++) &#123; <span class="comment">//以j为顶点的个数计算</span></span><br><span class="line">      dp[i] += dp[j - <span class="number">1</span>] * dp[i - j];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> dp[n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
    <summary type="html">汇集LeetCode题解思路，方便日后回忆</summary>
    
    
    
    <category term="数据结构与算法" scheme="https://kobingogo.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="LeetCode" scheme="https://kobingogo.github.io/tags/leetcode/"/>
    
  </entry>
  
  <entry>
    <title>从Chrome源码看JS Array的底层实现</title>
    <link href="https://kobingogo.github.io/Chrome%E6%BA%90%E7%A0%81-array-knowledge/"/>
    <id>https://kobingogo.github.io/Chrome%E6%BA%90%E7%A0%81-array-knowledge/</id>
    <published>2020-06-17T14:41:59.000Z</published>
    <updated>2022-02-07T02:52:27.794Z</updated>
    
    <content type="html"><![CDATA[<p>作为前端er，我们都知道，JS 的数组可以存放不同类型的元素、并且数组长度是可变的。不像其他的语言，比如C，创建的时候要决定数组的大小，如果数组满了，就要重新申请内存空间。</p><p>知道归知道，但是要想弄清楚其中原因，就得从Chrome源码去探究了。</p><span id="more"></span><h3 id="JS-Array为什么可以保存不同类型"><a href="#JS-Array为什么可以保存不同类型" class="headerlink" title="JS Array为什么可以保存不同类型"></a>JS Array为什么可以保存不同类型</h3><p>先看下Chrome V8对JSArray的定义：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The JSArray describes JavaScript Arrays</span></span><br><span class="line"><span class="comment">//  Such an array can be in one of two modes:</span></span><br><span class="line"><span class="comment">//    - fast, backing storage is a FixedArray and length &lt;= elements.length();</span></span><br><span class="line"><span class="comment">//       Please note: push and pop can be used to grow and shrink the array.</span></span><br><span class="line"><span class="comment">//    - slow, backing storage is a HashTable with numbers as keys.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JSArray</span>: <span class="keyword">public</span> JSObject &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="comment">// [length]: The length property.</span></span><br><span class="line">  <span class="built_in">DECL_ACCESSORS</span>(length, Object)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Number of element slots to pre-allocate for an empty array.</span></span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> kPreallocatedArrayElements = <span class="number">4</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>我们可以看到 JSArray 是继承自 JSObject 的，所以在 JavaScript 中，数组可以是一个特殊的对象，内部是以 key-value 形式存储数据，所以 JavaScript 中的数组可以存放不同类型的值。</p><h3 id="JS-Array如何存储"><a href="#JS-Array如何存储" class="headerlink" title="JS Array如何存储"></a>JS Array如何存储</h3><p>从上述 V8 源码注释中可以看出，JSArray有两种存储方式：</p><ul><li>fast：存储结构是 FixedArray ，并且数组长度 &lt;= elements.length() ，push 或 pop 时可能会伴随着动态扩容或减容，源码里叫 <code>FastElements</code>;</li><li>slow：存储结构是 HashTable，并且数组下标作为 key,源码里叫 <code>SlowElements</code>;</li></ul><ol><li><p>快数组（FastElements）<br>FixedArray 是 V8 实现的一个类似于数组的类，它表示一段连续的内存，可以使用索引直接定位。新创建的空数组默认就是快数组。当数组满（数组的长度达到数组在内存中申请的内存容量最大值）的时候，继续 push 时， JSArray 会进行动态的扩容，以存储更多的元素。</p></li><li><p>慢数组（SlowElements）<br>慢数组以哈希表的形式存储在内存空间里，它不需要开辟连续的存储空间,节省了内存，但需要额外维护一个哈希表，性能相对较差。</p></li><li><p>什么时候会从 fast 转变为 slow</p></li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/objects/js-objects.h</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">uint32_t</span> kMaxGap = <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// src/objects/dictionary.h</span></span><br><span class="line"><span class="comment">// JSObjects prefer dictionary elements if the dictionary saves this much</span></span><br><span class="line"><span class="comment">// memory compared to a fast elements backing store.</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">uint32_t</span> kPreferFastElementsSizeFactor = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// src/objects/js-objects-inl.h</span></span><br><span class="line"><span class="comment">// If the fast-case backing storage takes up much more memory than a dictionary</span></span><br><span class="line"><span class="comment">// backing storage would, the object should have slow elements.</span></span><br><span class="line"><span class="comment">// static</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">bool</span> <span class="title">ShouldConvertToSlowElements</span><span class="params">(<span class="type">uint32_t</span> used_elements,</span></span></span><br><span class="line"><span class="params"><span class="function">                                               <span class="type">uint32_t</span> new_capacity)</span> </span>&#123;</span><br><span class="line">  <span class="type">uint32_t</span> size_threshold = NumberDictionary::kPreferFastElementsSizeFactor *</span><br><span class="line">                            NumberDictionary::<span class="built_in">ComputeCapacity</span>(used_elements) *</span><br><span class="line">                            NumberDictionary::kEntrySize;</span><br><span class="line">  <span class="comment">// 快数组新容量是扩容后的容量3倍之多时，也会被转成慢数组</span></span><br><span class="line">  <span class="keyword">return</span> size_threshold &lt;= new_capacity;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">bool</span> <span class="title">ShouldConvertToSlowElements</span><span class="params">(JSObject object,</span></span></span><br><span class="line"><span class="params"><span class="function">                                               <span class="type">uint32_t</span> capacity,</span></span></span><br><span class="line"><span class="params"><span class="function">                                               <span class="type">uint32_t</span> index,</span></span></span><br><span class="line"><span class="params"><span class="function">                                               <span class="type">uint32_t</span>* new_capacity)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">STATIC_ASSERT</span>(JSObject::kMaxUncheckedOldFastElementsLength &lt;=</span><br><span class="line">                JSObject::kMaxUncheckedFastElementsLength);</span><br><span class="line">  <span class="keyword">if</span> (index &lt; capacity) &#123;</span><br><span class="line">    *new_capacity = capacity;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 当加入的索引值（例如例3中的2000）比当前容量capacity 大于等于 1024时，</span></span><br><span class="line">  <span class="comment">// 返回true，转为慢数组</span></span><br><span class="line">  <span class="keyword">if</span> (index - capacity &gt;= JSObject::kMaxGap) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  *new_capacity = JSObject::<span class="built_in">NewElementsCapacity</span>(index + <span class="number">1</span>);</span><br><span class="line">  <span class="built_in">DCHECK_LT</span>(index, *new_capacity);</span><br><span class="line">  <span class="comment">// TODO(ulan): Check if it works with young large objects.</span></span><br><span class="line">  <span class="keyword">if</span> (*new_capacity &lt;= JSObject::kMaxUncheckedOldFastElementsLength ||</span><br><span class="line">      (*new_capacity &lt;= JSObject::kMaxUncheckedFastElementsLength &amp;&amp;</span><br><span class="line">       <span class="built_in">ObjectInYoungGeneration</span>(object))) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">ShouldConvertToSlowElements</span>(object.<span class="built_in">GetFastElementsUsage</span>(),</span><br><span class="line">                                     *new_capacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从上述源码看出，当处于以下情况时，快数组会被转变为慢数组：</p><ul><li>当加入的索引值 index 比当前容量 capacity 差值大于等于 1024 时（index - capacity &gt;= 1024）</li><li>快数组新容量是扩容后的容量 3 倍之多时</li></ul><p>增加一个2000的索引时，array就会被转成慢数组:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">array[<span class="number">2000</span>] = <span class="number">1000</span>;</span><br></pre></td></tr></table></figure><ol start="4"><li>什么时候会从 slow 转变为 fast</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> <span class="type">bool</span> <span class="title">ShouldConvertToFastElements</span><span class="params">(JSObject object,</span></span></span><br><span class="line"><span class="params"><span class="function">                                        NumberDictionary dictionary,</span></span></span><br><span class="line"><span class="params"><span class="function">                                        <span class="type">uint32_t</span> index,</span></span></span><br><span class="line"><span class="params"><span class="function">                                        <span class="type">uint32_t</span>* new_capacity)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// If properties with non-standard attributes or accessors were added, we</span></span><br><span class="line">  <span class="comment">// cannot go back to fast elements.</span></span><br><span class="line">  <span class="keyword">if</span> (dictionary.<span class="built_in">requires_slow_elements</span>()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">// Adding a property with this index will require slow elements.</span></span><br><span class="line">  <span class="keyword">if</span> (index &gt;= <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(Smi::kMaxValue)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span> (object.<span class="built_in">IsJSArray</span>()) &#123;</span><br><span class="line">    Object length = JSArray::<span class="built_in">cast</span>(object).<span class="built_in">length</span>();</span><br><span class="line">    <span class="keyword">if</span> (!length.<span class="built_in">IsSmi</span>()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    *new_capacity = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(Smi::<span class="built_in">ToInt</span>(length));</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (object.<span class="built_in">IsJSArgumentsObject</span>()) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    *new_capacity = dictionary.<span class="built_in">max_number_key</span>() + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  *new_capacity = <span class="built_in">Max</span>(index + <span class="number">1</span>, *new_capacity);</span><br><span class="line">  <span class="type">uint32_t</span> dictionary_size = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(dictionary.<span class="built_in">Capacity</span>()) *</span><br><span class="line">                             NumberDictionary::kEntrySize;</span><br><span class="line">  <span class="comment">// Turn fast if the dictionary only saves 50% space.</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span> * dictionary_size &gt;= *new_capacity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当慢数组的元素可存放在快数组中且长度在 <code>smi</code> 之间且仅节省了50%的空间(用慢数组节省的空间不大于50%),则会转变为快数组</p><blockquote><p>smi在64位平台为-2<sup>31</sup> 到 2<sup>31</sup> -1，在32位平台为-2<sup>30</sup> 到 2<sup>30</sup> -1</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>,<span class="number">2</span>];</span><br><span class="line">a[<span class="number">1030</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">200</span>; i &lt; <span class="number">1030</span>; i++) &#123;</span><br><span class="line">    a[i] = i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在 1030 的位置上面添加一个值，会造成多于 1024 个空洞，数组变成慢数组；<br>然后往这个数组中 200-1029 这些位置上赋值，使慢数组不再比快数组节省 50% 的空间，则数组变成快数组。</p><ol start="5"><li>总结</li></ol><p>快数组就是以空间换时间的方式，申请了大块连续内存，提高效率。 慢数组以时间换空间，不必申请连续的空间，节省了内存，但需要付出效率变差的代价。</p><h3 id="数组的动态扩容与减容"><a href="#数组的动态扩容与减容" class="headerlink" title="数组的动态扩容与减容"></a>数组的动态扩容与减容</h3><p>默认空数组初始化大小为 4 :</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Number of element slots to pre-allocate for an empty array.</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> kPreallocatedArrayElements = <span class="number">4</span>;</span><br></pre></td></tr></table></figure><p>在 Chrome 源码中， push 的操作是用汇编实现的，在 c++ 里嵌入的汇编，以提高执行效率，并且在汇编的基础上用 c++ 封装了一层，在编译执行的时候，会将这些 c++ 代码转成汇编代码。</p><p>计算新容量的函数：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// js-objects.h</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">uint32_t</span> kMinAddedElementsCapacity = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// code-stub-assembler.cc</span></span><br><span class="line"><span class="function">Node* <span class="title">CodeStubAssembler::CalculateNewElementsCapacity</span><span class="params">(Node* old_capacity,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                      ParameterMode mode)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">CSA_SLOW_ASSERT</span>(<span class="keyword">this</span>, <span class="built_in">MatchesParameterMode</span>(old_capacity, mode));</span><br><span class="line">  Node* half_old_capacity = <span class="built_in">WordOrSmiShr</span>(old_capacity, <span class="number">1</span>, mode);</span><br><span class="line">  Node* new_capacity = <span class="built_in">IntPtrOrSmiAdd</span>(half_old_capacity, old_capacity, mode);</span><br><span class="line">  Node* padding =</span><br><span class="line">      <span class="built_in">IntPtrOrSmiConstant</span>(JSObject::kMinAddedElementsCapacity, mode);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">IntPtrOrSmiAdd</span>(new_capacity, padding, mode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>所以扩容后新容量计公式为：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new_capacity = old_capacity /<span class="number">2</span> + old_capacity + <span class="number">16</span></span><br></pre></td></tr></table></figure><p>即老的容量的 1.5 倍加上 16 。初始化为 4 个，当 push 第 5 个的时候，容量将会变成：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new_capacity = <span class="number">4</span> / <span class="number">2</span> + <span class="number">4</span> + <span class="number">16</span> = <span class="number">22</span></span><br></pre></td></tr></table></figure><p>接着申请一块这么大的内存，把老的数据拷过去，把新元素放在当前 length 位置，然后将数组的 length + 1，并返回 length。</p><p>整个过程，用户是无感知的，不像 C，需用用户手动申请内存空间。</p><p>当数组执行 pop 操作时，会判断 pop 后数组的容量，是否需要进行减容。</p><p>不同于数组的 push 使用汇编实现的， pop 使用 c++ 实现的。</p><p>判断是否进行减容：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="number">2</span> * length &lt;= capacity) &#123;</span><br><span class="line">  <span class="comment">// If more than half the elements won&#x27;t be used, trim the array.</span></span><br><span class="line">  isolate-&gt;<span class="built_in">heap</span>()-&gt;<span class="built_in">RightTrimFixedArray</span>(*backing_store, capacity - length);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// Otherwise, fill the unused tail with holes.</span></span><br><span class="line">  BackingStore::<span class="built_in">cast</span>(*backing_store)-&gt;<span class="built_in">FillWithHoles</span>(length, old_length);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>所以，当数组 pop 后，如果数组容量大于等于 length 的 2 倍，则进行容量调整，使用 RightTrimFixedArray 函数，计算出需要释放的空间大小，做好标记，等待 GC 回收；如果数组容量小于 length 的 2 倍，则用 holes 对象填充。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>JavaScript 中， JSArray 继承自 JSObject ，是一个特殊的对象，内部是以 key-value 形式存储数据，所以 JavaScript 中的数组可以存放不同类型的值。</p><p>JSArray有两种存储方式，快数组与慢数组，初始化空数组时，使用快数组，快数组使用连续的内存空间，当快数组长度达到最大时，JSArray 会进行动态的扩容，以存储更多的元素，相对慢数组，性能要好得多。</p><p>当数组中 hole 太多时，会转变成慢数组，即以哈希表的方式（ key-value 的形式）存储数据，以节省内存空间。</p><h3 id="一道面试题-数组扁平化"><a href="#一道面试题-数组扁平化" class="headerlink" title="一道面试题 - 数组扁平化"></a>一道面试题 - 数组扁平化</h3><p>假如有个数组：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [ [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>, [<span class="number">5</span>, <span class="number">5</span>]], <span class="number">10</span>]</span><br></pre></td></tr></table></figure><p>如何将其扁平化为：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">10</span>]</span><br></pre></td></tr></table></figure><p>核心思想： 遍历数组arr，若arr[i]为数组则递归遍历，直至arr[i]不为数组然后与之前的结果concat。</p><ol><li>ES6 flat</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr.<span class="title function_">flat</span>(<span class="title class_">Infinity</span>)</span><br></pre></td></tr></table></figure><ol start="2"><li>reduce</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">flatten</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> arr.<span class="title function_">reduce</span>(<span class="function">(<span class="params">result, item</span>)=&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> result.<span class="title function_">concat</span>(<span class="title class_">Array</span>.<span class="title function_">isArray</span>(item) ? <span class="title function_">flatten</span>(item) : item);</span><br><span class="line">    &#125;, []);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>toString / join</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">flatten</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> arr.<span class="title function_">toString</span>().<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>).<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">item</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Number</span>(item);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="4"><li>递归</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">flatten</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> res = [];</span><br><span class="line">    arr.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">Array</span>.<span class="title function_">isArray</span>(item)) &#123;</span><br><span class="line">            res = res.<span class="title function_">concat</span>(<span class="title function_">flatten</span>(item));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.<span class="title function_">push</span>(item);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>扩展运算符</li></ol><p>es6的扩展运算符能将二维数组变为一维</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">flatten</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">    <span class="keyword">while</span>(arr.<span class="title function_">some</span>(<span class="function"><span class="params">item</span>=&gt;</span><span class="title class_">Array</span>.<span class="title function_">isArray</span>(item))) &#123;</span><br><span class="line">        arr = [].<span class="title function_">concat</span>(...arr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>参考链接：<br><a href="https://github.com/sisterAn/JavaScript-Algorithms/issues/2" target="_blank" rel="noopener external nofollow noreferrer">前端进阶算法2：从Chrome V8源码看JavaScript数组</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;作为前端er，我们都知道，JS 的数组可以存放不同类型的元素、并且数组长度是可变的。不像其他的语言，比如C，创建的时候要决定数组的大小，如果数组满了，就要重新申请内存空间。&lt;/p&gt;
&lt;p&gt;知道归知道，但是要想弄清楚其中原因，就得从Chrome源码去探究了。&lt;/p&gt;</summary>
    
    
    
    <category term="Chrome源码" scheme="https://kobingogo.github.io/categories/chrome%E6%BA%90%E7%A0%81/"/>
    
    
    <category term="array" scheme="https://kobingogo.github.io/tags/array/"/>
    
  </entry>
  
  <entry>
    <title>常用系统命令汇总</title>
    <link href="https://kobingogo.github.io/others-%E5%B8%B8%E7%94%A8%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4%E6%B1%87%E6%80%BB/"/>
    <id>https://kobingogo.github.io/others-%E5%B8%B8%E7%94%A8%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4%E6%B1%87%E6%80%BB/</id>
    <published>2020-06-12T10:50:05.000Z</published>
    <updated>2022-02-07T02:52:27.802Z</updated>
    
    <content type="html"><![CDATA[<h3 id="端口检查"><a href="#端口检查" class="headerlink" title="端口检查"></a>端口检查</h3><ul><li>linux</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet 192.168.1.102 3306</span><br></pre></td></tr></table></figure><ul><li>mac</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -vz -w 2 192.168.1.104 3306</span><br></pre></td></tr></table></figure><h3 id="查看端口占用"><a href="#查看端口占用" class="headerlink" title="查看端口占用"></a>查看端口占用</h3><ul><li>Centos7+</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">lsof -i tcp:80  <span class="comment"># 查看80端口占用情况</span></span><br><span class="line"></span><br><span class="line">netstat -ntlp  <span class="comment"># 列出所有端口</span></span><br><span class="line"></span><br><span class="line">firewall-cmd --query-port=3306/tcp <span class="comment"># 查询是否开启3306端口</span></span><br><span class="line"></span><br><span class="line">firewall-cmd --zone=public --add-port=3306/tcp --permanent <span class="comment"># 开启端口</span></span><br><span class="line"></span><br><span class="line">firewall-cmd --zone=public --remove-port=3306/tcp --permanent <span class="comment"># 关闭端口</span></span><br><span class="line"></span><br><span class="line">firewall-cmd --reload <span class="comment">#重启防火墙</span></span><br></pre></td></tr></table></figure><h3 id="杀掉进程"><a href="#杀掉进程" class="headerlink" title="杀掉进程"></a>杀掉进程</h3><ul><li>Centos</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">netstat -tpnul <span class="comment"># 查看当前所有正在运行的进程</span></span><br><span class="line">ps aux |grep httpd <span class="comment"># 查看 httpd 进程</span></span><br><span class="line"><span class="built_in">kill</span> -9 6732 <span class="comment"># 6732为httpd进程对应的进程ID</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">各个系统常用终端命令汇总之地</summary>
    
    
    
    <category term="others" scheme="https://kobingogo.github.io/categories/others/"/>
    
    
    <category term="命令" scheme="https://kobingogo.github.io/tags/%E5%91%BD%E4%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>Vulter + v2ray / Trojan 使用教程</title>
    <link href="https://kobingogo.github.io/others-v2ray-manual/"/>
    <id>https://kobingogo.github.io/others-v2ray-manual/</id>
    <published>2020-06-11T10:25:33.000Z</published>
    <updated>2022-02-07T02:52:27.801Z</updated>
    
    <content type="html"><![CDATA[<p>最近一直在使用的梯子服务临近到期，想要续费发现价格又涨了一波，再加上平时使用中并不是很稳定。就萌生了自建一个梯子的想法。</p><span id="more"></span><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>要想自建梯子有两个前提：</p><ul><li>境外VPS服务器(虚拟专用服务器)</li><li>科学上网工具</li></ul><h4 id="VPS服务器"><a href="#VPS服务器" class="headerlink" title="VPS服务器"></a>VPS服务器</h4><p>对比了阿里云国际版、谷歌云、AWS等巨头产品，以及VULTR、搬瓦工等服务商，最终选择了<code>VULTR</code>，主要原因在于：</p><ol><li>价格便宜： 最便宜的有$2.5/月的服务，价格是王道；</li><li>机房众多：拥有日本、美国、欧洲等 17 个机房；</li><li>架构优秀：全部采用 KVM 架构、SSD 固态硬盘、500G/月流量起步；</li><li>后台强大 ：拥有系统快照、一键装机部署脚本、备份、防火墙等强大功能，从 VPS 这点丝毫不输给阿里云。</li><li>计费灵活 : 采用小时计费模式，可以任意的添加和删除机器 , 并且是单向流量收费 , 也就是只计算下载的的流量;</li><li>支持支付宝/微信支付，国内用户购买方便；</li></ol><p>注册购买请进入官网自行操作：<a href="https://www.vultr.com/" target="_blank" rel="noopener external nofollow noreferrer">vultr官网</a></p><h4 id="科学上网工具"><a href="#科学上网工具" class="headerlink" title="科学上网工具"></a>科学上网工具</h4><p>本文主要实现v2ray 和 Trojan 两个工具的搭建</p><h3 id="SSH免密登录vultr服务器"><a href="#SSH免密登录vultr服务器" class="headerlink" title="SSH免密登录vultr服务器"></a>SSH免密登录vultr服务器</h3><ol><li>在本机生成密钥（如果已经有了不用重复生成）：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure><ol start="2"><li>将本地公钥拷贝到服务器的<code>~/.ssh/authorized_keys</code>目录中：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方法一</span></span><br><span class="line">ssh-copy-id user@ip</span><br><span class="line"></span><br><span class="line"><span class="comment"># 法二</span></span><br><span class="line"><span class="comment"># 将 本机 ~/.ssh目录中的 id_rsa.pub 这个文件拷贝到服务器 的~/.ssh目录中</span></span><br><span class="line">scp ~/.ssh/id_rsa.pub user@ip:~/.ssh/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在服务器运行以下命令来将公钥导入到~/.ssh/authorized_keys这个文件中</span></span><br><span class="line"><span class="built_in">cat</span> ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># authorized_keys的权限要是600。</span></span><br><span class="line"><span class="built_in">chmod</span> 600 .ssh/authorized_keys</span><br></pre></td></tr></table></figure><p>user: 服务器用户名，默认为root<br>ip: 服务器公网IP</p><p>至此，就可以用下面命令免密登录了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh user@ip</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfopr1r33xj30pk0gpaar.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gfopr1r33xj30pk0gpaar.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="v2ray安装与配置"><a href="#v2ray安装与配置" class="headerlink" title="v2ray安装与配置"></a>v2ray安装与配置</h3><p>登录了云服务后，就可以开始下载安装v2ray了，执行以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://install.direct/go.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> +x go.sh</span><br><span class="line"></span><br><span class="line">./go.sh</span><br></pre></td></tr></table></figure><p>执行成功后，会输出 V2Ray v4.24.2 is installed. 等字样。</p><p>安装V2Ray后， 会在<code>/etc/v2ray/config.json</code>默认生成配置文件，我们需要编辑这个文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/v2ray/config.json</span><br></pre></td></tr></table></figure><p>然后连续按 d 键，将原本的文件内容清空，然后按 i 键开启编辑模式，复制以下配置</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;log&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;access&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/var/log/v2ray/access.log&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/var/log/v2ray/error.log&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;loglevel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;warning&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;inbound&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">9751</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vmess&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;clients&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;392029fa-a9e0-42e3-93cb-97a9288795ed&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;alterId&quot;</span><span class="punctuation">:</span> <span class="number">100</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;streamSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;network&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tcp&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;detour&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;to&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vmess-detour-118345&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;outbound&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;freedom&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;inboundDetour&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vmess&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10000-10010&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;tag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vmess-detour-118345&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;allocate&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;strategy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;random&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;concurrency&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;refresh&quot;</span><span class="punctuation">:</span> <span class="number">5</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;streamSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;network&quot;</span><span class="punctuation">:</span> <span class="string">&quot;kcp&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;outboundDetour&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;blackhole&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;tag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;blocked&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;routing&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;strategy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rules&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;rules&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;field&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;ip&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;0.0.0.0/8&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;10.0.0.0/8&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;100.64.0.0/10&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;127.0.0.0/8&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;169.254.0.0/16&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;172.16.0.0/12&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;192.0.0.0/24&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;192.0.2.0/24&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;192.168.0.0/16&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;198.18.0.0/15&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;198.51.100.0/24&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;203.0.113.0/24&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;::1/128&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;fc00::/7&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;fe80::/10&quot;</span></span><br><span class="line">          <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;outboundTag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;blocked&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>上述配置中可根据自己的喜好进行相应修改，也可直接使用不做修改。</p><p>保存并退出编辑模式，再启动v2ray服务，服务端的配置就完成了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start v2ray</span><br></pre></td></tr></table></figure><p>v2ray进程管理命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 v2ray 进程状态</span></span><br><span class="line">systemctl status v2ray</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动</span></span><br><span class="line">systemctl start v2ray</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line">systemctl restart v2ray</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭</span></span><br><span class="line">systemctl stop v2ray</span><br></pre></td></tr></table></figure><h3 id="配置防火墙"><a href="#配置防火墙" class="headerlink" title="配置防火墙"></a>配置防火墙</h3><p>CentOS 7 系统默认会开启防火墙，需要开放上面配置的端口：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --add-service=https</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">firewall-cmd --zone=public --add-port=9751/tcp --permanent</span><br></pre></td></tr></table></figure><p>– zone #作用域</p><p>– add-port=80/tcp #添加端口，格式为：端口/通讯协议</p><p>– permanent #永久生效，没有此参数重启后失效</p><p>防火墙其他相关命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">systemctl status firewalld <span class="comment"># 查看防火墙状态</span></span><br><span class="line">firewall-cmd --reload <span class="comment">#重启firewall</span></span><br><span class="line">systemctl restart firewalld <span class="comment"># 重启2</span></span><br><span class="line">systemctl stop firewalld.service <span class="comment">#停止firewall</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld.service <span class="comment">#禁止firewall开机启动</span></span><br><span class="line">firewall-cmd --state <span class="comment">#查看默认防火墙状态（关闭后显示notrunning，开启后显示running）</span></span><br><span class="line"></span><br><span class="line">firewall-cmd --list-ports  <span class="comment"># 查看已经开放的端口</span></span><br></pre></td></tr></table></figure><p>至此，服务端部分就算完成了。下面开始客户端配置。</p><h3 id="V2Ray-客户端"><a href="#V2Ray-客户端" class="headerlink" title="V2Ray 客户端"></a>V2Ray 客户端</h3><ul><li>Mac端</li></ul><p>Mac端使用的是<a href="https://github.com/yichengchen/clashX/releases" target="_blank" rel="noopener external nofollow noreferrer">ClashX</a>客户端。安装下载后打开配置文件夹：</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfoqnszotfj30ad0c0mya.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gfoqnszotfj30ad0c0mya.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>新建一个<code>.yaml</code>配置文件，具体配置如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">port:</span> <span class="number">7890</span></span><br><span class="line"><span class="attr">socks-port:</span> <span class="number">7891</span></span><br><span class="line"><span class="attr">redir-port:</span> <span class="number">7892</span></span><br><span class="line"><span class="attr">allow-lan:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">mode:</span> <span class="string">Rule</span></span><br><span class="line"><span class="attr">log-level:</span> <span class="string">info</span></span><br><span class="line"><span class="attr">external-controller:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9090</span></span><br><span class="line"><span class="attr">secret:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">cfw-bypass:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">localhost</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">127</span><span class="string">.*</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">10</span><span class="string">.*</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">172.16</span><span class="string">.*</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">172.17</span><span class="string">.*</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">172.18</span><span class="string">.*</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">172.19</span><span class="string">.*</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">172.20</span><span class="string">.*</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">172.21</span><span class="string">.*</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">172.22</span><span class="string">.*</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">172.23</span><span class="string">.*</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">172.24</span><span class="string">.*</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">172.25</span><span class="string">.*</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">172.26</span><span class="string">.*</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">172.27</span><span class="string">.*</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">172.28</span><span class="string">.*</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">172.29</span><span class="string">.*</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">172.30</span><span class="string">.*</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">172.31</span><span class="string">.*</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">192.168</span><span class="string">.*</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&lt;local&gt;</span></span><br><span class="line"><span class="attr">cfw-latency-timeout:</span> <span class="number">3000</span></span><br><span class="line"><span class="attr">Proxy:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">V2-NewJersey</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">vmess</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">208.167</span><span class="number">.222</span><span class="number">.200</span> <span class="comment"># 服务器公网IP</span></span><br><span class="line">    <span class="attr">port:</span> <span class="string">&quot;9751&quot;</span> <span class="comment"># v2ray配置的端口</span></span><br><span class="line">    <span class="attr">uuid:</span> <span class="string">392029fa-a9e0-42e3-93cb-97a9288795ed</span> <span class="comment"># v2ray的uuid</span></span><br><span class="line">    <span class="attr">alterId:</span> <span class="string">&quot;100&quot;</span> <span class="comment"># v2ray的额外ID</span></span><br><span class="line">    <span class="attr">cipher:</span> <span class="string">auto</span></span><br><span class="line">    <span class="attr">network:</span> <span class="string">tcp</span> <span class="comment"># 传输协议</span></span><br><span class="line"><span class="attr">Proxy Group:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CroLAX</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">select</span></span><br><span class="line">    <span class="attr">proxies:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">V2-NewJersey</span></span><br><span class="line"><span class="attr">Rule:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN,hls.itunes.apple.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN,itunes.apple.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN,itunes.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,icloud.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,icloud-content.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,me.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,mzstatic.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,akadns.net,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,aaplimg.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,cdn-apple.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,apple.com,DIRECT</span></span><br><span class="line">  <span class="comment">## 国内网站</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,cn,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-KEYWORD,-cn,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,126.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,126.net,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,127.net,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,163.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,360buyimg.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,36kr.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,acfun.tv,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,air-matters.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,aixifan.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,akamaized.net,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-KEYWORD,alicdn,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-KEYWORD,alipay,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-KEYWORD,taobao,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,amap.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,autonavi.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-KEYWORD,baidu,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,bdimg.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,bdstatic.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,bilibili.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,caiyunapp.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,clouddn.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,cnbeta.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,cnbetacdn.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,cootekservice.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,csdn.net,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,ctrip.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,dgtle.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,dianping.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,douban.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,doubanio.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,duokan.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,easou.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,ele.me,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,feng.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,fir.im,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,frdic.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,g-cores.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,godic.net,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,gtimg.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,hongxiu.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,hxcdn.net,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,iciba.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,ifeng.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,ifengimg.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,ipip.net,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,iqiyi.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,jd.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,jianshu.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,knewone.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,le.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,lecloud.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,lemicp.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,licdn.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,linkedin.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,luoo.net,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,meituan.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,meituan.net,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,mi.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,miaopai.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,microsoft.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,microsoftonline.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,miui.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,miwifi.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,mob.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,netease.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,office.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-KEYWORD,officecdn,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,office365.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,oschina.net,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,ppsimg.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,pstatp.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,qcloud.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,qdaily.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,qdmm.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,qhimg.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,qhres.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,qidian.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,qihucdn.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,qiniu.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,qiniucdn.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,qiyipic.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,qq.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,qqurl.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,rarbg.to,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,ruguoapp.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,segmentfault.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,sinaapp.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,smzdm.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,sogou.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,sogoucdn.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,sohu.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,soku.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,speedtest.net,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,sspai.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,suning.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,taobao.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,tencent.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,tenpay.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,tianyancha.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,tmall.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,tudou.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,umetrip.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,upaiyun.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,upyun.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,v2ex.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,veryzhun.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,weather.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,weibo.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,xiami.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,xiami.net,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,xiaomicp.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,ximalaya.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,xmcdn.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,xunlei.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,yhd.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,yihaodianimg.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,yinxiang.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,ykimg.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,youdao.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,youku.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,zealer.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,zhihu.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,zhimg.com,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,zimuzu.tv,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-KEYWORD,netflix,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-KEYWORD,nflx,CroLAX</span></span><br><span class="line">  <span class="comment">## 抗 DNS 污染</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-KEYWORD,amazon,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-KEYWORD,google,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-KEYWORD,gmail,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-KEYWORD,youtube,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-KEYWORD,facebook,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,fb.me,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,fbcdn.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-KEYWORD,twitter,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-KEYWORD,instagram,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-KEYWORD,dropbox,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,twimg.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-KEYWORD,blogspot,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,youtu.be,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-KEYWORD,whatsapp,CroLAX</span></span><br><span class="line">  <span class="comment">## 国外网站</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,9to5mac.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,abpchina.org,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,adblockplus.org,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,adobe.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,alfredapp.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,amplitude.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,ampproject.org,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,android.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,angularjs.org,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,aolcdn.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,apkpure.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,appledaily.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,appshopper.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,appspot.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,arcgis.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,archive.org,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,armorgames.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,aspnetcdn.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,att.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,awsstatic.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,azureedge.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,azurewebsites.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,bing.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,bintray.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,bit.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,bit.ly,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,bitbucket.org,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,bjango.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,bkrtx.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,blog.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,blogcdn.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,blogger.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,blogsmithmedia.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,blogspot.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,blogspot.hk,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,bloomberg.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,box.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,box.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,cachefly.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,chromium.org,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,cl.ly,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,cloudflare.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,cloudfront.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,cloudmagic.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,cmail19.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,cnet.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,cocoapods.org,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,comodoca.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,crashlytics.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,culturedcode.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,d.pr,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,danilo.to,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,dayone.me,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,db.tt,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,deskconnect.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,disq.us,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,disqus.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,disquscdn.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,dnsimple.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,docker.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,dribbble.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,droplr.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,duckduckgo.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,dueapp.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,dytt8.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,edgecastcdn.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,edgekey.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,edgesuite.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,engadget.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,entrust.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,eurekavpt.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,evernote.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,fabric.io,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,fast.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,fastly.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,fc2.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,feedburner.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,feedly.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,feedsportal.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,fiftythree.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,firebaseio.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,flexibits.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,flickr.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,flipboard.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,g.co,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,gabia.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,geni.us,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,gfx.ms,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,ggpht.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,ghostnoteapp.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,git.io,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-KEYWORD,github,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,globalsign.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,gmodules.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,godaddy.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,golang.org,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,gongm.in,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,goo.gl,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,goodreaders.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,goodreads.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,gravatar.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,gstatic.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,gvt0.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,hockeyapp.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,hotmail.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,icons8.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,ift.tt,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,ifttt.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,iherb.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,imageshack.us,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,img.ly,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,imgur.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,imore.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,instapaper.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,ipn.li,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,is.gd,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,issuu.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,itgonglun.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,itun.es,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,ixquick.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,j.mp,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,js.revsci.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,jshint.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,jtvnw.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,justgetflux.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,kat.cr,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,klip.me,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,libsyn.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,linode.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,lithium.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,littlehj.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,live.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,live.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,livefilestore.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,llnwd.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,macid.co,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,macromedia.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,macrumors.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,mashable.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,mathjax.org,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,medium.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,mega.co.nz,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,mega.nz,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,megaupload.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,microsofttranslator.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,mindnode.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,mobile01.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,modmyi.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,msedge.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,myfontastic.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,name.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,nextmedia.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,nsstatic.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,nssurge.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,nyt.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,nytimes.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,omnigroup.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,onedrive.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,onenote.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,ooyala.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,openvpn.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,openwrt.org,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,orkut.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,osxdaily.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,outlook.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,ow.ly,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,paddleapi.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,parallels.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,parse.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,pdfexpert.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,periscope.tv,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,pinboard.in,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,pinterest.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,pixelmator.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,pixiv.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,playpcesor.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,playstation.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,playstation.com.hk,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,playstation.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,playstationnetwork.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,pushwoosh.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,rime.im,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,servebom.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,sfx.ms,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,shadowsocks.org,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,sharethis.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,shazam.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,skype.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,smartdnsProxy.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,smartmailcloud.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,sndcdn.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,sony.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,soundcloud.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,sourceforge.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,spotify.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,squarespace.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,sstatic.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,st.luluku.pw,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,stackoverflow.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,startpage.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,staticflickr.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,steamcommunity.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,symauth.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,symcb.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,symcd.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,tapbots.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,tapbots.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,tdesktop.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,techcrunch.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,techsmith.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,thepiratebay.org,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,theverge.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,time.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,timeinc.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,tiny.cc,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,tinypic.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,tmblr.co,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,todoist.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,trello.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,trustasiassl.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,tumblr.co,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,tumblr.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,tweetdeck.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,tweetmarker.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,twitch.tv,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,txmblr.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,typekit.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,ubertags.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,ublock.org,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,ubnt.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,ulyssesapp.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,urchin.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,usertrust.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,v.gd,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,vimeo.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,vimeocdn.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,vine.co,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,vivaldi.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,vox-cdn.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,vsco.co,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,vultr.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,w.org,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,w3schools.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,webtype.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,wikiwand.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,wikileaks.org,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,wikimedia.org,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,wikipedia.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,wikipedia.org,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,windows.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,windows.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,wire.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,wordpress.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,workflowy.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,wp.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,wsj.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,wsj.net,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,xda-developers.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,xeeno.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,xiti.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,yahoo.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,yimg.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,ying.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,yoyo.org,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,ytimg.com,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,telegram.me,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">IP-CIDR,91.108.4.0/22,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">IP-CIDR,91.108.8.0/22,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">IP-CIDR,91.108.56.0/22,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">IP-CIDR,109.239.140.0/24,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">IP-CIDR,149.154.160.0/20,CroLAX</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">IP-CIDR,127.0.0.0/8,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">IP-CIDR,172.16.0.0/12,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">IP-CIDR,192.168.0.0/16,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">IP-CIDR,10.0.0.0/8,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">IP-CIDR,17.0.0.0/8,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">IP-CIDR,100.64.0.0/10,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">GEOIP,CN,DIRECT</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">MATCH,,CroLAX</span></span><br></pre></td></tr></table></figure><p>主要关注注释代码部分，更加详细的ClashX配置说明请参加 <a href="https://www.v2rayssr.com/clashxx.html" target="_blank" rel="noopener external nofollow noreferrer">此文</a>。</p><ul><li>windows端</li></ul><p>windows端使用<a href="https://github.com/2dust/v2rayN/releases" target="_blank" rel="noopener external nofollow noreferrer">v2rayN</a>软件，安装后点击服务器 -&gt; 添加[VMess]服务器, 具体配置如下：</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gformgphhaj30kh0gqq3b.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gformgphhaj30kh0gqq3b.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="配置-BBR-加速"><a href="#配置-BBR-加速" class="headerlink" title="配置 BBR 加速"></a>配置 BBR 加速</h3><p>TCP BBR 是谷歌在 2016 年 9 月开源的一个优化 TCP 拥塞的算法，并且 Linux 内核从 4.9 版本开始集成该算法，据多方网友反馈，网速甚至可以提升好几个数量级，</p><p>一般新版的Linux操作系统以及自带了BBR，不需要手动安装，如果是老系统，可以执行下面命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载脚本</span></span><br><span class="line">wget --no-check-certificate https://github.com/teddysun/across/raw/master/bbr.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加可执行权限</span></span><br><span class="line"><span class="built_in">chmod</span> +x bbr.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行bbr脚本</span></span><br><span class="line">./bbr.sh</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate https://raw.githubusercontent.com/cx9208/Linux-NetSpeed/master/tcp.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> +x tcp.sh</span><br><span class="line"></span><br><span class="line">./tcp.sh</span><br></pre></td></tr></table></figure><p>我这边系统以及自带，运行bbr脚本后提示已经安装了，结果如下：<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfortv177sj30k109vq3t.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gfortv177sj30k109vq3t.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>可以验证一下是否成功安装最新内核并开启 TCP BBR，输入以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">uname</span> -r  <span class="comment"># &gt;&gt; 4.18.0-147.8.1.el8_1.x86_64</span></span><br><span class="line"></span><br><span class="line">sysctl net.ipv4.tcp_available_congestion_control  <span class="comment"># &gt;&gt; net.ipv4.tcp_available_congestion_control = reno cubic bbr</span></span><br><span class="line"></span><br><span class="line">sysctl net.ipv4.tcp_congestion_control <span class="comment"># &gt;&gt; net.ipv4.tcp_congestion_control = bbr</span></span><br><span class="line"></span><br><span class="line">sysctl net.core.default_qdisc <span class="comment"># &gt;&gt; net.core.default_qdisc = fq</span></span><br><span class="line"></span><br><span class="line">lsmod | grep bbr <span class="comment"># &gt;&gt; tcp_bbr                20480  9</span></span><br></pre></td></tr></table></figure><p>返回值有 tcp_bbr 模块即说明bbr已启动。</p><h3 id="Trojan安装教程"><a href="#Trojan安装教程" class="headerlink" title="Trojan安装教程"></a>Trojan安装教程</h3><p>Trojan是一个近两年兴起的网络工具，项目官网（<a href="https://github.com/trojan-gfw" target="_blank" rel="noopener external nofollow noreferrer">https://github.com/trojan-gfw</a>）。与强调加密和混淆的SS/SSR等工具不同，trojan将通信流量伪装成互联网上最常见的https流量，从而有效防止流量被检测和干扰。</p><p>使用Trojan需要一个指向服务器IP的<a href="https://www.hijk.pw/namesilo-buy-domain-tutorial/" target="_blank" rel="noopener external nofollow noreferrer">域名</a>以及域名证书。</p><h4 id="使用Let’s-Encrypt获取免费证书"><a href="#使用Let’s-Encrypt获取免费证书" class="headerlink" title="使用Let’s Encrypt获取免费证书"></a>使用Let’s Encrypt获取免费证书</h4><ul><li>开发端口</li></ul><p>certbot 默认使用http方式对域名所有权进行验证，该操作需要绑定vps的80端口。需要开发防火墙端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=80/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=443/tcp --permanent</span><br></pre></td></tr></table></figure><p>如果80端口已被占用，请先停止占用的进程，例如停止Nginx：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">killall nginx</span><br></pre></td></tr></table></figure><ul><li>安装certbot</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y python3 &amp;&amp; pip3 install certbot</span><br></pre></td></tr></table></figure><p>查看certbot使用方法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certbot --<span class="built_in">help</span></span><br></pre></td></tr></table></figure><p>为指定域名生成证书：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certbot certonly --standalone -d 域名1 -d 域名2</span><br></pre></td></tr></table></figure><p>查看域名证书的路径和国旗时间</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certbot certificates</span><br></pre></td></tr></table></figure><h4 id="安装trojan服务端"><a href="#安装trojan服务端" class="headerlink" title="安装trojan服务端"></a>安装trojan服务端</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo bash -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/trojan-gfw/trojan-quickstart/master/trojan-quickstart.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure><p>该命令会下载最新版的trojan并安装。安装完毕后，trojan配置文件路径是 /usr/local/etc/trojan/config.json，其初始内容为：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;run_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;server&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;local_addr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;local_port&quot;</span><span class="punctuation">:</span> <span class="number">443</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;remote_addr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;remote_port&quot;</span><span class="punctuation">:</span> <span class="number">80</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;password1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;password2&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;log_level&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ssl&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;cert&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/path/to/certificate.crt&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/path/to/private.key&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;key_password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;cipher&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;cipher_tls13&quot;</span><span class="punctuation">:</span> <span class="string">&quot;TLS_AES_128_GCM_SHA256:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_256_GCM_SHA384&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;prefer_server_cipher&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;alpn&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;http/1.1&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;reuse_session&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;session_ticket&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;session_timeout&quot;</span><span class="punctuation">:</span> <span class="number">600</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;plain_http_response&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;curves&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;dhparam&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tcp&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;prefer_ipv4&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;no_delay&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;keep_alive&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;reuse_port&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;fast_open&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;fast_open_qlen&quot;</span><span class="punctuation">:</span> <span class="number">20</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mysql&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;enabled&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;server_addr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;server_port&quot;</span><span class="punctuation">:</span> <span class="number">3306</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;database&quot;</span><span class="punctuation">:</span> <span class="string">&quot;trojan&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;trojan&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ul><li>local_port：监听的端口，默认是443，除非端口被墙，不建议改成其他端口；</li><li>remote_addr和remote_port：非trojan协议时，将请求转发处理的地址和端口。可以是任意有效的ip/域名和端口号，默认是本机和80端口；</li><li>password：密码。需要几个密码就填几行，最后一行结尾不能有逗号；</li><li>cert和key：域名的证书和密钥，Let’s Encrypt申请的证书可用 certbot certificates 查看证书路径；</li><li>key_password：默认没有密码（如果证书文件有密码就要填上）；</li><li>alpn：建议填两行：http/1.1和h2，保持默认也没有问题。</li></ul><p>根据自己的情况修改配置，保存，然后设置开机启动：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> trojan</span><br></pre></td></tr></table></figure><p>启动Trojan：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start trojan</span><br></pre></td></tr></table></figure><p>检查是否运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss -lp | grep trojan</span><br></pre></td></tr></table></figure><h4 id="证书自动更新"><a href="#证书自动更新" class="headerlink" title="证书自动更新"></a>证书自动更新</h4><p>Let’s Encrypt证书的有效期是三个月，超过期限则需要续签。证书续期可以手动完成，例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop trojan</span><br><span class="line">certbot renew</span><br><span class="line">systemctl restart trojan</span><br></pre></td></tr></table></figure><p>也可以配置crontab任务自动续签，在/etc/crontab文件末添加一行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 1 */2 0 root systemctl stop trojan; /usr/local/bin/certbot renew; systemctl restart trojan</span><br></pre></td></tr></table></figure><h3 id="Trojan客户端"><a href="#Trojan客户端" class="headerlink" title="Trojan客户端"></a>Trojan客户端</h3><p>以Mac端使用ClashX客户端为例，配置如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Proxy:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">trojan_NJ5</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">trojan</span></span><br><span class="line">    <span class="attr">server:</span> <span class="string">nj5.kobingo.xyz</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">443</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">OF54OAJN3WZ66882</span></span><br><span class="line">    <span class="comment"># udp: true</span></span><br><span class="line">    <span class="comment"># sni: example.com # aka server name</span></span><br><span class="line">    <span class="attr">alpn:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">h2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">http/1.1</span></span><br><span class="line">    <span class="comment"># skip-cert-verify: true</span></span><br></pre></td></tr></table></figure><h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><ul><li><a href="https://trojan-gfw.github.io/trojan/" target="_blank" rel="noopener external nofollow noreferrer">Trojan官网</a></li><li><a href="https://tlanyan.me/trojan-tutorial/" target="_blank" rel="noopener external nofollow noreferrer">trojan教程</a></li><li><a href="https://github.com/hijkpw/scripts" target="_blank" rel="noopener external nofollow noreferrer">https://github.com/hijkpw/scripts</a></li><li><a href="https://www.hijk.pw/trojan-one-click-scrip/" target="_blank" rel="noopener external nofollow noreferrer">trojan一键脚本</a></li><li><a href="https://www.hijk.pw/namesilo-buy-domain-tutorial/" target="_blank" rel="noopener external nofollow noreferrer">Namesilo购买域名详细教程</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;最近一直在使用的梯子服务临近到期，想要续费发现价格又涨了一波，再加上平时使用中并不是很稳定。就萌生了自建一个梯子的想法。&lt;/p&gt;</summary>
    
    
    
    <category term="others" scheme="https://kobingogo.github.io/categories/others/"/>
    
    
    <category term="梯子" scheme="https://kobingogo.github.io/tags/%E6%A2%AF%E5%AD%90/"/>
    
  </entry>
  
  <entry>
    <title>打造赏心悦目的Mac终端</title>
    <link href="https://kobingogo.github.io/others-zsh/"/>
    <id>https://kobingogo.github.io/others-zsh/</id>
    <published>2020-06-10T03:36:19.000Z</published>
    <updated>2022-02-07T02:52:27.802Z</updated>
    
    <content type="html"><![CDATA[<p>本文主要讲解如何基于iTerm2 + Oh My Zsh 打造赏心悦目的Mac终端，以及如何配置终端代理等。</p><span id="more"></span><h3 id="下载iTerm2"><a href="#下载iTerm2" class="headerlink" title="下载iTerm2"></a>下载iTerm2</h3><p>可以直接去官网下载：<a href="https://www.iterm2.com/" target="_blank" rel="noopener external nofollow noreferrer">https://www.iterm2.com/</a></p><p>安装完成后，在/bin目录下会多出一个zsh的文件。</p><p>Mac系统自带很多Shell，可以通过命令查看：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/shells</span><br></pre></td></tr></table></figure><p>结果如下：<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfnavctvytj30ep05wdg2.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gfnavctvytj30ep05wdg2.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>由于Mac默认使用dash作为终端，所以首先修改为默认使用zsh：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chsh -s /bin/zsh</span><br></pre></td></tr></table></figure><p>这就是iTerm2初始的样子，下面我们来美化它，让它变得好用又好看！</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfn91wrixhj30vo0p40u7.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gfn91wrixhj30vo0p40u7.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="安装Oh-my-zsh"><a href="#安装Oh-my-zsh" class="headerlink" title="安装Oh my zsh"></a>安装Oh my zsh</h3><p>oh-my-zsh开源地址：<a href="https://github.com/robbyrussell/oh-my-zsh" target="_blank" rel="noopener external nofollow noreferrer">https://github.com/robbyrussell/oh-my-zsh</a></p><p>主要有<code>curl</code>和<code>wget</code>两种安装方式，可任选一种进行安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># curl 安装方式</span></span><br><span class="line">sh -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget 安装方式</span></span><br><span class="line">sh -c <span class="string">&quot;<span class="subst">$(wget https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -)</span>&quot;</span></span><br></pre></td></tr></table></figure><p>安装命令和安装完成后的截图：</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfn92cdy3oj312a0q27a7.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gfn92cdy3oj312a0q27a7.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="安装PowerLine"><a href="#安装PowerLine" class="headerlink" title="安装PowerLine"></a>安装PowerLine</h3><p><a href="http://powerline.readthedocs.io/en/latest/installation.html" target="_blank" rel="noopener external nofollow noreferrer">Powerline</a>是agnoster主题的依赖。具体可以在repo里查询到：<br><a href="https://github.com/agnoster/agnoster-zsh-theme" target="_blank" rel="noopener external nofollow noreferrer">https://github.com/agnoster/agnoster-zsh-theme</a></p><p>安装powerline的方式依然简单，也只需要一条命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install powerline-status --user</span><br></pre></td></tr></table></figure><p>没有安装pip的同学可能会碰到zsh: command not found: pip。<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfn92zc4clj30dg024dg6.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gfn92zc4clj30dg024dg6.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>使用命令安装pip即可：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo easy_install pip</span><br></pre></td></tr></table></figure><p>安装后再次执行安装powerline的命令即可。</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfn93bjfetj31mg08u77d.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gfn93bjfetj31mg08u77d.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="安装PowerFonts"><a href="#安装PowerFonts" class="headerlink" title="安装PowerFonts"></a>安装PowerFonts</h3><p>安装字体库需要首先将项目git clone至本地，然后执行源码中的install.sh。</p><p>在你习惯的位置新建一个文件夹，如：~/Desktop/OpenSource/</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfn93sc6fgj30di038aah.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gfn93sc6fgj30di038aah.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>在此文件夹下执行git clone命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git clone</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/powerline/fonts.git --depth=1</span><br><span class="line"><span class="comment"># cd to folder</span></span><br><span class="line"><span class="built_in">cd</span> fonts</span><br><span class="line"><span class="comment"># run install shell</span></span><br><span class="line">./install.sh</span><br></pre></td></tr></table></figure><p>执行结果如下：<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfn93zramcj31z60fyago.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gfn93zramcj31z60fyago.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>安装好字体库之后，我们来设置iTerm2的字体，具体的操作是iTerm2 -&gt; Preferences -&gt; Profiles -&gt; Text，在Font区域选中Change Font，然后找到Meslo LG字体。有L、M、S可选，看个人喜好：</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfn94aieloj310f0u011l.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gfn94aieloj310f0u011l.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="安装配色方案"><a href="#安装配色方案" class="headerlink" title="安装配色方案"></a>安装配色方案</h3><p>配色方案在使用VIM或Colorful Log时会变得非常有用，同时界面也不会一片黑绿一样死板。</p><p>同样使用git clone的方式下载源码进行安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/Desktop/OpenSource</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/altercation/solarized</span><br><span class="line"><span class="built_in">cd</span> solarized/iterm2-colors-solarized/</span><br><span class="line">open .</span><br></pre></td></tr></table></figure><p>在打开的finder窗口中，双击Solarized Dark.itermcolors和Solarized Light.itermcolors即可安装明暗两种配色：</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfn94su0j7j31570u07f1.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gfn94su0j7j31570u07f1.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>再次进入iTerm2 -&gt; Preferences -&gt; Profiles -&gt; Colors -&gt; Color Presets中根据个人喜好选择这两种配色中的一种即可：</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfn950gf0ej30zx0u04db.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gfn950gf0ej30zx0u04db.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="安装主题"><a href="#安装主题" class="headerlink" title="安装主题"></a>安装主题</h3><p>下载agnoster主题，执行脚本安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/Desktop/OpenSource</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/fcamblor/oh-my-zsh-agnoster-fcamblor.git</span><br><span class="line"><span class="built_in">cd</span> oh-my-zsh-agnoster-fcamblor/</span><br><span class="line">./install</span><br></pre></td></tr></table></figure><p>执行上面的命令会将主题拷贝到oh my zsh的themes中：</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfn95ek4pfj30vo0ra7a0.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gfn95ek4pfj30vo0ra7a0.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>拷贝完成后，执行命令打开zshrc配置文件，将ZSH_THEME后面的字段改为agnoster。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi ~/.zshrc</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/sirius1024/pubimgs/master/blogs/iterm2/11.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/sirius1024/pubimgs/master/blogs/iterm2/11.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="ImageInitIterm"></p><p>修改完成后按一下esc调出vi命令，输入:wq保存并退出vi模式。</p><p>此时command+Q或source配置文件后，iTerm2变了模样：</p><p><img src="https://raw.githubusercontent.com/sirius1024/pubimgs/master/blogs/iterm2/12.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/sirius1024/pubimgs/master/blogs/iterm2/12.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="ImageInitIterm"></p><h3 id="安装高亮插件"><a href="#安装高亮插件" class="headerlink" title="安装高亮插件"></a>安装高亮插件</h3><p>这是oh my zsh的一个插件，安装方式与theme大同小异：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/.oh-my-zsh/custom/plugins/</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-syntax-highlighting.git</span><br><span class="line">vi ~/.zshrc</span><br></pre></td></tr></table></figure><p>这时我们再次打开zshrc文件进行编辑。找到plugins，此时plugins中应该已经有了git，我们需要把高亮插件也加上：</p><p><img src="https://raw.githubusercontent.com/sirius1024/pubimgs/master/blogs/iterm2/13.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/sirius1024/pubimgs/master/blogs/iterm2/13.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="ImageInitIterm"></p><p>请务必保证插件顺序，zsh-syntax-highlighting必须在最后一个。</p><p>然后在文件的最后一行添加：source ~/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh</p><p>按一下esc调出vi命令，输入:wq保存并退出vi模式。</p><p>执行命令使刚才的修改生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure><p>至此大功告成，请看最终效果图：</p><p><img src="https://raw.githubusercontent.com/sirius1024/pubimgs/master/blogs/iterm2/14.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/sirius1024/pubimgs/master/blogs/iterm2/14.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="ImageInitIterm"></p><p>背景图片取自微软Surface Studio的4K壁纸(将近12MB大小)，非常漂亮，需要的可以自取：</p><p><a href="https://pan.baidu.com/s/1LKd4ghGyyNI6UwHhOHvfaA" target="_blank" rel="noopener external nofollow noreferrer">https://pan.baidu.com/s/1LKd4ghGyyNI6UwHhOHvfaA</a><br>提取码: snrd</p><p>更换背景图片方式：iTerm2 -&gt; Preferences -&gt; Profiles -&gt; Window -&gt; BackGround Image勾选图片即可。</p><h3 id="可选择、命令补全"><a href="#可选择、命令补全" class="headerlink" title="可选择、命令补全"></a>可选择、命令补全</h3><p>跟代码高亮的安装方式一样，这也是一个zsh的插件，叫做zsh-autosuggestion，用于命令建议和补全。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/.oh-my-zsh/custom/plugins/</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-autosuggestions</span><br><span class="line">vi ~/.zshrc</span><br></pre></td></tr></table></figure><p>找到plugins，加上这个插件即可：</p><p><img src="https://raw.githubusercontent.com/sirius1024/pubimgs/master/blogs/iterm2/15.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/sirius1024/pubimgs/master/blogs/iterm2/15.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="ImageInitIterm"></p><p>插件效果：</p><p><img src="https://raw.githubusercontent.com/sirius1024/pubimgs/master/blogs/iterm2/16.png" class="lazyload" data-srcset="https://raw.githubusercontent.com/sirius1024/pubimgs/master/blogs/iterm2/16.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="ImageInitIterm"></p><p>有同学说补全命令的字体不太清晰，与背景颜色太过相近，其实可以自己调整一下字体颜色。</p><p>Preferences -&gt; Profiles -&gt; Colors 中有Foreground是标准字体颜色，ANSI Colors中Bright的第一个是补全的字体颜色。</p><h3 id="VScode显示异常问题"><a href="#VScode显示异常问题" class="headerlink" title="VScode显示异常问题"></a>VScode显示异常问题</h3><p>在经过上面配置后，发现VScode上的终端显示异常，主要原因是前面配置的agnoster主题需要PowerFonts字体的支持。<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfna0fzj8zj30jc06bt8v.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gfna0fzj8zj30jc06bt8v.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>所以需要在VScode里设置字体（比如：<code>Meslo LG L for Powerline</code>）：<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfna2gfm6lj30kh0cg75k.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gfna2gfm6lj30kh0cg75k.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>完成后，显示正常：</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfna3j770hj30ll05rdg1.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gfna3j770hj30ll05rdg1.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="使用代理"><a href="#使用代理" class="headerlink" title="使用代理"></a>使用代理</h3><p>由于GFW的存在，平时用终端安装npm包，或者clone GitHub上的仓库等操作时，经常速度是可怜的10K/s甚至不到的速度，即便开了 SS / V2Ray 等代理服务，貌似在终端上没什么卵用😭（其实主要原因是这些代理服务走的是会话层，而item的命令走在网络层，层级更低，所以流量无法用过代理转发）。</p><blockquote><p>如果你用的是VPN方式代理，那么估计你没有这个烦恼</p><p>原因是主流的VPN协议（包括PPTP / L2TP / OPENVPN / SSTP）跑在第二层（数据链路层）和第三层（网络层），基本可以说是全流量代理。</p></blockquote><p>那有没有什么方法可以让iterm上的流量能走代理从而提高下载速度呢？</p><p>答案是有的！</p><blockquote><p>下面的操作的前提是你自己有有可用的代理服务</p></blockquote><p>编辑~/.zshrc:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.zshrc</span><br></pre></td></tr></table></figure><p>在配置的最下面添加如下代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">function useProxy() &#123;</span><br><span class="line">  export https_proxy=http://127.0.0.1:7890;</span><br><span class="line">  export http_proxy=http://127.0.0.1:7890;</span><br><span class="line">  export all_proxy=socks5://127.0.0.1:7891;</span><br><span class="line">  echo &#x27;open proxy successful&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">function closeProxy() &#123;</span><br><span class="line">  unset https_proxy;</span><br><span class="line">  unset http_proxy;</span><br><span class="line">  unset all_proxy;</span><br><span class="line">  echo &#x27;close proxy successful&#x27;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">alias openP=&#x27;useProxy&#x27;</span><br><span class="line">alias closeP=&#x27;closeProxy&#x27;</span><br></pre></td></tr></table></figure><p>保存更改，执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure><p>接着只要在终端执行<code>openP</code>就能打开终端代理，执行<code>closeP</code>就能关闭终端代理</p><h3 id="ZSH常用技能"><a href="#ZSH常用技能" class="headerlink" title="ZSH常用技能"></a>ZSH常用技能</h3><ul><li>自动补全<ul><li>ZSH的补全功能非常贴心，按TAB可以补全命令、路径还有参数。</li></ul></li><li>杀进程<ul><li>Bash杀进程需要先用<code>ps aux | grep xxx</code>查找进程的PID，然后才能用<code>kill PID</code>。ZSH可以直接就<code>kill xxx</code>后按TAB会显示对应的PID，非常方便。</li></ul></li><li>历史记录<ul><li>ZSH的history可以跨session，可以共享，这样就一进行历史记录的受限查询。比如，输入git，再按向上箭头，会搜索前面所有的git命令。</li></ul></li><li>通配符搜索<ul><li>l *.png查找当前目录下所有png文件，l **/*.png递归查找。</li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;本文主要讲解如何基于iTerm2 + Oh My Zsh 打造赏心悦目的Mac终端，以及如何配置终端代理等。&lt;/p&gt;</summary>
    
    
    
    <category term="others" scheme="https://kobingogo.github.io/categories/others/"/>
    
    
    <category term="Mac终端" scheme="https://kobingogo.github.io/tags/mac%E7%BB%88%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>常用软件大全</title>
    <link href="https://kobingogo.github.io/others-%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6%E6%8E%A8%E8%8D%90/"/>
    <id>https://kobingogo.github.io/others-%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6%E6%8E%A8%E8%8D%90/</id>
    <published>2020-05-27T14:51:15.000Z</published>
    <updated>2022-02-07T02:52:27.802Z</updated>
    
    <content type="html"><![CDATA[<h2 id="windows篇"><a href="#windows篇" class="headerlink" title="windows篇"></a>windows篇</h2><div class="story post-story"><h3 id="1-Listary"><a href="#1-Listary" class="headerlink" title="1. Listary"></a>1. Listary</h3><p>它不仅可以在本地非常快速的搜索，还可以打开网站、在搜索引擎中搜索、随时随地打开快捷菜单、文件快速定位、快速打开cmd窗口等等优秀的功能；</p><p>比如输入 cmd打开cmd窗口，输入 cmda使用管理员权限打开cmd窗口，输入 wyyyy打开网易云音乐，找到某个文件的时候 Enter直接打开， Ctrl+Enter 是打开文件所在文件夹；</p><p>值得一提的是搜索关键词功能，让我们可以非常便捷的打开相应网站或在对应网站搜索，比如输入 gg我的存款呢？就可以直接使用默认浏览器在谷歌搜索中搜索了，我们还可以自定义输入其他关键字，只需把搜索链接中的关键字换成 {query} ~</p><h3 id="2-uTools"><a href="#2-uTools" class="headerlink" title="2. uTools"></a>2. uTools</h3><p>可以作为程序启动器外，uTools最大的特点就是拥有强大的插件系统，每个插件都有简洁美观、易于操作的界面，输入plugins进入插件管理，你就可以根据自己的需求挑选安装，组合成自己最趁手的工具合集，为各种日常操作提供便利。不断产生的新插件，也将为你带来无限可能。</p><blockquote><p>个人常用图床、剪切板、todo、各种技术文档等</p></blockquote><h3 id="3-Ditto"><a href="#3-Ditto" class="headerlink" title="3. Ditto"></a>3. Ditto</h3><p>Ditto 是一款免费开源的windows剪切板管理工具，作为 CtrlC V工程师，复制粘贴少不了，更厉害的是，可以用它来批量的复制， Ctrl+C一堆别人的代码，一次性全粘上，岂不美哉；</p><p>使用快捷键打开剪切板历史，然后 Ctrl/Shift来选择你希望粘贴的内容， Enter即可选择性的粘贴多行内容；另外剪切板历史还可以搜索，快速找到复制内容；</p><p>只需设置寥寥几个快捷键，就可以很方便的操作剪切板，带来极大幸福~<br><img src="http://yanxuan.nosdn.127.net/10fd3cf8452793dde3fd68c9d914f044.png" class="lazyload" data-srcset="http://yanxuan.nosdn.127.net/10fd3cf8452793dde3fd68c9d914f044.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="UTOOLS1590592067470.png"></p><h3 id="4-Winsnap"><a href="#4-Winsnap" class="headerlink" title="4. Winsnap"></a>4. Winsnap</h3><p>看到上面的截图没，旁边都有很骚包的阴影，怎么做到的？不需要各种高大上的图片处理软件，只需 Winsnap ，它可以在截图的时候自动帮你加上背景阴影，然后帮你自动复制到剪切板；</p><p>它可以使用全屏、应用程序、窗口、对象等捕捉模式，更牛的是它还可以在截图的时候同时选择和捕捉多个对象，按住 Ctrl或 Shift选择多个窗口或对象...这个就比较厉害了，不信你试试？</p><p><img src="http://yanxuan.nosdn.127.net/89455e91edbd563fc808103fd3662506.png" class="lazyload" data-srcset="http://yanxuan.nosdn.127.net/89455e91edbd563fc808103fd3662506.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="UTOOLS1590592103032.png"></p><h3 id="5-Cmder"><a href="#5-Cmder" class="headerlink" title="5. Cmder"></a>5. Cmder</h3><p>Cmder 是一个美观又实用的命令行工具，它支持大部分Linux命令，支持ssh连Linux，还可以在它的窗口中新建cmd和powershell，更多玩法等你来战~</p><p>比较方便的是在安装目录下 \config\user-aliases.cmd设置 alias 别名，比如参见的 Git 操作：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ga=git add $*</span><br><span class="line"></span><br><span class="line">gb=git branch $*</span><br><span class="line"></span><br><span class="line">gc=git commit $*</span><br><span class="line"></span><br><span class="line">gch=git checkout $*</span><br><span class="line"></span><br><span class="line">gd=git diff $*</span><br><span class="line"></span><br><span class="line">gl=git <span class="built_in">log</span> $*</span><br><span class="line"></span><br><span class="line">gs=git status $*</span><br></pre></td></tr></table></figure><p>还可以将cmder配置到右键菜单，快捷在当前目录打开cmder，方法是先把这个地址加到系统的path环境变量里面，比如我的是 D:cmder，然后右键 Cmder.exe属性-兼容性-以管理员身份运行此程序，再重新打开 Cmder.exe输入 Cmder.exe/REGISTER ALL就行了~</p><p>记得安装完在配置 Setting-Startup-Environment里面加上 setLANG=zh_CN.UTF8，否则输出的一些中文会乱码；</p><p><img src="http://yanxuan.nosdn.127.net/4eca0107c4b9cf08de8de8ae6ec58269.png" class="lazyload" data-srcset="http://yanxuan.nosdn.127.net/4eca0107c4b9cf08de8de8ae6ec58269.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="UTOOLS1590592268002.png"></p><h3 id="6-Typora"><a href="#6-Typora" class="headerlink" title="6. Typora"></a>6. Typora</h3><p>使用过很多 Markdown 编辑器，最后选择了 Typora，与主流编辑器一边编辑一边预览的形式，Typora 是将编辑和预览合并到一起，简洁大方，目光也不需要在复杂的编辑区和预览区中来回切换了，只有当焦点移入的时候才显示 Markdown 语法；</p><p>另外 Typora 还支持 Latex、 [TOC]动态目录、拖拽图片自动生成本地预览链接、自定义主题等方便的功能；<br><img src="http://yanxuan.nosdn.127.net/f6c6fec071e757f18925e5c034a16c59.png" class="lazyload" data-srcset="http://yanxuan.nosdn.127.net/f6c6fec071e757f18925e5c034a16c59.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="UTOOLS1590592303191.png"></p><h3 id="7-Quick-Look"><a href="#7-Quick-Look" class="headerlink" title="7. Quick Look"></a>7. Quick Look</h3><p>QuickLook 是在 Microsoft Store 里面下载的一个速览工具，有时候打开一个PDF、TXT、图片之类的需要等关联程序启动半天，有了它之后只要选中目标文件，按空格，就可以快速预览了，速度非常快，支持图片、视频、音频、压缩包、PDF、文本文件、Markdown、HTML等格式；</p><p>用它来看一些代码什么的，甚至不需要 Sublime\VSCode 启动就可以直接看了，如果只是速览一下的话是非常适合的了。</p><h3 id="8-Myper-Splash"><a href="#8-Myper-Splash" class="headerlink" title="8. Myper Splash"></a>8. Myper Splash</h3><p>Myper Splash 也是可以在 Microsoft Store 里面下载的一款高质量壁纸库，所有壁纸来源 Unsplash 网站，均无版权可以免费使用，再加上简洁美观的UI/UX设计，让你体验一见钟情的感觉。</p><p>另外 MyperSplash 可以设置自动每天自动更换壁纸或锁屏，每天早晨来到办公室点亮屏幕就可以看到 Awesome 的锁屏或壁纸，让你带着好心情开启一天的工作。</p><h3 id="9-GifCam-ScreenToGif"><a href="#9-GifCam-ScreenToGif" class="headerlink" title="9. GifCam / ScreenToGif"></a>9. GifCam / ScreenToGif</h3><p>相信大家都有过需要截一个 Gif 的时候，这里有两个免费 Gif 屏幕录制工具都很不错，小而美的 GifCam 和开源强大的 ScreenToGif ；</p><h3 id="10-Free-Download-Manage"><a href="#10-Free-Download-Manage" class="headerlink" title="10. Free Download Manage"></a>10. Free Download Manage</h3><p>Free Download Manage (FDM) 是一款免费的下载工具，如果你已经受够了国内一些软件的广告和限速，那么 FDM 是一个不错的选择，另外多线程、断点续传、计划任务等功能让 FDM 值得推介。</p><h3 id="11-Sourcetree"><a href="#11-Sourcetree" class="headerlink" title="11. Sourcetree"></a>11. Sourcetree</h3><p>Sourcetree 是跨平台免费的 Git 客户端管理工具，如果受够了手打各种 Git 操作命令，那么 Sourcetree 是一个不错的选择；</p><p>Sourcetree 可以大大简化你的代码操作，特别是对于一些不甚熟悉 Git 命令的人来说灰常实用；一些对 Git 操作比较熟练的用户也可以用它来提升效率，减少出错。</p></div>]]></content>
    
    
    <summary type="html">在此记录一些堪称神器的软件</summary>
    
    
    
    <category term="others" scheme="https://kobingogo.github.io/categories/others/"/>
    
    
    <category term="software" scheme="https://kobingogo.github.io/tags/software/"/>
    
    <category term="软件" scheme="https://kobingogo.github.io/tags/%E8%BD%AF%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>centOS7安装Java环境</title>
    <link href="https://kobingogo.github.io/others-centOS7%E5%AE%89%E8%A3%85Java%E7%8E%AF%E5%A2%83/"/>
    <id>https://kobingogo.github.io/others-centOS7%E5%AE%89%E8%A3%85Java%E7%8E%AF%E5%A2%83/</id>
    <published>2020-05-22T08:28:42.000Z</published>
    <updated>2022-02-07T02:52:27.799Z</updated>
    
    <content type="html"><![CDATA[<p>记录一次在阿里云（系统CentOS 7.4 64位）安装配置Java环境的过程</p><span id="more"></span><h3 id="1-选择合适的jdk版本"><a href="#1-选择合适的jdk版本" class="headerlink" title="1. 选择合适的jdk版本"></a>1. 选择合适的jdk版本</h3><blockquote><p><a href="https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html" target="_blank" rel="noopener external nofollow noreferrer">jdk下载地址</a></p></blockquote><p>选择一下版本获取下载链接<br><img src="http://yanxuan.nosdn.127.net/3f479b3d56b3bfc9acad57e9a09fa94f.png" class="lazyload" data-srcset="http://yanxuan.nosdn.127.net/3f479b3d56b3bfc9acad57e9a09fa94f.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="UTOOLS1590136537164.png"></p><h3 id="2-下载"><a href="#2-下载" class="headerlink" title="2. 下载"></a>2. 下载</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://download.oracle.com/otn/java/jdk/8u251-b08/3d5a2bb8f8d4428bbe94aed7ec7ae784/jdk-8u251-linux-x64.tar.gz?AuthParam=1590135363_2f6dbe12605da3b1164a50e7c1a8db7b</span><br></pre></td></tr></table></figure><blockquote><p>此链接地址可能失效，请自行在步骤1中获取最新下载链接</p></blockquote><p>下载后检查安装包大小是否符合预期（判断安装包是否损坏）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -lht</span><br></pre></td></tr></table></figure><p><img src="http://yanxuan.nosdn.127.net/a9167b8a26ab786fadfaad86f432d0e9.png" class="lazyload" data-srcset="http://yanxuan.nosdn.127.net/a9167b8a26ab786fadfaad86f432d0e9.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="UTOOLS1590136951543.png"></p><h3 id="3-安装"><a href="#3-安装" class="headerlink" title="3. 安装"></a>3. 安装</h3><p>3.1. 创建安装目录：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /usr/local/java/</span><br></pre></td></tr></table></figure><p>3.2 解压到安装目录：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf jdk-8u251-linux-x64.tar.gz?AuthParam=1590135363_2f6dbe12605da3b1164a50e7c1a8db7b -C /usr/local/java</span><br></pre></td></tr></table></figure><h3 id="4-配置环境变量"><a href="#4-配置环境变量" class="headerlink" title="4. 配置环境变量"></a>4. 配置环境变量</h3><p>打开profile文件</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">vim</span> /etc/<span class="keyword">profile</span></span><br></pre></td></tr></table></figure><p>在末尾添加一下代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/local/java/jdk1.8.0_251</span><br><span class="line">export JRE_HOME=$&#123;JAVA_HOME&#125;/jre</span><br><span class="line">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib</span><br><span class="line">export PATH=$&#123;JAVA_HOME&#125;/bin:$PATH</span><br></pre></td></tr></table></figure><p>使环境变量生效</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><p>添加软链接</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/local/java/jdk1.8.0_251/bin/java /usr/bin/java</span><br></pre></td></tr></table></figure><p>验证是否安装成功</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure><p><img src="http://yanxuan.nosdn.127.net/7e0334391843b73fbfbc4963591ab65e.png" class="lazyload" data-srcset="http://yanxuan.nosdn.127.net/7e0334391843b73fbfbc4963591ab65e.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="UTOOLS1590137306874.png"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;记录一次在阿里云（系统CentOS 7.4 64位）安装配置Java环境的过程&lt;/p&gt;</summary>
    
    
    
    <category term="others" scheme="https://kobingogo.github.io/categories/others/"/>
    
    
    <category term="Linux" scheme="https://kobingogo.github.io/tags/linux/"/>
    
    <category term="centOS" scheme="https://kobingogo.github.io/tags/centos/"/>
    
    <category term="java" scheme="https://kobingogo.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>ECMAScript新特性</title>
    <link href="https://kobingogo.github.io/javascript-ECMAScript%E7%89%B9%E6%80%A7%E5%88%86%E6%9E%90/"/>
    <id>https://kobingogo.github.io/javascript-ECMAScript%E7%89%B9%E6%80%A7%E5%88%86%E6%9E%90/</id>
    <published>2020-05-22T06:59:54.000Z</published>
    <updated>2022-02-07T02:52:27.797Z</updated>
    
    <content type="html"><![CDATA[<p>2015年6月发布了ES 6，也就是我们今天广泛使用的版本。这之后每年6月发布一个极小更新的ES版本，比如2016年6月发布的 ES  2016 叫做ES 7，而这个版本只增加了两个新特性。截止目前，ES 11的提案已经定稿了。</p><span id="more"></span><h2 id="ES-7-新特性"><a href="#ES-7-新特性" class="headerlink" title="ES 7 新特性"></a>ES 7 新特性</h2><div class="story post-story"><table><thead><tr><th align="left">功能点</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">Array.prototype.includes</td><td align="left">查找数组</td></tr><tr><td align="left">Exponentiation operator</td><td align="left">指数函数的中缀表示法</td></tr></tbody></table><h3 id="Array-prototype-includes"><a href="#Array-prototype-includes" class="headerlink" title="Array.prototype.includes"></a>Array.prototype.includes</h3><p>includes是一个Array上很有用的方法，用于快速查找数组中是否包含某个元素，包括NaN（和indexOf不一样的点)。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="title class_">NaN</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (arr.<span class="title function_">includes</span>(<span class="number">2</span>)) &#123;</span><br><span class="line">  <span class="comment">//查找2是否存在于arr数组中</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;找到了!&quot;</span>); <span class="comment">//&gt;&gt; 找到了！</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!arr.<span class="title function_">includes</span>(<span class="number">2</span>, <span class="number">3</span>)) &#123;</span><br><span class="line">  <span class="comment">//第二个参数3表示数组下标为3的项，也即第4项开始查找</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">&quot;不存在!&quot;</span>); <span class="comment">//&gt;&gt; 不存在！</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//下面两句说明incluedes和indexOf的区别</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr.<span class="title function_">includes</span>(<span class="title class_">NaN</span>)); <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr.<span class="title function_">indexOf</span>(<span class="title class_">NaN</span>) != -<span class="number">1</span>); <span class="comment">//false</span></span><br></pre></td></tr></table></figure><h3 id="指数函数用法"><a href="#指数函数用法" class="headerlink" title="指数函数用法"></a>指数函数用法</h3><p>JavaScript采用两个星符号**来表示Math.pow，相对于Math.pow的好处：</p><ol><li>中缀表示法比函数表示法更简洁，这使它更可取。</li><li>方便数学、物理、机器人学等领域的计算。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用法一：x ** y</span></span><br><span class="line"><span class="keyword">let</span> squared = <span class="number">2</span> ** <span class="number">2</span>;<span class="comment">//等同于: 2 * 2</span></span><br><span class="line"><span class="keyword">let</span> cubed = <span class="number">2</span> ** <span class="number">3</span>;<span class="comment">//等同于: 2 * 2 * 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//用法二：x **= y</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">2</span>;</span><br><span class="line">a **= <span class="number">2</span>;<span class="comment">//等同于: a = a * a;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = <span class="number">3</span>;</span><br><span class="line">b **= <span class="number">3</span>;<span class="comment">//等同于: b = b * b * b;</span></span><br></pre></td></tr></table></figure></div><h2 id="ES-8-新特性"><a href="#ES-8-新特性" class="headerlink" title="ES 8 新特性"></a>ES 8 新特性</h2><div class="story post-story"><table><thead><tr><th align="left">功能点</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">Object.values / Object.entries</td><td align="left"></td></tr><tr><td align="left">String padding</td><td align="left">字符串追加</td></tr><tr><td align="left">Object.getOwnPropertyDescriptors</td><td align="left">返回指定对象自己所有的属性内容</td></tr><tr><td align="left">Async functions</td><td align="left">异步函数</td></tr><tr><td align="left">Shared memory and atomics</td><td align="left">共享内存和 Atomics 对象</td></tr></tbody></table><h3 id="Object-values-Object-entries"><a href="#Object-values-Object-entries" class="headerlink" title="Object.values() / Object.entries"></a>Object.values() / Object.entries</h3><ul><li>Object.values(obj)，obj 参数是对目标对象的操作，它可以是一个对象或者数组</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">x</span>: <span class="string">&#x27;xxx&#x27;</span>, <span class="attr">y</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">values</span>(obj); <span class="comment">// [&#x27;xxx&#x27;, 1]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = [<span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;8&#x27;</span>]; <span class="comment">// 等同于 &#123; 0: &#x27;e&#x27;, 1: &#x27;s&#x27;, 2: &#x27;8&#x27; &#125;;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">values</span>(obj); <span class="comment">// [&#x27;e&#x27;, &#x27;s&#x27;, &#x27;8&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//当把数字对象的当键的时候，返回的数组以键的值升序排序</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123; <span class="number">10</span>: <span class="string">&#x27;xxx&#x27;</span>, <span class="number">1</span>: <span class="string">&#x27;yyy&#x27;</span>, <span class="number">3</span>: <span class="string">&#x27;zzz&#x27;</span> &#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">values</span>(obj); <span class="comment">// [&#x27;yyy&#x27;, &#x27;zzz&#x27;, &#x27;xxx&#x27;]</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">values</span>(<span class="string">&#x27;es8&#x27;</span>); <span class="comment">// [&#x27;e&#x27;, &#x27;s&#x27;, &#x27;8&#x27;]</span></span><br></pre></td></tr></table></figure><ul><li>Object.entries方法返回一个给定对象可枚举属性值的数组[key, value]，与Object.values类似</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">x</span>: <span class="string">&#x27;xxx&#x27;</span>, <span class="attr">y</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">entries</span>(obj); <span class="comment">// [[&#x27;x&#x27;, &#x27;xxx&#x27;], [&#x27;y&#x27;, 1]]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = [<span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;8&#x27;</span>];</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">entries</span>(obj); <span class="comment">// [[&#x27;0&#x27;, &#x27;e&#x27;], [&#x27;1&#x27;, &#x27;s&#x27;], [&#x27;2&#x27;, &#x27;8&#x27;]]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123; <span class="number">10</span>: <span class="string">&#x27;xxx&#x27;</span>, <span class="number">1</span>: <span class="string">&#x27;yyy&#x27;</span>, <span class="number">3</span>: <span class="string">&#x27;zzz&#x27;</span> &#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">entries</span>(obj); <span class="comment">// [[&#x27;1&#x27;, &#x27;yyy&#x27;], [&#x27;3&#x27;, &#x27;zzz&#x27;], [&#x27;10&#x27;, &#x27;xxx&#x27;]]</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">entries</span>(<span class="string">&#x27;es8&#x27;</span>); <span class="comment">// [[&#x27;0&#x27;, &#x27;e&#x27;], [&#x27;1&#x27;, &#x27;s&#x27;], [&#x27;2&#x27;, &#x27;8&#x27;]]</span></span><br></pre></td></tr></table></figure><h3 id="字符串追加"><a href="#字符串追加" class="headerlink" title="字符串追加"></a>字符串追加</h3><p>在 ES 8 中String新增了两个实例函数String.prototype.padStart和String.prototype.padEnd，允许将空字符串或其他字符串添加到原始字符串的开头或结尾。<br><code>String.padStart(targetLength,[padString])</code><br>targetLength：当前字符串需要填充到的目标长度。如果这个数值小于当前字符串的长度，则返回当前字符串本身。<br>padString：(可选)填充字符串。如果字符串太长，使填充后的字符串长度超过了目标长度，则只保留最左侧的部分，其他部分会被截断，此参数的缺省值为空格。<br><code>String.padEnd(targetLength,padString]) 参数释义同上。</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;es8&#x27;</span>.<span class="title function_">padStart</span>(<span class="number">2</span>);          <span class="comment">// &#x27;es8&#x27;</span></span><br><span class="line"><span class="string">&#x27;es8&#x27;</span>.<span class="title function_">padStart</span>(<span class="number">5</span>);          <span class="comment">// &#x27;  es8&#x27;</span></span><br><span class="line"><span class="string">&#x27;es8&#x27;</span>.<span class="title function_">padStart</span>(<span class="number">6</span>, <span class="string">&#x27;1891&#x27;</span>);  <span class="comment">// &#x27;189es8&#x27;</span></span><br><span class="line"><span class="string">&#x27;es8&#x27;</span>.<span class="title function_">padStart</span>(<span class="number">14</span>, <span class="string">&#x27;coffe&#x27;</span>);  <span class="comment">// &#x27;coffecoffecoffes8&#x27;</span></span><br><span class="line"><span class="string">&#x27;es8&#x27;</span>.<span class="title function_">padStart</span>(<span class="number">7</span>, <span class="string">&#x27;0&#x27;</span>);     <span class="comment">// &#x27;0000es8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;es8&#x27;</span>.<span class="title function_">padEnd</span>(<span class="number">2</span>);            <span class="comment">// &#x27;es8&#x27;</span></span><br><span class="line"><span class="string">&#x27;es8&#x27;</span>.<span class="title function_">padEnd</span>(<span class="number">5</span>);            <span class="comment">// &#x27;es8  &#x27;</span></span><br><span class="line"><span class="string">&#x27;es8&#x27;</span>.<span class="title function_">padEnd</span>(<span class="number">6</span>, <span class="string">&#x27;1891&#x27;</span>);    <span class="comment">// &#x27;es81891&#x27;</span></span><br><span class="line"><span class="string">&#x27;es8&#x27;</span>.<span class="title function_">padEnd</span>(<span class="number">14</span>, <span class="string">&#x27;coffe&#x27;</span>);    <span class="comment">// &#x27;es8coffecoffecoff&#x27;</span></span><br><span class="line"><span class="string">&#x27;es8&#x27;</span>.<span class="title function_">padEnd</span>(<span class="number">7</span>, <span class="string">&#x27;9&#x27;</span>);       <span class="comment">// &#x27;es89999&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="Object-getOwnPropertyDescriptors"><a href="#Object-getOwnPropertyDescriptors" class="headerlink" title="Object.getOwnPropertyDescriptors"></a>Object.getOwnPropertyDescriptors</h3><p><code>getOwnPropertyDescriptors</code>方法返回指定对象自己所有的属性内容，并且属性内容只是自身直接定义的，而不是从object的原型继承而来的。<br>定义是：<code>Object.getOwnPropertyDescriptors(obj)</code>，<code>obj</code> 是指目标对象，这个方法返回的值可能是 configurable、enumerable、writable、get、set 和 value。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">es7</span>() &#123; <span class="keyword">return</span> <span class="number">7</span>; &#125;,</span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">es8</span>() &#123; <span class="keyword">return</span> <span class="number">8</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptors</span>(obj);</span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   es7: &#123;</span></span><br><span class="line"><span class="comment">//     configurable: true,</span></span><br><span class="line"><span class="comment">//     enumerable: true,</span></span><br><span class="line"><span class="comment">//     get: function es7()&#123;&#125;, //the getter function</span></span><br><span class="line"><span class="comment">//     set: undefined</span></span><br><span class="line"><span class="comment">//   &#125;,</span></span><br><span class="line"><span class="comment">//   es8: &#123;</span></span><br><span class="line"><span class="comment">//     configurable: true,</span></span><br><span class="line"><span class="comment">//     enumerable: true,</span></span><br><span class="line"><span class="comment">//     get: function es8()&#123;&#125;, //the getter function</span></span><br><span class="line"><span class="comment">//     set: undefined</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure><p>getOwnPropertyDescriptors可以用来创建子类：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">superclass</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">superclass.<span class="property"><span class="keyword">prototype</span></span> = &#123;</span><br><span class="line">  <span class="comment">// 在这里定义方法和属性</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">subclass</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">subclass.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(superclass.<span class="property"><span class="keyword">prototype</span></span>, <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptors</span>(&#123;</span><br><span class="line">  <span class="comment">// 在这里定义方法和属性</span></span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><h3 id="异步函数"><a href="#异步函数" class="headerlink" title="异步函数"></a>异步函数</h3><p>Async Functions也就是我们常说的Async/Await,已经用的很频繁了，在此不再赘述。</p><h3 id="SharedArrayBuffer-amp-Atomics"><a href="#SharedArrayBuffer-amp-Atomics" class="headerlink" title="SharedArrayBuffer &amp; Atomics"></a>SharedArrayBuffer &amp; Atomics</h3><p>SharedArrayBuffer 对象用来表示一个通用的，固定长度的原始二进制数据缓冲区，类似于 ArrayBuffer 对象，它们都可以用来在共享内存（shared memory）上创建视图。与 ArrayBuffer 不同的是，SharedArrayBuffer 不能被分离。</p><blockquote><p>请注意，作为对Spectre的响应，所有主流浏览器均默认于2018年1月5日禁用SharedArrayBuffer。 Chrome在启用了网站隔离功能的平台上的v67中重新启用了该功能，以防止出现Spectre风格的漏洞。</p></blockquote><ul><li>语法：</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; length 所创建的数组缓冲区的大小，以字节(byte)为单位。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">SharedArrayBuffer</span>&#125; 一个大小指定的新 SharedArrayBuffer 对象。其内容被初始化为 0。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">SharedArrayBuffer</span>(length)</span><br></pre></td></tr></table></figure><p>共享内存能被同时创建和更新于工作者线程或主线程。依赖于系统（CPU，操作系统，浏览器），变化传递给所有上下文环境需要一段时间。需要通过 atomic 操作来进行同步。</p><p><code>Atomics</code> 对象提供了一组静态方法用来对 <code>SharedArrayBuffer</code> 对象进行原子操作。这些原子操作属于 <code>Atomics</code> 模块。与一般的全局对象不同，Atomics 不是构造函数，因此不能使用 new 操作符调用，也不能将其当作函数直接调用。Atomics 的所有属性和方法都是静态的（与 <code>Math</code>  对象一样）。</p><p>多个共享内存的线程能够同时读写同一位置上的数据。原子操作会确保正在读或写的数据的值是符合预期的，即下一个原子操作一定会在上一个原子操作结束后才会开始，其操作过程不会中断。</p><table><thead><tr><th align="left">方法名</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Atomics/add" target="_blank" rel="noopener external nofollow noreferrer">Atomics.add()</a></td><td align="left">将指定位置上的数组元素与给定的值相加，并返回相加前该元素的值</td></tr><tr><td align="left"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Atomics/and" target="_blank" rel="noopener external nofollow noreferrer">Atomics.and()</a></td><td align="left">将指定位置上的数组元素与给定的值相与，并返回与操作前该元素的值。</td></tr><tr><td align="left"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Atomics/compareExchange" target="_blank" rel="noopener external nofollow noreferrer">Atomics.compareExchange()</a></td><td align="left">如果数组中指定的元素与给定的值相等，则将其更新为新的值，并返回该元素原先的值。</td></tr><tr><td align="left"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Atomics/exchange" target="_blank" rel="noopener external nofollow noreferrer">Atomics.exchange()</a></td><td align="left">将数组中指定的元素更新为给定的值，并返回该元素更新前的值。</td></tr><tr><td align="left"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Atomics/load" target="_blank" rel="noopener external nofollow noreferrer">Atomics.load()</a></td><td align="left">返回数组中指定元素的值。</td></tr><tr><td align="left"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Atomics/or" target="_blank" rel="noopener external nofollow noreferrer">Atomics.or()</a></td><td align="left">将指定位置上的数组元素与给定的值相或，并返回或操作前该元素的值。</td></tr><tr><td align="left"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Atomics/store" target="_blank" rel="noopener external nofollow noreferrer">Atomics.store()</a></td><td align="left">将数组中指定的元素设置为给定的值，并返回该值。</td></tr><tr><td align="left"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Atomics/sub" target="_blank" rel="noopener external nofollow noreferrer">Atomics.sub()</a></td><td align="left">将指定位置上的数组元素与给定的值相减，并返回相减前该元素的值。</td></tr><tr><td align="left"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Atomics/xor" target="_blank" rel="noopener external nofollow noreferrer">Atomics.xor()</a></td><td align="left">将指定位置上的数组元素与给定的值相异或，并返回异或操作前该元素的值。</td></tr><tr><td align="left"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Atomics/wait" target="_blank" rel="noopener external nofollow noreferrer">Atomics.wait()</a></td><td align="left">检测数组中某个指定位置上的值是否仍然是给定值，是则保持挂起直到被唤醒或超时。返回值为 &quot;ok&quot;、&quot;not-equal&quot; 或 &quot;time-out&quot;。调用时，如果当前线程不允许阻塞，则会抛出异常（大多数浏览器都不允许在主线程中调用 wait()）。</td></tr><tr><td align="left"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Atomics/wake" target="_blank" rel="noopener external nofollow noreferrer">Atomics.wake()</a></td><td align="left">唤醒等待队列中正在数组指定位置的元素上等待的线程。返回值为成功唤醒的线程数量。</td></tr><tr><td align="left"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Atomics/isLockFree" target="_blank" rel="noopener external nofollow noreferrer">Atomics.isLockFree(size)</a></td><td align="left">可以用来检测当前系统是否支持硬件级的原子操作。对于指定大小的数组，如果当前系统支持硬件级的原子操作，则返回 true；否则就意味着对于该数组，Atomics 对象中的各原子操作都只能用锁来实现。此函数面向的是技术专家。</td></tr></tbody></table></div><h2 id="ES-9-新特性"><a href="#ES-9-新特性" class="headerlink" title="ES 9 新特性"></a>ES 9 新特性</h2><div class="story post-story"><table><thead><tr><th align="left">新特性</th><th align="left">中文说明</th></tr></thead><tbody><tr><td align="left">Asynchronous Iteration</td><td align="left">异步迭代器</td></tr><tr><td align="left"><code>Promise.prototype.finally</code></td><td align="left"></td></tr><tr><td align="left">Lifting template literal restriction</td><td align="left">重新修订了字面量的转义</td></tr><tr><td align="left">Rest/Spread Properties</td><td align="left">Rest/Spread 属性</td></tr><tr><td align="left"><code>s</code> (dotAll) flag for regular expressions</td><td align="left">正则表达式dotAll模式</td></tr><tr><td align="left">RegExp named capture groups</td><td align="left">正则表达式命名捕获组</td></tr><tr><td align="left">RegExp Lookbehind Assertions</td><td align="left">正则表达式反向断言</td></tr><tr><td align="left">RegExp Unicode Property Escapes</td><td align="left">正则表达式 Unicode 转义</td></tr></tbody></table><h3 id="异步迭代器"><a href="#异步迭代器" class="headerlink" title="异步迭代器"></a>异步迭代器</h3><p>在<code>async</code>/<code>await</code>的某些时刻，你可能尝试在同步循环中调用异步函数。例如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">func</span>(<span class="params">array</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> array) &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">someFunc</span>(i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这段代码不会达到预期目的，下面这段同样也不会：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">func</span>(<span class="params">array</span>) &#123;</span><br><span class="line">  array.<span class="title function_">forEach</span>(<span class="keyword">async</span> i =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">someFunc</span>(i);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面这段代码中，循环本身依旧保持同步，并在内部异步函数之前全部调用完成。</p><p>引入异步迭代器后，就像常规迭代器，除了<code>next()</code>方法返回一个Promise。因此<code>await</code>可以和<code>for...of</code>循环一起使用，以串行的方式运行异步操作。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">func</span>(<span class="params">array</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> <span class="keyword">await</span> (<span class="keyword">let</span> i <span class="keyword">of</span> array) &#123;<span class="comment">//异步迭代</span></span><br><span class="line">    <span class="title function_">someFunc</span>(i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>更多详细论述见“壹.2.12”。</p><h3 id="Promise-prototype-finally"><a href="#Promise-prototype-finally" class="headerlink" title="Promise.prototype.finally"></a>Promise.prototype.finally</h3><p>一个Promise调用链要么成功到达最后一个<code>.then()</code>，要么失败触发<code>.catch()</code>。在某些情况下，你想要在无论Promise运行成功还是失败，运行相同的代码，例如清除数组、删除对话、关闭数据库连接等，<code>.finally()</code>允许实现这样的目的。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">func</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">promiseFunc</span>() <span class="comment">//返回一个Promise对象</span></span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;&#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">finally</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//无论promiseFunc()运行成功还是失败，这里的代码会被调用到</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>更多详细论述见“壹.2.12”。</p><h3 id="重新修订了字面量的转义"><a href="#重新修订了字面量的转义" class="headerlink" title="重新修订了字面量的转义"></a>重新修订了字面量的转义</h3><p>ES9 之前，<code>\u</code>表示 unicode 转义，<code>\x</code>表示十六进制转义，<code>\</code>后跟一个数字表示八进制转义，这使得创建特定的字符串变得不可能，例如Windows文件路径<code>C:\uuu\xxx\111</code>。</p><p>要取消转义序列的语法限制，可在模板字符串之前使用标记函数<code>String.raw</code>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">`\u&#123;54&#125;`</span> <span class="comment">//会转义成unicode &quot;T&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s);<span class="comment">//&gt;&gt; T</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> str = <span class="title class_">String</span>.<span class="property">raw</span><span class="string">`\u&#123;54&#125;`</span>; <span class="comment">//不会被转义</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str);<span class="comment">//&gt;&gt; \u&#123;54&#125;</span></span><br></pre></td></tr></table></figure><h3 id="Rest-Spread-属性"><a href="#Rest-Spread-属性" class="headerlink" title="Rest / Spread 属性"></a>Rest / Spread 属性</h3><p>这个就是我们通常所说的三个点<code>...</code>，在<code>=</code>左边的是<strong>rest参数</strong>，放在<code>=</code>右边或者作为参数的是<strong>扩展运算符</strong>，这项特性在ES6中已经引入，但是ES6中的作用对象仅限于数组。在ES9中，为对象提供了像数组一样的rest参数和扩展运算符：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">c</span>: <span class="number">3</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> &#123; a, ...param &#125; = obj; <span class="comment">//这里...是rest参数</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="comment">//&gt;&gt; 1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(param); <span class="comment">//&gt;&gt; &#123;b: 2, c: 3&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">&#123; a, ...param &#125;</span>) &#123;<span class="comment">//这里...是扩展运算符</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="comment">//&gt;&gt; 1</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(param); <span class="comment">//&gt;&gt; &#123;b: 2, c: 3&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="正则表达式dotAll模式"><a href="#正则表达式dotAll模式" class="headerlink" title="正则表达式dotAll模式"></a>正则表达式dotAll模式</h3><p>正则表达式中点<code>.</code>匹配除回车外的任何单字符，标记<code>s</code>改变这种行为，允许匹配回车换行。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/hello.<span class="property">world</span>/.<span class="title function_">test</span>(<span class="string">&#x27;hello\nworld&#x27;</span>);  <span class="comment">// false</span></span><br><span class="line"><span class="regexp">/hello.world/</span>s.<span class="title function_">test</span>(<span class="string">&#x27;hello\nworld&#x27;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="regexp">/hello.world/</span>s.<span class="title function_">test</span>(<span class="string">`hello</span></span><br><span class="line"><span class="string">world`</span>))   <span class="comment">//&gt;&gt; true</span></span><br></pre></td></tr></table></figure><h3 id="正则表达式命名捕获组"><a href="#正则表达式命名捕获组" class="headerlink" title="正则表达式命名捕获组"></a>正则表达式命名捕获组</h3><p>Javascript正则表达式中使用<code>exec()</code>匹配后，能够返回一个包含匹配字符串的类数组对象。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reDate = <span class="regexp">/(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)/</span>,</span><br><span class="line">  match = reDate.<span class="title function_">exec</span>(<span class="string">&quot;2018-08-06&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(match);<span class="comment">//&gt;&gt; [2018-08-06, 2018, 08, 06]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//这样就可以直接用索引来获取年月日：</span></span><br><span class="line"><span class="keyword">let</span> year = match[<span class="number">1</span>]; <span class="comment">//&gt;&gt; 2018</span></span><br><span class="line"><span class="keyword">let</span> month = match[<span class="number">2</span>]; <span class="comment">//&gt;&gt; 08</span></span><br><span class="line"><span class="keyword">let</span> day = match[<span class="number">3</span>]; <span class="comment">//&gt;&gt; 06</span></span><br></pre></td></tr></table></figure><p>返回数组的第0项为与正则表达式相匹配的文本，第 1 项是与 <code>reDate</code> 的第 1 个分组<code>\d&#123;4&#125;</code>相匹配的文本（如果有的话），第 2 项是与 <code>reDate</code> 的第 2 个分组<code>\d&#123;2&#125;</code>相匹配的文本（如果有的话），以此类推。正则表达式的组以<code>()</code>包起来。</p><p>上面的案例，若是日期格式变成<code>月日年</code>，那么改变正则表达式的结构后，还有可能会改变变量的赋值部分的代码。如下示例：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reDate = <span class="regexp">/(\d&#123;2&#125;)-(\d&#123;2&#125;)-(\d&#123;4&#125;)/</span>,<span class="comment">//表达式结构变化了</span></span><br><span class="line">  match = reDate.<span class="title function_">exec</span>(<span class="string">&quot;08-06-2018&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(match);<span class="comment">//&gt;&gt; [08-06-2018, 08, 06, 2018]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//此时年月日的赋值代码也要改了,改的地方真多啊！怎么办？</span></span><br><span class="line"><span class="keyword">let</span> year = match[<span class="number">3</span>]; <span class="comment">//&gt;&gt; 2018</span></span><br><span class="line"><span class="keyword">let</span> month = match[<span class="number">1</span>]; <span class="comment">//&gt;&gt; 08</span></span><br><span class="line"><span class="keyword">let</span> day = match[<span class="number">2</span>]; <span class="comment">//&gt;&gt; 06</span></span><br></pre></td></tr></table></figure><p>可以发现上面的写法改的地方太多了，有没有办法少改点代码省省事呢？有！ ES9 允许使用符号<code>?&lt;name&gt;</code>来命名<strong>捕获组</strong>（也即“匹配到的组”），示例如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reDate = <span class="regexp">/(?&lt;year&gt;\d&#123;4&#125;)-(?&lt;month&gt;\d&#123;2&#125;)-(?&lt;day&gt;\d&#123;2&#125;)/</span>,</span><br><span class="line">  match = reDate.<span class="title function_">exec</span>(<span class="string">&quot;2018-08-06&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(match);</span><br><span class="line"><span class="comment">//&gt;&gt; [2018-08-06, 08, 06, 2018, groups: &#123;day: 06, month: 08, year: 2018&#125;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//此时用groups对象来获取年月日，无论正则表达式怎么变换，这下面三行不用改了，省事！</span></span><br><span class="line"><span class="keyword">let</span> year = match.<span class="property">groups</span>.<span class="property">year</span>; <span class="comment">//&gt;&gt; 2018</span></span><br><span class="line"><span class="keyword">let</span> month = match.<span class="property">groups</span>.<span class="property">month</span>; <span class="comment">//&gt;&gt; 08</span></span><br><span class="line"><span class="keyword">let</span> day = match.<span class="property">groups</span>.<span class="property">day</span>; <span class="comment">//&gt;&gt; 06</span></span><br></pre></td></tr></table></figure><p>命名捕获组的写法相当于是把每个捕获组都定义了一个名字，然后存储到返回值的<code>groups</code>属性中。</p><h3 id="正则表达式后行断言"><a href="#正则表达式后行断言" class="headerlink" title="正则表达式后行断言"></a>正则表达式后行断言</h3><p>先看看正则表达式<strong>先行断言</strong>示例：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> re1 = <span class="regexp">/\D(\d+)/</span>,</span><br><span class="line">    re2 = <span class="regexp">/\D(?=\d+)/</span>,<span class="comment">//&quot;?=&quot;是正向先行断言</span></span><br><span class="line">    match1 = re1.<span class="title function_">exec</span>(<span class="string">&quot;$123.45&quot;</span>),</span><br><span class="line">    match2 = re2.<span class="title function_">exec</span>(<span class="string">&quot;$123.45&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(match1[<span class="number">0</span>]); <span class="comment">//&gt;&gt; $123</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(match2[<span class="number">0</span>]); <span class="comment">//&gt;&gt; $</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>(?=pattern)</strong> 零宽正向先行断言(zero-width positive lookahead assertion)<br>代表字符串中的一个位置，<strong>紧接该位置之后</strong>的字符序列<strong>能够匹配</strong>pattern；</p><p>(<strong>?!pattern)</strong> 零宽负向先行断言(zero-width negative lookahead assertion)<br>代表字符串中的一个位置，<strong>紧接该位置之后</strong>的字符序列<strong>不能匹配</strong>pattern；</p><p><strong>(?&lt;=pattern)</strong> 零宽正向后行断言(zero-width positive lookbehind assertion)<br>代表字符串中的一个位置，<strong>紧接该位置之前</strong>的字符序列<strong>能够匹配</strong>pattern；</p><p><strong>(?&lt;!pattern)</strong> 零宽负向后行断言(zero-width negative lookbehind assertion)<br>代表字符串中的一个位置，<strong>紧接该位置之前</strong>的字符序列<strong>不能匹配</strong>pattern。</p></blockquote><p>在ES9中，可以允许使用<code>?&lt;=</code>进行<strong>正向后行断言</strong>，可以获取货币的价格而忽略货币符号。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> re= <span class="regexp">/(?&lt;=\D)[\d\.]+/</span>,</span><br><span class="line">    match = re.<span class="title function_">exec</span>(<span class="string">&quot;$123.45&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(match[<span class="number">0</span>]); <span class="comment">//&gt;&gt; 123.45</span></span><br></pre></td></tr></table></figure><p>上面的正向后行断言，也就是说<code>\D</code>这个条件必须满足，但<code>\D</code>匹配的字符不会作为结果输出（因为<strong>先行/后行断言</strong>其实只是匹配了一个位置）。如果是下面这样：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> re= <span class="regexp">/(?&lt;=\D)[\d\.]+/</span>,</span><br><span class="line">    match1 = re.<span class="title function_">exec</span>(<span class="string">&quot;123.45&quot;</span>),</span><br><span class="line">    match2 = re.<span class="title function_">exec</span>(<span class="string">&quot;12345&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(match1 &amp;&amp; match1[<span class="number">0</span>]); <span class="comment">//&gt;&gt; 45</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(match2 &amp;&amp; match1[<span class="number">0</span>]); <span class="comment">//&gt;&gt; null</span></span><br></pre></td></tr></table></figure><p>可以看到<code>match1</code>匹配到的是<code>45</code>,这是由于在<code>.</code>前面没有任何符合<code>\D</code>的匹配内容，它会一直找到符合<code>\D</code>的内容，也就是<code>.</code>然后返回后面的内容。而<code>match2</code>若是没有满足前面肯定反向断言的条件的话，则结果返回<code>null</code>。</p><h3 id="正则表达式-Unicode-转义"><a href="#正则表达式-Unicode-转义" class="headerlink" title="正则表达式 Unicode 转义"></a>正则表达式 Unicode 转义</h3><p>ES9 之前，在正则表达式中本地访问 Unicode 字符属性是不被允许的。ES9 添加了 Unicode 属性转义，形式为<code>\p&#123;...&#125;</code>和<code>\P&#123;...&#125;</code>，在正则表达式中使用标记 <code>u</code> (unicode) 设置，在<code>\p</code>的<code>&#123;...&#125;</code>内，可用键值对的方式设置需要匹配的属性而非具体内容。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> regex = <span class="regexp">/\p&#123;Script=Greek&#125;/u</span>;<span class="comment">//Greek为希腊语的意思</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(regex.<span class="title function_">test</span>(<span class="string">&#x27;a&#x27;</span>)); <span class="comment">//&gt;&gt; flase</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(regex.<span class="title function_">test</span>(<span class="string">&#x27;Σ&#x27;</span>)); <span class="comment">//&gt;&gt; true</span></span><br></pre></td></tr></table></figure></div><h2 id="ES-10-新特性"><a href="#ES-10-新特性" class="headerlink" title="ES 10 新特性"></a>ES 10 新特性</h2><div class="story post-story"><table><thead><tr><th align="left">新特性</th><th align="left">中文说明</th></tr></thead><tbody><tr><td align="left">Optional <code>catch</code> binding</td><td align="left">可选的 catch 变量绑定</td></tr><tr><td align="left">JSON superset</td><td align="left">JSON超集</td></tr><tr><td align="left"><code>Symbol.prototype.description</code></td><td align="left">Symbol 对象的 description 属性</td></tr><tr><td align="left"><code>Function.prototype.toString</code> revision</td><td align="left">修订<code>Function.prototype.toString</code></td></tr><tr><td align="left"><code>Object.fromEntries</code></td><td align="left"></td></tr><tr><td align="left">Well-formed <code>JSON.stringify</code></td><td align="left">更加友好的JSON.stringify</td></tr><tr><td align="left"><code>String.prototype.&#123;trimStart,trimEnd&#125;</code></td><td align="left"></td></tr><tr><td align="left"><code>Array.prototype.&#123;flat,flatMap&#125;</code></td><td align="left"></td></tr></tbody></table><h3 id="可选的-catch-变量绑定"><a href="#可选的-catch-变量绑定" class="headerlink" title="可选的 catch 变量绑定"></a>可选的 catch 变量绑定</h3><p>在 ES10 之前，我们必须通过语法为 catch 子句绑定异常变量，无论是否有必要。很多时候 catch 块是多余的，而 ES10 使我们能够简单的把变量省略掉。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//之前是</span></span><br><span class="line"><span class="keyword">try</span> &#123;&#125; <span class="keyword">catch</span>(e) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ES10之后可以写成，</span></span><br><span class="line"><span class="keyword">try</span> &#123;&#125; <span class="keyword">catch</span> &#123;&#125;<span class="comment">//省掉了变量e</span></span><br></pre></td></tr></table></figure><h3 id="JSON超集"><a href="#JSON超集" class="headerlink" title="JSON超集"></a>JSON超集</h3><p>什么是 JSON 超集？简单来说就是 JSON 是 ECMAScript 的子集，也就是说让 ECMAScript 兼容 JSON 的内容所支持的全部文本。</p><p>ECMAScript 在标准 <a href="https://tc39.es/ecma262/#sec-json.parse" target="_blank" rel="noopener external nofollow noreferrer">JSON.parse</a> 部分阐明了 JSON 确为其一个子集，但由于 JSON 的内容可以正常包含 <code>U+2028</code> 行分隔符与 <code>U+2029</code> 段落分隔符，而 ECMAScript 却不行，所以，该草案旨在解决这一问题。在这之前，如果你使用 <code>JSON.parse()</code> 执行带如上特殊字符的字符串时，只会收到 <code>SyntaxError</code> 的错误提示。该草案同样是向后兼容的，其对用户唯一的影响是保持原样，即在暂不支持特殊字符解析的运行环境中保持报错 <code>SyntaxError</code> 。</p><h3 id="Symbol-对象的-description-属性"><a href="#Symbol-对象的-description-属性" class="headerlink" title="Symbol 对象的 description 属性"></a>Symbol 对象的 description 属性</h3><p>ES10 中为 Symbol 对象添加了只读属性 <code>description</code> ，该对象返回包含 Symbol 描述的字符串。在创建Symbol时向其添加<code>description</code> (描述)，能够直接访问<code>description</code> ，对调试是很有用的。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sym = <span class="title class_">Symbol</span>(<span class="string">&#x27;foo&#x27;</span>);<span class="comment">//添加的描述内容为“foo”</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sym.<span class="property">description</span>);<span class="comment">//&gt;&gt; foo</span></span><br><span class="line"></span><br><span class="line">sym = <span class="title class_">Symbol</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sym.<span class="property">description</span>);<span class="comment">//&gt;&gt; undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//和 Symbol() 不同的是，用 Symbol.for() 方法创建的的 symbol 会被放入一个全局</span></span><br><span class="line"><span class="comment">//symbol 注册表中。Symbol.for() 并不是每次都会创建一个新的 symbol，它会首先检</span></span><br><span class="line"><span class="comment">//查给定的 key 是否已经在注册表中了。假如是，则会直接返回上次存储的那个。否则，它</span></span><br><span class="line"><span class="comment">//会再新建一个。</span></span><br><span class="line">sym = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;bar&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sym.<span class="property">description</span>);<span class="comment">//&gt;&gt; bar</span></span><br></pre></td></tr></table></figure><h3 id="修订Function-prototype-toString"><a href="#修订Function-prototype-toString" class="headerlink" title="修订Function.prototype.toString"></a>修订Function.prototype.toString</h3><p>函数原型上的方法<code>toString()</code>现在返回精确字符，包括空格和注释。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="comment">/* comment */</span> foo <span class="comment">/* another comment */</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ES10之前不会打印注释部分</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo.<span class="title function_">toString</span>()); <span class="comment">//&gt;&gt; function foo()&#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ES10里，会把注释一同打印</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo.<span class="title function_">toString</span>()); <span class="comment">//&gt;&gt; function /* comment */ foo /* another comment */ ()&#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//注意：</span></span><br><span class="line"><span class="comment">//箭头函数是个例外</span></span><br><span class="line"><span class="keyword">const</span> bar <span class="comment">/* comment */</span> = <span class="comment">/* another comment */</span> <span class="function">() =&gt;</span> &#123;&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bar.<span class="title function_">toString</span>()); <span class="comment">//&gt;&gt; () =&gt; &#123;&#125;</span></span><br></pre></td></tr></table></figure><h3 id="Object-fromEntries"><a href="#Object-fromEntries" class="headerlink" title="Object.fromEntries"></a>Object.fromEntries</h3><p>在 JavaScript 操作中，数据在各种数据结构之间的转换都是很容易的，比如 Map 到数组、Map 到 Set、对象到 Map 等等。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>().<span class="title function_">set</span>(<span class="string">&#x27;foo&#x27;</span>, <span class="literal">true</span>).<span class="title function_">set</span>(<span class="string">&#x27;bar&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line"><span class="keyword">let</span> arr = <span class="title class_">Array</span>.<span class="title function_">from</span>(map);</span><br><span class="line"><span class="keyword">let</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>(map.<span class="title function_">values</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">foo</span>: <span class="literal">true</span>, <span class="attr">bar</span>: <span class="literal">false</span> &#125;;</span><br><span class="line"><span class="comment">//下一句 Object.entries() 方法返回给定对象 obj 自身可枚举属性的键值对数组,</span></span><br><span class="line"><span class="comment">//形如：[[&quot;foo&quot;,true],[&quot;bar&quot;,false]]</span></span><br><span class="line"><span class="keyword">let</span> newMap = <span class="keyword">new</span> <span class="title class_">Map</span>(<span class="title class_">Object</span>.<span class="title function_">entries</span>(obj));</span><br></pre></td></tr></table></figure><p>但是如果我们需要将一个键值对列表转换为对象，就要写点费劲的代码了。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>().<span class="title function_">set</span>(<span class="string">&quot;foo&quot;</span>, <span class="literal">true</span>).<span class="title function_">set</span>(<span class="string">&quot;bar&quot;</span>, <span class="literal">false</span>);</span><br><span class="line"><span class="keyword">let</span> obj = <span class="title class_">Array</span>.<span class="title function_">from</span>(map).<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, [key, val]</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">assign</span>(acc, &#123;</span><br><span class="line">    [key]: val</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;, &#123;&#125;);</span><br></pre></td></tr></table></figure><p>该特性的目的在于为对象添加一个新的静态方法 <code>Object.fromEntries</code>，用于将符合键值对的列表（例如 Map、数组等）转换为一个对象。上一块的代码中的转换逻辑，现在我们只需要一行代码即可搞定。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>().<span class="title function_">set</span>(<span class="string">&quot;foo&quot;</span>, <span class="literal">true</span>).<span class="title function_">set</span>(<span class="string">&quot;bar&quot;</span>, <span class="literal">false</span>);</span><br><span class="line"><span class="keyword">let</span> obj = <span class="title class_">Object</span>.<span class="title function_">fromEntries</span>(map);</span><br></pre></td></tr></table></figure><h3 id="更加友好的-JSON-stringify"><a href="#更加友好的-JSON-stringify" class="headerlink" title="更加友好的 JSON.stringify"></a>更加友好的 JSON.stringify</h3><p>ES10 之前，当你使用 <code>JSON.stringify()</code> 处理无法用 UTF-8 编码表示的字符时（U+D800 至 U+DFFF），返回的结果会是一个乱码 Unicode 字符“�”。该特性提出用<code>JSON.stringify()</code>来安全的表示这些不正常的UTF-8字符。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> r;</span><br><span class="line">r = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="string">&quot;❤&quot;</span>); <span class="comment">//正常的UTF-8字符原样输出</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(r); <span class="comment">//&gt;&gt; &quot;❤&quot;</span></span><br><span class="line"></span><br><span class="line">r = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="string">&#x27;\u2764&#x27;</span>); <span class="comment">//正常的UTF-8字符编码，输出解码之后的模样</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(r); <span class="comment">//&gt;&gt; &quot;❤&quot;</span></span><br><span class="line"></span><br><span class="line">r = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="string">&quot;\uDF06\uD834&quot;</span>); <span class="comment">//不正常的UTF-8字符编码，则以unicode形式输出</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(r); <span class="comment">//&gt;&gt; &quot;\udf06\ud834&quot;</span></span><br><span class="line"></span><br><span class="line">r = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="string">&quot;\uDEAD&quot;</span>); <span class="comment">//不正常的UTF-8字符编码，则以unicode形式输出</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(r); <span class="comment">//&gt;&gt; &quot;\udead&quot;</span></span><br></pre></td></tr></table></figure><h3 id="String-prototype-trimStart-trimEnd"><a href="#String-prototype-trimStart-trimEnd" class="headerlink" title="String.prototype.{trimStart,trimEnd}"></a>String.prototype.{trimStart,trimEnd}</h3><p>新增了String的<code>trimStart()</code>方法和<code>trimEnd()</code>方法，这两个方法很好理解，分别去除字符串首、尾的空白字符，就不举例占篇幅了。</p><h3 id="Array-prototype-flat-flatMap"><a href="#Array-prototype-flat-flatMap" class="headerlink" title="Array.prototype.{flat,flatMap}"></a>Array.prototype.{flat,flatMap}</h3><p>这个特性新创造了两个方法，其中：</p><ul><li><code>Array.prototype.flat</code> 数组的所有项会以指定的维度降维（扁平化），然后组成新数组返回；</li><li><code>Array.prototype.flatMap</code> 首先会执行一次<code>map()</code>方法，然后再通过类似<code>flat()</code>方法<strong>扁平化</strong>数组。它等同于执行完 <code>map()</code> 后再执行一次 <code>flat()</code> 方法，所以当你执行 <code>map()</code> 返回的结果如果是个数组，然后又要将其扁平化时，这个方法会显得方便。</li></ul><p>来看几个例子解释一下，首先 <code>flat()</code> 方法支持多维数组的扁平化，其中<code>Infinity</code>可以将多维数组压扁成一维数组。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> r;</span><br><span class="line">r = [<span class="string">&quot;1&quot;</span>, [<span class="string">&quot;8&quot;</span>, [<span class="string">&quot;9&quot;</span>, [<span class="string">&quot;1&quot;</span>]]]].<span class="title function_">flat</span>();<span class="comment">//4维数组，默认降维1，变成3维数组</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(r); <span class="comment">//&gt;&gt; [ &#x27;1&#x27;, &#x27;8&#x27;, [ &#x27;9&#x27;, [&#x27;1&#x27;] ] ]</span></span><br><span class="line"></span><br><span class="line">r = [<span class="string">&quot;1&quot;</span>, [<span class="string">&quot;8&quot;</span>, [<span class="string">&quot;9&quot;</span>, [<span class="string">&quot;1&quot;</span>]]]].<span class="title function_">flat</span>(<span class="number">2</span>); <span class="comment">//4维数组，降维2，变成2维数组</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(r); <span class="comment">//&gt;&gt; [ &#x27;1&#x27;, &#x27;8&#x27;, &#x27;9&#x27;, [&#x27;1&#x27;] ]</span></span><br><span class="line"></span><br><span class="line">r = [<span class="string">&quot;1&quot;</span>, [<span class="string">&quot;8&quot;</span>, [<span class="string">&quot;9&quot;</span>, [<span class="string">&quot;1&quot;</span>]]]].<span class="title function_">flat</span>(<span class="title class_">Infinity</span>);<span class="comment">//4维数组，最多变成1维数组</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(r); <span class="comment">//&gt;&gt; [ &#x27;1&#x27;, &#x27;8&#x27;, &#x27;9&#x27;, &#x27;1&#x27; ]</span></span><br></pre></td></tr></table></figure><p>接着来看看<code>flatMap()</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> r;</span><br><span class="line">r = [<span class="string">&quot;I love&quot;</span>, <span class="string">&quot;coffe 1891&quot;</span>].<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="title function_">split</span>(<span class="string">&quot; &quot;</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(r); <span class="comment">//&gt;&gt; [ [ &#x27;I&#x27;, &#x27;love&#x27; ], [ &#x27;coffe&#x27;, &#x27;1891&#x27; ] ]</span></span><br><span class="line"></span><br><span class="line">r = [<span class="string">&quot;I love&quot;</span>, <span class="string">&quot;coffe 1891&quot;</span>].<span class="title function_">flatMap</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="title function_">split</span>(<span class="string">&quot; &quot;</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(r); <span class="comment">//&gt;&gt;[ &#x27;I&#x27;, &#x27;love&#x27;, &#x27;coffe&#x27;, &#x27;1891&#x27; ]</span></span><br></pre></td></tr></table></figure></div><h2 id="ES-11-新特性一览"><a href="#ES-11-新特性一览" class="headerlink" title="ES 11 新特性一览"></a>ES 11 新特性一览</h2><div class="story post-story"><table><thead><tr><th align="left">新特性</th><th align="left">中文说明</th></tr></thead><tbody><tr><td align="left"><code>String.prototype.matchAll</code></td><td align="left"></td></tr><tr><td align="left"><code>import()</code></td><td align="left">import()函数</td></tr><tr><td align="left"><code>Promise.allSettled</code></td><td align="left"></td></tr></tbody></table><h3 id="String-prototype-matchAll"><a href="#String-prototype-matchAll" class="headerlink" title="String.prototype.matchAll"></a>String.prototype.matchAll</h3><p><code>matchAll()</code> 方法返回一个包含所有匹配正则表达式及分组捕获结果的迭代器（iterator）。 在 <code>matchAll</code> 出现之前，通过在循环中调用<code>Regexp.exec</code>来获取所有匹配项信息（<code>Regexp</code>需使用<code>/g</code>标志）：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> regexp = <span class="title class_">RegExp</span>(<span class="string">&#x27;foo*&#x27;</span>,<span class="string">&#x27;g&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;coffe football, foosball&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> ((matches = regexp.<span class="title function_">exec</span>(str)) !== <span class="literal">null</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`找到 <span class="subst">$&#123;matches[<span class="number">0</span>]&#125;</span>，下一轮循环从位置 <span class="subst">$&#123;regexp.lastIndex&#125;</span> 开始`</span>);</span><br><span class="line">  <span class="comment">//&gt;&gt; 找到 foo，下一轮循环从位置 9 开始</span></span><br><span class="line">  <span class="comment">//&gt;&gt; 找到 foo，下一轮循环从位置 19 开始</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果使用<code>matchAll</code> ，就可以不必使用<code>while</code>循环加<code>exec</code>方式（且正则表达式需使用<code>/g</code>标志）。使用<code>matchAll</code> 会得到一个迭代器的返回值，配合 <code>for...of</code>，<code>array spread</code>，<code>Array.from()</code> 可以更方便实现功能。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> regexp = <span class="title class_">RegExp</span>(<span class="string">&#x27;foo*&#x27;</span>,<span class="string">&#x27;g&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;coffe football, foosball&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> matches = str.<span class="title function_">matchAll</span>(regexp);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> match <span class="keyword">of</span> matches) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(match);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//&gt;&gt; [ &quot;foo&quot; ]</span></span><br><span class="line"><span class="comment">//&gt;&gt; [ &quot;foo&quot; ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//注意：</span></span><br><span class="line"><span class="comment">//matches的迭代器在for..of之后已经被消耗掉了，</span></span><br><span class="line"><span class="comment">//需要再次调用matchAll创建一个新的迭代器</span></span><br><span class="line">matches = str.<span class="title function_">matchAll</span>(regexp);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr = <span class="title class_">Array</span>.<span class="title function_">from</span>(matches, <span class="function"><span class="params">m</span> =&gt;</span> m[<span class="number">0</span>]);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr);</span><br><span class="line"><span class="comment">//&gt;&gt; [ &quot;foo&quot;, &quot;foo&quot; ]</span></span><br></pre></td></tr></table></figure><h3 id="import-函数"><a href="#import-函数" class="headerlink" title="import()函数"></a>import()函数</h3><p>这个特性为JavaScript添加了一个类函数（function-like）的<code>import()</code>功能，以便可以像函数传参那样传入参数实现<strong>动态</strong>（没错，<code>import</code>是静态引用的）引用模块（module）。下面有个单页应用简单示例，演示了用<code>import()</code>开启懒加载。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;nav&gt;</span><br><span class="line">  &lt;a href=&quot;books.html&quot; data-entry-module=&quot;books&quot;&gt;书籍&lt;/a&gt;</span><br><span class="line">  &lt;a href=&quot;movies.html&quot; data-entry-module=&quot;movies&quot;&gt;电影&lt;/a&gt;</span><br><span class="line">  &lt;a href=&quot;video-games.html&quot; data-entry-module=&quot;video-games&quot;&gt;电视游戏&lt;/a&gt;</span><br><span class="line">&lt;/nav&gt;</span><br><span class="line"></span><br><span class="line">&lt;main&gt;内容将会加载到这里！&lt;/main&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  const main = document.querySelector(&quot;main&quot;);</span><br><span class="line">  for (const link of document.querySelectorAll(&quot;nav &gt; a&quot;)) &#123;</span><br><span class="line">    link.addEventListener(&quot;click&quot;, e =&gt; &#123;</span><br><span class="line">      e.preventDefault();</span><br><span class="line"></span><br><span class="line">      import(`./section-modules/$&#123;link.dataset.entryModule&#125;.js`)//动态引用</span><br><span class="line">        .then(module =&gt; &#123;//加载模块成功以后，该模块会当作then方法的参数</span><br><span class="line">          module.loadPageInto(main);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(err =&gt; &#123;//捕捉异常</span><br><span class="line">          main.textContent = err.message;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>请注意<code>import()</code>和<code>import</code>的区别：</p><ul><li>import() 可以用在script脚本区，不止是模块内；</li><li>如果在模块内使用import()，它可以在任何地方任何级别执行，而不是被提升到顶级（优先执行）；</li><li>import() 是运行时执行，也即什么时候运行到这句，就会加载参数指定的模块；参数也可以是动态可变的，不止是静态参数；</li><li>import() 不建立可静态分析的依赖关系（静态分析的情况下可以做很多优化），但是，在一些比较简单的情况下，比如<code>import（“/foo.js”）</code>中，实现仍然可以执行静态分析优化。</li></ul><p>如果模块采用<code>default</code>的形式对外暴露接口，则可用<code>default</code>属性直接获得。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">import</span>(<span class="string">&#x27;./module.js&#x27;</span>)</span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">module</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">module</span>.<span class="property">default</span>);<span class="comment">//直接通过default属性获得模块暴露的接口</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="Promise-allSettled"><a href="#Promise-allSettled" class="headerlink" title="Promise.allSettled"></a>Promise.allSettled</h3><p>为什么要有<code>Promise.allSettled()</code>？</p><p>举例说明，比如各位用户在页面上面同时填了3个独立的表单，这三个表单分三个接口提交到后端，三个接口独立，没有顺序依赖，这个时候我们需要等到请求全部完成后给与用户提示表单提交的情况。</p><p>在多个<code>promise</code>同时进行时咱们很快会想到使用<code>Promise.all</code>来进行包装，但是由于<code>Promise.all</code>的一票否决的特性，三个提交中若前面任意一个提交失败，则后面的表单也不会进行提交了，这就与咱们需求不符合。</p><p><code>Promise.allSettled</code>跟<code>Promise.all</code>类似，其参数接受一个<code>Promise</code>的数组，返回一个新的<code>Promise</code>，唯一的不同在于，其没有一票否决的特性，也就是说当<code>Promise</code>全部处理完成后我们可以拿到每个<code>Promise</code>的状态，而不管其是否处理成功。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">allSettled</span>([<span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&quot;coffe&quot;</span>), <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&quot;1891&quot;</span>)]).<span class="title function_">then</span>(</span><br><span class="line">  <span class="function"><span class="params">arr</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(arr); <span class="comment">//&gt;&gt; [ &#123; status: &quot;fulfilled&quot;, value: &quot;coffe&quot;&#125;,</span></span><br><span class="line">                      <span class="comment">//&gt;&gt;   &#123; status: &quot;rejected&quot;, reason: &quot;1891&quot; &#125; ]</span></span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure></div><h2 id="本篇结语"><a href="#本篇结语" class="headerlink" title="本篇结语"></a>本篇结语</h2><div class="story post-story"><p>很显然ECMAScript接下来会持续不断地更新，按TC39的计划是每年都会发一个新版本。虽然节奏很快，但是我们完全没必要担心跟不上节奏。除了ES6这个史无前例的版本带来了超大量的新特性外，之后每年发的版本都仅仅带有少量的增量更新，你只需要花45分钟就能搞明白这一年更新的特性。保持一颗好奇的心，你会不断进步，变得更强！</p></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;2015年6月发布了ES 6，也就是我们今天广泛使用的版本。这之后每年6月发布一个极小更新的ES版本，比如2016年6月发布的 ES  2016 叫做ES 7，而这个版本只增加了两个新特性。截止目前，ES 11的提案已经定稿了。&lt;/p&gt;</summary>
    
    
    
    <category term="JavaScript" scheme="https://kobingogo.github.io/categories/javascript/"/>
    
    
    <category term="JavaScript" scheme="https://kobingogo.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>post</title>
    <link href="https://kobingogo.github.io/framework-virtual-dom/"/>
    <id>https://kobingogo.github.io/framework-virtual-dom/</id>
    <published>2020-05-13T09:28:22.000Z</published>
    <updated>2022-02-07T02:52:27.796Z</updated>
    
    <content type="html"><![CDATA[]]></content>
    
    
      
      
    <summary type="html">
</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>typeof 实现原理</title>
    <link href="https://kobingogo.github.io/javascript-typeof/"/>
    <id>https://kobingogo.github.io/javascript-typeof/</id>
    <published>2020-05-06T15:11:22.000Z</published>
    <updated>2022-02-07T02:52:27.799Z</updated>
    
    <content type="html"><![CDATA[<p><code>typeof</code> 一般被用于判断一个变量的类型，我们可以利用 <code>typeof</code> 来判断 <code>number</code>, <code>string</code>, <code>object</code>, <code>boolean</code>, <code>function</code>, <code>undefined</code>,<code>symbol</code> 这七种类型，这种判断能帮助我们搞定一些问题，比如在判断不是 <code>object</code> 类型的数据的时候，<code>typeof</code> 能比较清楚的告诉我们具体是哪一类的类型。但是，很遗憾的一点是，<code>typeof</code>在判断一个 <code>object</code> 的数据的时候只能告诉我们这个数据是 <code>object</code>, 而不能细致的具体到是哪一种 <code>object</code>, 比如</p><span id="more"></span><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"><span class="keyword">typeof</span> s === <span class="string">&quot;object&quot;</span>; <span class="comment">// true</span></span><br><span class="line">s <span class="keyword">instanceof</span> <span class="title class_">String</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>要想判断一个数据具体是哪一种 <code>object</code> 的时候，我们需要利用 <code>instanceof</code> 这个操作符来判断，这个我们后面会说到。</p><p>来谈谈关于 <code>typeof</code> 的原理吧，我们可以先想一个很有意思的问题，js 在底层是怎么存储数据的类型信息呢？或者说，一个 js 的变量，在它的底层实现中，它的类型信息是怎么实现的呢？</p><p>其实，js 在底层存储变量的时候，会在变量的机器码的低位 1-3 位存储其类型信息</p><ul><li>000：对象</li><li>010：浮点数</li><li>100：字符串</li><li>110：布尔</li><li>1：整数</li></ul><p>but, 对于 <code>undefined</code> 和 <code>null</code> 来说，这两个值的信息存储是有点特殊的。</p><pre><code>  `null`：所有机器码均为0  `undefined`：用 −2^30 整数来表示</code></pre><p>所以，<code>typeof</code> 在判断 null 的时候就出现问题了，由于 null 的所有机器码均为 0，因此直接被当做了对象来看待。</p><p>然而用 <code>instanceof</code> 来判断的话</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">null</span> <span class="keyword">instanceof</span> <span class="literal">null</span>; <span class="comment">// TypeError: Right-hand side of &#x27;instanceof&#x27; is not an object</span></span><br></pre></td></tr></table></figure><p><code>null</code> 直接被判断为不是 <code>object</code>，这也是 <code>JavaScript</code> 的历史遗留 bug，可以参考 <code>typeof</code>.</p><p>因此在用 <code>typeof</code> 来判断变量类型的时候，我们需要注意，最好是用 <code>typeof</code> 来判断基本数据类型（包括 symbol），避免对 <code>null</code> 的判断。</p><p>还有一个不错的判断类型的方法，就是 <code>Object.prototype.toString</code>，我们可以利用这个方法来对一个变量的类型来进行比较准确的判断</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="number">1</span>); <span class="comment">// &quot;[object Number]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="string">&quot;hi&quot;</span>); <span class="comment">// &quot;[object String]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(&#123; <span class="attr">a</span>: <span class="string">&quot;hi&quot;</span> &#125;); <span class="comment">// &quot;[object Object]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>([<span class="number">1</span>, <span class="string">&quot;a&quot;</span>]); <span class="comment">// &quot;[object Array]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="literal">true</span>); <span class="comment">// &quot;[object Boolean]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="function">() =&gt;</span> &#123;&#125;); <span class="comment">// &quot;[object Function]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="literal">null</span>); <span class="comment">// &quot;[object Null]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="literal">undefined</span>); <span class="comment">// &quot;[object Undefined]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="title class_">Symbol</span>(<span class="number">1</span>)); <span class="comment">// &quot;[object Symbol]&quot;</span></span><br></pre></td></tr></table></figure><h3 id="instanceof-操作符的实现原理"><a href="#instanceof-操作符的实现原理" class="headerlink" title="instanceof 操作符的实现原理"></a>instanceof 操作符的实现原理</h3><p>之前我们提到了 instanceof 来判断对象的具体类型，其实 instanceof 主要的作用就是判断一个实例是否属于某种类型</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> nicole = <span class="keyword">new</span> <span class="title function_">person</span>();</span><br><span class="line">nicole <span class="keyword">instanceof</span> person; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>当然，instanceof 也可以判断一个实例是否是其父类型或者祖先类型的实例。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> programmer = <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;;</span><br><span class="line">programmer.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title function_">person</span>();</span><br><span class="line"><span class="keyword">let</span> nicole = <span class="keyword">new</span> <span class="title function_">programmer</span>();</span><br><span class="line">nicole <span class="keyword">instanceof</span> person; <span class="comment">// true</span></span><br><span class="line">nicole <span class="keyword">instanceof</span> programmer; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>instanceof 实现原理：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">new_instance_of</span>(<span class="params">leftVaule, rightVaule</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> rightProto = rightVaule.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// 取右表达式的 prototype 值</span></span><br><span class="line">  leftVaule = leftVaule.<span class="property">__proto__</span>; <span class="comment">// 取左表达式的__proto__值</span></span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (leftVaule === <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (leftVaule === rightProto) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    leftVaule = leftVaule.<span class="property">__proto__</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>简单来说，我们使用 <code>typeof</code> 来判断基本数据类型是 ok 的，不过需要注意当用 <code>typeof</code> 来判断 null 类型时的问题，如果想要判断一个对象的具体类型可以考虑用 <code>instanceof</code>，但是 <code>instanceof</code> 也可能判断不准确，比如一个数组，他可以被 <code>instanceof</code> 判断为 Object。所以我们要想比较准确的判断对象实例的类型时，可以采取 <code>Object.prototype.toString.call</code> 方法。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;code&gt;typeof&lt;/code&gt; 一般被用于判断一个变量的类型，我们可以利用 &lt;code&gt;typeof&lt;/code&gt; 来判断 &lt;code&gt;number&lt;/code&gt;, &lt;code&gt;string&lt;/code&gt;, &lt;code&gt;object&lt;/code&gt;, &lt;code&gt;boolean&lt;/code&gt;, &lt;code&gt;function&lt;/code&gt;, &lt;code&gt;undefined&lt;/code&gt;,&lt;code&gt;symbol&lt;/code&gt; 这七种类型，这种判断能帮助我们搞定一些问题，比如在判断不是 &lt;code&gt;object&lt;/code&gt; 类型的数据的时候，&lt;code&gt;typeof&lt;/code&gt; 能比较清楚的告诉我们具体是哪一类的类型。但是，很遗憾的一点是，&lt;code&gt;typeof&lt;/code&gt;在判断一个 &lt;code&gt;object&lt;/code&gt; 的数据的时候只能告诉我们这个数据是 &lt;code&gt;object&lt;/code&gt;, 而不能细致的具体到是哪一种 &lt;code&gt;object&lt;/code&gt;, 比如&lt;/p&gt;</summary>
    
    
    
    <category term="JavaScript" scheme="https://kobingogo.github.io/categories/javascript/"/>
    
    
    <category term="JavaScript" scheme="https://kobingogo.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>一些 JS 关键技术的底层实现汇总</title>
    <link href="https://kobingogo.github.io/javascript-js-basic-implementation/"/>
    <id>https://kobingogo.github.io/javascript-js-basic-implementation/</id>
    <published>2020-05-06T14:40:35.000Z</published>
    <updated>2022-02-07T02:52:27.799Z</updated>
    
    <content type="html"><![CDATA[<p>在这里汇总一些 JS 常用技术的源码实现，通过源码了解其内部原理，可以加深对其的理解。</p><span id="more"></span><ul><li><a href="#functionprototypecall">Function.prototype.call()</a></li><li><a href="#functionprototypeapply">Function.prototype.apply()</a></li><li><a href="#functionprototypebind">Function.prototype.bind()</a></li><li><a href="#new-%E7%9A%84%E5%8E%9F%E7%90%86">new 的原理</a></li><li><a href="#reduce-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86">reduce 实现原理</a></li><li><a href="#%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A">双向绑定</a></li><li><a href="#%E7%BB%A7%E6%89%BF">继承</a></li><li><a href="#objectcreate">Object.create</a></li><li><a href="#instanceof-%E5%AE%9E%E7%8E%B0">instanceof 实现</a></li><li><a href="#arrayisarray-%E5%AE%9E%E7%8E%B0">Array.isArray 实现</a></li><li><a href="#getownpropertynames-%E5%AE%9E%E7%8E%B0">getOwnPropertyNames 实现</a></li><li><a href="#promise-%E5%AE%9E%E7%8E%B0">Promise 实现</a></li><li><a href="#%E9%98%B2%E6%8A%96%E8%8A%82%E6%B5%81">防抖/节流</a></li><li><a href="#%E5%87%BD%E6%95%B0%E6%9F%AF%E9%87%8C%E5%8C%96%E5%AE%9E%E7%8E%B0">函数柯里化实现</a></li><li><a href="#%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E6%B7%B1%E6%8B%B7%E8%B4%9D">实现简单深拷贝</a></li></ul><!-- # 一些 JS 关键技术的底层实现汇总 --><h2 id="Function-prototype-call"><a href="#Function-prototype-call" class="headerlink" title="Function.prototype.call()"></a>Function.prototype.call()</h2><div class="story post-story"><p><code>call()</code> 方法调用一个函数, 其具有一个指定的 this 值和分别地提供的参数。</p><p>语法：<code>fun.call(thisArg, arg1, arg2, ...)</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * call的实现原理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> getGlobal = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> self !== <span class="string">&quot;undefined&quot;</span>) <span class="keyword">return</span> self;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">window</span> !== <span class="string">&quot;undefined&quot;</span>) <span class="keyword">return</span> <span class="variable language_">window</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">global</span> !== <span class="string">&quot;undefined&quot;</span>) <span class="keyword">return</span> <span class="variable language_">global</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">mcall</span> = <span class="keyword">function</span> (<span class="params">context</span>) &#123;</span><br><span class="line">  context = context ? <span class="title class_">Object</span>(context) : <span class="title function_">getGlobal</span>();</span><br><span class="line">  <span class="keyword">const</span> fn = <span class="title class_">Symbol</span>(<span class="string">&quot;anything&quot;</span>); <span class="comment">//创建一个不重复的常量</span></span><br><span class="line">  context[fn] = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="keyword">let</span> args = [...<span class="variable language_">arguments</span>].<span class="title function_">slice</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> r = context[fn](...args);</span><br><span class="line">  <span class="keyword">delete</span> context[fn];</span><br><span class="line">  <span class="keyword">return</span> r;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一个用call实现继承的例子</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; <span class="variable">name</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; <span class="variable">price</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Product</span>(<span class="params">name, price</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">price</span> = price;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Fruit</span>(<span class="params">name, price</span>) &#123;</span><br><span class="line">  <span class="title class_">Product</span>.<span class="title function_">mcall</span>(<span class="variable language_">this</span>, name, price);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">category</span> = <span class="string">&quot;fruit&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> apple = <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">&quot;apple&quot;</span>, <span class="number">5</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(apple);</span><br></pre></td></tr></table></figure></div><h2 id="Function-prototype-apply"><a href="#Function-prototype-apply" class="headerlink" title="Function.prototype.apply()"></a>Function.prototype.apply()</h2><div class="story post-story"><p><code>apply()</code>调用一个指定 this 值的函数, 接收作为一个数组或者类数组对象提供的参数.</p><p>语法： <code>func.apply(thisArg, [argsArray])</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getGlobal = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> self !== <span class="string">&quot;undefined&quot;</span>) <span class="keyword">return</span> self;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">window</span> !== <span class="string">&quot;undefined&quot;</span>) <span class="keyword">return</span> <span class="variable language_">window</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">global</span> !== <span class="string">&quot;undefined&quot;</span>) <span class="keyword">return</span> <span class="variable language_">global</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * apply原理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">apply</span> = <span class="keyword">function</span> (<span class="params">context, arr</span>) &#123;</span><br><span class="line">  context = context ? <span class="title class_">Object</span>(context) : <span class="title function_">getGlobal</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;context&quot;</span>, context);</span><br><span class="line">  <span class="keyword">const</span> fn = <span class="title class_">Symbol</span>(<span class="string">&quot;anything&quot;</span>); <span class="comment">//创建一个不重复的常量</span></span><br><span class="line">  context[fn] = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="comment">// let args = [...arguments][1];</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!arr) &#123;</span><br><span class="line">    <span class="keyword">let</span> r = context[fn]();</span><br><span class="line">    <span class="keyword">delete</span> context[fn];</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> r = context[fn](...arr);</span><br><span class="line">  <span class="keyword">delete</span> context[fn];</span><br><span class="line">  <span class="keyword">return</span> r;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//使用例子</span></span><br><span class="line"><span class="keyword">var</span> array = [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>];</span><br><span class="line"><span class="keyword">var</span> elements = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">array.<span class="property">push</span>.<span class="title function_">apply</span>(array, elements);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;array&quot;</span>, array); <span class="comment">// [&quot;a&quot;, &quot;b&quot;, 0, 1, 2]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">A</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">b</span> + <span class="string">&quot; &quot;</span> + x + <span class="string">&quot; &quot;</span> + y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> B = &#123; <span class="attr">b</span>: <span class="number">1</span> &#125;;</span><br><span class="line">A.<span class="title function_">apply</span>(B, [<span class="number">2</span>, <span class="number">3</span>]);</span><br></pre></td></tr></table></figure></div><h2 id="Function-prototype-bind"><a href="#Function-prototype-bind" class="headerlink" title="Function.prototype.bind()"></a>Function.prototype.bind()</h2><div class="story post-story"><p><code>bind()</code>方法创建一个新函数, 在调用时设置 this 关键字为提供的值。</p><p>语法：<code>fun.bind(thisArg, arg1, arg2, ...)</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getGlobal = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> self !== <span class="string">&quot;undefined&quot;</span>) <span class="keyword">return</span> self;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">window</span> !== <span class="string">&quot;undefined&quot;</span>) <span class="keyword">return</span> <span class="variable language_">window</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">global</span> !== <span class="string">&quot;undefined&quot;</span>) <span class="keyword">return</span> <span class="variable language_">global</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * bind实现原理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">bind</span> = <span class="keyword">function</span> (<span class="params">context</span>) &#123;</span><br><span class="line">  context = context ? <span class="title class_">Object</span>(context) : <span class="title function_">getGlobal</span>();</span><br><span class="line">  <span class="keyword">const</span> me = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="keyword">const</span> args = [...<span class="variable language_">arguments</span>].<span class="title function_">slice</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    me.<span class="title function_">apply</span>(context, [...args, ...<span class="variable language_">arguments</span>]);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">A</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">b</span> + <span class="string">&quot;, &quot;</span> + x + <span class="string">&quot;, &quot;</span> + y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> B = &#123; <span class="attr">b</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> fnc = A.<span class="title function_">bind</span>(B, <span class="number">2</span>); <span class="comment">//1 2 3</span></span><br><span class="line"><span class="title function_">fnc</span>(<span class="number">3</span>);</span><br></pre></td></tr></table></figure></div><h2 id="new-的原理"><a href="#new-的原理" class="headerlink" title="new 的原理"></a>new 的原理</h2><div class="story post-story"><p>在了解 new 原理之前先看看 js 的内部机制图</p><p><img src="https://user-gold-cdn.xitu.io/2019/3/14/1697cc831ea2af8e?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" class="lazyload" data-srcset="https://user-gold-cdn.xitu.io/2019/3/14/1697cc831ea2af8e?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="js内部机制"></p><pre><code>我们需要知道当 new 的时候做了什么事情</code></pre><ol><li>创建一个新对象；</li><li>将构造函数的作用域赋给新对象（因此 this 就指向了这个新对象）</li><li>执行构造函数中的代码（为这个新对象添加属性）</li><li>返回新对象。</li></ol><p>new 没法重写，这里是有 mockNew 函数来模拟</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * new实现原理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mockNew</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">//创建一个实例</span></span><br><span class="line">  <span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line">  <span class="comment">//获得构造器</span></span><br><span class="line">  <span class="keyword">const</span> constructor = [].<span class="property">shift</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>);</span><br><span class="line">  <span class="comment">//实现继承，实例可以访问构造器熟悉</span></span><br><span class="line">  obj.<span class="property">__proto__</span> = constructor.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">  <span class="comment">//调用构造器，改变this指向为实例</span></span><br><span class="line">  <span class="keyword">const</span> res = constructor.<span class="title function_">apply</span>(obj, <span class="variable language_">arguments</span>);</span><br><span class="line">  <span class="comment">//如果构造器函数返回值为对象，则返回这个对象，否则返回新的实例对象</span></span><br><span class="line">  <span class="keyword">return</span> res <span class="keyword">instanceof</span> <span class="title class_">Object</span> ? res : obj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用例子</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; <span class="variable">color</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; <span class="variable">name</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Car</span>(<span class="params">color, name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">color</span> = color;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: name,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> car = <span class="title function_">mockNew</span>(<span class="title class_">Car</span>, <span class="string">&quot;black&quot;</span>, <span class="string">&quot;BMW&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(car.<span class="property">color</span>);</span><br><span class="line"><span class="comment">// undefined</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(car.<span class="property">name</span>);</span><br><span class="line"><span class="comment">// &quot;BMW&quot;</span></span><br></pre></td></tr></table></figure></div><h2 id="reduce-实现原理"><a href="#reduce-实现原理" class="headerlink" title="reduce 实现原理"></a>reduce 实现原理</h2><div class="story post-story"><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现原理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">mockReduce</span> = <span class="keyword">function</span> (<span class="params">callback</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> length = <span class="variable language_">this</span>.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">let</span> reducer = <span class="literal">undefined</span>, <span class="comment">//累加器，最终返回这个值</span></span><br><span class="line">    k = <span class="number">0</span>, <span class="comment">//数组下标</span></span><br><span class="line">    initVal = [...<span class="variable language_">arguments</span>].<span class="property">length</span> &gt; <span class="number">1</span> ? [...<span class="variable language_">arguments</span>][<span class="number">1</span>] : <span class="literal">undefined</span>; <span class="comment">//传入reduce的初始值</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> callback !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(callback + <span class="string">&quot; is not a function&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (length === <span class="number">0</span> &amp;&amp; !initVal) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Reduce of empty array with no initial value&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (initVal) &#123;</span><br><span class="line">    reducer = initVal;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    reducer = <span class="variable language_">this</span>[<span class="number">0</span>];</span><br><span class="line">    k++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> (k &lt; length) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">hasOwnProperty</span>(k)) &#123;</span><br><span class="line">      <span class="keyword">const</span> kValue = <span class="variable language_">this</span>[k];</span><br><span class="line">      reducer = <span class="title function_">callback</span>(reducer, kValue);</span><br><span class="line">    &#125;</span><br><span class="line">    k++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> reducer;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rReduce = [].<span class="title function_">reduce</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">const</span> mReduce = [].<span class="title function_">mockReduce</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(rReduce, mReduce);</span><br></pre></td></tr></table></figure></div><h2 id="双向绑定"><a href="#双向绑定" class="headerlink" title="双向绑定"></a>双向绑定</h2><div class="story post-story"><p><code>defineProperty</code>实现</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据</span></span><br><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">  <span class="attr">text</span>: <span class="string">&quot;hello&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;input&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> p = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;p&quot;</span>);</span><br><span class="line"><span class="comment">// 数据劫持</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(data, <span class="string">&quot;text&quot;</span>, &#123;</span><br><span class="line">  <span class="comment">// 数据变化 --&gt; 修改视图</span></span><br><span class="line">  <span class="title function_">set</span>(<span class="params">newVal</span>) &#123;</span><br><span class="line">    input.<span class="property">value</span> = newVal;</span><br><span class="line">    p.<span class="property">innerHTML</span> = newVal;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 视图更改 --&gt; 数据变化</span></span><br><span class="line">input.<span class="title function_">addEventListener</span>(<span class="string">&quot;keyup&quot;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">  data.<span class="property">text</span> = e.<span class="property">target</span>.<span class="property">value</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>proxy</code>实现</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据</span></span><br><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">  <span class="attr">text</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;input&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> p = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;p&quot;</span>);</span><br><span class="line"><span class="comment">// 数据劫持</span></span><br><span class="line"><span class="keyword">const</span> handler = &#123;</span><br><span class="line">  <span class="title function_">set</span>(<span class="params">target, key, value</span>) &#123;</span><br><span class="line">    target[key] = value;</span><br><span class="line">    <span class="comment">// 数据变化 --&gt; 修改视图</span></span><br><span class="line">    input.<span class="property">value</span> = value;</span><br><span class="line">    p.<span class="property">innerHTML</span> = value;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(data, handler);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 视图更改 --&gt; 数据变化</span></span><br><span class="line">input.<span class="title function_">addEventListener</span>(<span class="string">&quot;keyup&quot;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">  proxy.<span class="property">text</span> = e.<span class="property">target</span>.<span class="property">value</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div><h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><div class="story post-story"><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">inheritPrototype</span>(<span class="params">subType, superType</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> protoType = <span class="title class_">Object</span>.<span class="title function_">create</span>(superType.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">//创建对象</span></span><br><span class="line">  protoType.<span class="property">constructor</span> = subType; <span class="comment">//增强对象</span></span><br><span class="line">  subType.<span class="property"><span class="keyword">prototype</span></span> = protoType; <span class="comment">//指定对象</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SuperType</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">colors</span> = [<span class="string">&quot;red&quot;</span>, <span class="string">&quot;blue&quot;</span>, <span class="string">&quot;green&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">SuperType</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SubType</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">  <span class="title class_">SuperType</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">inheritPrototype</span>(<span class="title class_">SubType</span>, <span class="title class_">SuperType</span>);</span><br><span class="line"><span class="title class_">SubType</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayAge</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">age</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> instance = <span class="keyword">new</span> <span class="title class_">SubType</span>(<span class="string">&quot;Bob&quot;</span>, <span class="number">18</span>);</span><br><span class="line">instance.<span class="title function_">sayName</span>();</span><br><span class="line">instance.<span class="title function_">sayAge</span>();</span><br></pre></td></tr></table></figure></div><h2 id="Object-create"><a href="#Object-create" class="headerlink" title="Object.create"></a>Object.create</h2><div class="story post-story"><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="title class_">Object</span>.<span class="property">create</span> !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="property">create</span> = <span class="keyword">function</span> (<span class="params">prototype, properties</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> prototype !== <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="title class_">TypeError</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">Ctor</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">    <span class="title class_">Ctor</span>.<span class="property"><span class="keyword">prototype</span></span> = prototype;</span><br><span class="line">    <span class="keyword">var</span> o = <span class="keyword">new</span> <span class="title class_">Ctor</span>();</span><br><span class="line">    <span class="keyword">if</span> (prototype) &#123;</span><br><span class="line">      o.<span class="property">constructor</span> = <span class="title class_">Ctor</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (properties !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (properties !== <span class="title class_">Object</span>(properties)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="title class_">TypeError</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title class_">Object</span>.<span class="title function_">defineProperties</span>(o, properties);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> o;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="instanceof-实现"><a href="#instanceof-实现" class="headerlink" title="instanceof 实现"></a>instanceof 实现</h2><div class="story post-story"><p>原理： L 的 __proto__ 是不是等于 R.prototype，不等于再找 L.__proto__.__proto__ 直到 __proto__ 为 null</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// L 表示左表达式，R 表示右表达式</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">instance_of</span>(<span class="params">L, R</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> O = R.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">  L = L.<span class="property">__proto__</span>;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (L === <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// 这里重点：当 O 严格等于 L 时，返回 true</span></span><br><span class="line">    <span class="keyword">if</span> (O === L) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    L = L.<span class="property">__proto__</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="Array-isArray-实现"><a href="#Array-isArray-实现" class="headerlink" title="Array.isArray 实现"></a>Array.isArray 实现</h2><div class="story post-story"><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="property">myIsArray</span> = <span class="keyword">function</span> (<span class="params">o</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="title class_">Object</span>(o)) === <span class="string">&quot;[object Array]&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Array</span>.<span class="title function_">myIsArray</span>([])); <span class="comment">// true</span></span><br></pre></td></tr></table></figure></div><h2 id="getOwnPropertyNames-实现"><a href="#getOwnPropertyNames-实现" class="headerlink" title="getOwnPropertyNames 实现"></a>getOwnPropertyNames 实现</h2><div class="story post-story"><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="title class_">Object</span>.<span class="property">getOwnPropertyNames</span> !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="property">getOwnPropertyNames</span> = <span class="keyword">function</span> (<span class="params">o</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (o !== <span class="title class_">Object</span>(o)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Object.getOwnPropertyNames called on non-object&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> props = [],</span><br><span class="line">      p;</span><br><span class="line">    <span class="keyword">for</span> (p <span class="keyword">in</span> o) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hasOwnProperty</span>.<span class="title function_">call</span>(o, p)) &#123;</span><br><span class="line">        props.<span class="title function_">push</span>(p);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> props;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="Promise-实现"><a href="#Promise-实现" class="headerlink" title="Promise 实现"></a>Promise 实现</h2><div class="story post-story"><p>实现原理：其实就是一个发布订阅者模式</p><ol><li>构造函数接收一个 executor 函数，并会在 new Promise() 时立即执行该函数</li><li>then 时收集依赖，将回调函数收集到 成功/失败队列</li><li>executor 函数中调用 resolve/reject 函数</li><li>resolve/reject 函数被调用时会通知触发队列中的回调</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">isFunction</span> = variable =&gt; <span class="keyword">typeof</span> variable === <span class="string">&#x27;function&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义Promise的三种状态常量</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PENDING</span> = <span class="string">&#x27;pending&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">FULFILLED</span> = <span class="string">&#x27;fulfilled&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">REJECTED</span> = <span class="string">&#x27;rejected&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPromise</span> &#123;</span><br><span class="line">  <span class="comment">// 构造函数，new 时触发</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">handle: <span class="built_in">Function</span></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="title function_">handle</span>(<span class="variable language_">this</span>.<span class="property">_resolve</span>, <span class="variable language_">this</span>.<span class="property">_reject</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">_reject</span>(err);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 状态 pending fulfilled rejected</span></span><br><span class="line">  private <span class="attr">_status</span>: string = <span class="variable constant_">PENDING</span>;</span><br><span class="line">  <span class="comment">// 储存 value，用于 then 返回</span></span><br><span class="line">  private <span class="attr">_value</span>: string | <span class="literal">undefined</span> = <span class="literal">undefined</span>;</span><br><span class="line">  <span class="comment">// 失败队列，在 then 时注入，resolve 时触发</span></span><br><span class="line">  private <span class="attr">_rejectedQueues</span>: any = [];</span><br><span class="line">  <span class="comment">// 成功队列，在 then 时注入，resolve 时触发</span></span><br><span class="line">  private <span class="attr">_fulfilledQueues</span>: any = [];</span><br><span class="line">  <span class="comment">// resovle 时执行的函数</span></span><br><span class="line">  private _resolve = <span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">run</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_status</span> !== <span class="variable constant_">PENDING</span>) <span class="keyword">return</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_status</span> = <span class="variable constant_">FULFILLED</span>;</span><br><span class="line">      <span class="comment">// 依次执行成功队列中的函数，并清空队列</span></span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">runFulfilled</span> = value =&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> cb;</span><br><span class="line">        <span class="keyword">while</span> ((cb = <span class="variable language_">this</span>.<span class="property">_fulfilledQueues</span>.<span class="title function_">shift</span>())) &#123;</span><br><span class="line">          <span class="title function_">cb</span>(value);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="comment">// 依次执行失败队列中的函数，并清空队列</span></span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">runRejected</span> = error =&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> cb;</span><br><span class="line">        <span class="keyword">while</span> ((cb = <span class="variable language_">this</span>.<span class="property">_rejectedQueues</span>.<span class="title function_">shift</span>())) &#123;</span><br><span class="line">          <span class="title function_">cb</span>(error);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">       * 如果resolve的参数为Promise对象，</span></span><br><span class="line"><span class="comment">       * 则必须等待该Promise对象状态改变后当前Promsie的状态才会改变</span></span><br><span class="line"><span class="comment">       * 且状态取决于参数Promsie对象的状态</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">if</span> (val <span class="keyword">instanceof</span> <span class="title class_">MyPromise</span>) &#123;</span><br><span class="line">        val.<span class="title function_">then</span>(</span><br><span class="line">          <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_value</span> = value;</span><br><span class="line">            <span class="title function_">runFulfilled</span>(value);</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">_value</span> = err;</span><br><span class="line">            <span class="title function_">runRejected</span>(err);</span><br><span class="line">          &#125;</span><br><span class="line">        );</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_value</span> = val;</span><br><span class="line">        <span class="title function_">runFulfilled</span>(val);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 异步调用</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(run);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// reject 时执行的函数</span></span><br><span class="line">  private _reject = <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">_status</span> !== <span class="variable constant_">PENDING</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// 依次执行失败队列中的函数，并清空队列</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">run</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_status</span> = <span class="variable constant_">REJECTED</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_value</span> = err;</span><br><span class="line">      <span class="keyword">let</span> cb;</span><br><span class="line">      <span class="keyword">while</span> ((cb = <span class="variable language_">this</span>.<span class="property">_rejectedQueues</span>.<span class="title function_">shift</span>())) &#123;</span><br><span class="line">        <span class="title function_">cb</span>(err);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 为了支持同步的Promise，这里采用异步调用</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(run);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// then 方法</span></span><br><span class="line">  <span class="title function_">then</span>(<span class="params">onFulfilled?, onRejected?</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; _value, _status &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="comment">// 返回一个新的Promise对象</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">onFulfilledNext, onRejectedNext</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 封装一个成功时执行的函数</span></span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">fulfilled</span> = value =&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (!<span class="title function_">isFunction</span>(onFulfilled)) &#123;</span><br><span class="line">            <span class="title function_">onFulfilledNext</span>(value);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> res = <span class="title function_">onFulfilled</span>(value);</span><br><span class="line">            <span class="keyword">if</span> (res <span class="keyword">instanceof</span> <span class="title class_">MyPromise</span>) &#123;</span><br><span class="line">              <span class="comment">// 如果当前回调函数返回MyPromise对象，必须等待其状态改变后在执行下一个回调</span></span><br><span class="line">              res.<span class="title function_">then</span>(onFulfilledNext, onRejectedNext);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">//否则会将返回结果直接作为参数，传入下一个then的回调函数，并立即执行下一个then的回调函数</span></span><br><span class="line">              <span class="title function_">onFulfilledNext</span>(res);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">          <span class="comment">// 如果函数执行出错，新的Promise对象的状态为失败</span></span><br><span class="line">          <span class="title function_">onRejectedNext</span>(err);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 封装一个失败时执行的函数</span></span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">rejected</span> = error =&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (!<span class="title function_">isFunction</span>(onRejected)) &#123;</span><br><span class="line">            <span class="title function_">onRejectedNext</span>(error);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> res = <span class="title function_">onRejected</span>(error);</span><br><span class="line">            <span class="keyword">if</span> (res <span class="keyword">instanceof</span> <span class="title class_">MyPromise</span>) &#123;</span><br><span class="line">              <span class="comment">// 如果当前回调函数返回MyPromise对象，必须等待其状态改变后在执行下一个回调</span></span><br><span class="line">              res.<span class="title function_">then</span>(onFulfilledNext, onRejectedNext);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">//否则会将返回结果直接作为参数，传入下一个then的回调函数，并立即执行下一个then的回调函数</span></span><br><span class="line">              <span class="title function_">onFulfilledNext</span>(res);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">          <span class="comment">// 如果函数执行出错，新的Promise对象的状态为失败</span></span><br><span class="line">          <span class="title function_">onRejectedNext</span>(err);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">switch</span> (_status) &#123;</span><br><span class="line">        <span class="comment">// 当状态为pending时，将then方法回调函数加入执行队列等待执行</span></span><br><span class="line">        <span class="keyword">case</span> <span class="attr">PENDING</span>:</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">_fulfilledQueues</span>.<span class="title function_">push</span>(fulfilled);</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">_rejectedQueues</span>.<span class="title function_">push</span>(rejected);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="comment">// 当状态已经改变时，立即执行对应的回调函数</span></span><br><span class="line">        <span class="keyword">case</span> <span class="attr">FULFILLED</span>:</span><br><span class="line">          <span class="title function_">fulfilled</span>(_value);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="attr">REJECTED</span>:</span><br><span class="line">          <span class="title function_">rejected</span>(_value);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// catch 方法</span></span><br><span class="line">  <span class="keyword">catch</span>(onRejected) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(<span class="literal">undefined</span>, onRejected);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// finally 方法</span></span><br><span class="line">  <span class="title function_">finally</span>(<span class="params">cb</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(</span><br><span class="line">      <span class="function"><span class="params">value</span> =&gt;</span> <span class="title class_">MyPromise</span>.<span class="title function_">resolve</span>(<span class="title function_">cb</span>()).<span class="title function_">then</span>(<span class="function">() =&gt;</span> value),</span><br><span class="line">      <span class="function"><span class="params">reason</span> =&gt;</span></span><br><span class="line">        <span class="title class_">MyPromise</span>.<span class="title function_">resolve</span>(<span class="title function_">cb</span>()).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">throw</span> reason;</span><br><span class="line">        &#125;)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 静态 resolve 方法</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">resolve</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="comment">// 如果参数是MyPromise实例，直接返回这个实例</span></span><br><span class="line">    <span class="keyword">if</span> (value <span class="keyword">instanceof</span> <span class="title class_">MyPromise</span>) <span class="keyword">return</span> value;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="title function_">resolve</span>(value));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 静态 reject 方法</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">reject</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> <span class="title function_">reject</span>(value));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 静态 all 方法</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">all</span>(<span class="params">list</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 返回值的集合</span></span><br><span class="line">      <span class="keyword">let</span> values = [];</span><br><span class="line">      <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> [i, p] <span class="keyword">of</span> list.<span class="title function_">entries</span>()) &#123;</span><br><span class="line">        <span class="comment">// 数组参数如果不是MyPromise实例，先调用MyPromise.resolve</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">resolve</span>(p).<span class="title function_">then</span>(</span><br><span class="line">          <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            values[i] = res;</span><br><span class="line">            count++;</span><br><span class="line">            <span class="comment">// 所有状态都变成fulfilled时返回的MyPromise状态就变成fulfilled</span></span><br><span class="line">            <span class="keyword">if</span> (count === list.<span class="property">length</span>) <span class="title function_">resolve</span>(values);</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 有一个被rejected时返回的MyPromise状态就变成rejected</span></span><br><span class="line">            <span class="title function_">reject</span>(err);</span><br><span class="line">          &#125;</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 添加静态race方法</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">race</span>(<span class="params">list</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> p <span class="keyword">of</span> list) &#123;</span><br><span class="line">        <span class="comment">// 只要有一个实例率先改变状态，新的MyPromise的状态就跟着改变</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">resolve</span>(p).<span class="title function_">then</span>(</span><br><span class="line">          <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(res);</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">reject</span>(err);</span><br><span class="line">          &#125;</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h2 id="防抖-节流"><a href="#防抖-节流" class="headerlink" title="防抖/节流"></a>防抖/节流</h2><div class="story post-story"><pre><code>防抖函数 onscroll 结束时触发一次，延迟执行</code></pre><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">callback, wait</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timeout;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> context = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">let</span> args = <span class="variable language_">arguments</span>;</span><br><span class="line">    <span class="keyword">if</span> (timeout) <span class="built_in">clearTimeout</span>(timeout);</span><br><span class="line">    timeout = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      callback.<span class="title function_">apply</span>(context, args);</span><br><span class="line">    &#125;, wait);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">onscroll</span> = <span class="title function_">debounce</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;debounce&quot;</span>);</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><pre><code>节流函数 onscroll 时，每隔一段时间触发一次，像水滴一样</code></pre><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">callback, delay</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> prevTime = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> curTime = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">    <span class="keyword">if</span> (curTime - prevTime &gt; delay) &#123;</span><br><span class="line">      callback.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">      prevTime = curTime;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">onscroll</span> = <span class="title function_">throttle</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;throtte&quot;</span>);</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure></div><h2 id="函数柯里化实现"><a href="#函数柯里化实现" class="headerlink" title="函数柯里化实现"></a>函数柯里化实现</h2><div class="story post-story"><pre><code>其实我们无时无刻不在使用柯里化函数，只是没有将它总结出来而已。它的本质就是将一个参数很多的函数分解成单一参数的多个函数。</code></pre><p>应用场景：</p><ul><li>延迟计算 （用闭包把传入参数保存起来，当传入参数的数量足够执行函数时，开始执行函数）</li><li>动态创建函数 （参数不够时会返回接受剩下参数的函数）</li><li>参数复用（每个参数可以多次复用）</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">curry</span> = (<span class="params">fn</span>) =&gt;</span><br><span class="line">  (judge = <span class="function">(<span class="params">...args</span>) =&gt;</span></span><br><span class="line">    args.<span class="property">length</span> &gt;= fn.<span class="property">length</span></span><br><span class="line">      ? <span class="title function_">fn</span>(...args)</span><br><span class="line">      : <span class="function">(<span class="params">...arg</span>) =&gt;</span> <span class="title function_">judge</span>(...args, ...arg));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">sum</span> = (<span class="params">a, b, c, d</span>) =&gt; a + b + c + d;</span><br><span class="line"><span class="keyword">const</span> currySum = <span class="title function_">curry</span>(sum);</span><br><span class="line"></span><br><span class="line"><span class="title function_">currySum</span>(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>)(<span class="number">4</span>); <span class="comment">// 10</span></span><br><span class="line"><span class="title function_">currySum</span>(<span class="number">1</span>, <span class="number">2</span>)(<span class="number">3</span>)(<span class="number">4</span>); <span class="comment">// 10</span></span><br><span class="line"><span class="title function_">currySum</span>(<span class="number">1</span>)(<span class="number">2</span>, <span class="number">3</span>)(<span class="number">4</span>); <span class="comment">// 10</span></span><br></pre></td></tr></table></figure></div><h2 id="实现简单深拷贝"><a href="#实现简单深拷贝" class="headerlink" title="实现简单深拷贝"></a>实现简单深拷贝</h2><div class="story post-story"><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getType</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> str = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(obj);</span><br><span class="line">  <span class="keyword">const</span> map = &#123;</span><br><span class="line">    <span class="string">&quot;[object Boolean]&quot;</span>: <span class="string">&quot;boolean&quot;</span>,</span><br><span class="line">    <span class="string">&quot;[object Number]&quot;</span>: <span class="string">&quot;number&quot;</span>,</span><br><span class="line">    <span class="string">&quot;[object String]&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">    <span class="string">&quot;[object Function]&quot;</span>: <span class="string">&quot;function&quot;</span>,</span><br><span class="line">    <span class="string">&quot;[object Array]&quot;</span>: <span class="string">&quot;array&quot;</span>,</span><br><span class="line">    <span class="string">&quot;[object Date]&quot;</span>: <span class="string">&quot;date&quot;</span>,</span><br><span class="line">    <span class="string">&quot;[object RegExp]&quot;</span>: <span class="string">&quot;regExp&quot;</span>,</span><br><span class="line">    <span class="string">&quot;[object Undefined]&quot;</span>: <span class="string">&quot;undefined&quot;</span>,</span><br><span class="line">    <span class="string">&quot;[object Null]&quot;</span>: <span class="string">&quot;null&quot;</span>,</span><br><span class="line">    <span class="string">&quot;[object Object]&quot;</span>: <span class="string">&quot;object&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> <span class="title class_">Element</span>) &#123;</span><br><span class="line">    <span class="comment">// 判断是否是dom元素，如div等</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;element&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> map[str];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">deepCopy</span>(<span class="params">original</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> type = <span class="title function_">getType</span>(original);</span><br><span class="line">  <span class="keyword">let</span> copy;</span><br><span class="line">  <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;array&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">copyArray</span>(original, copy);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;object&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">copyObject</span>(original, copy);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;function&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">copyFunction</span>(original, copy);</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> original;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">copyArray</span>(<span class="params">original, copy = []</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> [index, value] <span class="keyword">of</span> original.<span class="title function_">entries</span>()) &#123;</span><br><span class="line">    copy[index] = <span class="title function_">deepCopy</span>(value);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> copy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">copyObject</span>(<span class="params">original, copy = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> [key, value] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(original)) &#123;</span><br><span class="line">    copy[key] = <span class="title function_">deepCopy</span>(value);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> copy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">copyFunction</span>(<span class="params">original, copy = () =&gt; &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> fn = <span class="built_in">eval</span>(original.<span class="title function_">toString</span>());</span><br><span class="line">  fn.<span class="property"><span class="keyword">prototype</span></span> = original.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">  <span class="keyword">return</span> fn;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> arr1 = [<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>], &#123; <span class="attr">i</span>: <span class="number">6</span>, <span class="attr">j</span>: <span class="number">6</span> &#125;, <span class="function">(<span class="params">k, m</span>) =&gt;</span> k + m];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">deepCopy</span>(arr1));</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
    <summary type="html">&lt;p&gt;在这里汇总一些 JS 常用技术的源码实现，通过源码了解其内部原理，可以加深对其的理解。&lt;/p&gt;</summary>
    
    
    
    <category term="JavaScript" scheme="https://kobingogo.github.io/categories/javascript/"/>
    
    
    <category term="JavaScript" scheme="https://kobingogo.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>前端如何学数据结构与算法 - 一篇讲完关于`堆`的一切</title>
    <link href="https://kobingogo.github.io/algorithms-heap-knowledge/"/>
    <id>https://kobingogo.github.io/algorithms-heap-knowledge/</id>
    <published>2020-02-17T07:01:41.000Z</published>
    <updated>2022-02-07T02:52:27.795Z</updated>
    
    <content type="html"><![CDATA[<p>对于前端来说，堆是一个不好理解的知识，但也是必不可少的知识点，是面试时经常考的重难点，本文是笔者自身学习<code>堆</code>的心得记录，意在能对<code>堆</code>有个更加系统的了解。</p><span id="more"></span><h3 id="一、什么是堆"><a href="#一、什么是堆" class="headerlink" title="一、什么是堆"></a>一、什么是堆</h3><p>在了解什么是堆前，需要先了解什么是<code>完全二叉树</code>。</p><ul><li>完全二叉树</li></ul><p>一种特殊的二叉树，叶子节点都在最底下两层，最后一层叶子节都靠左排列，并且除了最后一层，其他层的节点个数都要达到最大，这种二叉树叫做完全二叉树。<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfvcmzvjm4j31b00iijtq.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gfvcmzvjm4j31b00iijtq.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><ul><li>堆</li></ul><p>堆是一种特殊的完全二叉树，堆中每一个节点的值都必须大于等于（或小于等于）其子树中每个节点的值。<br>如果堆上的任意节点都大于等于子节点值，则称为 <code>大顶堆</code>;<br>如果堆上的任意节点都小于等于子节点值，则称为 <code>小顶堆</code>;<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfvcmzvjm4j31b00iijtq.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gfvcmzvjm4j31b00iijtq.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="二、堆的存储"><a href="#二、堆的存储" class="headerlink" title="二、堆的存储"></a>二、堆的存储</h3><p>完全二叉树可以用数组存储，如果一个节点存储在数组中的下标为 i（ i从1开始） ，那么它的左子节点的存储下标为 2 * i ，右子节点的下标为 2 * i + 1，反过来，下标 i / 2 位置存储的就是该节点的父节点。完全二叉树用数组来存储是最省内存的方式。</p><p>因为堆是一种特殊的完全二叉树，所以堆也适用于上面的存储方法。</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfvcv3i9l8j31b00iijtq.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gfvcv3i9l8j31b00iijtq.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="三、如何创建堆"><a href="#三、如何创建堆" class="headerlink" title="三、如何创建堆"></a>三、如何创建堆</h3><p>常用的创建堆方式有两种：</p><ul><li>插入式创建：每次插入一个节点，实现一个大顶堆（或小顶堆）</li><li>原地创建：又称堆化，给定一组节点，实现一个大顶堆（或小顶堆）</li></ul><p>下面都已创建大顶堆为例。</p><h4 id="3-1-插入式建堆"><a href="#3-1-插入式建堆" class="headerlink" title="3.1 插入式建堆"></a>3.1 插入式建堆</h4><p>步骤：</p><ol><li>将元素插入到队尾；</li><li>将插入节点与其父节点比较，如果插入节点大于父节点（对于大顶堆）或插入节点小于父节点（对于小顶堆），则插入节点与父节点调换位置。</li><li>如果需要调换位置，则调换后继续第2步向上比较，直到达到根节点，或者不需要调换为止。</li></ol><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfvd2cpts0j313s0u0416.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gfvd2cpts0j313s0u0416.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>实现代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//插入式建堆</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MaxHeap</span>(<span class="params">params</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> heaps = [,]; <span class="comment">//初始化一个堆，从1开始</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">insert</span> = <span class="keyword">function</span> (<span class="params">value</span>) &#123;</span><br><span class="line">    heaps.<span class="title function_">push</span>(value);</span><br><span class="line">    <span class="keyword">let</span> i = heaps.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="title class_">Math</span>.<span class="title function_">floor</span>(i / <span class="number">2</span>) &gt; <span class="number">0</span> &amp;&amp; heaps[i] &gt; heaps[<span class="title class_">Math</span>.<span class="title function_">floor</span>(i / <span class="number">2</span>)]) &#123;</span><br><span class="line">      [heaps[i], heaps[<span class="title class_">Math</span>.<span class="title function_">floor</span>(i / <span class="number">2</span>)]] = [</span><br><span class="line">        heaps[<span class="title class_">Math</span>.<span class="title function_">floor</span>(i / <span class="number">2</span>)],</span><br><span class="line">        heaps[i],</span><br><span class="line">      ]; <span class="comment">// 交换</span></span><br><span class="line">      i = <span class="title class_">Math</span>.<span class="title function_">floor</span>(i / <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">get</span> = <span class="keyword">function</span> (<span class="params">params</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> heaps</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> maxHeap = <span class="keyword">new</span> <span class="title class_">MaxHeap</span>();</span><br><span class="line">maxHeap.<span class="title function_">insert</span>(<span class="number">3</span>);</span><br><span class="line">maxHeap.<span class="title function_">insert</span>(<span class="number">5</span>);</span><br><span class="line">maxHeap.<span class="title function_">insert</span>(<span class="number">1</span>);</span><br><span class="line">maxHeap.<span class="title function_">insert</span>(<span class="number">2</span>);</span><br><span class="line">maxHeap.<span class="title function_">insert</span>(<span class="number">3</span>);</span><br><span class="line">maxHeap.<span class="title function_">insert</span>(<span class="number">4</span>);</span><br><span class="line"><span class="keyword">let</span> result = maxHeap.<span class="title function_">get</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line"><span class="comment">// =&gt; [empty, 5, 3, 4, 2, 3, 1]</span></span><br></pre></td></tr></table></figure><h4 id="3-2-原地建堆"><a href="#3-2-原地建堆" class="headerlink" title="3.2 原地建堆"></a>3.2 原地建堆</h4><p>原地建堆有两种思路：</p><ul><li>自下而上式堆化 ：将节点与其父节点比较，如果节点大于父节点（大顶堆）或节点小于父节点（小顶堆），则节点与父节点调整位置</li><li>自上往下式堆化 ：将节点与其左右子节点比较，如果存在左右子节点大于该节点（大顶堆）或小于该节点（小顶堆），则将子节点的最大值（大顶堆）或最小值（小顶堆）与之交换</li></ul><p>自下而上式堆是调整节点与父节点（往上走），自上往下式堆化是调整节点与其左右子节点（往下走）。</p><h5 id="3-2-1-从前往后、自下而上式堆化建堆。"><a href="#3-2-1-从前往后、自下而上式堆化建堆。" class="headerlink" title="3.2.1. 从前往后、自下而上式堆化建堆。"></a>3.2.1. 从前往后、自下而上式堆化建堆。</h5><p>假设有个序列：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [,<span class="number">4</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>];</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfvek9jr3cj30pd0g0jv2.jpg" class="lazyload" data-srcset="https://tva1.sinaimg.cn/large/007S8ZIlly1gfvek9jr3cj30pd0g0jv2.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>实现代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">buildHeap</span>(<span class="params">items, heapSize = <span class="number">1</span></span>) &#123;</span><br><span class="line">  <span class="keyword">while</span> (heapSize &lt; items.<span class="property">length</span> - <span class="number">1</span>) &#123;</span><br><span class="line">    heapSize++;</span><br><span class="line">    <span class="title function_">heapify</span>(items, heapSize);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">heapify</span>(<span class="params">items, i</span>) &#123;</span><br><span class="line">  <span class="keyword">while</span> (<span class="title class_">Math</span>.<span class="title function_">floor</span>(i / <span class="number">2</span>) &gt; <span class="number">0</span> &amp;&amp; items[i] &gt; items[<span class="title class_">Math</span>.<span class="title function_">floor</span>(i / <span class="number">2</span>)]) &#123;</span><br><span class="line">    [items[i], items[<span class="title class_">Math</span>.<span class="title function_">floor</span>(i / <span class="number">2</span>)]] = [items[<span class="title class_">Math</span>.<span class="title function_">floor</span>(i / <span class="number">2</span>)], items[i]]; <span class="comment">//利用解构方式交换元素</span></span><br><span class="line">    i = <span class="title class_">Math</span>.<span class="title function_">floor</span>(i / <span class="number">2</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> arr = [, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line"><span class="title function_">buildHeap</span>(arr);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// =&gt; [ empty, 6, 4, 5, 2, 3, 1 ]</span></span><br></pre></td></tr></table></figure><h5 id="3-2-2-从后往前、自上而下式堆化建堆"><a href="#3-2-2-从后往前、自上而下式堆化建堆" class="headerlink" title="3.2.2. 从后往前、自上而下式堆化建堆"></a>3.2.2. 从后往前、自上而下式堆化建堆</h5><p>因为叶子节点没有子节点，不需要自上而下式堆化，所以从后往前是从序列的最后一个非叶子节点开始（即 n/2）。</p><p>假设有个序列：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [,<span class="number">4</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>];</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20200629110822.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/jiangawait/CDN/images/20200629110822.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="20200629110822"></p><p>实现代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">buildHeap</span>(<span class="params">items</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> heapSize = items.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line">  <span class="comment">// 从最后一个非叶子节点开始遍历</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="title class_">Math</span>.<span class="title function_">floor</span>(heapSize / <span class="number">2</span>); i &gt;= <span class="number">1</span>; i--) &#123;</span><br><span class="line">    <span class="title function_">heapify</span>(items, heapSize, i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">heapify</span>(<span class="params">items, heapSize, i</span>) &#123;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> maxIndex = i; <span class="comment">// 用maxIndex表示 i 的最大子节点的下标</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">2</span> * i &lt;= heapSize &amp;&amp; items[i] &lt; items[<span class="number">2</span> * i]) &#123;</span><br><span class="line">      maxIndex = <span class="number">2</span> * i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">2</span> * i + <span class="number">1</span> &lt;= heapSize &amp;&amp; items[maxIndex] &lt; items[<span class="number">2</span> * i + <span class="number">1</span>]) &#123;</span><br><span class="line">      maxIndex = <span class="number">2</span> * i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (maxIndex === i) <span class="keyword">break</span>;</span><br><span class="line">    [items[maxIndex], items[i]] = [items[i], items[maxIndex]]; <span class="comment">//交换 i 与其最大的子节点</span></span><br><span class="line">    i = maxIndex;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr = [, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line"><span class="title function_">buildHeap</span>(arr);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// =&gt; [ empty, 6, 5, 4, 3, 2, 1 ]</span></span><br></pre></td></tr></table></figure><h3 id="四、堆排序"><a href="#四、堆排序" class="headerlink" title="四、堆排序"></a>四、堆排序</h3><p>由于大顶堆的堆顶点（i=1）存放的是最大值，所以可以每次让堆顶与最后一个节点交换数据，此时最大值放入了有效序列的最后一位，并且有效序列减1，有效堆依然保持完全二叉树的结构，然后堆化，成为新的大顶堆，重复此操作，直到有效堆的长度为 0，排序完成。</p><p>详细步骤：</p><ol><li>将原序列转化成一个大顶堆；</li><li>设置堆的有效序列长度为 heapSize；</li><li>将堆顶元素与最后一个子元素（最后一个有效序列）交换，并有效序列长度减1；</li><li>堆化有效序列，使有效序列重新称为一个大顶堆；</li><li>重复以上2、3步，直到有效序列的长度为 1，排序完成；</li></ol><p>实现代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">heapSort</span>(<span class="params">items</span>) &#123;</span><br><span class="line">  <span class="comment">// 设置堆的初始有效序列长度为 items.length - 1</span></span><br><span class="line">  <span class="keyword">let</span> heapSize = items.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line">  <span class="comment">// 构建大顶堆</span></span><br><span class="line">  <span class="title function_">buildHeap</span>(items, heapSize);</span><br><span class="line">  <span class="keyword">while</span> (heapSize &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">// 交换堆顶元素与最后一个有效子元素</span></span><br><span class="line">    [items[<span class="number">1</span>], items[heapSize]] = [items[heapSize], items[<span class="number">1</span>]];</span><br><span class="line">    <span class="comment">// 有效序列长度减 1</span></span><br><span class="line">    heapSize--;</span><br><span class="line">    <span class="title function_">heapify</span>(items, heapSize, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> items;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 原地建堆: 自上而下建堆，</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">原始序列</span>&#125; <span class="variable">items</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">有效序列长度</span>&#125; <span class="variable">heapSize</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">buildHeap</span>(<span class="params">items, heapSize</span>) &#123;</span><br><span class="line">  <span class="comment">// 从最后一个非叶子节点开始，自上而下式堆化</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="title class_">Math</span>.<span class="title function_">floor</span>(heapSize / <span class="number">2</span>); i &gt;= <span class="number">1</span>; --i) &#123;</span><br><span class="line">    <span class="title function_">heapify</span>(items, heapSize, i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这里不适合用自下而上方式，因为交换过后，有效序列里唯一没有堆化的是堆顶元素，</span></span><br><span class="line"><span class="comment"> * 所以直接从堆顶开始自上而下堆化是最快的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">heapify</span>(<span class="params">items, heapSize, i</span>) &#123;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> maxIndex = i; <span class="comment">// 用maxIndex表示 i 的最大子节点的下标</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">2</span> * i &lt;= heapSize &amp;&amp; items[i] &lt; items[<span class="number">2</span> * i]) &#123;</span><br><span class="line">      maxIndex = <span class="number">2</span> * i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">2</span> * i + <span class="number">1</span> &lt;= heapSize &amp;&amp; items[maxIndex] &lt; items[<span class="number">2</span> * i + <span class="number">1</span>]) &#123;</span><br><span class="line">      maxIndex = <span class="number">2</span> * i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (maxIndex === i) <span class="keyword">break</span>;</span><br><span class="line">    [items[maxIndex], items[i]] = [items[i], items[maxIndex]]; <span class="comment">//交换 i 与其最大的子节点</span></span><br><span class="line">    i = maxIndex;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">var</span> items = [, <span class="number">8</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">5</span>]</span><br><span class="line"><span class="title function_">heapSort</span>(items)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(items);</span><br><span class="line"></span><br><span class="line"><span class="comment">// =&gt; [ empty, 1, 2, 3, 4, 5, 6, 7, 8, 9 ]</span></span><br></pre></td></tr></table></figure><p>复杂度分析：</p><ul><li>时间复杂度： <code>建堆</code> - O(nlogn),  <code>排序</code> - O(nlogn), <code>整体</code> - O(nlogn);</li><li>空间复杂度： O(1);</li></ul><h3 id="堆的典型应用场景：-Top-K-问题"><a href="#堆的典型应用场景：-Top-K-问题" class="headerlink" title="堆的典型应用场景： Top K 问题"></a>堆的典型应用场景： Top K 问题</h3><blockquote><p>什么是 Top K 问题？简单来说就是在一组数据里面找到频率出现最高的前K个数，或前K大（或前K小）的数。</p></blockquote><p>下面以取前K大为例来讲解：</p><ol><li>从数组中取前 K 个数，构造成小顶堆；</li><li>从 K+1 位开始遍历数组，每一个数据都和小顶堆的堆顶元素进行比较，如果小于堆顶元素，则不做任何处理，继续遍历下一元素；如果大于堆顶元素，则将这个元素替换掉堆顶元素，然后再堆化成一个小顶堆。</li><li>遍历完成后，堆中的数据就是前 K 大的数据；</li></ol><p>实现代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">findKthLargest</span>(<span class="params">nums, k</span>) &#123;</span><br><span class="line">  nums.<span class="title function_">splice</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="literal">null</span>);</span><br><span class="line">  <span class="title function_">buildHeap</span>(nums, k);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = k + <span class="number">1</span>; i &lt; nums.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nums[i] &gt; nums[<span class="number">1</span>]) &#123;</span><br><span class="line">      nums[<span class="number">1</span>] = nums[i];</span><br><span class="line">      <span class="title function_">heapify</span>(nums, k, <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> nums[<span class="number">1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 原地建堆: 自上而下建堆，</span></span><br><span class="line"><span class="comment"> * 这里不适合用自下而上方式，因为交换过后，有效序列里唯一没有堆化的是堆顶元素，</span></span><br><span class="line"><span class="comment"> * 所以直接从堆顶开始自上而下堆化是最快的</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">原始序列</span>&#125; <span class="variable">items</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">有效序列长度</span>&#125; <span class="variable">heapSize</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">buildHeap</span>(<span class="params">items, heapSize</span>) &#123;</span><br><span class="line">  <span class="comment">// 从最后一个非叶子节点开始，自上而下式堆化</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="title class_">Math</span>.<span class="title function_">floor</span>(heapSize / <span class="number">2</span>); i &gt;= <span class="number">1</span>; --i) &#123;</span><br><span class="line">    <span class="title function_">heapify</span>(items, heapSize, i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">heapify</span>(<span class="params">items, heapSize, i</span>) &#123;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> minIndex = i; <span class="comment">// 用minIndex表示 i 的最小子节点的下标</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">2</span> * i &lt;= heapSize &amp;&amp; items[i] &gt; items[<span class="number">2</span> * i]) &#123;</span><br><span class="line">      minIndex = <span class="number">2</span> * i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">2</span> * i + <span class="number">1</span> &lt;= heapSize &amp;&amp; items[minIndex] &gt; items[<span class="number">2</span> * i + <span class="number">1</span>]) &#123;</span><br><span class="line">      minIndex = <span class="number">2</span> * i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (minIndex === i) <span class="keyword">break</span>;</span><br><span class="line">    [items[minIndex], items[i]] = [items[i], items[minIndex]]; <span class="comment">//交换</span></span><br><span class="line">    i = minIndex;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">var</span> nums = [<span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line"><span class="keyword">let</span> kth = <span class="title function_">findKthLargest</span>(nums, <span class="number">2</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(kth);</span><br></pre></td></tr></table></figure><p>复杂度分析：</p><ul><li>时间复杂度：遍历数组需要 O(n) 的时间复杂度，一次堆化需要 O(logk) 时间复杂度，所以利用堆求 Top k 问题的时间复杂度为 O(nlogk)</li><li>空间复杂度：O(k)</li></ul><p>当然，topK的最简单实现是用排序，但是用堆方式的话，最大好处就是求<code>动态数组</code>的topK。如果用排序方式的话，每次进来一个新元素都得重新排序，这是非常不可取的，而堆方式可以有效处理这个问题。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;对于前端来说，堆是一个不好理解的知识，但也是必不可少的知识点，是面试时经常考的重难点，本文是笔者自身学习&lt;code&gt;堆&lt;/code&gt;的心得记录，意在能对&lt;code&gt;堆&lt;/code&gt;有个更加系统的了解。&lt;/p&gt;</summary>
    
    
    
    <category term="数据结构与算法" scheme="https://kobingogo.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="堆" scheme="https://kobingogo.github.io/tags/%E5%A0%86/"/>
    
  </entry>
  
</feed>
